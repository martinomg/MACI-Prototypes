import e,{promisify as t}from"util";import n,{Readable as r,Writable as i,Transform as s,PassThrough as a,pipeline as o}from"stream";import c,{sep as l,join as u}from"path";import d,{Agent as p,request as h}from"http";import m,{Agent as f,request as g}from"https";import y,{parse as v}from"url";import b,{promises as w,lstatSync as _,fstatSync as x,readFileSync as E}from"fs";import S,{createHash as k,createHmac as A}from"crypto";import O from"assert";import C from"tty";import I,{homedir as T,platform as P,release as R}from"os";import j from"zlib";import{EventEmitter as N}from"events";import{Buffer as $}from"buffer";import"node:stream";import L,{constants as D}from"http2";import U from"node:fs";import M from"fs/promises";import{exec as F}from"child_process";import{versions as z,env as B}from"process";function q(e,t){return function(){return e.apply(t,arguments)}}const{toString:W}=Object.prototype,{getPrototypeOf:H}=Object,{iterator:K,toStringTag:G}=Symbol,V=(e=>t=>{const n=W.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Z=e=>(e=e.toLowerCase(),t=>V(t)===e),J=e=>t=>typeof t===e,{isArray:Y}=Array,X=J("undefined");function Q(e){return null!==e&&!X(e)&&null!==e.constructor&&!X(e.constructor)&&ne(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const ee=Z("ArrayBuffer");const te=J("string"),ne=J("function"),re=J("number"),ie=e=>null!==e&&"object"==typeof e,se=e=>{if("object"!==V(e))return!1;const t=H(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||G in e||K in e)},ae=Z("Date"),oe=Z("File"),ce=Z("Blob"),le=Z("FileList"),ue=Z("URLSearchParams"),[de,pe,he,me]=["ReadableStream","Request","Response","Headers"].map(Z);function fe(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let r,i;if("object"!=typeof e&&(e=[e]),Y(e))for(r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else{if(Q(e))return;const i=n?Object.getOwnPropertyNames(e):Object.keys(e),s=i.length;let a;for(r=0;r<s;r++)a=i[r],t.call(null,e[a],a,e)}}function ge(e,t){if(Q(e))return null;t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const ye="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,ve=e=>!X(e)&&e!==ye;const be=(e=>t=>e&&t instanceof e)("undefined"!=typeof Uint8Array&&H(Uint8Array)),we=Z("HTMLFormElement"),_e=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),xe=Z("RegExp"),Ee=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};fe(n,(n,i)=>{let s;!1!==(s=t(n,i,e))&&(r[i]=s||n)}),Object.defineProperties(e,r)};const Se=Z("AsyncFunction"),ke=(Ae="function"==typeof setImmediate,Oe=ne(ye.postMessage),Ae?setImmediate:Oe?(Ce=`axios@${Math.random()}`,Ie=[],ye.addEventListener("message",({source:e,data:t})=>{e===ye&&t===Ce&&Ie.length&&Ie.shift()()},!1),e=>{Ie.push(e),ye.postMessage(Ce,"*")}):e=>setTimeout(e));var Ae,Oe,Ce,Ie;const Te="undefined"!=typeof queueMicrotask?queueMicrotask.bind(ye):"undefined"!=typeof process&&process.nextTick||ke;var Pe={isArray:Y,isArrayBuffer:ee,isBuffer:Q,isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||ne(e.append)&&("formdata"===(t=V(e))||"object"===t&&ne(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&ee(e.buffer),t},isString:te,isNumber:re,isBoolean:e=>!0===e||!1===e,isObject:ie,isPlainObject:se,isEmptyObject:e=>{if(!ie(e)||Q(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(e){return!1}},isReadableStream:de,isRequest:pe,isResponse:he,isHeaders:me,isUndefined:X,isDate:ae,isFile:oe,isBlob:ce,isRegExp:xe,isFunction:ne,isStream:e=>ie(e)&&ne(e.pipe),isURLSearchParams:ue,isTypedArray:be,isFileList:le,forEach:fe,merge:function e(){const{caseless:t}=ve(this)&&this||{},n={},r=(r,i)=>{const s=t&&ge(n,i)||i;se(n[s])&&se(r)?n[s]=e(n[s],r):se(r)?n[s]=e({},r):Y(r)?n[s]=r.slice():n[s]=r};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&fe(arguments[e],r);return n},extend:(e,t,n,{allOwnKeys:r}={})=>(fe(t,(t,r)=>{n&&ne(t)?e[r]=q(t,n):e[r]=t},{allOwnKeys:r}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,s,a;const o={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)a=i[s],r&&!r(a,e,t)||o[a]||(t[a]=e[a],o[a]=!0);e=!1!==n&&H(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:V,kindOfTest:Z,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(Y(e))return e;let t=e.length;if(!re(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[K]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:we,hasOwnProperty:_e,hasOwnProp:_e,reduceDescriptors:Ee,freezeMethods:e=>{Ee(e,(t,n)=>{if(ne(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];ne(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach(e=>{n[e]=!0})};return Y(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:ge,global:ye,isContextDefined:ve,isSpecCompliantForm:function(e){return!!(e&&ne(e.append)&&"FormData"===e[G]&&e[K])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(ie(e)){if(t.indexOf(e)>=0)return;if(Q(e))return e;if(!("toJSON"in e)){t[r]=e;const i=Y(e)?[]:{};return fe(e,(e,t)=>{const s=n(e,r+1);!X(s)&&(i[t]=s)}),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:Se,isThenable:e=>e&&(ie(e)||ne(e))&&ne(e.then)&&ne(e.catch),setImmediate:ke,asap:Te,isIterable:e=>null!=e&&ne(e[K])};function Re(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}Pe.inherits(Re,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Pe.toJSONObject(this.config),code:this.code,status:this.status}}});const je=Re.prototype,Ne={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Ne[e]={value:e}}),Object.defineProperties(Re,Ne),Object.defineProperty(je,"isAxiosError",{value:!0}),Re.from=(e,t,n,r,i,s)=>{const a=Object.create(je);return Pe.toFlatObject(e,a,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),Re.call(a,e.message,t,n,r,i),a.cause=e,a.name=e.name,s&&Object.assign(a,s),a};var $e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Le(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var De=n.Stream,Ue=Me;function Me(){this.source=null,this.dataSize=0,this.maxDataSize=1048576,this.pauseStream=!0,this._maxDataSizeExceeded=!1,this._released=!1,this._bufferedEvents=[]}e.inherits(Me,De),Me.create=function(e,t){var n=new this;for(var r in t=t||{})n[r]=t[r];n.source=e;var i=e.emit;return e.emit=function(){return n._handleEmit(arguments),i.apply(e,arguments)},e.on("error",function(){}),n.pauseStream&&e.pause(),n},Object.defineProperty(Me.prototype,"readable",{configurable:!0,enumerable:!0,get:function(){return this.source.readable}}),Me.prototype.setEncoding=function(){return this.source.setEncoding.apply(this.source,arguments)},Me.prototype.resume=function(){this._released||this.release(),this.source.resume()},Me.prototype.pause=function(){this.source.pause()},Me.prototype.release=function(){this._released=!0,this._bufferedEvents.forEach(function(e){this.emit.apply(this,e)}.bind(this)),this._bufferedEvents=[]},Me.prototype.pipe=function(){var e=De.prototype.pipe.apply(this,arguments);return this.resume(),e},Me.prototype._handleEmit=function(e){this._released?this.emit.apply(this,e):("data"===e[0]&&(this.dataSize+=e[1].length,this._checkIfMaxDataSizeExceeded()),this._bufferedEvents.push(e))},Me.prototype._checkIfMaxDataSizeExceeded=function(){if(!(this._maxDataSizeExceeded||this.dataSize<=this.maxDataSize)){this._maxDataSizeExceeded=!0;var e="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this.emit("error",new Error(e))}};var Fe=e,ze=n.Stream,Be=Ue,qe=We;function We(){this.writable=!1,this.readable=!0,this.dataSize=0,this.maxDataSize=2097152,this.pauseStreams=!0,this._released=!1,this._streams=[],this._currentStream=null,this._insideLoop=!1,this._pendingNext=!1}Fe.inherits(We,ze),We.create=function(e){var t=new this;for(var n in e=e||{})t[n]=e[n];return t},We.isStreamLike=function(e){return"function"!=typeof e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e&&!Buffer.isBuffer(e)},We.prototype.append=function(e){if(We.isStreamLike(e)){if(!(e instanceof Be)){var t=Be.create(e,{maxDataSize:1/0,pauseStream:this.pauseStreams});e.on("data",this._checkDataSize.bind(this)),e=t}this._handleErrors(e),this.pauseStreams&&e.pause()}return this._streams.push(e),this},We.prototype.pipe=function(e,t){return ze.prototype.pipe.call(this,e,t),this.resume(),e},We.prototype._getNext=function(){if(this._currentStream=null,this._insideLoop)this._pendingNext=!0;else{this._insideLoop=!0;try{do{this._pendingNext=!1,this._realGetNext()}while(this._pendingNext)}finally{this._insideLoop=!1}}},We.prototype._realGetNext=function(){var e=this._streams.shift();void 0!==e?"function"==typeof e?e(function(e){We.isStreamLike(e)&&(e.on("data",this._checkDataSize.bind(this)),this._handleErrors(e)),this._pipeNext(e)}.bind(this)):this._pipeNext(e):this.end()},We.prototype._pipeNext=function(e){if(this._currentStream=e,We.isStreamLike(e))return e.on("end",this._getNext.bind(this)),void e.pipe(this,{end:!1});var t=e;this.write(t),this._getNext()},We.prototype._handleErrors=function(e){var t=this;e.on("error",function(e){t._emitError(e)})},We.prototype.write=function(e){this.emit("data",e)},We.prototype.pause=function(){this.pauseStreams&&(this.pauseStreams&&this._currentStream&&"function"==typeof this._currentStream.pause&&this._currentStream.pause(),this.emit("pause"))},We.prototype.resume=function(){this._released||(this._released=!0,this.writable=!0,this._getNext()),this.pauseStreams&&this._currentStream&&"function"==typeof this._currentStream.resume&&this._currentStream.resume(),this.emit("resume")},We.prototype.end=function(){this._reset(),this.emit("end")},We.prototype.destroy=function(){this._reset(),this.emit("close")},We.prototype._reset=function(){this.writable=!1,this._streams=[],this._currentStream=null},We.prototype._checkDataSize=function(){if(this._updateDataSize(),!(this.dataSize<=this.maxDataSize)){var e="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this._emitError(new Error(e))}},We.prototype._updateDataSize=function(){this.dataSize=0;var e=this;this._streams.forEach(function(t){t.dataSize&&(e.dataSize+=t.dataSize)}),this._currentStream&&this._currentStream.dataSize&&(this.dataSize+=this._currentStream.dataSize)},We.prototype._emitError=function(e){this._reset(),this.emit("error",e)};var He={},Ke={"application/1d-interleaved-parityfec":{source:"iana"},"application/3gpdash-qoe-report+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/3gpp-ims+xml":{source:"iana",compressible:!0},"application/3gpphal+json":{source:"iana",compressible:!0},"application/3gpphalforms+json":{source:"iana",compressible:!0},"application/a2l":{source:"iana"},"application/ace+cbor":{source:"iana"},"application/activemessage":{source:"iana"},"application/activity+json":{source:"iana",compressible:!0},"application/alto-costmap+json":{source:"iana",compressible:!0},"application/alto-costmapfilter+json":{source:"iana",compressible:!0},"application/alto-directory+json":{source:"iana",compressible:!0},"application/alto-endpointcost+json":{source:"iana",compressible:!0},"application/alto-endpointcostparams+json":{source:"iana",compressible:!0},"application/alto-endpointprop+json":{source:"iana",compressible:!0},"application/alto-endpointpropparams+json":{source:"iana",compressible:!0},"application/alto-error+json":{source:"iana",compressible:!0},"application/alto-networkmap+json":{source:"iana",compressible:!0},"application/alto-networkmapfilter+json":{source:"iana",compressible:!0},"application/alto-updatestreamcontrol+json":{source:"iana",compressible:!0},"application/alto-updatestreamparams+json":{source:"iana",compressible:!0},"application/aml":{source:"iana"},"application/andrew-inset":{source:"iana",extensions:["ez"]},"application/applefile":{source:"iana"},"application/applixware":{source:"apache",extensions:["aw"]},"application/at+jwt":{source:"iana"},"application/atf":{source:"iana"},"application/atfx":{source:"iana"},"application/atom+xml":{source:"iana",compressible:!0,extensions:["atom"]},"application/atomcat+xml":{source:"iana",compressible:!0,extensions:["atomcat"]},"application/atomdeleted+xml":{source:"iana",compressible:!0,extensions:["atomdeleted"]},"application/atomicmail":{source:"iana"},"application/atomsvc+xml":{source:"iana",compressible:!0,extensions:["atomsvc"]},"application/atsc-dwd+xml":{source:"iana",compressible:!0,extensions:["dwd"]},"application/atsc-dynamic-event-message":{source:"iana"},"application/atsc-held+xml":{source:"iana",compressible:!0,extensions:["held"]},"application/atsc-rdt+json":{source:"iana",compressible:!0},"application/atsc-rsat+xml":{source:"iana",compressible:!0,extensions:["rsat"]},"application/atxml":{source:"iana"},"application/auth-policy+xml":{source:"iana",compressible:!0},"application/bacnet-xdd+zip":{source:"iana",compressible:!1},"application/batch-smtp":{source:"iana"},"application/bdoc":{compressible:!1,extensions:["bdoc"]},"application/beep+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/calendar+json":{source:"iana",compressible:!0},"application/calendar+xml":{source:"iana",compressible:!0,extensions:["xcs"]},"application/call-completion":{source:"iana"},"application/cals-1840":{source:"iana"},"application/captive+json":{source:"iana",compressible:!0},"application/cbor":{source:"iana"},"application/cbor-seq":{source:"iana"},"application/cccex":{source:"iana"},"application/ccmp+xml":{source:"iana",compressible:!0},"application/ccxml+xml":{source:"iana",compressible:!0,extensions:["ccxml"]},"application/cdfx+xml":{source:"iana",compressible:!0,extensions:["cdfx"]},"application/cdmi-capability":{source:"iana",extensions:["cdmia"]},"application/cdmi-container":{source:"iana",extensions:["cdmic"]},"application/cdmi-domain":{source:"iana",extensions:["cdmid"]},"application/cdmi-object":{source:"iana",extensions:["cdmio"]},"application/cdmi-queue":{source:"iana",extensions:["cdmiq"]},"application/cdni":{source:"iana"},"application/cea":{source:"iana"},"application/cea-2018+xml":{source:"iana",compressible:!0},"application/cellml+xml":{source:"iana",compressible:!0},"application/cfw":{source:"iana"},"application/city+json":{source:"iana",compressible:!0},"application/clr":{source:"iana"},"application/clue+xml":{source:"iana",compressible:!0},"application/clue_info+xml":{source:"iana",compressible:!0},"application/cms":{source:"iana"},"application/cnrp+xml":{source:"iana",compressible:!0},"application/coap-group+json":{source:"iana",compressible:!0},"application/coap-payload":{source:"iana"},"application/commonground":{source:"iana"},"application/conference-info+xml":{source:"iana",compressible:!0},"application/cose":{source:"iana"},"application/cose-key":{source:"iana"},"application/cose-key-set":{source:"iana"},"application/cpl+xml":{source:"iana",compressible:!0,extensions:["cpl"]},"application/csrattrs":{source:"iana"},"application/csta+xml":{source:"iana",compressible:!0},"application/cstadata+xml":{source:"iana",compressible:!0},"application/csvm+json":{source:"iana",compressible:!0},"application/cu-seeme":{source:"apache",extensions:["cu"]},"application/cwt":{source:"iana"},"application/cybercash":{source:"iana"},"application/dart":{compressible:!0},"application/dash+xml":{source:"iana",compressible:!0,extensions:["mpd"]},"application/dash-patch+xml":{source:"iana",compressible:!0,extensions:["mpp"]},"application/dashdelta":{source:"iana"},"application/davmount+xml":{source:"iana",compressible:!0,extensions:["davmount"]},"application/dca-rft":{source:"iana"},"application/dcd":{source:"iana"},"application/dec-dx":{source:"iana"},"application/dialog-info+xml":{source:"iana",compressible:!0},"application/dicom":{source:"iana"},"application/dicom+json":{source:"iana",compressible:!0},"application/dicom+xml":{source:"iana",compressible:!0},"application/dii":{source:"iana"},"application/dit":{source:"iana"},"application/dns":{source:"iana"},"application/dns+json":{source:"iana",compressible:!0},"application/dns-message":{source:"iana"},"application/docbook+xml":{source:"apache",compressible:!0,extensions:["dbk"]},"application/dots+cbor":{source:"iana"},"application/dskpp+xml":{source:"iana",compressible:!0},"application/dssc+der":{source:"iana",extensions:["dssc"]},"application/dssc+xml":{source:"iana",compressible:!0,extensions:["xdssc"]},"application/dvcs":{source:"iana"},"application/ecmascript":{source:"iana",compressible:!0,extensions:["es","ecma"]},"application/edi-consent":{source:"iana"},"application/edi-x12":{source:"iana",compressible:!1},"application/edifact":{source:"iana",compressible:!1},"application/efi":{source:"iana"},"application/elm+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/elm+xml":{source:"iana",compressible:!0},"application/emergencycalldata.cap+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/emergencycalldata.comment+xml":{source:"iana",compressible:!0},"application/emergencycalldata.control+xml":{source:"iana",compressible:!0},"application/emergencycalldata.deviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.ecall.msd":{source:"iana"},"application/emergencycalldata.providerinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.serviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.subscriberinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.veds+xml":{source:"iana",compressible:!0},"application/emma+xml":{source:"iana",compressible:!0,extensions:["emma"]},"application/emotionml+xml":{source:"iana",compressible:!0,extensions:["emotionml"]},"application/encaprtp":{source:"iana"},"application/epp+xml":{source:"iana",compressible:!0},"application/epub+zip":{source:"iana",compressible:!1,extensions:["epub"]},"application/eshop":{source:"iana"},"application/exi":{source:"iana",extensions:["exi"]},"application/expect-ct-report+json":{source:"iana",compressible:!0},"application/express":{source:"iana",extensions:["exp"]},"application/fastinfoset":{source:"iana"},"application/fastsoap":{source:"iana"},"application/fdt+xml":{source:"iana",compressible:!0,extensions:["fdt"]},"application/fhir+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/fhir+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/fido.trusted-apps+json":{compressible:!0},"application/fits":{source:"iana"},"application/flexfec":{source:"iana"},"application/font-sfnt":{source:"iana"},"application/font-tdpfr":{source:"iana",extensions:["pfr"]},"application/font-woff":{source:"iana",compressible:!1},"application/framework-attributes+xml":{source:"iana",compressible:!0},"application/geo+json":{source:"iana",compressible:!0,extensions:["geojson"]},"application/geo+json-seq":{source:"iana"},"application/geopackage+sqlite3":{source:"iana"},"application/geoxacml+xml":{source:"iana",compressible:!0},"application/gltf-buffer":{source:"iana"},"application/gml+xml":{source:"iana",compressible:!0,extensions:["gml"]},"application/gpx+xml":{source:"apache",compressible:!0,extensions:["gpx"]},"application/gxf":{source:"apache",extensions:["gxf"]},"application/gzip":{source:"iana",compressible:!1,extensions:["gz"]},"application/h224":{source:"iana"},"application/held+xml":{source:"iana",compressible:!0},"application/hjson":{extensions:["hjson"]},"application/http":{source:"iana"},"application/hyperstudio":{source:"iana",extensions:["stk"]},"application/ibe-key-request+xml":{source:"iana",compressible:!0},"application/ibe-pkg-reply+xml":{source:"iana",compressible:!0},"application/ibe-pp-data":{source:"iana"},"application/iges":{source:"iana"},"application/im-iscomposing+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/index":{source:"iana"},"application/index.cmd":{source:"iana"},"application/index.obj":{source:"iana"},"application/index.response":{source:"iana"},"application/index.vnd":{source:"iana"},"application/inkml+xml":{source:"iana",compressible:!0,extensions:["ink","inkml"]},"application/iotp":{source:"iana"},"application/ipfix":{source:"iana",extensions:["ipfix"]},"application/ipp":{source:"iana"},"application/isup":{source:"iana"},"application/its+xml":{source:"iana",compressible:!0,extensions:["its"]},"application/java-archive":{source:"apache",compressible:!1,extensions:["jar","war","ear"]},"application/java-serialized-object":{source:"apache",compressible:!1,extensions:["ser"]},"application/java-vm":{source:"apache",compressible:!1,extensions:["class"]},"application/javascript":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["js","mjs"]},"application/jf2feed+json":{source:"iana",compressible:!0},"application/jose":{source:"iana"},"application/jose+json":{source:"iana",compressible:!0},"application/jrd+json":{source:"iana",compressible:!0},"application/jscalendar+json":{source:"iana",compressible:!0},"application/json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["json","map"]},"application/json-patch+json":{source:"iana",compressible:!0},"application/json-seq":{source:"iana"},"application/json5":{extensions:["json5"]},"application/jsonml+json":{source:"apache",compressible:!0,extensions:["jsonml"]},"application/jwk+json":{source:"iana",compressible:!0},"application/jwk-set+json":{source:"iana",compressible:!0},"application/jwt":{source:"iana"},"application/kpml-request+xml":{source:"iana",compressible:!0},"application/kpml-response+xml":{source:"iana",compressible:!0},"application/ld+json":{source:"iana",compressible:!0,extensions:["jsonld"]},"application/lgr+xml":{source:"iana",compressible:!0,extensions:["lgr"]},"application/link-format":{source:"iana"},"application/load-control+xml":{source:"iana",compressible:!0},"application/lost+xml":{source:"iana",compressible:!0,extensions:["lostxml"]},"application/lostsync+xml":{source:"iana",compressible:!0},"application/lpf+zip":{source:"iana",compressible:!1},"application/lxf":{source:"iana"},"application/mac-binhex40":{source:"iana",extensions:["hqx"]},"application/mac-compactpro":{source:"apache",extensions:["cpt"]},"application/macwriteii":{source:"iana"},"application/mads+xml":{source:"iana",compressible:!0,extensions:["mads"]},"application/manifest+json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["webmanifest"]},"application/marc":{source:"iana",extensions:["mrc"]},"application/marcxml+xml":{source:"iana",compressible:!0,extensions:["mrcx"]},"application/mathematica":{source:"iana",extensions:["ma","nb","mb"]},"application/mathml+xml":{source:"iana",compressible:!0,extensions:["mathml"]},"application/mathml-content+xml":{source:"iana",compressible:!0},"application/mathml-presentation+xml":{source:"iana",compressible:!0},"application/mbms-associated-procedure-description+xml":{source:"iana",compressible:!0},"application/mbms-deregister+xml":{source:"iana",compressible:!0},"application/mbms-envelope+xml":{source:"iana",compressible:!0},"application/mbms-msk+xml":{source:"iana",compressible:!0},"application/mbms-msk-response+xml":{source:"iana",compressible:!0},"application/mbms-protection-description+xml":{source:"iana",compressible:!0},"application/mbms-reception-report+xml":{source:"iana",compressible:!0},"application/mbms-register+xml":{source:"iana",compressible:!0},"application/mbms-register-response+xml":{source:"iana",compressible:!0},"application/mbms-schedule+xml":{source:"iana",compressible:!0},"application/mbms-user-service-description+xml":{source:"iana",compressible:!0},"application/mbox":{source:"iana",extensions:["mbox"]},"application/media-policy-dataset+xml":{source:"iana",compressible:!0,extensions:["mpf"]},"application/media_control+xml":{source:"iana",compressible:!0},"application/mediaservercontrol+xml":{source:"iana",compressible:!0,extensions:["mscml"]},"application/merge-patch+json":{source:"iana",compressible:!0},"application/metalink+xml":{source:"apache",compressible:!0,extensions:["metalink"]},"application/metalink4+xml":{source:"iana",compressible:!0,extensions:["meta4"]},"application/mets+xml":{source:"iana",compressible:!0,extensions:["mets"]},"application/mf4":{source:"iana"},"application/mikey":{source:"iana"},"application/mipc":{source:"iana"},"application/missing-blocks+cbor-seq":{source:"iana"},"application/mmt-aei+xml":{source:"iana",compressible:!0,extensions:["maei"]},"application/mmt-usd+xml":{source:"iana",compressible:!0,extensions:["musd"]},"application/mods+xml":{source:"iana",compressible:!0,extensions:["mods"]},"application/moss-keys":{source:"iana"},"application/moss-signature":{source:"iana"},"application/mosskey-data":{source:"iana"},"application/mosskey-request":{source:"iana"},"application/mp21":{source:"iana",extensions:["m21","mp21"]},"application/mp4":{source:"iana",extensions:["mp4s","m4p"]},"application/mpeg4-generic":{source:"iana"},"application/mpeg4-iod":{source:"iana"},"application/mpeg4-iod-xmt":{source:"iana"},"application/mrb-consumer+xml":{source:"iana",compressible:!0},"application/mrb-publish+xml":{source:"iana",compressible:!0},"application/msc-ivr+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msc-mixer+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msword":{source:"iana",compressible:!1,extensions:["doc","dot"]},"application/mud+json":{source:"iana",compressible:!0},"application/multipart-core":{source:"iana"},"application/mxf":{source:"iana",extensions:["mxf"]},"application/n-quads":{source:"iana",extensions:["nq"]},"application/n-triples":{source:"iana",extensions:["nt"]},"application/nasdata":{source:"iana"},"application/news-checkgroups":{source:"iana",charset:"US-ASCII"},"application/news-groupinfo":{source:"iana",charset:"US-ASCII"},"application/news-transmission":{source:"iana"},"application/nlsml+xml":{source:"iana",compressible:!0},"application/node":{source:"iana",extensions:["cjs"]},"application/nss":{source:"iana"},"application/oauth-authz-req+jwt":{source:"iana"},"application/oblivious-dns-message":{source:"iana"},"application/ocsp-request":{source:"iana"},"application/ocsp-response":{source:"iana"},"application/octet-stream":{source:"iana",compressible:!1,extensions:["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"]},"application/oda":{source:"iana",extensions:["oda"]},"application/odm+xml":{source:"iana",compressible:!0},"application/odx":{source:"iana"},"application/oebps-package+xml":{source:"iana",compressible:!0,extensions:["opf"]},"application/ogg":{source:"iana",compressible:!1,extensions:["ogx"]},"application/omdoc+xml":{source:"apache",compressible:!0,extensions:["omdoc"]},"application/onenote":{source:"apache",extensions:["onetoc","onetoc2","onetmp","onepkg"]},"application/opc-nodeset+xml":{source:"iana",compressible:!0},"application/oscore":{source:"iana"},"application/oxps":{source:"iana",extensions:["oxps"]},"application/p21":{source:"iana"},"application/p21+zip":{source:"iana",compressible:!1},"application/p2p-overlay+xml":{source:"iana",compressible:!0,extensions:["relo"]},"application/parityfec":{source:"iana"},"application/passport":{source:"iana"},"application/patch-ops-error+xml":{source:"iana",compressible:!0,extensions:["xer"]},"application/pdf":{source:"iana",compressible:!1,extensions:["pdf"]},"application/pdx":{source:"iana"},"application/pem-certificate-chain":{source:"iana"},"application/pgp-encrypted":{source:"iana",compressible:!1,extensions:["pgp"]},"application/pgp-keys":{source:"iana",extensions:["asc"]},"application/pgp-signature":{source:"iana",extensions:["asc","sig"]},"application/pics-rules":{source:"apache",extensions:["prf"]},"application/pidf+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pidf-diff+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pkcs10":{source:"iana",extensions:["p10"]},"application/pkcs12":{source:"iana"},"application/pkcs7-mime":{source:"iana",extensions:["p7m","p7c"]},"application/pkcs7-signature":{source:"iana",extensions:["p7s"]},"application/pkcs8":{source:"iana",extensions:["p8"]},"application/pkcs8-encrypted":{source:"iana"},"application/pkix-attr-cert":{source:"iana",extensions:["ac"]},"application/pkix-cert":{source:"iana",extensions:["cer"]},"application/pkix-crl":{source:"iana",extensions:["crl"]},"application/pkix-pkipath":{source:"iana",extensions:["pkipath"]},"application/pkixcmp":{source:"iana",extensions:["pki"]},"application/pls+xml":{source:"iana",compressible:!0,extensions:["pls"]},"application/poc-settings+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/postscript":{source:"iana",compressible:!0,extensions:["ai","eps","ps"]},"application/ppsp-tracker+json":{source:"iana",compressible:!0},"application/problem+json":{source:"iana",compressible:!0},"application/problem+xml":{source:"iana",compressible:!0},"application/provenance+xml":{source:"iana",compressible:!0,extensions:["provx"]},"application/prs.alvestrand.titrax-sheet":{source:"iana"},"application/prs.cww":{source:"iana",extensions:["cww"]},"application/prs.cyn":{source:"iana",charset:"7-BIT"},"application/prs.hpub+zip":{source:"iana",compressible:!1},"application/prs.nprend":{source:"iana"},"application/prs.plucker":{source:"iana"},"application/prs.rdf-xml-crypt":{source:"iana"},"application/prs.xsf+xml":{source:"iana",compressible:!0},"application/pskc+xml":{source:"iana",compressible:!0,extensions:["pskcxml"]},"application/pvd+json":{source:"iana",compressible:!0},"application/qsig":{source:"iana"},"application/raml+yaml":{compressible:!0,extensions:["raml"]},"application/raptorfec":{source:"iana"},"application/rdap+json":{source:"iana",compressible:!0},"application/rdf+xml":{source:"iana",compressible:!0,extensions:["rdf","owl"]},"application/reginfo+xml":{source:"iana",compressible:!0,extensions:["rif"]},"application/relax-ng-compact-syntax":{source:"iana",extensions:["rnc"]},"application/remote-printing":{source:"iana"},"application/reputon+json":{source:"iana",compressible:!0},"application/resource-lists+xml":{source:"iana",compressible:!0,extensions:["rl"]},"application/resource-lists-diff+xml":{source:"iana",compressible:!0,extensions:["rld"]},"application/rfc+xml":{source:"iana",compressible:!0},"application/riscos":{source:"iana"},"application/rlmi+xml":{source:"iana",compressible:!0},"application/rls-services+xml":{source:"iana",compressible:!0,extensions:["rs"]},"application/route-apd+xml":{source:"iana",compressible:!0,extensions:["rapd"]},"application/route-s-tsid+xml":{source:"iana",compressible:!0,extensions:["sls"]},"application/route-usd+xml":{source:"iana",compressible:!0,extensions:["rusd"]},"application/rpki-ghostbusters":{source:"iana",extensions:["gbr"]},"application/rpki-manifest":{source:"iana",extensions:["mft"]},"application/rpki-publication":{source:"iana"},"application/rpki-roa":{source:"iana",extensions:["roa"]},"application/rpki-updown":{source:"iana"},"application/rsd+xml":{source:"apache",compressible:!0,extensions:["rsd"]},"application/rss+xml":{source:"apache",compressible:!0,extensions:["rss"]},"application/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"application/rtploopback":{source:"iana"},"application/rtx":{source:"iana"},"application/samlassertion+xml":{source:"iana",compressible:!0},"application/samlmetadata+xml":{source:"iana",compressible:!0},"application/sarif+json":{source:"iana",compressible:!0},"application/sarif-external-properties+json":{source:"iana",compressible:!0},"application/sbe":{source:"iana"},"application/sbml+xml":{source:"iana",compressible:!0,extensions:["sbml"]},"application/scaip+xml":{source:"iana",compressible:!0},"application/scim+json":{source:"iana",compressible:!0},"application/scvp-cv-request":{source:"iana",extensions:["scq"]},"application/scvp-cv-response":{source:"iana",extensions:["scs"]},"application/scvp-vp-request":{source:"iana",extensions:["spq"]},"application/scvp-vp-response":{source:"iana",extensions:["spp"]},"application/sdp":{source:"iana",extensions:["sdp"]},"application/secevent+jwt":{source:"iana"},"application/senml+cbor":{source:"iana"},"application/senml+json":{source:"iana",compressible:!0},"application/senml+xml":{source:"iana",compressible:!0,extensions:["senmlx"]},"application/senml-etch+cbor":{source:"iana"},"application/senml-etch+json":{source:"iana",compressible:!0},"application/senml-exi":{source:"iana"},"application/sensml+cbor":{source:"iana"},"application/sensml+json":{source:"iana",compressible:!0},"application/sensml+xml":{source:"iana",compressible:!0,extensions:["sensmlx"]},"application/sensml-exi":{source:"iana"},"application/sep+xml":{source:"iana",compressible:!0},"application/sep-exi":{source:"iana"},"application/session-info":{source:"iana"},"application/set-payment":{source:"iana"},"application/set-payment-initiation":{source:"iana",extensions:["setpay"]},"application/set-registration":{source:"iana"},"application/set-registration-initiation":{source:"iana",extensions:["setreg"]},"application/sgml":{source:"iana"},"application/sgml-open-catalog":{source:"iana"},"application/shf+xml":{source:"iana",compressible:!0,extensions:["shf"]},"application/sieve":{source:"iana",extensions:["siv","sieve"]},"application/simple-filter+xml":{source:"iana",compressible:!0},"application/simple-message-summary":{source:"iana"},"application/simplesymbolcontainer":{source:"iana"},"application/sipc":{source:"iana"},"application/slate":{source:"iana"},"application/smil":{source:"iana"},"application/smil+xml":{source:"iana",compressible:!0,extensions:["smi","smil"]},"application/smpte336m":{source:"iana"},"application/soap+fastinfoset":{source:"iana"},"application/soap+xml":{source:"iana",compressible:!0},"application/sparql-query":{source:"iana",extensions:["rq"]},"application/sparql-results+xml":{source:"iana",compressible:!0,extensions:["srx"]},"application/spdx+json":{source:"iana",compressible:!0},"application/spirits-event+xml":{source:"iana",compressible:!0},"application/sql":{source:"iana"},"application/srgs":{source:"iana",extensions:["gram"]},"application/srgs+xml":{source:"iana",compressible:!0,extensions:["grxml"]},"application/sru+xml":{source:"iana",compressible:!0,extensions:["sru"]},"application/ssdl+xml":{source:"apache",compressible:!0,extensions:["ssdl"]},"application/ssml+xml":{source:"iana",compressible:!0,extensions:["ssml"]},"application/stix+json":{source:"iana",compressible:!0},"application/swid+xml":{source:"iana",compressible:!0,extensions:["swidtag"]},"application/tamp-apex-update":{source:"iana"},"application/tamp-apex-update-confirm":{source:"iana"},"application/tamp-community-update":{source:"iana"},"application/tamp-community-update-confirm":{source:"iana"},"application/tamp-error":{source:"iana"},"application/tamp-sequence-adjust":{source:"iana"},"application/tamp-sequence-adjust-confirm":{source:"iana"},"application/tamp-status-query":{source:"iana"},"application/tamp-status-response":{source:"iana"},"application/tamp-update":{source:"iana"},"application/tamp-update-confirm":{source:"iana"},"application/tar":{compressible:!0},"application/taxii+json":{source:"iana",compressible:!0},"application/td+json":{source:"iana",compressible:!0},"application/tei+xml":{source:"iana",compressible:!0,extensions:["tei","teicorpus"]},"application/tetra_isi":{source:"iana"},"application/thraud+xml":{source:"iana",compressible:!0,extensions:["tfi"]},"application/timestamp-query":{source:"iana"},"application/timestamp-reply":{source:"iana"},"application/timestamped-data":{source:"iana",extensions:["tsd"]},"application/tlsrpt+gzip":{source:"iana"},"application/tlsrpt+json":{source:"iana",compressible:!0},"application/tnauthlist":{source:"iana"},"application/token-introspection+jwt":{source:"iana"},"application/toml":{compressible:!0,extensions:["toml"]},"application/trickle-ice-sdpfrag":{source:"iana"},"application/trig":{source:"iana",extensions:["trig"]},"application/ttml+xml":{source:"iana",compressible:!0,extensions:["ttml"]},"application/tve-trigger":{source:"iana"},"application/tzif":{source:"iana"},"application/tzif-leap":{source:"iana"},"application/ubjson":{compressible:!1,extensions:["ubj"]},"application/ulpfec":{source:"iana"},"application/urc-grpsheet+xml":{source:"iana",compressible:!0},"application/urc-ressheet+xml":{source:"iana",compressible:!0,extensions:["rsheet"]},"application/urc-targetdesc+xml":{source:"iana",compressible:!0,extensions:["td"]},"application/urc-uisocketdesc+xml":{source:"iana",compressible:!0},"application/vcard+json":{source:"iana",compressible:!0},"application/vcard+xml":{source:"iana",compressible:!0},"application/vemmi":{source:"iana"},"application/vividence.scriptfile":{source:"apache"},"application/vnd.1000minds.decision-model+xml":{source:"iana",compressible:!0,extensions:["1km"]},"application/vnd.3gpp-prose+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-prose-pc3ch+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-v2x-local-service-information":{source:"iana"},"application/vnd.3gpp.5gnas":{source:"iana"},"application/vnd.3gpp.access-transfer-events+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.bsf+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gmop+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gtpc":{source:"iana"},"application/vnd.3gpp.interworking-data":{source:"iana"},"application/vnd.3gpp.lpp":{source:"iana"},"application/vnd.3gpp.mc-signalling-ear":{source:"iana"},"application/vnd.3gpp.mcdata-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-payload":{source:"iana"},"application/vnd.3gpp.mcdata-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-signalling":{source:"iana"},"application/vnd.3gpp.mcdata-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-floor-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-signed+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-init-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-transmission-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mid-call+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ngap":{source:"iana"},"application/vnd.3gpp.pfcp":{source:"iana"},"application/vnd.3gpp.pic-bw-large":{source:"iana",extensions:["plb"]},"application/vnd.3gpp.pic-bw-small":{source:"iana",extensions:["psb"]},"application/vnd.3gpp.pic-bw-var":{source:"iana",extensions:["pvb"]},"application/vnd.3gpp.s1ap":{source:"iana"},"application/vnd.3gpp.sms":{source:"iana"},"application/vnd.3gpp.sms+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-ext+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.state-and-event-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ussd+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.bcmcsinfo+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.sms":{source:"iana"},"application/vnd.3gpp2.tcap":{source:"iana",extensions:["tcap"]},"application/vnd.3lightssoftware.imagescal":{source:"iana"},"application/vnd.3m.post-it-notes":{source:"iana",extensions:["pwn"]},"application/vnd.accpac.simply.aso":{source:"iana",extensions:["aso"]},"application/vnd.accpac.simply.imp":{source:"iana",extensions:["imp"]},"application/vnd.acucobol":{source:"iana",extensions:["acu"]},"application/vnd.acucorp":{source:"iana",extensions:["atc","acutc"]},"application/vnd.adobe.air-application-installer-package+zip":{source:"apache",compressible:!1,extensions:["air"]},"application/vnd.adobe.flash.movie":{source:"iana"},"application/vnd.adobe.formscentral.fcdt":{source:"iana",extensions:["fcdt"]},"application/vnd.adobe.fxp":{source:"iana",extensions:["fxp","fxpl"]},"application/vnd.adobe.partial-upload":{source:"iana"},"application/vnd.adobe.xdp+xml":{source:"iana",compressible:!0,extensions:["xdp"]},"application/vnd.adobe.xfdf":{source:"iana",extensions:["xfdf"]},"application/vnd.aether.imp":{source:"iana"},"application/vnd.afpc.afplinedata":{source:"iana"},"application/vnd.afpc.afplinedata-pagedef":{source:"iana"},"application/vnd.afpc.cmoca-cmresource":{source:"iana"},"application/vnd.afpc.foca-charset":{source:"iana"},"application/vnd.afpc.foca-codedfont":{source:"iana"},"application/vnd.afpc.foca-codepage":{source:"iana"},"application/vnd.afpc.modca":{source:"iana"},"application/vnd.afpc.modca-cmtable":{source:"iana"},"application/vnd.afpc.modca-formdef":{source:"iana"},"application/vnd.afpc.modca-mediummap":{source:"iana"},"application/vnd.afpc.modca-objectcontainer":{source:"iana"},"application/vnd.afpc.modca-overlay":{source:"iana"},"application/vnd.afpc.modca-pagesegment":{source:"iana"},"application/vnd.age":{source:"iana",extensions:["age"]},"application/vnd.ah-barcode":{source:"iana"},"application/vnd.ahead.space":{source:"iana",extensions:["ahead"]},"application/vnd.airzip.filesecure.azf":{source:"iana",extensions:["azf"]},"application/vnd.airzip.filesecure.azs":{source:"iana",extensions:["azs"]},"application/vnd.amadeus+json":{source:"iana",compressible:!0},"application/vnd.amazon.ebook":{source:"apache",extensions:["azw"]},"application/vnd.amazon.mobi8-ebook":{source:"iana"},"application/vnd.americandynamics.acc":{source:"iana",extensions:["acc"]},"application/vnd.amiga.ami":{source:"iana",extensions:["ami"]},"application/vnd.amundsen.maze+xml":{source:"iana",compressible:!0},"application/vnd.android.ota":{source:"iana"},"application/vnd.android.package-archive":{source:"apache",compressible:!1,extensions:["apk"]},"application/vnd.anki":{source:"iana"},"application/vnd.anser-web-certificate-issue-initiation":{source:"iana",extensions:["cii"]},"application/vnd.anser-web-funds-transfer-initiation":{source:"apache",extensions:["fti"]},"application/vnd.antix.game-component":{source:"iana",extensions:["atx"]},"application/vnd.apache.arrow.file":{source:"iana"},"application/vnd.apache.arrow.stream":{source:"iana"},"application/vnd.apache.thrift.binary":{source:"iana"},"application/vnd.apache.thrift.compact":{source:"iana"},"application/vnd.apache.thrift.json":{source:"iana"},"application/vnd.api+json":{source:"iana",compressible:!0},"application/vnd.aplextor.warrp+json":{source:"iana",compressible:!0},"application/vnd.apothekende.reservation+json":{source:"iana",compressible:!0},"application/vnd.apple.installer+xml":{source:"iana",compressible:!0,extensions:["mpkg"]},"application/vnd.apple.keynote":{source:"iana",extensions:["key"]},"application/vnd.apple.mpegurl":{source:"iana",extensions:["m3u8"]},"application/vnd.apple.numbers":{source:"iana",extensions:["numbers"]},"application/vnd.apple.pages":{source:"iana",extensions:["pages"]},"application/vnd.apple.pkpass":{compressible:!1,extensions:["pkpass"]},"application/vnd.arastra.swi":{source:"iana"},"application/vnd.aristanetworks.swi":{source:"iana",extensions:["swi"]},"application/vnd.artisan+json":{source:"iana",compressible:!0},"application/vnd.artsquare":{source:"iana"},"application/vnd.astraea-software.iota":{source:"iana",extensions:["iota"]},"application/vnd.audiograph":{source:"iana",extensions:["aep"]},"application/vnd.autopackage":{source:"iana"},"application/vnd.avalon+json":{source:"iana",compressible:!0},"application/vnd.avistar+xml":{source:"iana",compressible:!0},"application/vnd.balsamiq.bmml+xml":{source:"iana",compressible:!0,extensions:["bmml"]},"application/vnd.balsamiq.bmpr":{source:"iana"},"application/vnd.banana-accounting":{source:"iana"},"application/vnd.bbf.usp.error":{source:"iana"},"application/vnd.bbf.usp.msg":{source:"iana"},"application/vnd.bbf.usp.msg+json":{source:"iana",compressible:!0},"application/vnd.bekitzur-stech+json":{source:"iana",compressible:!0},"application/vnd.bint.med-content":{source:"iana"},"application/vnd.biopax.rdf+xml":{source:"iana",compressible:!0},"application/vnd.blink-idb-value-wrapper":{source:"iana"},"application/vnd.blueice.multipass":{source:"iana",extensions:["mpm"]},"application/vnd.bluetooth.ep.oob":{source:"iana"},"application/vnd.bluetooth.le.oob":{source:"iana"},"application/vnd.bmi":{source:"iana",extensions:["bmi"]},"application/vnd.bpf":{source:"iana"},"application/vnd.bpf3":{source:"iana"},"application/vnd.businessobjects":{source:"iana",extensions:["rep"]},"application/vnd.byu.uapi+json":{source:"iana",compressible:!0},"application/vnd.cab-jscript":{source:"iana"},"application/vnd.canon-cpdl":{source:"iana"},"application/vnd.canon-lips":{source:"iana"},"application/vnd.capasystems-pg+json":{source:"iana",compressible:!0},"application/vnd.cendio.thinlinc.clientconf":{source:"iana"},"application/vnd.century-systems.tcp_stream":{source:"iana"},"application/vnd.chemdraw+xml":{source:"iana",compressible:!0,extensions:["cdxml"]},"application/vnd.chess-pgn":{source:"iana"},"application/vnd.chipnuts.karaoke-mmd":{source:"iana",extensions:["mmd"]},"application/vnd.ciedi":{source:"iana"},"application/vnd.cinderella":{source:"iana",extensions:["cdy"]},"application/vnd.cirpack.isdn-ext":{source:"iana"},"application/vnd.citationstyles.style+xml":{source:"iana",compressible:!0,extensions:["csl"]},"application/vnd.claymore":{source:"iana",extensions:["cla"]},"application/vnd.cloanto.rp9":{source:"iana",extensions:["rp9"]},"application/vnd.clonk.c4group":{source:"iana",extensions:["c4g","c4d","c4f","c4p","c4u"]},"application/vnd.cluetrust.cartomobile-config":{source:"iana",extensions:["c11amc"]},"application/vnd.cluetrust.cartomobile-config-pkg":{source:"iana",extensions:["c11amz"]},"application/vnd.coffeescript":{source:"iana"},"application/vnd.collabio.xodocuments.document":{source:"iana"},"application/vnd.collabio.xodocuments.document-template":{source:"iana"},"application/vnd.collabio.xodocuments.presentation":{source:"iana"},"application/vnd.collabio.xodocuments.presentation-template":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet-template":{source:"iana"},"application/vnd.collection+json":{source:"iana",compressible:!0},"application/vnd.collection.doc+json":{source:"iana",compressible:!0},"application/vnd.collection.next+json":{source:"iana",compressible:!0},"application/vnd.comicbook+zip":{source:"iana",compressible:!1},"application/vnd.comicbook-rar":{source:"iana"},"application/vnd.commerce-battelle":{source:"iana"},"application/vnd.commonspace":{source:"iana",extensions:["csp"]},"application/vnd.contact.cmsg":{source:"iana",extensions:["cdbcmsg"]},"application/vnd.coreos.ignition+json":{source:"iana",compressible:!0},"application/vnd.cosmocaller":{source:"iana",extensions:["cmc"]},"application/vnd.crick.clicker":{source:"iana",extensions:["clkx"]},"application/vnd.crick.clicker.keyboard":{source:"iana",extensions:["clkk"]},"application/vnd.crick.clicker.palette":{source:"iana",extensions:["clkp"]},"application/vnd.crick.clicker.template":{source:"iana",extensions:["clkt"]},"application/vnd.crick.clicker.wordbank":{source:"iana",extensions:["clkw"]},"application/vnd.criticaltools.wbs+xml":{source:"iana",compressible:!0,extensions:["wbs"]},"application/vnd.cryptii.pipe+json":{source:"iana",compressible:!0},"application/vnd.crypto-shade-file":{source:"iana"},"application/vnd.cryptomator.encrypted":{source:"iana"},"application/vnd.cryptomator.vault":{source:"iana"},"application/vnd.ctc-posml":{source:"iana",extensions:["pml"]},"application/vnd.ctct.ws+xml":{source:"iana",compressible:!0},"application/vnd.cups-pdf":{source:"iana"},"application/vnd.cups-postscript":{source:"iana"},"application/vnd.cups-ppd":{source:"iana",extensions:["ppd"]},"application/vnd.cups-raster":{source:"iana"},"application/vnd.cups-raw":{source:"iana"},"application/vnd.curl":{source:"iana"},"application/vnd.curl.car":{source:"apache",extensions:["car"]},"application/vnd.curl.pcurl":{source:"apache",extensions:["pcurl"]},"application/vnd.cyan.dean.root+xml":{source:"iana",compressible:!0},"application/vnd.cybank":{source:"iana"},"application/vnd.cyclonedx+json":{source:"iana",compressible:!0},"application/vnd.cyclonedx+xml":{source:"iana",compressible:!0},"application/vnd.d2l.coursepackage1p0+zip":{source:"iana",compressible:!1},"application/vnd.d3m-dataset":{source:"iana"},"application/vnd.d3m-problem":{source:"iana"},"application/vnd.dart":{source:"iana",compressible:!0,extensions:["dart"]},"application/vnd.data-vision.rdz":{source:"iana",extensions:["rdz"]},"application/vnd.datapackage+json":{source:"iana",compressible:!0},"application/vnd.dataresource+json":{source:"iana",compressible:!0},"application/vnd.dbf":{source:"iana",extensions:["dbf"]},"application/vnd.debian.binary-package":{source:"iana"},"application/vnd.dece.data":{source:"iana",extensions:["uvf","uvvf","uvd","uvvd"]},"application/vnd.dece.ttml+xml":{source:"iana",compressible:!0,extensions:["uvt","uvvt"]},"application/vnd.dece.unspecified":{source:"iana",extensions:["uvx","uvvx"]},"application/vnd.dece.zip":{source:"iana",extensions:["uvz","uvvz"]},"application/vnd.denovo.fcselayout-link":{source:"iana",extensions:["fe_launch"]},"application/vnd.desmume.movie":{source:"iana"},"application/vnd.dir-bi.plate-dl-nosuffix":{source:"iana"},"application/vnd.dm.delegation+xml":{source:"iana",compressible:!0},"application/vnd.dna":{source:"iana",extensions:["dna"]},"application/vnd.document+json":{source:"iana",compressible:!0},"application/vnd.dolby.mlp":{source:"apache",extensions:["mlp"]},"application/vnd.dolby.mobile.1":{source:"iana"},"application/vnd.dolby.mobile.2":{source:"iana"},"application/vnd.doremir.scorecloud-binary-document":{source:"iana"},"application/vnd.dpgraph":{source:"iana",extensions:["dpg"]},"application/vnd.dreamfactory":{source:"iana",extensions:["dfac"]},"application/vnd.drive+json":{source:"iana",compressible:!0},"application/vnd.ds-keypoint":{source:"apache",extensions:["kpxx"]},"application/vnd.dtg.local":{source:"iana"},"application/vnd.dtg.local.flash":{source:"iana"},"application/vnd.dtg.local.html":{source:"iana"},"application/vnd.dvb.ait":{source:"iana",extensions:["ait"]},"application/vnd.dvb.dvbisl+xml":{source:"iana",compressible:!0},"application/vnd.dvb.dvbj":{source:"iana"},"application/vnd.dvb.esgcontainer":{source:"iana"},"application/vnd.dvb.ipdcdftnotifaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess2":{source:"iana"},"application/vnd.dvb.ipdcesgpdd":{source:"iana"},"application/vnd.dvb.ipdcroaming":{source:"iana"},"application/vnd.dvb.iptv.alfec-base":{source:"iana"},"application/vnd.dvb.iptv.alfec-enhancement":{source:"iana"},"application/vnd.dvb.notif-aggregate-root+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-container+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-generic+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-msglist+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-request+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-response+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-init+xml":{source:"iana",compressible:!0},"application/vnd.dvb.pfr":{source:"iana"},"application/vnd.dvb.service":{source:"iana",extensions:["svc"]},"application/vnd.dxr":{source:"iana"},"application/vnd.dynageo":{source:"iana",extensions:["geo"]},"application/vnd.dzr":{source:"iana"},"application/vnd.easykaraoke.cdgdownload":{source:"iana"},"application/vnd.ecdis-update":{source:"iana"},"application/vnd.ecip.rlp":{source:"iana"},"application/vnd.eclipse.ditto+json":{source:"iana",compressible:!0},"application/vnd.ecowin.chart":{source:"iana",extensions:["mag"]},"application/vnd.ecowin.filerequest":{source:"iana"},"application/vnd.ecowin.fileupdate":{source:"iana"},"application/vnd.ecowin.series":{source:"iana"},"application/vnd.ecowin.seriesrequest":{source:"iana"},"application/vnd.ecowin.seriesupdate":{source:"iana"},"application/vnd.efi.img":{source:"iana"},"application/vnd.efi.iso":{source:"iana"},"application/vnd.emclient.accessrequest+xml":{source:"iana",compressible:!0},"application/vnd.enliven":{source:"iana",extensions:["nml"]},"application/vnd.enphase.envoy":{source:"iana"},"application/vnd.eprints.data+xml":{source:"iana",compressible:!0},"application/vnd.epson.esf":{source:"iana",extensions:["esf"]},"application/vnd.epson.msf":{source:"iana",extensions:["msf"]},"application/vnd.epson.quickanime":{source:"iana",extensions:["qam"]},"application/vnd.epson.salt":{source:"iana",extensions:["slt"]},"application/vnd.epson.ssf":{source:"iana",extensions:["ssf"]},"application/vnd.ericsson.quickcall":{source:"iana"},"application/vnd.espass-espass+zip":{source:"iana",compressible:!1},"application/vnd.eszigno3+xml":{source:"iana",compressible:!0,extensions:["es3","et3"]},"application/vnd.etsi.aoc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.asic-e+zip":{source:"iana",compressible:!1},"application/vnd.etsi.asic-s+zip":{source:"iana",compressible:!1},"application/vnd.etsi.cug+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvcommand+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-bc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-cod+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-npvr+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvservice+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsync+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvueprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mcid+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mheg5":{source:"iana"},"application/vnd.etsi.overload-control-policy-dataset+xml":{source:"iana",compressible:!0},"application/vnd.etsi.pstn+xml":{source:"iana",compressible:!0},"application/vnd.etsi.sci+xml":{source:"iana",compressible:!0},"application/vnd.etsi.simservs+xml":{source:"iana",compressible:!0},"application/vnd.etsi.timestamp-token":{source:"iana"},"application/vnd.etsi.tsl+xml":{source:"iana",compressible:!0},"application/vnd.etsi.tsl.der":{source:"iana"},"application/vnd.eu.kasparian.car+json":{source:"iana",compressible:!0},"application/vnd.eudora.data":{source:"iana"},"application/vnd.evolv.ecig.profile":{source:"iana"},"application/vnd.evolv.ecig.settings":{source:"iana"},"application/vnd.evolv.ecig.theme":{source:"iana"},"application/vnd.exstream-empower+zip":{source:"iana",compressible:!1},"application/vnd.exstream-package":{source:"iana"},"application/vnd.ezpix-album":{source:"iana",extensions:["ez2"]},"application/vnd.ezpix-package":{source:"iana",extensions:["ez3"]},"application/vnd.f-secure.mobile":{source:"iana"},"application/vnd.familysearch.gedcom+zip":{source:"iana",compressible:!1},"application/vnd.fastcopy-disk-image":{source:"iana"},"application/vnd.fdf":{source:"iana",extensions:["fdf"]},"application/vnd.fdsn.mseed":{source:"iana",extensions:["mseed"]},"application/vnd.fdsn.seed":{source:"iana",extensions:["seed","dataless"]},"application/vnd.ffsns":{source:"iana"},"application/vnd.ficlab.flb+zip":{source:"iana",compressible:!1},"application/vnd.filmit.zfc":{source:"iana"},"application/vnd.fints":{source:"iana"},"application/vnd.firemonkeys.cloudcell":{source:"iana"},"application/vnd.flographit":{source:"iana",extensions:["gph"]},"application/vnd.fluxtime.clip":{source:"iana",extensions:["ftc"]},"application/vnd.font-fontforge-sfd":{source:"iana"},"application/vnd.framemaker":{source:"iana",extensions:["fm","frame","maker","book"]},"application/vnd.frogans.fnc":{source:"iana",extensions:["fnc"]},"application/vnd.frogans.ltf":{source:"iana",extensions:["ltf"]},"application/vnd.fsc.weblaunch":{source:"iana",extensions:["fsc"]},"application/vnd.fujifilm.fb.docuworks":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.binder":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.container":{source:"iana"},"application/vnd.fujifilm.fb.jfi+xml":{source:"iana",compressible:!0},"application/vnd.fujitsu.oasys":{source:"iana",extensions:["oas"]},"application/vnd.fujitsu.oasys2":{source:"iana",extensions:["oa2"]},"application/vnd.fujitsu.oasys3":{source:"iana",extensions:["oa3"]},"application/vnd.fujitsu.oasysgp":{source:"iana",extensions:["fg5"]},"application/vnd.fujitsu.oasysprs":{source:"iana",extensions:["bh2"]},"application/vnd.fujixerox.art-ex":{source:"iana"},"application/vnd.fujixerox.art4":{source:"iana"},"application/vnd.fujixerox.ddd":{source:"iana",extensions:["ddd"]},"application/vnd.fujixerox.docuworks":{source:"iana",extensions:["xdw"]},"application/vnd.fujixerox.docuworks.binder":{source:"iana",extensions:["xbd"]},"application/vnd.fujixerox.docuworks.container":{source:"iana"},"application/vnd.fujixerox.hbpl":{source:"iana"},"application/vnd.fut-misnet":{source:"iana"},"application/vnd.futoin+cbor":{source:"iana"},"application/vnd.futoin+json":{source:"iana",compressible:!0},"application/vnd.fuzzysheet":{source:"iana",extensions:["fzs"]},"application/vnd.genomatix.tuxedo":{source:"iana",extensions:["txd"]},"application/vnd.gentics.grd+json":{source:"iana",compressible:!0},"application/vnd.geo+json":{source:"iana",compressible:!0},"application/vnd.geocube+xml":{source:"iana",compressible:!0},"application/vnd.geogebra.file":{source:"iana",extensions:["ggb"]},"application/vnd.geogebra.slides":{source:"iana"},"application/vnd.geogebra.tool":{source:"iana",extensions:["ggt"]},"application/vnd.geometry-explorer":{source:"iana",extensions:["gex","gre"]},"application/vnd.geonext":{source:"iana",extensions:["gxt"]},"application/vnd.geoplan":{source:"iana",extensions:["g2w"]},"application/vnd.geospace":{source:"iana",extensions:["g3w"]},"application/vnd.gerber":{source:"iana"},"application/vnd.globalplatform.card-content-mgt":{source:"iana"},"application/vnd.globalplatform.card-content-mgt-response":{source:"iana"},"application/vnd.gmx":{source:"iana",extensions:["gmx"]},"application/vnd.google-apps.document":{compressible:!1,extensions:["gdoc"]},"application/vnd.google-apps.presentation":{compressible:!1,extensions:["gslides"]},"application/vnd.google-apps.spreadsheet":{compressible:!1,extensions:["gsheet"]},"application/vnd.google-earth.kml+xml":{source:"iana",compressible:!0,extensions:["kml"]},"application/vnd.google-earth.kmz":{source:"iana",compressible:!1,extensions:["kmz"]},"application/vnd.gov.sk.e-form+xml":{source:"iana",compressible:!0},"application/vnd.gov.sk.e-form+zip":{source:"iana",compressible:!1},"application/vnd.gov.sk.xmldatacontainer+xml":{source:"iana",compressible:!0},"application/vnd.grafeq":{source:"iana",extensions:["gqf","gqs"]},"application/vnd.gridmp":{source:"iana"},"application/vnd.groove-account":{source:"iana",extensions:["gac"]},"application/vnd.groove-help":{source:"iana",extensions:["ghf"]},"application/vnd.groove-identity-message":{source:"iana",extensions:["gim"]},"application/vnd.groove-injector":{source:"iana",extensions:["grv"]},"application/vnd.groove-tool-message":{source:"iana",extensions:["gtm"]},"application/vnd.groove-tool-template":{source:"iana",extensions:["tpl"]},"application/vnd.groove-vcard":{source:"iana",extensions:["vcg"]},"application/vnd.hal+json":{source:"iana",compressible:!0},"application/vnd.hal+xml":{source:"iana",compressible:!0,extensions:["hal"]},"application/vnd.handheld-entertainment+xml":{source:"iana",compressible:!0,extensions:["zmm"]},"application/vnd.hbci":{source:"iana",extensions:["hbci"]},"application/vnd.hc+json":{source:"iana",compressible:!0},"application/vnd.hcl-bireports":{source:"iana"},"application/vnd.hdt":{source:"iana"},"application/vnd.heroku+json":{source:"iana",compressible:!0},"application/vnd.hhe.lesson-player":{source:"iana",extensions:["les"]},"application/vnd.hl7cda+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hl7v2+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hp-hpgl":{source:"iana",extensions:["hpgl"]},"application/vnd.hp-hpid":{source:"iana",extensions:["hpid"]},"application/vnd.hp-hps":{source:"iana",extensions:["hps"]},"application/vnd.hp-jlyt":{source:"iana",extensions:["jlt"]},"application/vnd.hp-pcl":{source:"iana",extensions:["pcl"]},"application/vnd.hp-pclxl":{source:"iana",extensions:["pclxl"]},"application/vnd.httphone":{source:"iana"},"application/vnd.hydrostatix.sof-data":{source:"iana",extensions:["sfd-hdstx"]},"application/vnd.hyper+json":{source:"iana",compressible:!0},"application/vnd.hyper-item+json":{source:"iana",compressible:!0},"application/vnd.hyperdrive+json":{source:"iana",compressible:!0},"application/vnd.hzn-3d-crossword":{source:"iana"},"application/vnd.ibm.afplinedata":{source:"iana"},"application/vnd.ibm.electronic-media":{source:"iana"},"application/vnd.ibm.minipay":{source:"iana",extensions:["mpy"]},"application/vnd.ibm.modcap":{source:"iana",extensions:["afp","listafp","list3820"]},"application/vnd.ibm.rights-management":{source:"iana",extensions:["irm"]},"application/vnd.ibm.secure-container":{source:"iana",extensions:["sc"]},"application/vnd.iccprofile":{source:"iana",extensions:["icc","icm"]},"application/vnd.ieee.1905":{source:"iana"},"application/vnd.igloader":{source:"iana",extensions:["igl"]},"application/vnd.imagemeter.folder+zip":{source:"iana",compressible:!1},"application/vnd.imagemeter.image+zip":{source:"iana",compressible:!1},"application/vnd.immervision-ivp":{source:"iana",extensions:["ivp"]},"application/vnd.immervision-ivu":{source:"iana",extensions:["ivu"]},"application/vnd.ims.imsccv1p1":{source:"iana"},"application/vnd.ims.imsccv1p2":{source:"iana"},"application/vnd.ims.imsccv1p3":{source:"iana"},"application/vnd.ims.lis.v2.result+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolconsumerprofile+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy.id+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings.simple+json":{source:"iana",compressible:!0},"application/vnd.informedcontrol.rms+xml":{source:"iana",compressible:!0},"application/vnd.informix-visionary":{source:"iana"},"application/vnd.infotech.project":{source:"iana"},"application/vnd.infotech.project+xml":{source:"iana",compressible:!0},"application/vnd.innopath.wamp.notification":{source:"iana"},"application/vnd.insors.igm":{source:"iana",extensions:["igm"]},"application/vnd.intercon.formnet":{source:"iana",extensions:["xpw","xpx"]},"application/vnd.intergeo":{source:"iana",extensions:["i2g"]},"application/vnd.intertrust.digibox":{source:"iana"},"application/vnd.intertrust.nncp":{source:"iana"},"application/vnd.intu.qbo":{source:"iana",extensions:["qbo"]},"application/vnd.intu.qfx":{source:"iana",extensions:["qfx"]},"application/vnd.iptc.g2.catalogitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.conceptitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.knowledgeitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsmessage+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.packageitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.planningitem+xml":{source:"iana",compressible:!0},"application/vnd.ipunplugged.rcprofile":{source:"iana",extensions:["rcprofile"]},"application/vnd.irepository.package+xml":{source:"iana",compressible:!0,extensions:["irp"]},"application/vnd.is-xpr":{source:"iana",extensions:["xpr"]},"application/vnd.isac.fcs":{source:"iana",extensions:["fcs"]},"application/vnd.iso11783-10+zip":{source:"iana",compressible:!1},"application/vnd.jam":{source:"iana",extensions:["jam"]},"application/vnd.japannet-directory-service":{source:"iana"},"application/vnd.japannet-jpnstore-wakeup":{source:"iana"},"application/vnd.japannet-payment-wakeup":{source:"iana"},"application/vnd.japannet-registration":{source:"iana"},"application/vnd.japannet-registration-wakeup":{source:"iana"},"application/vnd.japannet-setstore-wakeup":{source:"iana"},"application/vnd.japannet-verification":{source:"iana"},"application/vnd.japannet-verification-wakeup":{source:"iana"},"application/vnd.jcp.javame.midlet-rms":{source:"iana",extensions:["rms"]},"application/vnd.jisp":{source:"iana",extensions:["jisp"]},"application/vnd.joost.joda-archive":{source:"iana",extensions:["joda"]},"application/vnd.jsk.isdn-ngn":{source:"iana"},"application/vnd.kahootz":{source:"iana",extensions:["ktz","ktr"]},"application/vnd.kde.karbon":{source:"iana",extensions:["karbon"]},"application/vnd.kde.kchart":{source:"iana",extensions:["chrt"]},"application/vnd.kde.kformula":{source:"iana",extensions:["kfo"]},"application/vnd.kde.kivio":{source:"iana",extensions:["flw"]},"application/vnd.kde.kontour":{source:"iana",extensions:["kon"]},"application/vnd.kde.kpresenter":{source:"iana",extensions:["kpr","kpt"]},"application/vnd.kde.kspread":{source:"iana",extensions:["ksp"]},"application/vnd.kde.kword":{source:"iana",extensions:["kwd","kwt"]},"application/vnd.kenameaapp":{source:"iana",extensions:["htke"]},"application/vnd.kidspiration":{source:"iana",extensions:["kia"]},"application/vnd.kinar":{source:"iana",extensions:["kne","knp"]},"application/vnd.koan":{source:"iana",extensions:["skp","skd","skt","skm"]},"application/vnd.kodak-descriptor":{source:"iana",extensions:["sse"]},"application/vnd.las":{source:"iana"},"application/vnd.las.las+json":{source:"iana",compressible:!0},"application/vnd.las.las+xml":{source:"iana",compressible:!0,extensions:["lasxml"]},"application/vnd.laszip":{source:"iana"},"application/vnd.leap+json":{source:"iana",compressible:!0},"application/vnd.liberty-request+xml":{source:"iana",compressible:!0},"application/vnd.llamagraphics.life-balance.desktop":{source:"iana",extensions:["lbd"]},"application/vnd.llamagraphics.life-balance.exchange+xml":{source:"iana",compressible:!0,extensions:["lbe"]},"application/vnd.logipipe.circuit+zip":{source:"iana",compressible:!1},"application/vnd.loom":{source:"iana"},"application/vnd.lotus-1-2-3":{source:"iana",extensions:["123"]},"application/vnd.lotus-approach":{source:"iana",extensions:["apr"]},"application/vnd.lotus-freelance":{source:"iana",extensions:["pre"]},"application/vnd.lotus-notes":{source:"iana",extensions:["nsf"]},"application/vnd.lotus-organizer":{source:"iana",extensions:["org"]},"application/vnd.lotus-screencam":{source:"iana",extensions:["scm"]},"application/vnd.lotus-wordpro":{source:"iana",extensions:["lwp"]},"application/vnd.macports.portpkg":{source:"iana",extensions:["portpkg"]},"application/vnd.mapbox-vector-tile":{source:"iana",extensions:["mvt"]},"application/vnd.marlin.drm.actiontoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.conftoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.license+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.mdcf":{source:"iana"},"application/vnd.mason+json":{source:"iana",compressible:!0},"application/vnd.maxar.archive.3tz+zip":{source:"iana",compressible:!1},"application/vnd.maxmind.maxmind-db":{source:"iana"},"application/vnd.mcd":{source:"iana",extensions:["mcd"]},"application/vnd.medcalcdata":{source:"iana",extensions:["mc1"]},"application/vnd.mediastation.cdkey":{source:"iana",extensions:["cdkey"]},"application/vnd.meridian-slingshot":{source:"iana"},"application/vnd.mfer":{source:"iana",extensions:["mwf"]},"application/vnd.mfmp":{source:"iana",extensions:["mfm"]},"application/vnd.micro+json":{source:"iana",compressible:!0},"application/vnd.micrografx.flo":{source:"iana",extensions:["flo"]},"application/vnd.micrografx.igx":{source:"iana",extensions:["igx"]},"application/vnd.microsoft.portable-executable":{source:"iana"},"application/vnd.microsoft.windows.thumbnail-cache":{source:"iana"},"application/vnd.miele+json":{source:"iana",compressible:!0},"application/vnd.mif":{source:"iana",extensions:["mif"]},"application/vnd.minisoft-hp3000-save":{source:"iana"},"application/vnd.mitsubishi.misty-guard.trustweb":{source:"iana"},"application/vnd.mobius.daf":{source:"iana",extensions:["daf"]},"application/vnd.mobius.dis":{source:"iana",extensions:["dis"]},"application/vnd.mobius.mbk":{source:"iana",extensions:["mbk"]},"application/vnd.mobius.mqy":{source:"iana",extensions:["mqy"]},"application/vnd.mobius.msl":{source:"iana",extensions:["msl"]},"application/vnd.mobius.plc":{source:"iana",extensions:["plc"]},"application/vnd.mobius.txf":{source:"iana",extensions:["txf"]},"application/vnd.mophun.application":{source:"iana",extensions:["mpn"]},"application/vnd.mophun.certificate":{source:"iana",extensions:["mpc"]},"application/vnd.motorola.flexsuite":{source:"iana"},"application/vnd.motorola.flexsuite.adsi":{source:"iana"},"application/vnd.motorola.flexsuite.fis":{source:"iana"},"application/vnd.motorola.flexsuite.gotap":{source:"iana"},"application/vnd.motorola.flexsuite.kmr":{source:"iana"},"application/vnd.motorola.flexsuite.ttc":{source:"iana"},"application/vnd.motorola.flexsuite.wem":{source:"iana"},"application/vnd.motorola.iprm":{source:"iana"},"application/vnd.mozilla.xul+xml":{source:"iana",compressible:!0,extensions:["xul"]},"application/vnd.ms-3mfdocument":{source:"iana"},"application/vnd.ms-artgalry":{source:"iana",extensions:["cil"]},"application/vnd.ms-asf":{source:"iana"},"application/vnd.ms-cab-compressed":{source:"iana",extensions:["cab"]},"application/vnd.ms-color.iccprofile":{source:"apache"},"application/vnd.ms-excel":{source:"iana",compressible:!1,extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"application/vnd.ms-excel.addin.macroenabled.12":{source:"iana",extensions:["xlam"]},"application/vnd.ms-excel.sheet.binary.macroenabled.12":{source:"iana",extensions:["xlsb"]},"application/vnd.ms-excel.sheet.macroenabled.12":{source:"iana",extensions:["xlsm"]},"application/vnd.ms-excel.template.macroenabled.12":{source:"iana",extensions:["xltm"]},"application/vnd.ms-fontobject":{source:"iana",compressible:!0,extensions:["eot"]},"application/vnd.ms-htmlhelp":{source:"iana",extensions:["chm"]},"application/vnd.ms-ims":{source:"iana",extensions:["ims"]},"application/vnd.ms-lrm":{source:"iana",extensions:["lrm"]},"application/vnd.ms-office.activex+xml":{source:"iana",compressible:!0},"application/vnd.ms-officetheme":{source:"iana",extensions:["thmx"]},"application/vnd.ms-opentype":{source:"apache",compressible:!0},"application/vnd.ms-outlook":{compressible:!1,extensions:["msg"]},"application/vnd.ms-package.obfuscated-opentype":{source:"apache"},"application/vnd.ms-pki.seccat":{source:"apache",extensions:["cat"]},"application/vnd.ms-pki.stl":{source:"apache",extensions:["stl"]},"application/vnd.ms-playready.initiator+xml":{source:"iana",compressible:!0},"application/vnd.ms-powerpoint":{source:"iana",compressible:!1,extensions:["ppt","pps","pot"]},"application/vnd.ms-powerpoint.addin.macroenabled.12":{source:"iana",extensions:["ppam"]},"application/vnd.ms-powerpoint.presentation.macroenabled.12":{source:"iana",extensions:["pptm"]},"application/vnd.ms-powerpoint.slide.macroenabled.12":{source:"iana",extensions:["sldm"]},"application/vnd.ms-powerpoint.slideshow.macroenabled.12":{source:"iana",extensions:["ppsm"]},"application/vnd.ms-powerpoint.template.macroenabled.12":{source:"iana",extensions:["potm"]},"application/vnd.ms-printdevicecapabilities+xml":{source:"iana",compressible:!0},"application/vnd.ms-printing.printticket+xml":{source:"apache",compressible:!0},"application/vnd.ms-printschematicket+xml":{source:"iana",compressible:!0},"application/vnd.ms-project":{source:"iana",extensions:["mpp","mpt"]},"application/vnd.ms-tnef":{source:"iana"},"application/vnd.ms-windows.devicepairing":{source:"iana"},"application/vnd.ms-windows.nwprinting.oob":{source:"iana"},"application/vnd.ms-windows.printerpairing":{source:"iana"},"application/vnd.ms-windows.wsd.oob":{source:"iana"},"application/vnd.ms-wmdrm.lic-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.lic-resp":{source:"iana"},"application/vnd.ms-wmdrm.meter-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.meter-resp":{source:"iana"},"application/vnd.ms-word.document.macroenabled.12":{source:"iana",extensions:["docm"]},"application/vnd.ms-word.template.macroenabled.12":{source:"iana",extensions:["dotm"]},"application/vnd.ms-works":{source:"iana",extensions:["wps","wks","wcm","wdb"]},"application/vnd.ms-wpl":{source:"iana",extensions:["wpl"]},"application/vnd.ms-xpsdocument":{source:"iana",compressible:!1,extensions:["xps"]},"application/vnd.msa-disk-image":{source:"iana"},"application/vnd.mseq":{source:"iana",extensions:["mseq"]},"application/vnd.msign":{source:"iana"},"application/vnd.multiad.creator":{source:"iana"},"application/vnd.multiad.creator.cif":{source:"iana"},"application/vnd.music-niff":{source:"iana"},"application/vnd.musician":{source:"iana",extensions:["mus"]},"application/vnd.muvee.style":{source:"iana",extensions:["msty"]},"application/vnd.mynfc":{source:"iana",extensions:["taglet"]},"application/vnd.nacamar.ybrid+json":{source:"iana",compressible:!0},"application/vnd.ncd.control":{source:"iana"},"application/vnd.ncd.reference":{source:"iana"},"application/vnd.nearst.inv+json":{source:"iana",compressible:!0},"application/vnd.nebumind.line":{source:"iana"},"application/vnd.nervana":{source:"iana"},"application/vnd.netfpx":{source:"iana"},"application/vnd.neurolanguage.nlu":{source:"iana",extensions:["nlu"]},"application/vnd.nimn":{source:"iana"},"application/vnd.nintendo.nitro.rom":{source:"iana"},"application/vnd.nintendo.snes.rom":{source:"iana"},"application/vnd.nitf":{source:"iana",extensions:["ntf","nitf"]},"application/vnd.noblenet-directory":{source:"iana",extensions:["nnd"]},"application/vnd.noblenet-sealer":{source:"iana",extensions:["nns"]},"application/vnd.noblenet-web":{source:"iana",extensions:["nnw"]},"application/vnd.nokia.catalogs":{source:"iana"},"application/vnd.nokia.conml+wbxml":{source:"iana"},"application/vnd.nokia.conml+xml":{source:"iana",compressible:!0},"application/vnd.nokia.iptv.config+xml":{source:"iana",compressible:!0},"application/vnd.nokia.isds-radio-presets":{source:"iana"},"application/vnd.nokia.landmark+wbxml":{source:"iana"},"application/vnd.nokia.landmark+xml":{source:"iana",compressible:!0},"application/vnd.nokia.landmarkcollection+xml":{source:"iana",compressible:!0},"application/vnd.nokia.n-gage.ac+xml":{source:"iana",compressible:!0,extensions:["ac"]},"application/vnd.nokia.n-gage.data":{source:"iana",extensions:["ngdat"]},"application/vnd.nokia.n-gage.symbian.install":{source:"iana",extensions:["n-gage"]},"application/vnd.nokia.ncd":{source:"iana"},"application/vnd.nokia.pcd+wbxml":{source:"iana"},"application/vnd.nokia.pcd+xml":{source:"iana",compressible:!0},"application/vnd.nokia.radio-preset":{source:"iana",extensions:["rpst"]},"application/vnd.nokia.radio-presets":{source:"iana",extensions:["rpss"]},"application/vnd.novadigm.edm":{source:"iana",extensions:["edm"]},"application/vnd.novadigm.edx":{source:"iana",extensions:["edx"]},"application/vnd.novadigm.ext":{source:"iana",extensions:["ext"]},"application/vnd.ntt-local.content-share":{source:"iana"},"application/vnd.ntt-local.file-transfer":{source:"iana"},"application/vnd.ntt-local.ogw_remote-access":{source:"iana"},"application/vnd.ntt-local.sip-ta_remote":{source:"iana"},"application/vnd.ntt-local.sip-ta_tcp_stream":{source:"iana"},"application/vnd.oasis.opendocument.chart":{source:"iana",extensions:["odc"]},"application/vnd.oasis.opendocument.chart-template":{source:"iana",extensions:["otc"]},"application/vnd.oasis.opendocument.database":{source:"iana",extensions:["odb"]},"application/vnd.oasis.opendocument.formula":{source:"iana",extensions:["odf"]},"application/vnd.oasis.opendocument.formula-template":{source:"iana",extensions:["odft"]},"application/vnd.oasis.opendocument.graphics":{source:"iana",compressible:!1,extensions:["odg"]},"application/vnd.oasis.opendocument.graphics-template":{source:"iana",extensions:["otg"]},"application/vnd.oasis.opendocument.image":{source:"iana",extensions:["odi"]},"application/vnd.oasis.opendocument.image-template":{source:"iana",extensions:["oti"]},"application/vnd.oasis.opendocument.presentation":{source:"iana",compressible:!1,extensions:["odp"]},"application/vnd.oasis.opendocument.presentation-template":{source:"iana",extensions:["otp"]},"application/vnd.oasis.opendocument.spreadsheet":{source:"iana",compressible:!1,extensions:["ods"]},"application/vnd.oasis.opendocument.spreadsheet-template":{source:"iana",extensions:["ots"]},"application/vnd.oasis.opendocument.text":{source:"iana",compressible:!1,extensions:["odt"]},"application/vnd.oasis.opendocument.text-master":{source:"iana",extensions:["odm"]},"application/vnd.oasis.opendocument.text-template":{source:"iana",extensions:["ott"]},"application/vnd.oasis.opendocument.text-web":{source:"iana",extensions:["oth"]},"application/vnd.obn":{source:"iana"},"application/vnd.ocf+cbor":{source:"iana"},"application/vnd.oci.image.manifest.v1+json":{source:"iana",compressible:!0},"application/vnd.oftn.l10n+json":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessdownload+xml":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessstreaming+xml":{source:"iana",compressible:!0},"application/vnd.oipf.cspg-hexbinary":{source:"iana"},"application/vnd.oipf.dae.svg+xml":{source:"iana",compressible:!0},"application/vnd.oipf.dae.xhtml+xml":{source:"iana",compressible:!0},"application/vnd.oipf.mippvcontrolmessage+xml":{source:"iana",compressible:!0},"application/vnd.oipf.pae.gem":{source:"iana"},"application/vnd.oipf.spdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.oipf.spdlist+xml":{source:"iana",compressible:!0},"application/vnd.oipf.ueprofile+xml":{source:"iana",compressible:!0},"application/vnd.oipf.userprofile+xml":{source:"iana",compressible:!0},"application/vnd.olpc-sugar":{source:"iana",extensions:["xo"]},"application/vnd.oma-scws-config":{source:"iana"},"application/vnd.oma-scws-http-request":{source:"iana"},"application/vnd.oma-scws-http-response":{source:"iana"},"application/vnd.oma.bcast.associated-procedure-parameter+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.drm-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.imd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.ltkm":{source:"iana"},"application/vnd.oma.bcast.notification+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.provisioningtrigger":{source:"iana"},"application/vnd.oma.bcast.sgboot":{source:"iana"},"application/vnd.oma.bcast.sgdd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sgdu":{source:"iana"},"application/vnd.oma.bcast.simple-symbol-container":{source:"iana"},"application/vnd.oma.bcast.smartcard-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sprov+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.stkm":{source:"iana"},"application/vnd.oma.cab-address-book+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-feature-handler+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-pcc+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-subs-invite+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-user-prefs+xml":{source:"iana",compressible:!0},"application/vnd.oma.dcd":{source:"iana"},"application/vnd.oma.dcdc":{source:"iana"},"application/vnd.oma.dd2+xml":{source:"iana",compressible:!0,extensions:["dd2"]},"application/vnd.oma.drm.risd+xml":{source:"iana",compressible:!0},"application/vnd.oma.group-usage-list+xml":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+cbor":{source:"iana"},"application/vnd.oma.lwm2m+json":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+tlv":{source:"iana"},"application/vnd.oma.pal+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.detailed-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.final-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.groups+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.invocation-descriptor+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.optimized-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.push":{source:"iana"},"application/vnd.oma.scidm.messages+xml":{source:"iana",compressible:!0},"application/vnd.oma.xcap-directory+xml":{source:"iana",compressible:!0},"application/vnd.omads-email+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-file+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-folder+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omaloc-supl-init":{source:"iana"},"application/vnd.onepager":{source:"iana"},"application/vnd.onepagertamp":{source:"iana"},"application/vnd.onepagertamx":{source:"iana"},"application/vnd.onepagertat":{source:"iana"},"application/vnd.onepagertatp":{source:"iana"},"application/vnd.onepagertatx":{source:"iana"},"application/vnd.openblox.game+xml":{source:"iana",compressible:!0,extensions:["obgx"]},"application/vnd.openblox.game-binary":{source:"iana"},"application/vnd.openeye.oeb":{source:"iana"},"application/vnd.openofficeorg.extension":{source:"apache",extensions:["oxt"]},"application/vnd.openstreetmap.data+xml":{source:"iana",compressible:!0,extensions:["osm"]},"application/vnd.opentimestamps.ots":{source:"iana"},"application/vnd.openxmlformats-officedocument.custom-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.customxmlproperties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawing+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chart+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramcolors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramdata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramlayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramstyle+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.extended-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.commentauthors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.handoutmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesslide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{source:"iana",compressible:!1,extensions:["pptx"]},"application/vnd.openxmlformats-officedocument.presentationml.presentation.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slide":{source:"iana",extensions:["sldx"]},"application/vnd.openxmlformats-officedocument.presentationml.slide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidelayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidemaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideshow":{source:"iana",extensions:["ppsx"]},"application/vnd.openxmlformats-officedocument.presentationml.slideshow.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideupdateinfo+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tablestyles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tags+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.template":{source:"iana",extensions:["potx"]},"application/vnd.openxmlformats-officedocument.presentationml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.viewprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.calcchain+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.externallink+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcachedefinition+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcacherecords+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivottable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.querytable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionheaders+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionlog+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedstrings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{source:"iana",compressible:!1,extensions:["xlsx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetmetadata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.tablesinglecells+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.template":{source:"iana",extensions:["xltx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.usernames+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.volatiledependencies+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.theme+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.themeoverride+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.vmldrawing":{source:"iana"},"application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{source:"iana",compressible:!1,extensions:["docx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.glossary+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.fonttable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footer+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.settings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.template":{source:"iana",extensions:["dotx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.websettings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.core-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.digital-signature-xmlsignature+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.relationships+xml":{source:"iana",compressible:!0},"application/vnd.oracle.resource+json":{source:"iana",compressible:!0},"application/vnd.orange.indata":{source:"iana"},"application/vnd.osa.netdeploy":{source:"iana"},"application/vnd.osgeo.mapguide.package":{source:"iana",extensions:["mgp"]},"application/vnd.osgi.bundle":{source:"iana"},"application/vnd.osgi.dp":{source:"iana",extensions:["dp"]},"application/vnd.osgi.subsystem":{source:"iana",extensions:["esa"]},"application/vnd.otps.ct-kip+xml":{source:"iana",compressible:!0},"application/vnd.oxli.countgraph":{source:"iana"},"application/vnd.pagerduty+json":{source:"iana",compressible:!0},"application/vnd.palm":{source:"iana",extensions:["pdb","pqa","oprc"]},"application/vnd.panoply":{source:"iana"},"application/vnd.paos.xml":{source:"iana"},"application/vnd.patentdive":{source:"iana"},"application/vnd.patientecommsdoc":{source:"iana"},"application/vnd.pawaafile":{source:"iana",extensions:["paw"]},"application/vnd.pcos":{source:"iana"},"application/vnd.pg.format":{source:"iana",extensions:["str"]},"application/vnd.pg.osasli":{source:"iana",extensions:["ei6"]},"application/vnd.piaccess.application-licence":{source:"iana"},"application/vnd.picsel":{source:"iana",extensions:["efif"]},"application/vnd.pmi.widget":{source:"iana",extensions:["wg"]},"application/vnd.poc.group-advertisement+xml":{source:"iana",compressible:!0},"application/vnd.pocketlearn":{source:"iana",extensions:["plf"]},"application/vnd.powerbuilder6":{source:"iana",extensions:["pbd"]},"application/vnd.powerbuilder6-s":{source:"iana"},"application/vnd.powerbuilder7":{source:"iana"},"application/vnd.powerbuilder7-s":{source:"iana"},"application/vnd.powerbuilder75":{source:"iana"},"application/vnd.powerbuilder75-s":{source:"iana"},"application/vnd.preminet":{source:"iana"},"application/vnd.previewsystems.box":{source:"iana",extensions:["box"]},"application/vnd.proteus.magazine":{source:"iana",extensions:["mgz"]},"application/vnd.psfs":{source:"iana"},"application/vnd.publishare-delta-tree":{source:"iana",extensions:["qps"]},"application/vnd.pvi.ptid1":{source:"iana",extensions:["ptid"]},"application/vnd.pwg-multiplexed":{source:"iana"},"application/vnd.pwg-xhtml-print+xml":{source:"iana",compressible:!0},"application/vnd.qualcomm.brew-app-res":{source:"iana"},"application/vnd.quarantainenet":{source:"iana"},"application/vnd.quark.quarkxpress":{source:"iana",extensions:["qxd","qxt","qwd","qwt","qxl","qxb"]},"application/vnd.quobject-quoxdocument":{source:"iana"},"application/vnd.radisys.moml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conn+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-stream+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-base+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-detect+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-sendrecv+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-group+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-speech+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-transform+xml":{source:"iana",compressible:!0},"application/vnd.rainstor.data":{source:"iana"},"application/vnd.rapid":{source:"iana"},"application/vnd.rar":{source:"iana",extensions:["rar"]},"application/vnd.realvnc.bed":{source:"iana",extensions:["bed"]},"application/vnd.recordare.musicxml":{source:"iana",extensions:["mxl"]},"application/vnd.recordare.musicxml+xml":{source:"iana",compressible:!0,extensions:["musicxml"]},"application/vnd.renlearn.rlprint":{source:"iana"},"application/vnd.resilient.logic":{source:"iana"},"application/vnd.restful+json":{source:"iana",compressible:!0},"application/vnd.rig.cryptonote":{source:"iana",extensions:["cryptonote"]},"application/vnd.rim.cod":{source:"apache",extensions:["cod"]},"application/vnd.rn-realmedia":{source:"apache",extensions:["rm"]},"application/vnd.rn-realmedia-vbr":{source:"apache",extensions:["rmvb"]},"application/vnd.route66.link66+xml":{source:"iana",compressible:!0,extensions:["link66"]},"application/vnd.rs-274x":{source:"iana"},"application/vnd.ruckus.download":{source:"iana"},"application/vnd.s3sms":{source:"iana"},"application/vnd.sailingtracker.track":{source:"iana",extensions:["st"]},"application/vnd.sar":{source:"iana"},"application/vnd.sbm.cid":{source:"iana"},"application/vnd.sbm.mid2":{source:"iana"},"application/vnd.scribus":{source:"iana"},"application/vnd.sealed.3df":{source:"iana"},"application/vnd.sealed.csf":{source:"iana"},"application/vnd.sealed.doc":{source:"iana"},"application/vnd.sealed.eml":{source:"iana"},"application/vnd.sealed.mht":{source:"iana"},"application/vnd.sealed.net":{source:"iana"},"application/vnd.sealed.ppt":{source:"iana"},"application/vnd.sealed.tiff":{source:"iana"},"application/vnd.sealed.xls":{source:"iana"},"application/vnd.sealedmedia.softseal.html":{source:"iana"},"application/vnd.sealedmedia.softseal.pdf":{source:"iana"},"application/vnd.seemail":{source:"iana",extensions:["see"]},"application/vnd.seis+json":{source:"iana",compressible:!0},"application/vnd.sema":{source:"iana",extensions:["sema"]},"application/vnd.semd":{source:"iana",extensions:["semd"]},"application/vnd.semf":{source:"iana",extensions:["semf"]},"application/vnd.shade-save-file":{source:"iana"},"application/vnd.shana.informed.formdata":{source:"iana",extensions:["ifm"]},"application/vnd.shana.informed.formtemplate":{source:"iana",extensions:["itp"]},"application/vnd.shana.informed.interchange":{source:"iana",extensions:["iif"]},"application/vnd.shana.informed.package":{source:"iana",extensions:["ipk"]},"application/vnd.shootproof+json":{source:"iana",compressible:!0},"application/vnd.shopkick+json":{source:"iana",compressible:!0},"application/vnd.shp":{source:"iana"},"application/vnd.shx":{source:"iana"},"application/vnd.sigrok.session":{source:"iana"},"application/vnd.simtech-mindmapper":{source:"iana",extensions:["twd","twds"]},"application/vnd.siren+json":{source:"iana",compressible:!0},"application/vnd.smaf":{source:"iana",extensions:["mmf"]},"application/vnd.smart.notebook":{source:"iana"},"application/vnd.smart.teacher":{source:"iana",extensions:["teacher"]},"application/vnd.snesdev-page-table":{source:"iana"},"application/vnd.software602.filler.form+xml":{source:"iana",compressible:!0,extensions:["fo"]},"application/vnd.software602.filler.form-xml-zip":{source:"iana"},"application/vnd.solent.sdkm+xml":{source:"iana",compressible:!0,extensions:["sdkm","sdkd"]},"application/vnd.spotfire.dxp":{source:"iana",extensions:["dxp"]},"application/vnd.spotfire.sfs":{source:"iana",extensions:["sfs"]},"application/vnd.sqlite3":{source:"iana"},"application/vnd.sss-cod":{source:"iana"},"application/vnd.sss-dtf":{source:"iana"},"application/vnd.sss-ntf":{source:"iana"},"application/vnd.stardivision.calc":{source:"apache",extensions:["sdc"]},"application/vnd.stardivision.draw":{source:"apache",extensions:["sda"]},"application/vnd.stardivision.impress":{source:"apache",extensions:["sdd"]},"application/vnd.stardivision.math":{source:"apache",extensions:["smf"]},"application/vnd.stardivision.writer":{source:"apache",extensions:["sdw","vor"]},"application/vnd.stardivision.writer-global":{source:"apache",extensions:["sgl"]},"application/vnd.stepmania.package":{source:"iana",extensions:["smzip"]},"application/vnd.stepmania.stepchart":{source:"iana",extensions:["sm"]},"application/vnd.street-stream":{source:"iana"},"application/vnd.sun.wadl+xml":{source:"iana",compressible:!0,extensions:["wadl"]},"application/vnd.sun.xml.calc":{source:"apache",extensions:["sxc"]},"application/vnd.sun.xml.calc.template":{source:"apache",extensions:["stc"]},"application/vnd.sun.xml.draw":{source:"apache",extensions:["sxd"]},"application/vnd.sun.xml.draw.template":{source:"apache",extensions:["std"]},"application/vnd.sun.xml.impress":{source:"apache",extensions:["sxi"]},"application/vnd.sun.xml.impress.template":{source:"apache",extensions:["sti"]},"application/vnd.sun.xml.math":{source:"apache",extensions:["sxm"]},"application/vnd.sun.xml.writer":{source:"apache",extensions:["sxw"]},"application/vnd.sun.xml.writer.global":{source:"apache",extensions:["sxg"]},"application/vnd.sun.xml.writer.template":{source:"apache",extensions:["stw"]},"application/vnd.sus-calendar":{source:"iana",extensions:["sus","susp"]},"application/vnd.svd":{source:"iana",extensions:["svd"]},"application/vnd.swiftview-ics":{source:"iana"},"application/vnd.sycle+xml":{source:"iana",compressible:!0},"application/vnd.syft+json":{source:"iana",compressible:!0},"application/vnd.symbian.install":{source:"apache",extensions:["sis","sisx"]},"application/vnd.syncml+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xsm"]},"application/vnd.syncml.dm+wbxml":{source:"iana",charset:"UTF-8",extensions:["bdm"]},"application/vnd.syncml.dm+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xdm"]},"application/vnd.syncml.dm.notification":{source:"iana"},"application/vnd.syncml.dmddf+wbxml":{source:"iana"},"application/vnd.syncml.dmddf+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["ddf"]},"application/vnd.syncml.dmtnds+wbxml":{source:"iana"},"application/vnd.syncml.dmtnds+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.syncml.ds.notification":{source:"iana"},"application/vnd.tableschema+json":{source:"iana",compressible:!0},"application/vnd.tao.intent-module-archive":{source:"iana",extensions:["tao"]},"application/vnd.tcpdump.pcap":{source:"iana",extensions:["pcap","cap","dmp"]},"application/vnd.think-cell.ppttc+json":{source:"iana",compressible:!0},"application/vnd.tmd.mediaflex.api+xml":{source:"iana",compressible:!0},"application/vnd.tml":{source:"iana"},"application/vnd.tmobile-livetv":{source:"iana",extensions:["tmo"]},"application/vnd.tri.onesource":{source:"iana"},"application/vnd.trid.tpt":{source:"iana",extensions:["tpt"]},"application/vnd.triscape.mxs":{source:"iana",extensions:["mxs"]},"application/vnd.trueapp":{source:"iana",extensions:["tra"]},"application/vnd.truedoc":{source:"iana"},"application/vnd.ubisoft.webplayer":{source:"iana"},"application/vnd.ufdl":{source:"iana",extensions:["ufd","ufdl"]},"application/vnd.uiq.theme":{source:"iana",extensions:["utz"]},"application/vnd.umajin":{source:"iana",extensions:["umj"]},"application/vnd.unity":{source:"iana",extensions:["unityweb"]},"application/vnd.uoml+xml":{source:"iana",compressible:!0,extensions:["uoml"]},"application/vnd.uplanet.alert":{source:"iana"},"application/vnd.uplanet.alert-wbxml":{source:"iana"},"application/vnd.uplanet.bearer-choice":{source:"iana"},"application/vnd.uplanet.bearer-choice-wbxml":{source:"iana"},"application/vnd.uplanet.cacheop":{source:"iana"},"application/vnd.uplanet.cacheop-wbxml":{source:"iana"},"application/vnd.uplanet.channel":{source:"iana"},"application/vnd.uplanet.channel-wbxml":{source:"iana"},"application/vnd.uplanet.list":{source:"iana"},"application/vnd.uplanet.list-wbxml":{source:"iana"},"application/vnd.uplanet.listcmd":{source:"iana"},"application/vnd.uplanet.listcmd-wbxml":{source:"iana"},"application/vnd.uplanet.signal":{source:"iana"},"application/vnd.uri-map":{source:"iana"},"application/vnd.valve.source.material":{source:"iana"},"application/vnd.vcx":{source:"iana",extensions:["vcx"]},"application/vnd.vd-study":{source:"iana"},"application/vnd.vectorworks":{source:"iana"},"application/vnd.vel+json":{source:"iana",compressible:!0},"application/vnd.verimatrix.vcas":{source:"iana"},"application/vnd.veritone.aion+json":{source:"iana",compressible:!0},"application/vnd.veryant.thin":{source:"iana"},"application/vnd.ves.encrypted":{source:"iana"},"application/vnd.vidsoft.vidconference":{source:"iana"},"application/vnd.visio":{source:"iana",extensions:["vsd","vst","vss","vsw"]},"application/vnd.visionary":{source:"iana",extensions:["vis"]},"application/vnd.vividence.scriptfile":{source:"iana"},"application/vnd.vsf":{source:"iana",extensions:["vsf"]},"application/vnd.wap.sic":{source:"iana"},"application/vnd.wap.slc":{source:"iana"},"application/vnd.wap.wbxml":{source:"iana",charset:"UTF-8",extensions:["wbxml"]},"application/vnd.wap.wmlc":{source:"iana",extensions:["wmlc"]},"application/vnd.wap.wmlscriptc":{source:"iana",extensions:["wmlsc"]},"application/vnd.webturbo":{source:"iana",extensions:["wtb"]},"application/vnd.wfa.dpp":{source:"iana"},"application/vnd.wfa.p2p":{source:"iana"},"application/vnd.wfa.wsc":{source:"iana"},"application/vnd.windows.devicepairing":{source:"iana"},"application/vnd.wmc":{source:"iana"},"application/vnd.wmf.bootstrap":{source:"iana"},"application/vnd.wolfram.mathematica":{source:"iana"},"application/vnd.wolfram.mathematica.package":{source:"iana"},"application/vnd.wolfram.player":{source:"iana",extensions:["nbp"]},"application/vnd.wordperfect":{source:"iana",extensions:["wpd"]},"application/vnd.wqd":{source:"iana",extensions:["wqd"]},"application/vnd.wrq-hp3000-labelled":{source:"iana"},"application/vnd.wt.stf":{source:"iana",extensions:["stf"]},"application/vnd.wv.csp+wbxml":{source:"iana"},"application/vnd.wv.csp+xml":{source:"iana",compressible:!0},"application/vnd.wv.ssp+xml":{source:"iana",compressible:!0},"application/vnd.xacml+json":{source:"iana",compressible:!0},"application/vnd.xara":{source:"iana",extensions:["xar"]},"application/vnd.xfdl":{source:"iana",extensions:["xfdl"]},"application/vnd.xfdl.webform":{source:"iana"},"application/vnd.xmi+xml":{source:"iana",compressible:!0},"application/vnd.xmpie.cpkg":{source:"iana"},"application/vnd.xmpie.dpkg":{source:"iana"},"application/vnd.xmpie.plan":{source:"iana"},"application/vnd.xmpie.ppkg":{source:"iana"},"application/vnd.xmpie.xlim":{source:"iana"},"application/vnd.yamaha.hv-dic":{source:"iana",extensions:["hvd"]},"application/vnd.yamaha.hv-script":{source:"iana",extensions:["hvs"]},"application/vnd.yamaha.hv-voice":{source:"iana",extensions:["hvp"]},"application/vnd.yamaha.openscoreformat":{source:"iana",extensions:["osf"]},"application/vnd.yamaha.openscoreformat.osfpvg+xml":{source:"iana",compressible:!0,extensions:["osfpvg"]},"application/vnd.yamaha.remote-setup":{source:"iana"},"application/vnd.yamaha.smaf-audio":{source:"iana",extensions:["saf"]},"application/vnd.yamaha.smaf-phrase":{source:"iana",extensions:["spf"]},"application/vnd.yamaha.through-ngn":{source:"iana"},"application/vnd.yamaha.tunnel-udpencap":{source:"iana"},"application/vnd.yaoweme":{source:"iana"},"application/vnd.yellowriver-custom-menu":{source:"iana",extensions:["cmp"]},"application/vnd.youtube.yt":{source:"iana"},"application/vnd.zul":{source:"iana",extensions:["zir","zirz"]},"application/vnd.zzazz.deck+xml":{source:"iana",compressible:!0,extensions:["zaz"]},"application/voicexml+xml":{source:"iana",compressible:!0,extensions:["vxml"]},"application/voucher-cms+json":{source:"iana",compressible:!0},"application/vq-rtcpxr":{source:"iana"},"application/wasm":{source:"iana",compressible:!0,extensions:["wasm"]},"application/watcherinfo+xml":{source:"iana",compressible:!0,extensions:["wif"]},"application/webpush-options+json":{source:"iana",compressible:!0},"application/whoispp-query":{source:"iana"},"application/whoispp-response":{source:"iana"},"application/widget":{source:"iana",extensions:["wgt"]},"application/winhlp":{source:"apache",extensions:["hlp"]},"application/wita":{source:"iana"},"application/wordperfect5.1":{source:"iana"},"application/wsdl+xml":{source:"iana",compressible:!0,extensions:["wsdl"]},"application/wspolicy+xml":{source:"iana",compressible:!0,extensions:["wspolicy"]},"application/x-7z-compressed":{source:"apache",compressible:!1,extensions:["7z"]},"application/x-abiword":{source:"apache",extensions:["abw"]},"application/x-ace-compressed":{source:"apache",extensions:["ace"]},"application/x-amf":{source:"apache"},"application/x-apple-diskimage":{source:"apache",extensions:["dmg"]},"application/x-arj":{compressible:!1,extensions:["arj"]},"application/x-authorware-bin":{source:"apache",extensions:["aab","x32","u32","vox"]},"application/x-authorware-map":{source:"apache",extensions:["aam"]},"application/x-authorware-seg":{source:"apache",extensions:["aas"]},"application/x-bcpio":{source:"apache",extensions:["bcpio"]},"application/x-bdoc":{compressible:!1,extensions:["bdoc"]},"application/x-bittorrent":{source:"apache",extensions:["torrent"]},"application/x-blorb":{source:"apache",extensions:["blb","blorb"]},"application/x-bzip":{source:"apache",compressible:!1,extensions:["bz"]},"application/x-bzip2":{source:"apache",compressible:!1,extensions:["bz2","boz"]},"application/x-cbr":{source:"apache",extensions:["cbr","cba","cbt","cbz","cb7"]},"application/x-cdlink":{source:"apache",extensions:["vcd"]},"application/x-cfs-compressed":{source:"apache",extensions:["cfs"]},"application/x-chat":{source:"apache",extensions:["chat"]},"application/x-chess-pgn":{source:"apache",extensions:["pgn"]},"application/x-chrome-extension":{extensions:["crx"]},"application/x-cocoa":{source:"nginx",extensions:["cco"]},"application/x-compress":{source:"apache"},"application/x-conference":{source:"apache",extensions:["nsc"]},"application/x-cpio":{source:"apache",extensions:["cpio"]},"application/x-csh":{source:"apache",extensions:["csh"]},"application/x-deb":{compressible:!1},"application/x-debian-package":{source:"apache",extensions:["deb","udeb"]},"application/x-dgc-compressed":{source:"apache",extensions:["dgc"]},"application/x-director":{source:"apache",extensions:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"]},"application/x-doom":{source:"apache",extensions:["wad"]},"application/x-dtbncx+xml":{source:"apache",compressible:!0,extensions:["ncx"]},"application/x-dtbook+xml":{source:"apache",compressible:!0,extensions:["dtb"]},"application/x-dtbresource+xml":{source:"apache",compressible:!0,extensions:["res"]},"application/x-dvi":{source:"apache",compressible:!1,extensions:["dvi"]},"application/x-envoy":{source:"apache",extensions:["evy"]},"application/x-eva":{source:"apache",extensions:["eva"]},"application/x-font-bdf":{source:"apache",extensions:["bdf"]},"application/x-font-dos":{source:"apache"},"application/x-font-framemaker":{source:"apache"},"application/x-font-ghostscript":{source:"apache",extensions:["gsf"]},"application/x-font-libgrx":{source:"apache"},"application/x-font-linux-psf":{source:"apache",extensions:["psf"]},"application/x-font-pcf":{source:"apache",extensions:["pcf"]},"application/x-font-snf":{source:"apache",extensions:["snf"]},"application/x-font-speedo":{source:"apache"},"application/x-font-sunos-news":{source:"apache"},"application/x-font-type1":{source:"apache",extensions:["pfa","pfb","pfm","afm"]},"application/x-font-vfont":{source:"apache"},"application/x-freearc":{source:"apache",extensions:["arc"]},"application/x-futuresplash":{source:"apache",extensions:["spl"]},"application/x-gca-compressed":{source:"apache",extensions:["gca"]},"application/x-glulx":{source:"apache",extensions:["ulx"]},"application/x-gnumeric":{source:"apache",extensions:["gnumeric"]},"application/x-gramps-xml":{source:"apache",extensions:["gramps"]},"application/x-gtar":{source:"apache",extensions:["gtar"]},"application/x-gzip":{source:"apache"},"application/x-hdf":{source:"apache",extensions:["hdf"]},"application/x-httpd-php":{compressible:!0,extensions:["php"]},"application/x-install-instructions":{source:"apache",extensions:["install"]},"application/x-iso9660-image":{source:"apache",extensions:["iso"]},"application/x-iwork-keynote-sffkey":{extensions:["key"]},"application/x-iwork-numbers-sffnumbers":{extensions:["numbers"]},"application/x-iwork-pages-sffpages":{extensions:["pages"]},"application/x-java-archive-diff":{source:"nginx",extensions:["jardiff"]},"application/x-java-jnlp-file":{source:"apache",compressible:!1,extensions:["jnlp"]},"application/x-javascript":{compressible:!0},"application/x-keepass2":{extensions:["kdbx"]},"application/x-latex":{source:"apache",compressible:!1,extensions:["latex"]},"application/x-lua-bytecode":{extensions:["luac"]},"application/x-lzh-compressed":{source:"apache",extensions:["lzh","lha"]},"application/x-makeself":{source:"nginx",extensions:["run"]},"application/x-mie":{source:"apache",extensions:["mie"]},"application/x-mobipocket-ebook":{source:"apache",extensions:["prc","mobi"]},"application/x-mpegurl":{compressible:!1},"application/x-ms-application":{source:"apache",extensions:["application"]},"application/x-ms-shortcut":{source:"apache",extensions:["lnk"]},"application/x-ms-wmd":{source:"apache",extensions:["wmd"]},"application/x-ms-wmz":{source:"apache",extensions:["wmz"]},"application/x-ms-xbap":{source:"apache",extensions:["xbap"]},"application/x-msaccess":{source:"apache",extensions:["mdb"]},"application/x-msbinder":{source:"apache",extensions:["obd"]},"application/x-mscardfile":{source:"apache",extensions:["crd"]},"application/x-msclip":{source:"apache",extensions:["clp"]},"application/x-msdos-program":{extensions:["exe"]},"application/x-msdownload":{source:"apache",extensions:["exe","dll","com","bat","msi"]},"application/x-msmediaview":{source:"apache",extensions:["mvb","m13","m14"]},"application/x-msmetafile":{source:"apache",extensions:["wmf","wmz","emf","emz"]},"application/x-msmoney":{source:"apache",extensions:["mny"]},"application/x-mspublisher":{source:"apache",extensions:["pub"]},"application/x-msschedule":{source:"apache",extensions:["scd"]},"application/x-msterminal":{source:"apache",extensions:["trm"]},"application/x-mswrite":{source:"apache",extensions:["wri"]},"application/x-netcdf":{source:"apache",extensions:["nc","cdf"]},"application/x-ns-proxy-autoconfig":{compressible:!0,extensions:["pac"]},"application/x-nzb":{source:"apache",extensions:["nzb"]},"application/x-perl":{source:"nginx",extensions:["pl","pm"]},"application/x-pilot":{source:"nginx",extensions:["prc","pdb"]},"application/x-pkcs12":{source:"apache",compressible:!1,extensions:["p12","pfx"]},"application/x-pkcs7-certificates":{source:"apache",extensions:["p7b","spc"]},"application/x-pkcs7-certreqresp":{source:"apache",extensions:["p7r"]},"application/x-pki-message":{source:"iana"},"application/x-rar-compressed":{source:"apache",compressible:!1,extensions:["rar"]},"application/x-redhat-package-manager":{source:"nginx",extensions:["rpm"]},"application/x-research-info-systems":{source:"apache",extensions:["ris"]},"application/x-sea":{source:"nginx",extensions:["sea"]},"application/x-sh":{source:"apache",compressible:!0,extensions:["sh"]},"application/x-shar":{source:"apache",extensions:["shar"]},"application/x-shockwave-flash":{source:"apache",compressible:!1,extensions:["swf"]},"application/x-silverlight-app":{source:"apache",extensions:["xap"]},"application/x-sql":{source:"apache",extensions:["sql"]},"application/x-stuffit":{source:"apache",compressible:!1,extensions:["sit"]},"application/x-stuffitx":{source:"apache",extensions:["sitx"]},"application/x-subrip":{source:"apache",extensions:["srt"]},"application/x-sv4cpio":{source:"apache",extensions:["sv4cpio"]},"application/x-sv4crc":{source:"apache",extensions:["sv4crc"]},"application/x-t3vm-image":{source:"apache",extensions:["t3"]},"application/x-tads":{source:"apache",extensions:["gam"]},"application/x-tar":{source:"apache",compressible:!0,extensions:["tar"]},"application/x-tcl":{source:"apache",extensions:["tcl","tk"]},"application/x-tex":{source:"apache",extensions:["tex"]},"application/x-tex-tfm":{source:"apache",extensions:["tfm"]},"application/x-texinfo":{source:"apache",extensions:["texinfo","texi"]},"application/x-tgif":{source:"apache",extensions:["obj"]},"application/x-ustar":{source:"apache",extensions:["ustar"]},"application/x-virtualbox-hdd":{compressible:!0,extensions:["hdd"]},"application/x-virtualbox-ova":{compressible:!0,extensions:["ova"]},"application/x-virtualbox-ovf":{compressible:!0,extensions:["ovf"]},"application/x-virtualbox-vbox":{compressible:!0,extensions:["vbox"]},"application/x-virtualbox-vbox-extpack":{compressible:!1,extensions:["vbox-extpack"]},"application/x-virtualbox-vdi":{compressible:!0,extensions:["vdi"]},"application/x-virtualbox-vhd":{compressible:!0,extensions:["vhd"]},"application/x-virtualbox-vmdk":{compressible:!0,extensions:["vmdk"]},"application/x-wais-source":{source:"apache",extensions:["src"]},"application/x-web-app-manifest+json":{compressible:!0,extensions:["webapp"]},"application/x-www-form-urlencoded":{source:"iana",compressible:!0},"application/x-x509-ca-cert":{source:"iana",extensions:["der","crt","pem"]},"application/x-x509-ca-ra-cert":{source:"iana"},"application/x-x509-next-ca-cert":{source:"iana"},"application/x-xfig":{source:"apache",extensions:["fig"]},"application/x-xliff+xml":{source:"apache",compressible:!0,extensions:["xlf"]},"application/x-xpinstall":{source:"apache",compressible:!1,extensions:["xpi"]},"application/x-xz":{source:"apache",extensions:["xz"]},"application/x-zmachine":{source:"apache",extensions:["z1","z2","z3","z4","z5","z6","z7","z8"]},"application/x400-bp":{source:"iana"},"application/xacml+xml":{source:"iana",compressible:!0},"application/xaml+xml":{source:"apache",compressible:!0,extensions:["xaml"]},"application/xcap-att+xml":{source:"iana",compressible:!0,extensions:["xav"]},"application/xcap-caps+xml":{source:"iana",compressible:!0,extensions:["xca"]},"application/xcap-diff+xml":{source:"iana",compressible:!0,extensions:["xdf"]},"application/xcap-el+xml":{source:"iana",compressible:!0,extensions:["xel"]},"application/xcap-error+xml":{source:"iana",compressible:!0},"application/xcap-ns+xml":{source:"iana",compressible:!0,extensions:["xns"]},"application/xcon-conference-info+xml":{source:"iana",compressible:!0},"application/xcon-conference-info-diff+xml":{source:"iana",compressible:!0},"application/xenc+xml":{source:"iana",compressible:!0,extensions:["xenc"]},"application/xhtml+xml":{source:"iana",compressible:!0,extensions:["xhtml","xht"]},"application/xhtml-voice+xml":{source:"apache",compressible:!0},"application/xliff+xml":{source:"iana",compressible:!0,extensions:["xlf"]},"application/xml":{source:"iana",compressible:!0,extensions:["xml","xsl","xsd","rng"]},"application/xml-dtd":{source:"iana",compressible:!0,extensions:["dtd"]},"application/xml-external-parsed-entity":{source:"iana"},"application/xml-patch+xml":{source:"iana",compressible:!0},"application/xmpp+xml":{source:"iana",compressible:!0},"application/xop+xml":{source:"iana",compressible:!0,extensions:["xop"]},"application/xproc+xml":{source:"apache",compressible:!0,extensions:["xpl"]},"application/xslt+xml":{source:"iana",compressible:!0,extensions:["xsl","xslt"]},"application/xspf+xml":{source:"apache",compressible:!0,extensions:["xspf"]},"application/xv+xml":{source:"iana",compressible:!0,extensions:["mxml","xhvml","xvml","xvm"]},"application/yang":{source:"iana",extensions:["yang"]},"application/yang-data+json":{source:"iana",compressible:!0},"application/yang-data+xml":{source:"iana",compressible:!0},"application/yang-patch+json":{source:"iana",compressible:!0},"application/yang-patch+xml":{source:"iana",compressible:!0},"application/yin+xml":{source:"iana",compressible:!0,extensions:["yin"]},"application/zip":{source:"iana",compressible:!1,extensions:["zip"]},"application/zlib":{source:"iana"},"application/zstd":{source:"iana"},"audio/1d-interleaved-parityfec":{source:"iana"},"audio/32kadpcm":{source:"iana"},"audio/3gpp":{source:"iana",compressible:!1,extensions:["3gpp"]},"audio/3gpp2":{source:"iana"},"audio/aac":{source:"iana"},"audio/ac3":{source:"iana"},"audio/adpcm":{source:"apache",extensions:["adp"]},"audio/amr":{source:"iana",extensions:["amr"]},"audio/amr-wb":{source:"iana"},"audio/amr-wb+":{source:"iana"},"audio/aptx":{source:"iana"},"audio/asc":{source:"iana"},"audio/atrac-advanced-lossless":{source:"iana"},"audio/atrac-x":{source:"iana"},"audio/atrac3":{source:"iana"},"audio/basic":{source:"iana",compressible:!1,extensions:["au","snd"]},"audio/bv16":{source:"iana"},"audio/bv32":{source:"iana"},"audio/clearmode":{source:"iana"},"audio/cn":{source:"iana"},"audio/dat12":{source:"iana"},"audio/dls":{source:"iana"},"audio/dsr-es201108":{source:"iana"},"audio/dsr-es202050":{source:"iana"},"audio/dsr-es202211":{source:"iana"},"audio/dsr-es202212":{source:"iana"},"audio/dv":{source:"iana"},"audio/dvi4":{source:"iana"},"audio/eac3":{source:"iana"},"audio/encaprtp":{source:"iana"},"audio/evrc":{source:"iana"},"audio/evrc-qcp":{source:"iana"},"audio/evrc0":{source:"iana"},"audio/evrc1":{source:"iana"},"audio/evrcb":{source:"iana"},"audio/evrcb0":{source:"iana"},"audio/evrcb1":{source:"iana"},"audio/evrcnw":{source:"iana"},"audio/evrcnw0":{source:"iana"},"audio/evrcnw1":{source:"iana"},"audio/evrcwb":{source:"iana"},"audio/evrcwb0":{source:"iana"},"audio/evrcwb1":{source:"iana"},"audio/evs":{source:"iana"},"audio/flexfec":{source:"iana"},"audio/fwdred":{source:"iana"},"audio/g711-0":{source:"iana"},"audio/g719":{source:"iana"},"audio/g722":{source:"iana"},"audio/g7221":{source:"iana"},"audio/g723":{source:"iana"},"audio/g726-16":{source:"iana"},"audio/g726-24":{source:"iana"},"audio/g726-32":{source:"iana"},"audio/g726-40":{source:"iana"},"audio/g728":{source:"iana"},"audio/g729":{source:"iana"},"audio/g7291":{source:"iana"},"audio/g729d":{source:"iana"},"audio/g729e":{source:"iana"},"audio/gsm":{source:"iana"},"audio/gsm-efr":{source:"iana"},"audio/gsm-hr-08":{source:"iana"},"audio/ilbc":{source:"iana"},"audio/ip-mr_v2.5":{source:"iana"},"audio/isac":{source:"apache"},"audio/l16":{source:"iana"},"audio/l20":{source:"iana"},"audio/l24":{source:"iana",compressible:!1},"audio/l8":{source:"iana"},"audio/lpc":{source:"iana"},"audio/melp":{source:"iana"},"audio/melp1200":{source:"iana"},"audio/melp2400":{source:"iana"},"audio/melp600":{source:"iana"},"audio/mhas":{source:"iana"},"audio/midi":{source:"apache",extensions:["mid","midi","kar","rmi"]},"audio/mobile-xmf":{source:"iana",extensions:["mxmf"]},"audio/mp3":{compressible:!1,extensions:["mp3"]},"audio/mp4":{source:"iana",compressible:!1,extensions:["m4a","mp4a"]},"audio/mp4a-latm":{source:"iana"},"audio/mpa":{source:"iana"},"audio/mpa-robust":{source:"iana"},"audio/mpeg":{source:"iana",compressible:!1,extensions:["mpga","mp2","mp2a","mp3","m2a","m3a"]},"audio/mpeg4-generic":{source:"iana"},"audio/musepack":{source:"apache"},"audio/ogg":{source:"iana",compressible:!1,extensions:["oga","ogg","spx","opus"]},"audio/opus":{source:"iana"},"audio/parityfec":{source:"iana"},"audio/pcma":{source:"iana"},"audio/pcma-wb":{source:"iana"},"audio/pcmu":{source:"iana"},"audio/pcmu-wb":{source:"iana"},"audio/prs.sid":{source:"iana"},"audio/qcelp":{source:"iana"},"audio/raptorfec":{source:"iana"},"audio/red":{source:"iana"},"audio/rtp-enc-aescm128":{source:"iana"},"audio/rtp-midi":{source:"iana"},"audio/rtploopback":{source:"iana"},"audio/rtx":{source:"iana"},"audio/s3m":{source:"apache",extensions:["s3m"]},"audio/scip":{source:"iana"},"audio/silk":{source:"apache",extensions:["sil"]},"audio/smv":{source:"iana"},"audio/smv-qcp":{source:"iana"},"audio/smv0":{source:"iana"},"audio/sofa":{source:"iana"},"audio/sp-midi":{source:"iana"},"audio/speex":{source:"iana"},"audio/t140c":{source:"iana"},"audio/t38":{source:"iana"},"audio/telephone-event":{source:"iana"},"audio/tetra_acelp":{source:"iana"},"audio/tetra_acelp_bb":{source:"iana"},"audio/tone":{source:"iana"},"audio/tsvcis":{source:"iana"},"audio/uemclip":{source:"iana"},"audio/ulpfec":{source:"iana"},"audio/usac":{source:"iana"},"audio/vdvi":{source:"iana"},"audio/vmr-wb":{source:"iana"},"audio/vnd.3gpp.iufp":{source:"iana"},"audio/vnd.4sb":{source:"iana"},"audio/vnd.audiokoz":{source:"iana"},"audio/vnd.celp":{source:"iana"},"audio/vnd.cisco.nse":{source:"iana"},"audio/vnd.cmles.radio-events":{source:"iana"},"audio/vnd.cns.anp1":{source:"iana"},"audio/vnd.cns.inf1":{source:"iana"},"audio/vnd.dece.audio":{source:"iana",extensions:["uva","uvva"]},"audio/vnd.digital-winds":{source:"iana",extensions:["eol"]},"audio/vnd.dlna.adts":{source:"iana"},"audio/vnd.dolby.heaac.1":{source:"iana"},"audio/vnd.dolby.heaac.2":{source:"iana"},"audio/vnd.dolby.mlp":{source:"iana"},"audio/vnd.dolby.mps":{source:"iana"},"audio/vnd.dolby.pl2":{source:"iana"},"audio/vnd.dolby.pl2x":{source:"iana"},"audio/vnd.dolby.pl2z":{source:"iana"},"audio/vnd.dolby.pulse.1":{source:"iana"},"audio/vnd.dra":{source:"iana",extensions:["dra"]},"audio/vnd.dts":{source:"iana",extensions:["dts"]},"audio/vnd.dts.hd":{source:"iana",extensions:["dtshd"]},"audio/vnd.dts.uhd":{source:"iana"},"audio/vnd.dvb.file":{source:"iana"},"audio/vnd.everad.plj":{source:"iana"},"audio/vnd.hns.audio":{source:"iana"},"audio/vnd.lucent.voice":{source:"iana",extensions:["lvp"]},"audio/vnd.ms-playready.media.pya":{source:"iana",extensions:["pya"]},"audio/vnd.nokia.mobile-xmf":{source:"iana"},"audio/vnd.nortel.vbk":{source:"iana"},"audio/vnd.nuera.ecelp4800":{source:"iana",extensions:["ecelp4800"]},"audio/vnd.nuera.ecelp7470":{source:"iana",extensions:["ecelp7470"]},"audio/vnd.nuera.ecelp9600":{source:"iana",extensions:["ecelp9600"]},"audio/vnd.octel.sbc":{source:"iana"},"audio/vnd.presonus.multitrack":{source:"iana"},"audio/vnd.qcelp":{source:"iana"},"audio/vnd.rhetorex.32kadpcm":{source:"iana"},"audio/vnd.rip":{source:"iana",extensions:["rip"]},"audio/vnd.rn-realaudio":{compressible:!1},"audio/vnd.sealedmedia.softseal.mpeg":{source:"iana"},"audio/vnd.vmx.cvsd":{source:"iana"},"audio/vnd.wave":{compressible:!1},"audio/vorbis":{source:"iana",compressible:!1},"audio/vorbis-config":{source:"iana"},"audio/wav":{compressible:!1,extensions:["wav"]},"audio/wave":{compressible:!1,extensions:["wav"]},"audio/webm":{source:"apache",compressible:!1,extensions:["weba"]},"audio/x-aac":{source:"apache",compressible:!1,extensions:["aac"]},"audio/x-aiff":{source:"apache",extensions:["aif","aiff","aifc"]},"audio/x-caf":{source:"apache",compressible:!1,extensions:["caf"]},"audio/x-flac":{source:"apache",extensions:["flac"]},"audio/x-m4a":{source:"nginx",extensions:["m4a"]},"audio/x-matroska":{source:"apache",extensions:["mka"]},"audio/x-mpegurl":{source:"apache",extensions:["m3u"]},"audio/x-ms-wax":{source:"apache",extensions:["wax"]},"audio/x-ms-wma":{source:"apache",extensions:["wma"]},"audio/x-pn-realaudio":{source:"apache",extensions:["ram","ra"]},"audio/x-pn-realaudio-plugin":{source:"apache",extensions:["rmp"]},"audio/x-realaudio":{source:"nginx",extensions:["ra"]},"audio/x-tta":{source:"apache"},"audio/x-wav":{source:"apache",extensions:["wav"]},"audio/xm":{source:"apache",extensions:["xm"]},"chemical/x-cdx":{source:"apache",extensions:["cdx"]},"chemical/x-cif":{source:"apache",extensions:["cif"]},"chemical/x-cmdf":{source:"apache",extensions:["cmdf"]},"chemical/x-cml":{source:"apache",extensions:["cml"]},"chemical/x-csml":{source:"apache",extensions:["csml"]},"chemical/x-pdb":{source:"apache"},"chemical/x-xyz":{source:"apache",extensions:["xyz"]},"font/collection":{source:"iana",extensions:["ttc"]},"font/otf":{source:"iana",compressible:!0,extensions:["otf"]},"font/sfnt":{source:"iana"},"font/ttf":{source:"iana",compressible:!0,extensions:["ttf"]},"font/woff":{source:"iana",extensions:["woff"]},"font/woff2":{source:"iana",extensions:["woff2"]},"image/aces":{source:"iana",extensions:["exr"]},"image/apng":{compressible:!1,extensions:["apng"]},"image/avci":{source:"iana",extensions:["avci"]},"image/avcs":{source:"iana",extensions:["avcs"]},"image/avif":{source:"iana",compressible:!1,extensions:["avif"]},"image/bmp":{source:"iana",compressible:!0,extensions:["bmp"]},"image/cgm":{source:"iana",extensions:["cgm"]},"image/dicom-rle":{source:"iana",extensions:["drle"]},"image/emf":{source:"iana",extensions:["emf"]},"image/fits":{source:"iana",extensions:["fits"]},"image/g3fax":{source:"iana",extensions:["g3"]},"image/gif":{source:"iana",compressible:!1,extensions:["gif"]},"image/heic":{source:"iana",extensions:["heic"]},"image/heic-sequence":{source:"iana",extensions:["heics"]},"image/heif":{source:"iana",extensions:["heif"]},"image/heif-sequence":{source:"iana",extensions:["heifs"]},"image/hej2k":{source:"iana",extensions:["hej2"]},"image/hsj2":{source:"iana",extensions:["hsj2"]},"image/ief":{source:"iana",extensions:["ief"]},"image/jls":{source:"iana",extensions:["jls"]},"image/jp2":{source:"iana",compressible:!1,extensions:["jp2","jpg2"]},"image/jpeg":{source:"iana",compressible:!1,extensions:["jpeg","jpg","jpe"]},"image/jph":{source:"iana",extensions:["jph"]},"image/jphc":{source:"iana",extensions:["jhc"]},"image/jpm":{source:"iana",compressible:!1,extensions:["jpm"]},"image/jpx":{source:"iana",compressible:!1,extensions:["jpx","jpf"]},"image/jxr":{source:"iana",extensions:["jxr"]},"image/jxra":{source:"iana",extensions:["jxra"]},"image/jxrs":{source:"iana",extensions:["jxrs"]},"image/jxs":{source:"iana",extensions:["jxs"]},"image/jxsc":{source:"iana",extensions:["jxsc"]},"image/jxsi":{source:"iana",extensions:["jxsi"]},"image/jxss":{source:"iana",extensions:["jxss"]},"image/ktx":{source:"iana",extensions:["ktx"]},"image/ktx2":{source:"iana",extensions:["ktx2"]},"image/naplps":{source:"iana"},"image/pjpeg":{compressible:!1},"image/png":{source:"iana",compressible:!1,extensions:["png"]},"image/prs.btif":{source:"iana",extensions:["btif"]},"image/prs.pti":{source:"iana",extensions:["pti"]},"image/pwg-raster":{source:"iana"},"image/sgi":{source:"apache",extensions:["sgi"]},"image/svg+xml":{source:"iana",compressible:!0,extensions:["svg","svgz"]},"image/t38":{source:"iana",extensions:["t38"]},"image/tiff":{source:"iana",compressible:!1,extensions:["tif","tiff"]},"image/tiff-fx":{source:"iana",extensions:["tfx"]},"image/vnd.adobe.photoshop":{source:"iana",compressible:!0,extensions:["psd"]},"image/vnd.airzip.accelerator.azv":{source:"iana",extensions:["azv"]},"image/vnd.cns.inf2":{source:"iana"},"image/vnd.dece.graphic":{source:"iana",extensions:["uvi","uvvi","uvg","uvvg"]},"image/vnd.djvu":{source:"iana",extensions:["djvu","djv"]},"image/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"image/vnd.dwg":{source:"iana",extensions:["dwg"]},"image/vnd.dxf":{source:"iana",extensions:["dxf"]},"image/vnd.fastbidsheet":{source:"iana",extensions:["fbs"]},"image/vnd.fpx":{source:"iana",extensions:["fpx"]},"image/vnd.fst":{source:"iana",extensions:["fst"]},"image/vnd.fujixerox.edmics-mmr":{source:"iana",extensions:["mmr"]},"image/vnd.fujixerox.edmics-rlc":{source:"iana",extensions:["rlc"]},"image/vnd.globalgraphics.pgb":{source:"iana"},"image/vnd.microsoft.icon":{source:"iana",compressible:!0,extensions:["ico"]},"image/vnd.mix":{source:"iana"},"image/vnd.mozilla.apng":{source:"iana"},"image/vnd.ms-dds":{compressible:!0,extensions:["dds"]},"image/vnd.ms-modi":{source:"iana",extensions:["mdi"]},"image/vnd.ms-photo":{source:"apache",extensions:["wdp"]},"image/vnd.net-fpx":{source:"iana",extensions:["npx"]},"image/vnd.pco.b16":{source:"iana",extensions:["b16"]},"image/vnd.radiance":{source:"iana"},"image/vnd.sealed.png":{source:"iana"},"image/vnd.sealedmedia.softseal.gif":{source:"iana"},"image/vnd.sealedmedia.softseal.jpg":{source:"iana"},"image/vnd.svf":{source:"iana"},"image/vnd.tencent.tap":{source:"iana",extensions:["tap"]},"image/vnd.valve.source.texture":{source:"iana",extensions:["vtf"]},"image/vnd.wap.wbmp":{source:"iana",extensions:["wbmp"]},"image/vnd.xiff":{source:"iana",extensions:["xif"]},"image/vnd.zbrush.pcx":{source:"iana",extensions:["pcx"]},"image/webp":{source:"apache",extensions:["webp"]},"image/wmf":{source:"iana",extensions:["wmf"]},"image/x-3ds":{source:"apache",extensions:["3ds"]},"image/x-cmu-raster":{source:"apache",extensions:["ras"]},"image/x-cmx":{source:"apache",extensions:["cmx"]},"image/x-freehand":{source:"apache",extensions:["fh","fhc","fh4","fh5","fh7"]},"image/x-icon":{source:"apache",compressible:!0,extensions:["ico"]},"image/x-jng":{source:"nginx",extensions:["jng"]},"image/x-mrsid-image":{source:"apache",extensions:["sid"]},"image/x-ms-bmp":{source:"nginx",compressible:!0,extensions:["bmp"]},"image/x-pcx":{source:"apache",extensions:["pcx"]},"image/x-pict":{source:"apache",extensions:["pic","pct"]},"image/x-portable-anymap":{source:"apache",extensions:["pnm"]},"image/x-portable-bitmap":{source:"apache",extensions:["pbm"]},"image/x-portable-graymap":{source:"apache",extensions:["pgm"]},"image/x-portable-pixmap":{source:"apache",extensions:["ppm"]},"image/x-rgb":{source:"apache",extensions:["rgb"]},"image/x-tga":{source:"apache",extensions:["tga"]},"image/x-xbitmap":{source:"apache",extensions:["xbm"]},"image/x-xcf":{compressible:!1},"image/x-xpixmap":{source:"apache",extensions:["xpm"]},"image/x-xwindowdump":{source:"apache",extensions:["xwd"]},"message/cpim":{source:"iana"},"message/delivery-status":{source:"iana"},"message/disposition-notification":{source:"iana",extensions:["disposition-notification"]},"message/external-body":{source:"iana"},"message/feedback-report":{source:"iana"},"message/global":{source:"iana",extensions:["u8msg"]},"message/global-delivery-status":{source:"iana",extensions:["u8dsn"]},"message/global-disposition-notification":{source:"iana",extensions:["u8mdn"]},"message/global-headers":{source:"iana",extensions:["u8hdr"]},"message/http":{source:"iana",compressible:!1},"message/imdn+xml":{source:"iana",compressible:!0},"message/news":{source:"iana"},"message/partial":{source:"iana",compressible:!1},"message/rfc822":{source:"iana",compressible:!0,extensions:["eml","mime"]},"message/s-http":{source:"iana"},"message/sip":{source:"iana"},"message/sipfrag":{source:"iana"},"message/tracking-status":{source:"iana"},"message/vnd.si.simp":{source:"iana"},"message/vnd.wfa.wsc":{source:"iana",extensions:["wsc"]},"model/3mf":{source:"iana",extensions:["3mf"]},"model/e57":{source:"iana"},"model/gltf+json":{source:"iana",compressible:!0,extensions:["gltf"]},"model/gltf-binary":{source:"iana",compressible:!0,extensions:["glb"]},"model/iges":{source:"iana",compressible:!1,extensions:["igs","iges"]},"model/mesh":{source:"iana",compressible:!1,extensions:["msh","mesh","silo"]},"model/mtl":{source:"iana",extensions:["mtl"]},"model/obj":{source:"iana",extensions:["obj"]},"model/step":{source:"iana"},"model/step+xml":{source:"iana",compressible:!0,extensions:["stpx"]},"model/step+zip":{source:"iana",compressible:!1,extensions:["stpz"]},"model/step-xml+zip":{source:"iana",compressible:!1,extensions:["stpxz"]},"model/stl":{source:"iana",extensions:["stl"]},"model/vnd.collada+xml":{source:"iana",compressible:!0,extensions:["dae"]},"model/vnd.dwf":{source:"iana",extensions:["dwf"]},"model/vnd.flatland.3dml":{source:"iana"},"model/vnd.gdl":{source:"iana",extensions:["gdl"]},"model/vnd.gs-gdl":{source:"apache"},"model/vnd.gs.gdl":{source:"iana"},"model/vnd.gtw":{source:"iana",extensions:["gtw"]},"model/vnd.moml+xml":{source:"iana",compressible:!0},"model/vnd.mts":{source:"iana",extensions:["mts"]},"model/vnd.opengex":{source:"iana",extensions:["ogex"]},"model/vnd.parasolid.transmit.binary":{source:"iana",extensions:["x_b"]},"model/vnd.parasolid.transmit.text":{source:"iana",extensions:["x_t"]},"model/vnd.pytha.pyox":{source:"iana"},"model/vnd.rosette.annotated-data-model":{source:"iana"},"model/vnd.sap.vds":{source:"iana",extensions:["vds"]},"model/vnd.usdz+zip":{source:"iana",compressible:!1,extensions:["usdz"]},"model/vnd.valve.source.compiled-map":{source:"iana",extensions:["bsp"]},"model/vnd.vtu":{source:"iana",extensions:["vtu"]},"model/vrml":{source:"iana",compressible:!1,extensions:["wrl","vrml"]},"model/x3d+binary":{source:"apache",compressible:!1,extensions:["x3db","x3dbz"]},"model/x3d+fastinfoset":{source:"iana",extensions:["x3db"]},"model/x3d+vrml":{source:"apache",compressible:!1,extensions:["x3dv","x3dvz"]},"model/x3d+xml":{source:"iana",compressible:!0,extensions:["x3d","x3dz"]},"model/x3d-vrml":{source:"iana",extensions:["x3dv"]},"multipart/alternative":{source:"iana",compressible:!1},"multipart/appledouble":{source:"iana"},"multipart/byteranges":{source:"iana"},"multipart/digest":{source:"iana"},"multipart/encrypted":{source:"iana",compressible:!1},"multipart/form-data":{source:"iana",compressible:!1},"multipart/header-set":{source:"iana"},"multipart/mixed":{source:"iana"},"multipart/multilingual":{source:"iana"},"multipart/parallel":{source:"iana"},"multipart/related":{source:"iana",compressible:!1},"multipart/report":{source:"iana"},"multipart/signed":{source:"iana",compressible:!1},"multipart/vnd.bint.med-plus":{source:"iana"},"multipart/voice-message":{source:"iana"},"multipart/x-mixed-replace":{source:"iana"},"text/1d-interleaved-parityfec":{source:"iana"},"text/cache-manifest":{source:"iana",compressible:!0,extensions:["appcache","manifest"]},"text/calendar":{source:"iana",extensions:["ics","ifb"]},"text/calender":{compressible:!0},"text/cmd":{compressible:!0},"text/coffeescript":{extensions:["coffee","litcoffee"]},"text/cql":{source:"iana"},"text/cql-expression":{source:"iana"},"text/cql-identifier":{source:"iana"},"text/css":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["css"]},"text/csv":{source:"iana",compressible:!0,extensions:["csv"]},"text/csv-schema":{source:"iana"},"text/directory":{source:"iana"},"text/dns":{source:"iana"},"text/ecmascript":{source:"iana"},"text/encaprtp":{source:"iana"},"text/enriched":{source:"iana"},"text/fhirpath":{source:"iana"},"text/flexfec":{source:"iana"},"text/fwdred":{source:"iana"},"text/gff3":{source:"iana"},"text/grammar-ref-list":{source:"iana"},"text/html":{source:"iana",compressible:!0,extensions:["html","htm","shtml"]},"text/jade":{extensions:["jade"]},"text/javascript":{source:"iana",compressible:!0},"text/jcr-cnd":{source:"iana"},"text/jsx":{compressible:!0,extensions:["jsx"]},"text/less":{compressible:!0,extensions:["less"]},"text/markdown":{source:"iana",compressible:!0,extensions:["markdown","md"]},"text/mathml":{source:"nginx",extensions:["mml"]},"text/mdx":{compressible:!0,extensions:["mdx"]},"text/mizar":{source:"iana"},"text/n3":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["n3"]},"text/parameters":{source:"iana",charset:"UTF-8"},"text/parityfec":{source:"iana"},"text/plain":{source:"iana",compressible:!0,extensions:["txt","text","conf","def","list","log","in","ini"]},"text/provenance-notation":{source:"iana",charset:"UTF-8"},"text/prs.fallenstein.rst":{source:"iana"},"text/prs.lines.tag":{source:"iana",extensions:["dsc"]},"text/prs.prop.logic":{source:"iana"},"text/raptorfec":{source:"iana"},"text/red":{source:"iana"},"text/rfc822-headers":{source:"iana"},"text/richtext":{source:"iana",compressible:!0,extensions:["rtx"]},"text/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"text/rtp-enc-aescm128":{source:"iana"},"text/rtploopback":{source:"iana"},"text/rtx":{source:"iana"},"text/sgml":{source:"iana",extensions:["sgml","sgm"]},"text/shaclc":{source:"iana"},"text/shex":{source:"iana",extensions:["shex"]},"text/slim":{extensions:["slim","slm"]},"text/spdx":{source:"iana",extensions:["spdx"]},"text/strings":{source:"iana"},"text/stylus":{extensions:["stylus","styl"]},"text/t140":{source:"iana"},"text/tab-separated-values":{source:"iana",compressible:!0,extensions:["tsv"]},"text/troff":{source:"iana",extensions:["t","tr","roff","man","me","ms"]},"text/turtle":{source:"iana",charset:"UTF-8",extensions:["ttl"]},"text/ulpfec":{source:"iana"},"text/uri-list":{source:"iana",compressible:!0,extensions:["uri","uris","urls"]},"text/vcard":{source:"iana",compressible:!0,extensions:["vcard"]},"text/vnd.a":{source:"iana"},"text/vnd.abc":{source:"iana"},"text/vnd.ascii-art":{source:"iana"},"text/vnd.curl":{source:"iana",extensions:["curl"]},"text/vnd.curl.dcurl":{source:"apache",extensions:["dcurl"]},"text/vnd.curl.mcurl":{source:"apache",extensions:["mcurl"]},"text/vnd.curl.scurl":{source:"apache",extensions:["scurl"]},"text/vnd.debian.copyright":{source:"iana",charset:"UTF-8"},"text/vnd.dmclientscript":{source:"iana"},"text/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"text/vnd.esmertec.theme-descriptor":{source:"iana",charset:"UTF-8"},"text/vnd.familysearch.gedcom":{source:"iana",extensions:["ged"]},"text/vnd.ficlab.flt":{source:"iana"},"text/vnd.fly":{source:"iana",extensions:["fly"]},"text/vnd.fmi.flexstor":{source:"iana",extensions:["flx"]},"text/vnd.gml":{source:"iana"},"text/vnd.graphviz":{source:"iana",extensions:["gv"]},"text/vnd.hans":{source:"iana"},"text/vnd.hgl":{source:"iana"},"text/vnd.in3d.3dml":{source:"iana",extensions:["3dml"]},"text/vnd.in3d.spot":{source:"iana",extensions:["spot"]},"text/vnd.iptc.newsml":{source:"iana"},"text/vnd.iptc.nitf":{source:"iana"},"text/vnd.latex-z":{source:"iana"},"text/vnd.motorola.reflex":{source:"iana"},"text/vnd.ms-mediapackage":{source:"iana"},"text/vnd.net2phone.commcenter.command":{source:"iana"},"text/vnd.radisys.msml-basic-layout":{source:"iana"},"text/vnd.senx.warpscript":{source:"iana"},"text/vnd.si.uricatalogue":{source:"iana"},"text/vnd.sosi":{source:"iana"},"text/vnd.sun.j2me.app-descriptor":{source:"iana",charset:"UTF-8",extensions:["jad"]},"text/vnd.trolltech.linguist":{source:"iana",charset:"UTF-8"},"text/vnd.wap.si":{source:"iana"},"text/vnd.wap.sl":{source:"iana"},"text/vnd.wap.wml":{source:"iana",extensions:["wml"]},"text/vnd.wap.wmlscript":{source:"iana",extensions:["wmls"]},"text/vtt":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["vtt"]},"text/x-asm":{source:"apache",extensions:["s","asm"]},"text/x-c":{source:"apache",extensions:["c","cc","cxx","cpp","h","hh","dic"]},"text/x-component":{source:"nginx",extensions:["htc"]},"text/x-fortran":{source:"apache",extensions:["f","for","f77","f90"]},"text/x-gwt-rpc":{compressible:!0},"text/x-handlebars-template":{extensions:["hbs"]},"text/x-java-source":{source:"apache",extensions:["java"]},"text/x-jquery-tmpl":{compressible:!0},"text/x-lua":{extensions:["lua"]},"text/x-markdown":{compressible:!0,extensions:["mkd"]},"text/x-nfo":{source:"apache",extensions:["nfo"]},"text/x-opml":{source:"apache",extensions:["opml"]},"text/x-org":{compressible:!0,extensions:["org"]},"text/x-pascal":{source:"apache",extensions:["p","pas"]},"text/x-processing":{compressible:!0,extensions:["pde"]},"text/x-sass":{extensions:["sass"]},"text/x-scss":{extensions:["scss"]},"text/x-setext":{source:"apache",extensions:["etx"]},"text/x-sfv":{source:"apache",extensions:["sfv"]},"text/x-suse-ymp":{compressible:!0,extensions:["ymp"]},"text/x-uuencode":{source:"apache",extensions:["uu"]},"text/x-vcalendar":{source:"apache",extensions:["vcs"]},"text/x-vcard":{source:"apache",extensions:["vcf"]},"text/xml":{source:"iana",compressible:!0,extensions:["xml"]},"text/xml-external-parsed-entity":{source:"iana"},"text/yaml":{compressible:!0,extensions:["yaml","yml"]},"video/1d-interleaved-parityfec":{source:"iana"},"video/3gpp":{source:"iana",extensions:["3gp","3gpp"]},"video/3gpp-tt":{source:"iana"},"video/3gpp2":{source:"iana",extensions:["3g2"]},"video/av1":{source:"iana"},"video/bmpeg":{source:"iana"},"video/bt656":{source:"iana"},"video/celb":{source:"iana"},"video/dv":{source:"iana"},"video/encaprtp":{source:"iana"},"video/ffv1":{source:"iana"},"video/flexfec":{source:"iana"},"video/h261":{source:"iana",extensions:["h261"]},"video/h263":{source:"iana",extensions:["h263"]},"video/h263-1998":{source:"iana"},"video/h263-2000":{source:"iana"},"video/h264":{source:"iana",extensions:["h264"]},"video/h264-rcdo":{source:"iana"},"video/h264-svc":{source:"iana"},"video/h265":{source:"iana"},"video/iso.segment":{source:"iana",extensions:["m4s"]},"video/jpeg":{source:"iana",extensions:["jpgv"]},"video/jpeg2000":{source:"iana"},"video/jpm":{source:"apache",extensions:["jpm","jpgm"]},"video/jxsv":{source:"iana"},"video/mj2":{source:"iana",extensions:["mj2","mjp2"]},"video/mp1s":{source:"iana"},"video/mp2p":{source:"iana"},"video/mp2t":{source:"iana",extensions:["ts"]},"video/mp4":{source:"iana",compressible:!1,extensions:["mp4","mp4v","mpg4"]},"video/mp4v-es":{source:"iana"},"video/mpeg":{source:"iana",compressible:!1,extensions:["mpeg","mpg","mpe","m1v","m2v"]},"video/mpeg4-generic":{source:"iana"},"video/mpv":{source:"iana"},"video/nv":{source:"iana"},"video/ogg":{source:"iana",compressible:!1,extensions:["ogv"]},"video/parityfec":{source:"iana"},"video/pointer":{source:"iana"},"video/quicktime":{source:"iana",compressible:!1,extensions:["qt","mov"]},"video/raptorfec":{source:"iana"},"video/raw":{source:"iana"},"video/rtp-enc-aescm128":{source:"iana"},"video/rtploopback":{source:"iana"},"video/rtx":{source:"iana"},"video/scip":{source:"iana"},"video/smpte291":{source:"iana"},"video/smpte292m":{source:"iana"},"video/ulpfec":{source:"iana"},"video/vc1":{source:"iana"},"video/vc2":{source:"iana"},"video/vnd.cctv":{source:"iana"},"video/vnd.dece.hd":{source:"iana",extensions:["uvh","uvvh"]},"video/vnd.dece.mobile":{source:"iana",extensions:["uvm","uvvm"]},"video/vnd.dece.mp4":{source:"iana"},"video/vnd.dece.pd":{source:"iana",extensions:["uvp","uvvp"]},"video/vnd.dece.sd":{source:"iana",extensions:["uvs","uvvs"]},"video/vnd.dece.video":{source:"iana",extensions:["uvv","uvvv"]},"video/vnd.directv.mpeg":{source:"iana"},"video/vnd.directv.mpeg-tts":{source:"iana"},"video/vnd.dlna.mpeg-tts":{source:"iana"},"video/vnd.dvb.file":{source:"iana",extensions:["dvb"]},"video/vnd.fvt":{source:"iana",extensions:["fvt"]},"video/vnd.hns.video":{source:"iana"},"video/vnd.iptvforum.1dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.1dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.2dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.2dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.ttsavc":{source:"iana"},"video/vnd.iptvforum.ttsmpeg2":{source:"iana"},"video/vnd.motorola.video":{source:"iana"},"video/vnd.motorola.videop":{source:"iana"},"video/vnd.mpegurl":{source:"iana",extensions:["mxu","m4u"]},"video/vnd.ms-playready.media.pyv":{source:"iana",extensions:["pyv"]},"video/vnd.nokia.interleaved-multimedia":{source:"iana"},"video/vnd.nokia.mp4vr":{source:"iana"},"video/vnd.nokia.videovoip":{source:"iana"},"video/vnd.objectvideo":{source:"iana"},"video/vnd.radgamettools.bink":{source:"iana"},"video/vnd.radgamettools.smacker":{source:"iana"},"video/vnd.sealed.mpeg1":{source:"iana"},"video/vnd.sealed.mpeg4":{source:"iana"},"video/vnd.sealed.swf":{source:"iana"},"video/vnd.sealedmedia.softseal.mov":{source:"iana"},"video/vnd.uvvu.mp4":{source:"iana",extensions:["uvu","uvvu"]},"video/vnd.vivo":{source:"iana",extensions:["viv"]},"video/vnd.youtube.yt":{source:"iana"},"video/vp8":{source:"iana"},"video/vp9":{source:"iana"},"video/webm":{source:"apache",compressible:!1,extensions:["webm"]},"video/x-f4v":{source:"apache",extensions:["f4v"]},"video/x-fli":{source:"apache",extensions:["fli"]},"video/x-flv":{source:"apache",compressible:!1,extensions:["flv"]},"video/x-m4v":{source:"apache",extensions:["m4v"]},"video/x-matroska":{source:"apache",compressible:!1,extensions:["mkv","mk3d","mks"]},"video/x-mng":{source:"apache",extensions:["mng"]},"video/x-ms-asf":{source:"apache",extensions:["asf","asx"]},"video/x-ms-vob":{source:"apache",extensions:["vob"]},"video/x-ms-wm":{source:"apache",extensions:["wm"]},"video/x-ms-wmv":{source:"apache",compressible:!1,extensions:["wmv"]},"video/x-ms-wmx":{source:"apache",extensions:["wmx"]},"video/x-ms-wvx":{source:"apache",extensions:["wvx"]},"video/x-msvideo":{source:"apache",extensions:["avi"]},"video/x-sgi-movie":{source:"apache",extensions:["movie"]},"video/x-smv":{source:"apache",extensions:["smv"]},"x-conference/x-cooltalk":{source:"apache",extensions:["ice"]},"x-shader/x-fragment":{compressible:!0},"x-shader/x-vertex":{compressible:!0}};
/*!
 * mime-types
 * Copyright(c) 2014 Jonathan Ong
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
!function(e){var t,n,r,i=Ke,s=c.extname,a=/^\s*([^;\s]*)(?:;|\s|$)/,o=/^text\//i;function l(e){if(!e||"string"!=typeof e)return!1;var t=a.exec(e),n=t&&i[t[1].toLowerCase()];return n&&n.charset?n.charset:!(!t||!o.test(t[1]))&&"UTF-8"}e.charset=l,e.charsets={lookup:l},e.contentType=function(t){if(!t||"string"!=typeof t)return!1;var n=-1===t.indexOf("/")?e.lookup(t):t;if(!n)return!1;if(-1===n.indexOf("charset")){var r=e.charset(n);r&&(n+="; charset="+r.toLowerCase())}return n},e.extension=function(t){if(!t||"string"!=typeof t)return!1;var n=a.exec(t),r=n&&e.extensions[n[1].toLowerCase()];if(!r||!r.length)return!1;return r[0]},e.extensions=Object.create(null),e.lookup=function(t){if(!t||"string"!=typeof t)return!1;var n=s("x."+t).toLowerCase().substr(1);if(!n)return!1;return e.types[n]||!1},e.types=Object.create(null),t=e.extensions,n=e.types,r=["nginx","apache",void 0,"iana"],Object.keys(i).forEach(function(e){var s=i[e],a=s.extensions;if(a&&a.length){t[e]=a;for(var o=0;o<a.length;o++){var c=a[o];if(n[c]){var l=r.indexOf(i[n[c]].source),u=r.indexOf(s.source);if("application/octet-stream"!==n[c]&&(l>u||l===u&&"application/"===n[c].substr(0,12)))continue}n[c]=e}}})}(He);var Ge=function(e){var t="function"==typeof setImmediate?setImmediate:"object"==typeof process&&"function"==typeof process.nextTick?process.nextTick:null;t?t(e):setTimeout(e,0)},Ve=function(e){var t=!1;return Ge(function(){t=!0}),function(n,r){t?e(n,r):Ge(function(){e(n,r)})}};var Ze=function(e){Object.keys(e.jobs).forEach(Je.bind(e)),e.jobs={}};function Je(e){"function"==typeof this.jobs[e]&&this.jobs[e]()}var Ye=Ve,Xe=Ze,Qe=function(e,t,n,r){var i=n.keyedList?n.keyedList[n.index]:n.index;n.jobs[i]=function(e,t,n,r){var i;i=2==e.length?e(n,Ye(r)):e(n,t,Ye(r));return i}(t,i,e[i],function(e,t){i in n.jobs&&(delete n.jobs[i],e?Xe(n):n.results[i]=t,r(e,n.results))})};var et=function(e,t){var n=!Array.isArray(e),r={index:0,keyedList:n||t?Object.keys(e):null,jobs:{},results:n?{}:[],size:n?Object.keys(e).length:e.length};t&&r.keyedList.sort(n?t:function(n,r){return t(e[n],e[r])});return r};var tt=Ze,nt=Ve,rt=function(e){if(!Object.keys(this.jobs).length)return;this.index=this.size,tt(this),nt(e)(null,this.results)};var it=Qe,st=et,at=rt,ot=function(e,t,n){var r=st(e);for(;r.index<(r.keyedList||e).length;)it(e,t,r,function(e,t){e?n(e,t):0!==Object.keys(r.jobs).length||n(null,r.results)}),r.index++;return at.bind(r,n)};var ct={exports:{}},lt=Qe,ut=et,dt=rt;function pt(e,t){return e<t?-1:e>t?1:0}ct.exports=function(e,t,n,r){var i=ut(e,n);return lt(e,t,i,function n(s,a){s?r(s,a):(i.index++,i.index<(i.keyedList||e).length?lt(e,t,i,n):r(null,i.results))}),dt.bind(i,r)},ct.exports.ascending=pt,ct.exports.descending=function(e,t){return-1*pt(e,t)};var ht=ct.exports,mt=ht,ft=function(e,t,n){return mt(e,t,null,n)};var gt,yt,vt={parallel:ot,serial:ft,serialOrdered:ht},bt=Object,wt=Error,_t=EvalError,xt=RangeError,Et=ReferenceError,St=SyntaxError;function kt(){return yt?gt:(yt=1,gt=TypeError)}var At=URIError,Ot=Math.abs,Ct=Math.floor,It=Math.max,Tt=Math.min,Pt=Math.pow,Rt=Math.round,jt=Number.isNaN||function(e){return e!=e},Nt=jt,$t=Object.getOwnPropertyDescriptor;if($t)try{$t([],"length")}catch(XZ){$t=null}var Lt=$t,Dt=Object.defineProperty||!1;if(Dt)try{Dt({},"a",{value:1})}catch(XZ){Dt=!1}var Ut,Mt,Ft,zt,Bt,qt,Wt,Ht,Kt=Dt;function Gt(){return Mt?Ut:(Mt=1,Ut=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(var r in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var i=Object.getOwnPropertySymbols(e);if(1!==i.length||i[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var s=Object.getOwnPropertyDescriptor(e,t);if(42!==s.value||!0!==s.enumerable)return!1}return!0})}function Vt(){return qt?Bt:(qt=1,Bt="undefined"!=typeof Reflect&&Reflect.getPrototypeOf||null)}function Zt(){return Ht?Wt:(Ht=1,Wt=bt.getPrototypeOf||null)}var Jt,Yt,Xt,Qt,en,tn,nn,rn,sn,an,on,cn,ln,un,dn=Object.prototype.toString,pn=Math.max,hn=function(e,t){for(var n=[],r=0;r<e.length;r+=1)n[r]=e[r];for(var i=0;i<t.length;i+=1)n[i+e.length]=t[i];return n},mn=function(e){var t=this;if("function"!=typeof t||"[object Function]"!==dn.apply(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var n,r=function(e,t){for(var n=[],r=t,i=0;r<e.length;r+=1,i+=1)n[i]=e[r];return n}(arguments,1),i=pn(0,t.length-r.length),s=[],a=0;a<i;a++)s[a]="$"+a;if(n=Function("binder","return function ("+function(e,t){for(var n="",r=0;r<e.length;r+=1)n+=e[r],r+1<e.length&&(n+=t);return n}(s,",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof n){var i=t.apply(this,hn(r,arguments));return Object(i)===i?i:this}return t.apply(e,hn(r,arguments))}),t.prototype){var o=function(){};o.prototype=t.prototype,n.prototype=new o,o.prototype=null}return n},fn=Function.prototype.bind||mn;function gn(){return Yt?Jt:(Yt=1,Jt=Function.prototype.call)}function yn(){return Qt?Xt:(Qt=1,Xt=Function.prototype.apply)}function vn(){if(rn)return nn;rn=1;var e=fn,t=yn(),n=gn(),r=tn?en:(tn=1,en="undefined"!=typeof Reflect&&Reflect&&Reflect.apply);return nn=r||e.call(n,t)}function bn(){if(cn)return on;cn=1;var e,t=function(){if(an)return sn;an=1;var e=fn,t=kt(),n=gn(),r=vn();return sn=function(i){if(i.length<1||"function"!=typeof i[0])throw new t("a function is required");return r(e,n,i)}}(),n=Lt;try{e=[].__proto__===Array.prototype}catch(e){if(!e||"object"!=typeof e||!("code"in e)||"ERR_PROTO_ACCESS"!==e.code)throw e}var r=!!e&&n&&n(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return on=r&&"function"==typeof r.get?t([r.get]):"function"==typeof s&&function(e){return s(null==e?e:i(e))}}var wn,_n=Function.prototype.call,xn=Object.prototype.hasOwnProperty,En=fn.call(_n,xn),Sn=bt,kn=wt,An=_t,On=xt,Cn=Et,In=St,Tn=kt(),Pn=At,Rn=Ot,jn=Ct,Nn=It,$n=Tt,Ln=Pt,Dn=Rt,Un=function(e){return Nt(e)||0===e?e:e<0?-1:1},Mn=Function,Fn=function(e){try{return Mn('"use strict"; return ('+e+").constructor;")()}catch(e){}},zn=Lt,Bn=Kt,qn=function(){throw new Tn},Wn=zn?function(){try{return qn}catch(e){try{return zn(arguments,"callee").get}catch(e){return qn}}}():qn,Hn=function(){if(zt)return Ft;zt=1;var e="undefined"!=typeof Symbol&&Symbol,t=Gt();return Ft=function(){return"function"==typeof e&&("function"==typeof Symbol&&("symbol"==typeof e("foo")&&("symbol"==typeof Symbol("bar")&&t())))}}()(),Kn=function(){if(un)return ln;un=1;var e=Vt(),t=Zt(),n=bn();return ln=e?function(t){return e(t)}:t?function(e){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("getProto: not an object");return t(e)}:n?function(e){return n(e)}:null}(),Gn=Zt(),Vn=Vt(),Zn=yn(),Jn=gn(),Yn={},Xn="undefined"!=typeof Uint8Array&&Kn?Kn(Uint8Array):wn,Qn={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?wn:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?wn:ArrayBuffer,"%ArrayIteratorPrototype%":Hn&&Kn?Kn([][Symbol.iterator]()):wn,"%AsyncFromSyncIteratorPrototype%":wn,"%AsyncFunction%":Yn,"%AsyncGenerator%":Yn,"%AsyncGeneratorFunction%":Yn,"%AsyncIteratorPrototype%":Yn,"%Atomics%":"undefined"==typeof Atomics?wn:Atomics,"%BigInt%":"undefined"==typeof BigInt?wn:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?wn:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?wn:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?wn:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":kn,"%eval%":eval,"%EvalError%":An,"%Float16Array%":"undefined"==typeof Float16Array?wn:Float16Array,"%Float32Array%":"undefined"==typeof Float32Array?wn:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?wn:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?wn:FinalizationRegistry,"%Function%":Mn,"%GeneratorFunction%":Yn,"%Int8Array%":"undefined"==typeof Int8Array?wn:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?wn:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?wn:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Hn&&Kn?Kn(Kn([][Symbol.iterator]())):wn,"%JSON%":"object"==typeof JSON?JSON:wn,"%Map%":"undefined"==typeof Map?wn:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&Hn&&Kn?Kn((new Map)[Symbol.iterator]()):wn,"%Math%":Math,"%Number%":Number,"%Object%":Sn,"%Object.getOwnPropertyDescriptor%":zn,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?wn:Promise,"%Proxy%":"undefined"==typeof Proxy?wn:Proxy,"%RangeError%":On,"%ReferenceError%":Cn,"%Reflect%":"undefined"==typeof Reflect?wn:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?wn:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&Hn&&Kn?Kn((new Set)[Symbol.iterator]()):wn,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?wn:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Hn&&Kn?Kn(""[Symbol.iterator]()):wn,"%Symbol%":Hn?Symbol:wn,"%SyntaxError%":In,"%ThrowTypeError%":Wn,"%TypedArray%":Xn,"%TypeError%":Tn,"%Uint8Array%":"undefined"==typeof Uint8Array?wn:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?wn:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?wn:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?wn:Uint32Array,"%URIError%":Pn,"%WeakMap%":"undefined"==typeof WeakMap?wn:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?wn:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?wn:WeakSet,"%Function.prototype.call%":Jn,"%Function.prototype.apply%":Zn,"%Object.defineProperty%":Bn,"%Object.getPrototypeOf%":Gn,"%Math.abs%":Rn,"%Math.floor%":jn,"%Math.max%":Nn,"%Math.min%":$n,"%Math.pow%":Ln,"%Math.round%":Dn,"%Math.sign%":Un,"%Reflect.getPrototypeOf%":Vn};if(Kn)try{null.error}catch(XZ){var er=Kn(Kn(XZ));Qn["%Error.prototype%"]=er}var tr,nr,rr=function e(t){var n;if("%AsyncFunction%"===t)n=Fn("async function () {}");else if("%GeneratorFunction%"===t)n=Fn("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=Fn("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&Kn&&(n=Kn(i.prototype))}return Qn[t]=n,n},ir={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},sr=fn,ar=En,or=sr.call(Jn,Array.prototype.concat),cr=sr.call(Zn,Array.prototype.splice),lr=sr.call(Jn,String.prototype.replace),ur=sr.call(Jn,String.prototype.slice),dr=sr.call(Jn,RegExp.prototype.exec),pr=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,hr=/\\(\\)?/g,mr=function(e,t){var n,r=e;if(ar(ir,r)&&(r="%"+(n=ir[r])[0]+"%"),ar(Qn,r)){var i=Qn[r];if(i===Yn&&(i=rr(r)),void 0===i&&!t)throw new Tn("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:i}}throw new In("intrinsic "+e+" does not exist!")};var fr=function(e,t){if("string"!=typeof e||0===e.length)throw new Tn("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new Tn('"allowMissing" argument must be a boolean');if(null===dr(/^%?[^%]*%?$/,e))throw new In("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(e){var t=ur(e,0,1),n=ur(e,-1);if("%"===t&&"%"!==n)throw new In("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new In("invalid intrinsic syntax, expected opening `%`");var r=[];return lr(e,pr,function(e,t,n,i){r[r.length]=n?lr(i,hr,"$1"):t||e}),r}(e),r=n.length>0?n[0]:"",i=mr("%"+r+"%",t),s=i.name,a=i.value,o=!1,c=i.alias;c&&(r=c[0],cr(n,or([0,1],c)));for(var l=1,u=!0;l<n.length;l+=1){var d=n[l],p=ur(d,0,1),h=ur(d,-1);if(('"'===p||"'"===p||"`"===p||'"'===h||"'"===h||"`"===h)&&p!==h)throw new In("property names with quotes must have matching quotes");if("constructor"!==d&&u||(o=!0),ar(Qn,s="%"+(r+="."+d)+"%"))a=Qn[s];else if(null!=a){if(!(d in a)){if(!t)throw new Tn("base intrinsic for "+e+" exists, but the property is not available.");return}if(zn&&l+1>=n.length){var m=zn(a,d);a=(u=!!m)&&"get"in m&&!("originalValue"in m.get)?m.get:a[d]}else u=ar(a,d),a=a[d];u&&!o&&(Qn[s]=a)}}return a},gr=fr("%Object.defineProperty%",!0),yr=function(){if(nr)return tr;nr=1;var e=Gt();return tr=function(){return e()&&!!Symbol.toStringTag}}()(),vr=En,br=kt(),wr=yr?Symbol.toStringTag:null,_r=qe,xr=e,Er=c,Sr=d,kr=m,Ar=y.parse,Or=b,Cr=n.Stream,Ir=S,Tr=He,Pr=vt,Rr=function(e,t){var n=arguments.length>2&&!!arguments[2]&&arguments[2].force,r=arguments.length>2&&!!arguments[2]&&arguments[2].nonConfigurable;if(void 0!==n&&"boolean"!=typeof n||void 0!==r&&"boolean"!=typeof r)throw new br("if provided, the `overrideIfSet` and `nonConfigurable` options must be booleans");!wr||!n&&vr(e,wr)||(gr?gr(e,wr,{configurable:!r,enumerable:!1,value:t,writable:!1}):e[wr]=t)},jr=En,Nr=function(e,t){return Object.keys(t).forEach(function(n){e[n]=e[n]||t[n]}),e};function $r(e){if(!(this instanceof $r))return new $r(e);for(var t in this._overheadLength=0,this._valueLength=0,this._valuesToMeasure=[],_r.call(this),e=e||{})this[t]=e[t]}xr.inherits($r,_r),$r.LINE_BREAK="\r\n",$r.DEFAULT_CONTENT_TYPE="application/octet-stream",$r.prototype.append=function(e,t,n){"string"==typeof(n=n||{})&&(n={filename:n});var r=_r.prototype.append.bind(this);if("number"!=typeof t&&null!=t||(t=String(t)),Array.isArray(t))this._error(new Error("Arrays are not supported."));else{var i=this._multiPartHeader(e,t,n),s=this._multiPartFooter();r(i),r(t),r(s),this._trackLength(i,t,n)}},$r.prototype._trackLength=function(e,t,n){var r=0;null!=n.knownLength?r+=Number(n.knownLength):Buffer.isBuffer(t)?r=t.length:"string"==typeof t&&(r=Buffer.byteLength(t)),this._valueLength+=r,this._overheadLength+=Buffer.byteLength(e)+$r.LINE_BREAK.length,t&&(t.path||t.readable&&jr(t,"httpVersion")||t instanceof Cr)&&(n.knownLength||this._valuesToMeasure.push(t))},$r.prototype._lengthRetriever=function(e,t){jr(e,"fd")?null!=e.end&&e.end!=1/0&&null!=e.start?t(null,e.end+1-(e.start?e.start:0)):Or.stat(e.path,function(n,r){if(n)t(n);else{var i=r.size-(e.start?e.start:0);t(null,i)}}):jr(e,"httpVersion")?t(null,Number(e.headers["content-length"])):jr(e,"httpModule")?(e.on("response",function(n){e.pause(),t(null,Number(n.headers["content-length"]))}),e.resume()):t("Unknown stream")},$r.prototype._multiPartHeader=function(e,t,n){if("string"==typeof n.header)return n.header;var r,i=this._getContentDisposition(t,n),s=this._getContentType(t,n),a="",o={"Content-Disposition":["form-data",'name="'+e+'"'].concat(i||[]),"Content-Type":[].concat(s||[])};for(var c in"object"==typeof n.header&&Nr(o,n.header),o)if(jr(o,c)){if(null==(r=o[c]))continue;Array.isArray(r)||(r=[r]),r.length&&(a+=c+": "+r.join("; ")+$r.LINE_BREAK)}return"--"+this.getBoundary()+$r.LINE_BREAK+a+$r.LINE_BREAK},$r.prototype._getContentDisposition=function(e,t){var n;if("string"==typeof t.filepath?n=Er.normalize(t.filepath).replace(/\\/g,"/"):t.filename||e&&(e.name||e.path)?n=Er.basename(t.filename||e&&(e.name||e.path)):e&&e.readable&&jr(e,"httpVersion")&&(n=Er.basename(e.client._httpMessage.path||"")),n)return'filename="'+n+'"'},$r.prototype._getContentType=function(e,t){var n=t.contentType;return!n&&e&&e.name&&(n=Tr.lookup(e.name)),!n&&e&&e.path&&(n=Tr.lookup(e.path)),!n&&e&&e.readable&&jr(e,"httpVersion")&&(n=e.headers["content-type"]),n||!t.filepath&&!t.filename||(n=Tr.lookup(t.filepath||t.filename)),!n&&e&&"object"==typeof e&&(n=$r.DEFAULT_CONTENT_TYPE),n},$r.prototype._multiPartFooter=function(){return function(e){var t=$r.LINE_BREAK;0===this._streams.length&&(t+=this._lastBoundary()),e(t)}.bind(this)},$r.prototype._lastBoundary=function(){return"--"+this.getBoundary()+"--"+$r.LINE_BREAK},$r.prototype.getHeaders=function(e){var t,n={"content-type":"multipart/form-data; boundary="+this.getBoundary()};for(t in e)jr(e,t)&&(n[t.toLowerCase()]=e[t]);return n},$r.prototype.setBoundary=function(e){if("string"!=typeof e)throw new TypeError("FormData boundary must be a string");this._boundary=e},$r.prototype.getBoundary=function(){return this._boundary||this._generateBoundary(),this._boundary},$r.prototype.getBuffer=function(){for(var e=new Buffer.alloc(0),t=this.getBoundary(),n=0,r=this._streams.length;n<r;n++)"function"!=typeof this._streams[n]&&(e=Buffer.isBuffer(this._streams[n])?Buffer.concat([e,this._streams[n]]):Buffer.concat([e,Buffer.from(this._streams[n])]),"string"==typeof this._streams[n]&&this._streams[n].substring(2,t.length+2)===t||(e=Buffer.concat([e,Buffer.from($r.LINE_BREAK)])));return Buffer.concat([e,Buffer.from(this._lastBoundary())])},$r.prototype._generateBoundary=function(){this._boundary="--------------------------"+Ir.randomBytes(12).toString("hex")},$r.prototype.getLengthSync=function(){var e=this._overheadLength+this._valueLength;return this._streams.length&&(e+=this._lastBoundary().length),this.hasKnownLength()||this._error(new Error("Cannot calculate proper length in synchronous way.")),e},$r.prototype.hasKnownLength=function(){var e=!0;return this._valuesToMeasure.length&&(e=!1),e},$r.prototype.getLength=function(e){var t=this._overheadLength+this._valueLength;this._streams.length&&(t+=this._lastBoundary().length),this._valuesToMeasure.length?Pr.parallel(this._valuesToMeasure,this._lengthRetriever,function(n,r){n?e(n):(r.forEach(function(e){t+=e}),e(null,t))}):process.nextTick(e.bind(this,null,t))},$r.prototype.submit=function(e,t){var n,r,i={method:"post"};return"string"==typeof e?(e=Ar(e),r=Nr({port:e.port,path:e.pathname,host:e.hostname,protocol:e.protocol},i)):(r=Nr(e,i)).port||(r.port="https:"===r.protocol?443:80),r.headers=this.getHeaders(e.headers),n="https:"===r.protocol?kr.request(r):Sr.request(r),this.getLength(function(e,r){if(e&&"Unknown stream"!==e)this._error(e);else if(r&&n.setHeader("Content-Length",r),this.pipe(n),t){var i,s=function(e,r){return n.removeListener("error",s),n.removeListener("response",i),t.call(this,e,r)};i=s.bind(this,null),n.on("error",s),n.on("response",i)}}.bind(this)),n},$r.prototype._error=function(e){this.error||(this.error=e,this.pause(),this.emit("error",e))},$r.prototype.toString=function(){return"[object FormData]"},Rr($r,"FormData");var Lr=Le($r);function Dr(e){return Pe.isPlainObject(e)||Pe.isArray(e)}function Ur(e){return Pe.endsWith(e,"[]")?e.slice(0,-2):e}function Mr(e,t,n){return e?e.concat(t).map(function(e,t){return e=Ur(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}const Fr=Pe.toFlatObject(Pe,{},null,function(e){return/^is[A-Z]/.test(e)});function zr(e,t,n){if(!Pe.isObject(e))throw new TypeError("target must be an object");t=t||new(Lr||FormData);const r=(n=Pe.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!Pe.isUndefined(t[e])})).metaTokens,i=n.visitor||l,s=n.dots,a=n.indexes,o=(n.Blob||"undefined"!=typeof Blob&&Blob)&&Pe.isSpecCompliantForm(t);if(!Pe.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(Pe.isDate(e))return e.toISOString();if(Pe.isBoolean(e))return e.toString();if(!o&&Pe.isBlob(e))throw new Re("Blob is not supported. Use a Buffer instead.");return Pe.isArrayBuffer(e)||Pe.isTypedArray(e)?o&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,i){let o=e;if(e&&!i&&"object"==typeof e)if(Pe.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(Pe.isArray(e)&&function(e){return Pe.isArray(e)&&!e.some(Dr)}(e)||(Pe.isFileList(e)||Pe.endsWith(n,"[]"))&&(o=Pe.toArray(e)))return n=Ur(n),o.forEach(function(e,r){!Pe.isUndefined(e)&&null!==e&&t.append(!0===a?Mr([n],r,s):null===a?n:n+"[]",c(e))}),!1;return!!Dr(e)||(t.append(Mr(i,n,s),c(e)),!1)}const u=[],d=Object.assign(Fr,{defaultVisitor:l,convertValue:c,isVisitable:Dr});if(!Pe.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!Pe.isUndefined(n)){if(-1!==u.indexOf(n))throw Error("Circular reference detected in "+r.join("."));u.push(n),Pe.forEach(n,function(n,s){!0===(!(Pe.isUndefined(n)||null===n)&&i.call(t,n,Pe.isString(s)?s.trim():s,r,d))&&e(n,r?r.concat(s):[s])}),u.pop()}}(e),t}function Br(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function qr(e,t){this._pairs=[],e&&zr(e,this,t)}const Wr=qr.prototype;function Hr(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Kr(e,t,n){if(!t)return e;const r=n&&n.encode||Hr;Pe.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let s;if(s=i?i(t,n):Pe.isURLSearchParams(t)?t.toString():new qr(t,n).toString(r),s){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}Wr.append=function(e,t){this._pairs.push([e,t])},Wr.toString=function(e){const t=e?function(t){return e.call(this,t,Br)}:Br;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};class Gr{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Pe.forEach(this.handlers,function(t){null!==t&&e(t)})}}var Vr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Zr=y.URLSearchParams;const Jr="abcdefghijklmnopqrstuvwxyz",Yr="0123456789",Xr={DIGIT:Yr,ALPHA:Jr,ALPHA_DIGIT:Jr+Jr.toUpperCase()+Yr};var Qr={isNode:!0,classes:{URLSearchParams:Zr,FormData:Lr,Blob:"undefined"!=typeof Blob&&Blob||null},ALPHABET:Xr,generateString:(e=16,t=Xr.ALPHA_DIGIT)=>{let n="";const{length:r}=t,i=new Uint32Array(e);S.randomFillSync(i);for(let s=0;s<e;s++)n+=t[i[s]%r];return n},protocols:["http","https","file","data"]};const ei="undefined"!=typeof window&&"undefined"!=typeof document,ti="object"==typeof navigator&&navigator||void 0,ni=ei&&(!ti||["ReactNative","NativeScript","NS"].indexOf(ti.product)<0),ri="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,ii=ei&&window.location.href||"http://localhost";var si={...Object.freeze({__proto__:null,hasBrowserEnv:ei,hasStandardBrowserEnv:ni,hasStandardBrowserWebWorkerEnv:ri,navigator:ti,origin:ii}),...Qr};function ai(e){function t(e,n,r,i){let s=e[i++];if("__proto__"===s)return!0;const a=Number.isFinite(+s),o=i>=e.length;if(s=!s&&Pe.isArray(r)?r.length:s,o)return Pe.hasOwnProp(r,s)?r[s]=[r[s],n]:r[s]=n,!a;r[s]&&Pe.isObject(r[s])||(r[s]=[]);return t(e,n,r[s],i)&&Pe.isArray(r[s])&&(r[s]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let s;for(r=0;r<i;r++)s=n[r],t[s]=e[s];return t}(r[s])),!a}if(Pe.isFormData(e)&&Pe.isFunction(e.entries)){const n={};return Pe.forEachEntry(e,(e,r)=>{t(function(e){return Pe.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),r,n,0)}),n}return null}const oi={transitional:Vr,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=Pe.isObject(e);i&&Pe.isHTMLForm(e)&&(e=new FormData(e));if(Pe.isFormData(e))return r?JSON.stringify(ai(e)):e;if(Pe.isArrayBuffer(e)||Pe.isBuffer(e)||Pe.isStream(e)||Pe.isFile(e)||Pe.isBlob(e)||Pe.isReadableStream(e))return e;if(Pe.isArrayBufferView(e))return e.buffer;if(Pe.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return zr(e,new si.classes.URLSearchParams,{visitor:function(e,t,n,r){return si.isNode&&Pe.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)},...t})}(e,this.formSerializer).toString();if((s=Pe.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return zr(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(e,t,n){if(Pe.isString(e))try{return(t||JSON.parse)(e),Pe.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||oi.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(Pe.isResponse(e)||Pe.isReadableStream(e))return e;if(e&&Pe.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw Re.from(e,Re.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:si.classes.FormData,Blob:si.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Pe.forEach(["delete","get","head","post","put","patch"],e=>{oi.headers[e]={}});const ci=Pe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);const li=Symbol("internals");function ui(e){return e&&String(e).trim().toLowerCase()}function di(e){return!1===e||null==e?e:Pe.isArray(e)?e.map(di):String(e)}function pi(e,t,n,r,i){return Pe.isFunction(r)?r.call(this,t,n):(i&&(t=n),Pe.isString(t)?Pe.isString(r)?-1!==t.indexOf(r):Pe.isRegExp(r)?r.test(t):void 0:void 0)}let hi=class{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=ui(t);if(!i)throw new Error("header name must be a non-empty string");const s=Pe.findKey(r,i);(!s||void 0===r[s]||!0===n||void 0===n&&!1!==r[s])&&(r[s||t]=di(e))}const s=(e,t)=>Pe.forEach(e,(e,n)=>i(e,n,t));if(Pe.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(Pe.isString(e)&&(e=e.trim())&&!(e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))(e))s((e=>{const t={};let n,r,i;return e&&e.split("\n").forEach(function(e){i=e.indexOf(":"),n=e.substring(0,i).trim().toLowerCase(),r=e.substring(i+1).trim(),!n||t[n]&&ci[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)}),t})(e),t);else if(Pe.isObject(e)&&Pe.isIterable(e)){let n,r,i={};for(const t of e){if(!Pe.isArray(t))throw TypeError("Object iterator must return a key-value pair");i[r=t[0]]=(n=i[r])?Pe.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}s(i,t)}else null!=e&&i(t,e,n);return this}get(e,t){if(e=ui(e)){const n=Pe.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(Pe.isFunction(t))return t.call(this,e,n);if(Pe.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ui(e)){const n=Pe.findKey(this,e);return!(!n||void 0===this[n]||t&&!pi(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=ui(e)){const i=Pe.findKey(n,e);!i||t&&!pi(0,n[i],i,t)||(delete n[i],r=!0)}}return Pe.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!pi(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return Pe.forEach(this,(r,i)=>{const s=Pe.findKey(n,i);if(s)return t[s]=di(r),void delete t[i];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}(i):String(i).trim();a!==i&&delete t[i],t[a]=di(r),n[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Pe.forEach(this,(n,r)=>{null!=n&&!1!==n&&(t[r]=e&&Pe.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(e=>n.set(e)),n}static accessor(e){const t=(this[li]=this[li]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=ui(e);t[r]||(!function(e,t){const n=Pe.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})})}(n,e),t[r]=!0)}return Pe.isArray(e)?e.forEach(r):r(e),this}};function mi(e,t){const n=this||oi,r=t||n,i=hi.from(r.headers);let s=r.data;return Pe.forEach(e,function(e){s=e.call(n,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function fi(e){return!(!e||!e.__CANCEL__)}function gi(e,t,n){Re.call(this,null==e?"canceled":e,Re.ERR_CANCELED,t,n),this.name="CanceledError"}function yi(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new Re("Request failed with status code "+n.status,[Re.ERR_BAD_REQUEST,Re.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}function vi(e,t,n){let r=!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t);return e&&(r||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}hi.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Pe.reduceDescriptors(hi.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[n]=e}}}),Pe.freezeMethods(hi),Pe.inherits(gi,Re,{__CANCEL__:!0});var bi={},wi=y.parse,_i={ftp:21,gopher:70,http:80,https:443,ws:80,wss:443},xi=String.prototype.endsWith||function(e){return e.length<=this.length&&-1!==this.indexOf(e,this.length-e.length)};function Ei(e){return process.env[e.toLowerCase()]||process.env[e.toUpperCase()]||""}bi.getProxyForUrl=function(e){var t="string"==typeof e?wi(e):e||{},n=t.protocol,r=t.host,i=t.port;if("string"!=typeof r||!r||"string"!=typeof n)return"";if(n=n.split(":",1)[0],!function(e,t){var n=(Ei("npm_config_no_proxy")||Ei("no_proxy")).toLowerCase();if(!n)return!0;if("*"===n)return!1;return n.split(/[,\s]/).every(function(n){if(!n)return!0;var r=n.match(/^(.+):(\d+)$/),i=r?r[1]:n,s=r?parseInt(r[2]):0;return!(!s||s===t)||(/^[.*]/.test(i)?("*"===i.charAt(0)&&(i=i.slice(1)),!xi.call(e,i)):e!==i)})}(r=r.replace(/:\d*$/,""),i=parseInt(i)||_i[n]||0))return"";var s=Ei("npm_config_"+n+"_proxy")||Ei(n+"_proxy")||Ei("npm_config_proxy")||Ei("all_proxy");return s&&-1===s.indexOf("://")&&(s=n+"://"+s),s};var Si,ki,Ai,Oi,Ci,Ii={exports:{}},Ti={exports:{}},Pi={exports:{}};function Ri(){if(ki)return Si;ki=1;var e=1e3,t=60*e,n=60*t,r=24*n,i=7*r,s=365.25*r;function a(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}return Si=function(o,c){c=c||{};var l=typeof o;if("string"===l&&o.length>0)return function(a){if(a=String(a),a.length>100)return;var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(a);if(!o)return;var c=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*s;case"weeks":case"week":case"w":return c*i;case"days":case"day":case"d":return c*r;case"hours":case"hour":case"hrs":case"hr":case"h":return c*n;case"minutes":case"minute":case"mins":case"min":case"m":return c*t;case"seconds":case"second":case"secs":case"sec":case"s":return c*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(o);if("number"===l&&isFinite(o))return c.long?function(i){var s=Math.abs(i);if(s>=r)return a(i,s,r,"day");if(s>=n)return a(i,s,n,"hour");if(s>=t)return a(i,s,t,"minute");if(s>=e)return a(i,s,e,"second");return i+" ms"}(o):function(i){var s=Math.abs(i);if(s>=r)return Math.round(i/r)+"d";if(s>=n)return Math.round(i/n)+"h";if(s>=t)return Math.round(i/t)+"m";if(s>=e)return Math.round(i/e)+"s";return i+"ms"}(o);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(o))},Si}function ji(){if(Oi)return Ai;return Oi=1,Ai=function(e){function t(e){let r,i,s,a=null;function o(...e){if(!o.enabled)return;const n=o,i=Number(new Date),s=i-(r||i);n.diff=s,n.prev=r,n.curr=i,r=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,i)=>{if("%%"===r)return"%";a++;const s=t.formatters[i];if("function"==typeof s){const t=e[a];r=s.call(n,t),e.splice(a,1),a--}return r}),t.formatArgs.call(n,e);(n.log||t.log).apply(n,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=n,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(i!==t.namespaces&&(i=t.namespaces,s=t.enabled(e)),s),set:e=>{a=e}}),"function"==typeof t.init&&t.init(o),o}function n(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function r(e,t){let n=0,r=0,i=-1,s=0;for(;n<e.length;)if(r<t.length&&(t[r]===e[n]||"*"===t[r]))"*"===t[r]?(i=r,s=n,r++):(n++,r++);else{if(-1===i)return!1;r=i+1,s++,n=s}for(;r<t.length&&"*"===t[r];)r++;return r===t.length}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names,...t.skips.map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const e of n)"-"===e[0]?t.skips.push(e.slice(1)):t.names.push(e)},t.enabled=function(e){for(const n of t.skips)if(r(e,n))return!1;for(const n of t.names)if(r(e,n))return!0;return!1},t.humanize=Ri(),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(n=>{t[n]=e[n]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t},Ai}var Ni,$i,Li,Di,Ui,Mi,Fi,zi={exports:{}};function Bi(){return $i?Ni:($i=1,Ni=(e,t=process.argv)=>{const n=e.startsWith("-")?"":1===e.length?"-":"--",r=t.indexOf(n+e),i=t.indexOf("--");return-1!==r&&(-1===i||r<i)})}function qi(){return Ui||(Ui=1,function(t,n){const r=C,i=e;n.init=function(e){e.inspectOpts={};const t=Object.keys(n.inspectOpts);for(let r=0;r<t.length;r++)e.inspectOpts[t[r]]=n.inspectOpts[t[r]]},n.log=function(...e){return process.stderr.write(i.formatWithOptions(n.inspectOpts,...e)+"\n")},n.formatArgs=function(e){const{namespace:r,useColors:i}=this;if(i){const n=this.color,i="[3"+(n<8?n:"8;5;"+n),s=`  ${i};1m${r} [0m`;e[0]=s+e[0].split("\n").join("\n"+s),e.push(i+"m+"+t.exports.humanize(this.diff)+"[0m")}else e[0]=function(){if(n.inspectOpts.hideDate)return"";return(new Date).toISOString()+" "}()+r+" "+e[0]},n.save=function(e){e?process.env.DEBUG=e:delete process.env.DEBUG},n.load=function(){return process.env.DEBUG},n.useColors=function(){return"colors"in n.inspectOpts?Boolean(n.inspectOpts.colors):r.isatty(process.stderr.fd)},n.destroy=i.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),n.colors=[6,2,3,4,5,1];try{const e=function(){if(Di)return Li;Di=1;const e=I,t=C,n=Bi(),{env:r}=process;let i;function s(e){return 0!==e&&{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function a(t,s){if(0===i)return 0;if(n("color=16m")||n("color=full")||n("color=truecolor"))return 3;if(n("color=256"))return 2;if(t&&!s&&void 0===i)return 0;const a=i||0;if("dumb"===r.TERM)return a;if("win32"===process.platform){const t=e.release().split(".");return Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in r)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(e=>e in r)||"codeship"===r.CI_NAME?1:a;if("TEAMCITY_VERSION"in r)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(r.TEAMCITY_VERSION)?1:0;if("truecolor"===r.COLORTERM)return 3;if("TERM_PROGRAM"in r){const e=parseInt((r.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(r.TERM_PROGRAM){case"iTerm.app":return e>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(r.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(r.TERM)||"COLORTERM"in r?1:a}return n("no-color")||n("no-colors")||n("color=false")||n("color=never")?i=0:(n("color")||n("colors")||n("color=true")||n("color=always"))&&(i=1),"FORCE_COLOR"in r&&(i="true"===r.FORCE_COLOR?1:"false"===r.FORCE_COLOR?0:0===r.FORCE_COLOR.length?1:Math.min(parseInt(r.FORCE_COLOR,10),3)),Li={supportsColor:function(e){return s(a(e,e&&e.isTTY))},stdout:s(a(!0,t.isatty(1))),stderr:s(a(!0,t.isatty(2)))},Li}();e&&(e.stderr||e).level>=2&&(n.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}n.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{const n=t.substring(6).toLowerCase().replace(/_([a-z])/g,(e,t)=>t.toUpperCase());let r=process.env[t];return r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:Number(r)),e[n]=r,e},{}),t.exports=ji()(n);const{formatters:s}=t.exports;s.o=function(e){return this.inspectOpts.colors=this.useColors,i.inspect(e,this.inspectOpts).split("\n").map(e=>e.trim()).join(" ")},s.O=function(e){return this.inspectOpts.colors=this.useColors,i.inspect(e,this.inspectOpts)}}(zi,zi.exports)),zi.exports}function Wi(){return Mi||(Mi=1,"undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs?Ti.exports=(Ci||(Ci=1,function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))}),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=ji()(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(Pi,Pi.exports)),Pi.exports):Ti.exports=qi()),Ti.exports}var Hi,Ki,Gi,Vi=y,Zi=Vi.URL,Ji=d,Yi=m,Xi=n.Writable,Qi=O,es=function(){if(!Fi){try{Fi=Wi()("follow-redirects")}catch(e){}"function"!=typeof Fi&&(Fi=function(){})}Fi.apply(null,arguments)};Hi="undefined"!=typeof process,Ki="undefined"!=typeof window&&"undefined"!=typeof document,Gi=_s(Error.captureStackTrace),Hi||!Ki&&Gi||console.warn("The follow-redirects package should be excluded from browser builds.");var ts=!1;try{Qi(new Zi(""))}catch(e){ts="ERR_INVALID_URL"===e.code}var ns=["auth","host","hostname","href","path","pathname","port","protocol","query","search","hash"],rs=["abort","aborted","connect","error","socket","timeout"],is=Object.create(null);rs.forEach(function(e){is[e]=function(t,n,r){this._redirectable.emit(e,t,n,r)}});var ss=vs("ERR_INVALID_URL","Invalid URL",TypeError),as=vs("ERR_FR_REDIRECTION_FAILURE","Redirected request failed"),os=vs("ERR_FR_TOO_MANY_REDIRECTS","Maximum number of redirects exceeded",as),cs=vs("ERR_FR_MAX_BODY_LENGTH_EXCEEDED","Request body larger than maxBodyLength limit"),ls=vs("ERR_STREAM_WRITE_AFTER_END","write after end"),us=Xi.prototype.destroy||hs;function ds(e,t){Xi.call(this),this._sanitizeOptions(e),this._options=e,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],t&&this.on("response",t);var n=this;this._onNativeResponse=function(e){try{n._processResponse(e)}catch(e){n.emit("error",e instanceof as?e:new as({cause:e}))}},this._performRequest()}function ps(e){var t={maxRedirects:21,maxBodyLength:10485760},n={};return Object.keys(e).forEach(function(r){var i=r+":",s=n[i]=e[r],a=t[r]=Object.create(s);Object.defineProperties(a,{request:{value:function(e,r,s){var a;return a=e,Zi&&a instanceof Zi?e=gs(e):ws(e)?e=gs(ms(e)):(s=r,r=fs(e),e={protocol:i}),_s(r)&&(s=r,r=null),(r=Object.assign({maxRedirects:t.maxRedirects,maxBodyLength:t.maxBodyLength},e,r)).nativeProtocols=n,ws(r.host)||ws(r.hostname)||(r.hostname="::1"),Qi.equal(r.protocol,i,"protocol mismatch"),es("options",r),new ds(r,s)},configurable:!0,enumerable:!0,writable:!0},get:{value:function(e,t,n){var r=a.request(e,t,n);return r.end(),r},configurable:!0,enumerable:!0,writable:!0}})}),t}function hs(){}function ms(e){var t;if(ts)t=new Zi(e);else if(!ws((t=fs(Vi.parse(e))).protocol))throw new ss({input:e});return t}function fs(e){if(/^\[/.test(e.hostname)&&!/^\[[:0-9a-f]+\]$/i.test(e.hostname))throw new ss({input:e.href||e});if(/^\[/.test(e.host)&&!/^\[[:0-9a-f]+\](:\d+)?$/i.test(e.host))throw new ss({input:e.href||e});return e}function gs(e,t){var n=t||{};for(var r of ns)n[r]=e[r];return n.hostname.startsWith("[")&&(n.hostname=n.hostname.slice(1,-1)),""!==n.port&&(n.port=Number(n.port)),n.path=n.search?n.pathname+n.search:n.pathname,n}function ys(e,t){var n;for(var r in t)e.test(r)&&(n=t[r],delete t[r]);return null==n?void 0:String(n).trim()}function vs(e,t,n){function r(n){_s(Error.captureStackTrace)&&Error.captureStackTrace(this,this.constructor),Object.assign(this,n||{}),this.code=e,this.message=this.cause?t+": "+this.cause.message:t}return r.prototype=new(n||Error),Object.defineProperties(r.prototype,{constructor:{value:r,enumerable:!1},name:{value:"Error ["+e+"]",enumerable:!1}}),r}function bs(e,t){for(var n of rs)e.removeListener(n,is[n]);e.on("error",hs),e.destroy(t)}function ws(e){return"string"==typeof e||e instanceof String}function _s(e){return"function"==typeof e}ds.prototype=Object.create(Xi.prototype),ds.prototype.abort=function(){bs(this._currentRequest),this._currentRequest.abort(),this.emit("abort")},ds.prototype.destroy=function(e){return bs(this._currentRequest,e),us.call(this,e),this},ds.prototype.write=function(e,t,n){if(this._ending)throw new ls;if(!ws(e)&&("object"!=typeof(r=e)||!("length"in r)))throw new TypeError("data should be a string, Buffer or Uint8Array");var r;_s(t)&&(n=t,t=null),0!==e.length?this._requestBodyLength+e.length<=this._options.maxBodyLength?(this._requestBodyLength+=e.length,this._requestBodyBuffers.push({data:e,encoding:t}),this._currentRequest.write(e,t,n)):(this.emit("error",new cs),this.abort()):n&&n()},ds.prototype.end=function(e,t,n){if(_s(e)?(n=e,e=t=null):_s(t)&&(n=t,t=null),e){var r=this,i=this._currentRequest;this.write(e,t,function(){r._ended=!0,i.end(null,null,n)}),this._ending=!0}else this._ended=this._ending=!0,this._currentRequest.end(null,null,n)},ds.prototype.setHeader=function(e,t){this._options.headers[e]=t,this._currentRequest.setHeader(e,t)},ds.prototype.removeHeader=function(e){delete this._options.headers[e],this._currentRequest.removeHeader(e)},ds.prototype.setTimeout=function(e,t){var n=this;function r(t){t.setTimeout(e),t.removeListener("timeout",t.destroy),t.addListener("timeout",t.destroy)}function i(t){n._timeout&&clearTimeout(n._timeout),n._timeout=setTimeout(function(){n.emit("timeout"),s()},e),r(t)}function s(){n._timeout&&(clearTimeout(n._timeout),n._timeout=null),n.removeListener("abort",s),n.removeListener("error",s),n.removeListener("response",s),n.removeListener("close",s),t&&n.removeListener("timeout",t),n.socket||n._currentRequest.removeListener("socket",i)}return t&&this.on("timeout",t),this.socket?i(this.socket):this._currentRequest.once("socket",i),this.on("socket",r),this.on("abort",s),this.on("error",s),this.on("response",s),this.on("close",s),this},["flushHeaders","getHeader","setNoDelay","setSocketKeepAlive"].forEach(function(e){ds.prototype[e]=function(t,n){return this._currentRequest[e](t,n)}}),["aborted","connection","socket"].forEach(function(e){Object.defineProperty(ds.prototype,e,{get:function(){return this._currentRequest[e]}})}),ds.prototype._sanitizeOptions=function(e){if(e.headers||(e.headers={}),e.host&&(e.hostname||(e.hostname=e.host),delete e.host),!e.pathname&&e.path){var t=e.path.indexOf("?");t<0?e.pathname=e.path:(e.pathname=e.path.substring(0,t),e.search=e.path.substring(t))}},ds.prototype._performRequest=function(){var e=this._options.protocol,t=this._options.nativeProtocols[e];if(!t)throw new TypeError("Unsupported protocol "+e);if(this._options.agents){var n=e.slice(0,-1);this._options.agent=this._options.agents[n]}var r=this._currentRequest=t.request(this._options,this._onNativeResponse);for(var i of(r._redirectable=this,rs))r.on(i,is[i]);if(this._currentUrl=/^\//.test(this._options.path)?Vi.format(this._options):this._options.path,this._isRedirect){var s=0,a=this,o=this._requestBodyBuffers;!function e(t){if(r===a._currentRequest)if(t)a.emit("error",t);else if(s<o.length){var n=o[s++];r.finished||r.write(n.data,n.encoding,e)}else a._ended&&r.end()}()}},ds.prototype._processResponse=function(e){var t=e.statusCode;this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:e.headers,statusCode:t});var n,r=e.headers.location;if(!r||!1===this._options.followRedirects||t<300||t>=400)return e.responseUrl=this._currentUrl,e.redirects=this._redirects,this.emit("response",e),void(this._requestBodyBuffers=[]);if(bs(this._currentRequest),e.destroy(),++this._redirectCount>this._options.maxRedirects)throw new os;var i=this._options.beforeRedirect;i&&(n=Object.assign({Host:e.req.getHeader("host")},this._options.headers));var s=this._options.method;((301===t||302===t)&&"POST"===this._options.method||303===t&&!/^(?:GET|HEAD)$/.test(this._options.method))&&(this._options.method="GET",this._requestBodyBuffers=[],ys(/^content-/i,this._options.headers));var a,o,c=ys(/^host$/i,this._options.headers),l=ms(this._currentUrl),u=c||l.host,d=/^\w+:/.test(r)?this._currentUrl:Vi.format(Object.assign(l,{host:u})),p=(a=r,o=d,ts?new Zi(a,o):ms(Vi.resolve(o,a)));if(es("redirecting to",p.href),this._isRedirect=!0,gs(p,this._options),(p.protocol!==l.protocol&&"https:"!==p.protocol||p.host!==u&&!function(e,t){Qi(ws(e)&&ws(t));var n=e.length-t.length-1;return n>0&&"."===e[n]&&e.endsWith(t)}(p.host,u))&&ys(/^(?:(?:proxy-)?authorization|cookie)$/i,this._options.headers),_s(i)){var h={headers:e.headers,statusCode:t},m={url:d,method:s,headers:n};i(this._options,h,m),this._sanitizeOptions(this._options)}this._performRequest()},Ii.exports=ps({http:Ji,https:Yi}),Ii.exports.wrap=ps;var xs=Le(Ii.exports);const Es="1.11.0";function Ss(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}const ks=/^(?:([^;]+);)?(?:[^;]+;)?(base64|),([\s\S]*)$/;const As=Symbol("internals");class Os extends n.Transform{constructor(e){super({readableHighWaterMark:(e=Pe.toFlatObject(e,{maxRate:0,chunkSize:65536,minChunkSize:100,timeWindow:500,ticksRate:2,samplesCount:15},null,(e,t)=>!Pe.isUndefined(t[e]))).chunkSize});const t=this[As]={timeWindow:e.timeWindow,chunkSize:e.chunkSize,maxRate:e.maxRate,minChunkSize:e.minChunkSize,bytesSeen:0,isCaptured:!1,notifiedBytesLoaded:0,ts:Date.now(),bytes:0,onReadCallback:null};this.on("newListener",e=>{"progress"===e&&(t.isCaptured||(t.isCaptured=!0))})}_read(e){const t=this[As];return t.onReadCallback&&t.onReadCallback(),super._read(e)}_transform(e,t,n){const r=this[As],i=r.maxRate,s=this.readableHighWaterMark,a=r.timeWindow,o=i/(1e3/a),c=!1!==r.minChunkSize?Math.max(r.minChunkSize,.01*o):0,l=(e,t)=>{const n=Buffer.byteLength(e);r.bytesSeen+=n,r.bytes+=n,r.isCaptured&&this.emit("progress",r.bytesSeen),this.push(e)?process.nextTick(t):r.onReadCallback=()=>{r.onReadCallback=null,process.nextTick(t)}},u=(e,t)=>{const n=Buffer.byteLength(e);let u,d=null,p=s,h=0;if(i){const e=Date.now();(!r.ts||(h=e-r.ts)>=a)&&(r.ts=e,u=o-r.bytes,r.bytes=u<0?-u:0,h=0),u=o-r.bytes}if(i){if(u<=0)return setTimeout(()=>{t(null,e)},a-h);u<p&&(p=u)}p&&n>p&&n-p>c&&(d=e.subarray(p),e=e.subarray(0,p)),l(e,d?()=>{process.nextTick(t,null,d)}:t)};u(e,function e(t,r){if(t)return n(t);r?u(r,e):n(null)})}}const{asyncIterator:Cs}=Symbol,Is=async function*(e){e.stream?yield*e.stream():e.arrayBuffer?yield await e.arrayBuffer():e[Cs]?yield*e[Cs]():yield e},Ts=si.ALPHABET.ALPHA_DIGIT+"-_",Ps="function"==typeof TextEncoder?new TextEncoder:new e.TextEncoder,Rs="\r\n",js=Ps.encode(Rs);class Ns{constructor(e,t){const{escapeName:n}=this.constructor,r=Pe.isString(t);let i=`Content-Disposition: form-data; name="${n(e)}"${!r&&t.name?`; filename="${n(t.name)}"`:""}${Rs}`;r?t=Ps.encode(String(t).replace(/\r?\n|\r\n?/g,Rs)):i+=`Content-Type: ${t.type||"application/octet-stream"}${Rs}`,this.headers=Ps.encode(i+Rs),this.contentLength=r?t.byteLength:t.size,this.size=this.headers.byteLength+this.contentLength+2,this.name=e,this.value=t}async*encode(){yield this.headers;const{value:e}=this;Pe.isTypedArray(e)?yield e:yield*Is(e),yield js}static escapeName(e){return String(e).replace(/[\r\n"]/g,e=>({"\r":"%0D","\n":"%0A",'"':"%22"}[e]))}}class $s extends n.Transform{__transform(e,t,n){this.push(e),n()}_transform(e,t,n){if(0!==e.length&&(this._transform=this.__transform,120!==e[0])){const e=Buffer.alloc(2);e[0]=120,e[1]=156,this.push(e,t)}this.__transform(e,t,n)}}const Ls=(e,t)=>Pe.isAsyncFn(e)?function(...n){const r=n.pop();e.apply(this,n).then(e=>{try{t?r(null,...t(e)):r(null,e)}catch(e){r(e)}},r)}:e;const Ds=(e,t,n=3)=>{let r=0;const i=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,s=0,a=0;return t=void 0!==t?t:1e3,function(o){const c=Date.now(),l=r[a];i||(i=c),n[s]=o,r[s]=c;let u=a,d=0;for(;u!==s;)d+=n[u++],u%=e;if(s=(s+1)%e,s===a&&(a=(a+1)%e),c-i<t)return;const p=l&&c-l;return p?Math.round(1e3*d/p):void 0}}(50,250);return function(e,t){let n,r,i=0,s=1e3/t;const a=(t,s=Date.now())=>{i=s,n=null,r&&(clearTimeout(r),r=null),e(...t)};return[(...e)=>{const t=Date.now(),o=t-i;o>=s?a(e,t):(n=e,r||(r=setTimeout(()=>{r=null,a(n)},s-o)))},()=>n&&a(n)]}(n=>{const s=n.loaded,a=n.lengthComputable?n.total:void 0,o=s-r,c=i(o);r=s;e({loaded:s,total:a,progress:a?s/a:void 0,bytes:o,rate:c||void 0,estimated:c&&a&&s<=a?(a-s)/c:void 0,event:n,lengthComputable:null!=a,[t?"download":"upload"]:!0})},n)},Us=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},Ms=e=>(...t)=>Pe.asap(()=>e(...t)),Fs={flush:j.constants.Z_SYNC_FLUSH,finishFlush:j.constants.Z_SYNC_FLUSH},zs={flush:j.constants.BROTLI_OPERATION_FLUSH,finishFlush:j.constants.BROTLI_OPERATION_FLUSH},Bs=Pe.isFunction(j.createBrotliDecompress),{http:qs,https:Ws}=xs,Hs=/https:?/,Ks=si.protocols.map(e=>e+":"),Gs=(e,[t,n])=>(e.on("end",n).on("error",n),t);function Vs(e,t){e.beforeRedirects.proxy&&e.beforeRedirects.proxy(e),e.beforeRedirects.config&&e.beforeRedirects.config(e,t)}function Zs(e,t,n){let r=t;if(!r&&!1!==r){const e=bi.getProxyForUrl(n);e&&(r=new URL(e))}if(r){if(r.username&&(r.auth=(r.username||"")+":"+(r.password||"")),r.auth){(r.auth.username||r.auth.password)&&(r.auth=(r.auth.username||"")+":"+(r.auth.password||""));const t=Buffer.from(r.auth,"utf8").toString("base64");e.headers["Proxy-Authorization"]="Basic "+t}e.headers.host=e.hostname+(e.port?":"+e.port:"");const t=r.hostname||r.host;e.hostname=t,e.host=t,e.port=r.port,e.path=n,r.protocol&&(e.protocol=r.protocol.includes(":")?r.protocol:`${r.protocol}:`)}e.beforeRedirects.proxy=function(e){Zs(e,t,e.href)}}const Js="undefined"!=typeof process&&"process"===Pe.kindOf(process),Ys=(e,t)=>(({address:e,family:t})=>{if(!Pe.isString(e))throw TypeError("address must be a string");return{address:e,family:t||(e.indexOf(".")<0?6:4)}})(Pe.isObject(e)?e:{address:e,family:t});var Xs=Js&&function(t){return i=async function(i,s,a){let{data:o,lookup:c,family:l}=t;const{responseType:u,responseEncoding:p}=t,h=t.method.toUpperCase();let f,g,y=!1;if(c){const e=Ls(c,e=>Pe.isArray(e)?e:[e]);c=(t,n,r)=>{e(t,n,(e,t,i)=>{if(e)return r(e);const s=Pe.isArray(t)?t.map(e=>Ys(e)):[Ys(t,i)];n.all?r(e,s):r(e,s[0].address,s[0].family)})}}const v=new N,b=()=>{t.cancelToken&&t.cancelToken.unsubscribe(w),t.signal&&t.signal.removeEventListener("abort",w),v.removeAllListeners()};function w(e){v.emit("abort",!e||e.type?new gi(null,t,g):e)}a((e,t)=>{f=!0,t&&(y=!0,b())}),v.once("abort",s),(t.cancelToken||t.signal)&&(t.cancelToken&&t.cancelToken.subscribe(w),t.signal&&(t.signal.aborted?w():t.signal.addEventListener("abort",w)));const _=vi(t.baseURL,t.url,t.allowAbsoluteUrls),x=new URL(_,si.hasBrowserEnv?si.origin:void 0),E=x.protocol||Ks[0];if("data:"===E){let e;if("GET"!==h)return yi(i,s,{status:405,statusText:"method not allowed",headers:{},config:t});try{e=function(e,t,n){const r=n&&n.Blob||si.classes.Blob,i=Ss(e);if(void 0===t&&r&&(t=!0),"data"===i){e=i.length?e.slice(i.length+1):e;const n=ks.exec(e);if(!n)throw new Re("Invalid URL",Re.ERR_INVALID_URL);const s=n[1],a=n[2],o=n[3],c=Buffer.from(decodeURIComponent(o),a?"base64":"utf8");if(t){if(!r)throw new Re("Blob is not supported",Re.ERR_NOT_SUPPORT);return new r([c],{type:s})}return c}throw new Re("Unsupported protocol "+i,Re.ERR_NOT_SUPPORT)}(t.url,"blob"===u,{Blob:t.env&&t.env.Blob})}catch(e){throw Re.from(e,Re.ERR_BAD_REQUEST,t)}return"text"===u?(e=e.toString(p),p&&"utf8"!==p||(e=Pe.stripBOM(e))):"stream"===u&&(e=n.Readable.from(e)),yi(i,s,{data:e,status:200,statusText:"OK",headers:new hi,config:t})}if(-1===Ks.indexOf(E))return s(new Re("Unsupported protocol "+E,Re.ERR_BAD_REQUEST,t));const S=hi.from(t.headers).normalize();S.set("User-Agent","axios/"+Es,!1);const{onUploadProgress:k,onDownloadProgress:A}=t,O=t.maxRate;let C,I;if(Pe.isSpecCompliantForm(o)){const e=S.getContentType(/boundary=([-_\w\d]{10,70})/i);o=((e,t,n)=>{const{tag:i="form-data-boundary",size:s=25,boundary:a=i+"-"+si.generateString(s,Ts)}=n||{};if(!Pe.isFormData(e))throw TypeError("FormData instance required");if(a.length<1||a.length>70)throw Error("boundary must be 10-70 characters long");const o=Ps.encode("--"+a+Rs),c=Ps.encode("--"+a+"--"+Rs);let l=c.byteLength;const u=Array.from(e.entries()).map(([e,t])=>{const n=new Ns(e,t);return l+=n.size,n});l+=o.byteLength*u.length,l=Pe.toFiniteNumber(l);const d={"Content-Type":`multipart/form-data; boundary=${a}`};return Number.isFinite(l)&&(d["Content-Length"]=l),t&&t(d),r.from(async function*(){for(const e of u)yield o,yield*e.encode();yield c}())})(o,e=>{S.set(e)},{tag:`axios-${Es}-boundary`,boundary:e&&e[1]||void 0})}else if(Pe.isFormData(o)&&Pe.isFunction(o.getHeaders)){if(S.set(o.getHeaders()),!S.hasContentLength())try{const t=await e.promisify(o.getLength).call(o);Number.isFinite(t)&&t>=0&&S.setContentLength(t)}catch(e){}}else if(Pe.isBlob(o)||Pe.isFile(o))o.size&&S.setContentType(o.type||"application/octet-stream"),S.setContentLength(o.size||0),o=n.Readable.from(Is(o));else if(o&&!Pe.isStream(o)){if(Buffer.isBuffer(o));else if(Pe.isArrayBuffer(o))o=Buffer.from(new Uint8Array(o));else{if(!Pe.isString(o))return s(new Re("Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream",Re.ERR_BAD_REQUEST,t));o=Buffer.from(o,"utf-8")}if(S.setContentLength(o.length,!1),t.maxBodyLength>-1&&o.length>t.maxBodyLength)return s(new Re("Request body larger than maxBodyLength limit",Re.ERR_BAD_REQUEST,t))}const T=Pe.toFiniteNumber(S.getContentLength());let P,R;Pe.isArray(O)?(C=O[0],I=O[1]):C=I=O,o&&(k||C)&&(Pe.isStream(o)||(o=n.Readable.from(o,{objectMode:!1})),o=n.pipeline([o,new Os({maxRate:Pe.toFiniteNumber(C)})],Pe.noop),k&&o.on("progress",Gs(o,Us(T,Ds(Ms(k),!1,3))))),t.auth&&(P=(t.auth.username||"")+":"+(t.auth.password||"")),!P&&x.username&&(P=x.username+":"+x.password),P&&S.delete("authorization");try{R=Kr(x.pathname+x.search,t.params,t.paramsSerializer).replace(/^\?/,"")}catch(e){const n=new Error(e.message);return n.config=t,n.url=t.url,n.exists=!0,s(n)}S.set("Accept-Encoding","gzip, compress, deflate"+(Bs?", br":""),!1);const $={path:R,method:h,headers:S.toJSON(),agents:{http:t.httpAgent,https:t.httpsAgent},auth:P,protocol:E,family:l,beforeRedirect:Vs,beforeRedirects:{}};let L;!Pe.isUndefined(c)&&($.lookup=c),t.socketPath?$.socketPath=t.socketPath:($.hostname=x.hostname.startsWith("[")?x.hostname.slice(1,-1):x.hostname,$.port=x.port,Zs($,t.proxy,E+"//"+x.hostname+(x.port?":"+x.port:"")+$.path));const D=Hs.test($.protocol);if($.agent=D?t.httpsAgent:t.httpAgent,t.transport?L=t.transport:0===t.maxRedirects?L=D?m:d:(t.maxRedirects&&($.maxRedirects=t.maxRedirects),t.beforeRedirect&&($.beforeRedirects.config=t.beforeRedirect),L=D?Ws:qs),t.maxBodyLength>-1?$.maxBodyLength=t.maxBodyLength:$.maxBodyLength=1/0,t.insecureHTTPParser&&($.insecureHTTPParser=t.insecureHTTPParser),g=L.request($,function(e){if(g.destroyed)return;const r=[e],a=+e.headers["content-length"];if(A||I){const e=new Os({maxRate:Pe.toFiniteNumber(I)});A&&e.on("progress",Gs(e,Us(a,Ds(Ms(A),!0,3)))),r.push(e)}let o=e;const c=e.req||g;if(!1!==t.decompress&&e.headers["content-encoding"])switch("HEAD"!==h&&204!==e.statusCode||delete e.headers["content-encoding"],(e.headers["content-encoding"]||"").toLowerCase()){case"gzip":case"x-gzip":case"compress":case"x-compress":r.push(j.createUnzip(Fs)),delete e.headers["content-encoding"];break;case"deflate":r.push(new $s),r.push(j.createUnzip(Fs)),delete e.headers["content-encoding"];break;case"br":Bs&&(r.push(j.createBrotliDecompress(zs)),delete e.headers["content-encoding"])}o=r.length>1?n.pipeline(r,Pe.noop):r[0];const l=n.finished(o,()=>{l(),b()}),d={status:e.statusCode,statusText:e.statusMessage,headers:new hi(e.headers),config:t,request:c};if("stream"===u)d.data=o,yi(i,s,d);else{const e=[];let n=0;o.on("data",function(r){e.push(r),n+=r.length,t.maxContentLength>-1&&n>t.maxContentLength&&(y=!0,o.destroy(),s(new Re("maxContentLength size of "+t.maxContentLength+" exceeded",Re.ERR_BAD_RESPONSE,t,c)))}),o.on("aborted",function(){if(y)return;const e=new Re("stream has been aborted",Re.ERR_BAD_RESPONSE,t,c);o.destroy(e),s(e)}),o.on("error",function(e){g.destroyed||s(Re.from(e,null,t,c))}),o.on("end",function(){try{let t=1===e.length?e[0]:Buffer.concat(e);"arraybuffer"!==u&&(t=t.toString(p),p&&"utf8"!==p||(t=Pe.stripBOM(t))),d.data=t}catch(e){return s(Re.from(e,null,t,d.request,d))}yi(i,s,d)})}v.once("abort",e=>{o.destroyed||(o.emit("error",e),o.destroy())})}),v.once("abort",e=>{s(e),g.destroy(e)}),g.on("error",function(e){s(Re.from(e,null,t,g))}),g.on("socket",function(e){e.setKeepAlive(!0,6e4)}),t.timeout){const e=parseInt(t.timeout,10);if(Number.isNaN(e))return void s(new Re("error trying to parse `config.timeout` to int",Re.ERR_BAD_OPTION_VALUE,t,g));g.setTimeout(e,function(){if(f)return;let e=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const n=t.transitional||Vr;t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),s(new Re(e,n.clarifyTimeoutError?Re.ETIMEDOUT:Re.ECONNABORTED,t,g)),w()})}if(Pe.isStream(o)){let e=!1,n=!1;o.on("end",()=>{e=!0}),o.once("error",e=>{n=!0,g.destroy(e)}),o.on("close",()=>{e||n||w(new gi("Request stream has been aborted",t,g))}),o.pipe(g)}else g.end(o)},new Promise((e,t)=>{let n,r;const s=(e,t)=>{r||(r=!0,n&&n(e,t))},a=e=>{s(e,!0),t(e)};i(t=>{s(t),e(t)},a,e=>n=e).catch(a)});var i},Qs=si.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,si.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(si.origin),si.navigator&&/(msie|trident)/i.test(si.navigator.userAgent)):()=>!0,ea=si.hasStandardBrowserEnv?{write(e,t,n,r,i,s){const a=[e+"="+encodeURIComponent(t)];Pe.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),Pe.isString(r)&&a.push("path="+r),Pe.isString(i)&&a.push("domain="+i),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};const ta=e=>e instanceof hi?{...e}:e;function na(e,t){t=t||{};const n={};function r(e,t,n,r){return Pe.isPlainObject(e)&&Pe.isPlainObject(t)?Pe.merge.call({caseless:r},e,t):Pe.isPlainObject(t)?Pe.merge({},t):Pe.isArray(t)?t.slice():t}function i(e,t,n,i){return Pe.isUndefined(t)?Pe.isUndefined(e)?void 0:r(void 0,e,0,i):r(e,t,0,i)}function s(e,t){if(!Pe.isUndefined(t))return r(void 0,t)}function a(e,t){return Pe.isUndefined(t)?Pe.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function o(n,i,s){return s in t?r(n,i):s in e?r(void 0,n):void 0}const c={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t,n)=>i(ta(e),ta(t),0,!0)};return Pe.forEach(Object.keys({...e,...t}),function(r){const s=c[r]||i,a=s(e[r],t[r],r);Pe.isUndefined(a)&&s!==o||(n[r]=a)}),n}var ra=e=>{const t=na({},e);let n,{data:r,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:a,headers:o,auth:c}=t;if(t.headers=o=hi.from(o),t.url=Kr(vi(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&o.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),Pe.isFormData(r))if(si.hasStandardBrowserEnv||si.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(!1!==(n=o.getContentType())){const[e,...t]=n?n.split(";").map(e=>e.trim()).filter(Boolean):[];o.setContentType([e||"multipart/form-data",...t].join("; "))}if(si.hasStandardBrowserEnv&&(i&&Pe.isFunction(i)&&(i=i(t)),i||!1!==i&&Qs(t.url))){const e=s&&a&&ea.read(a);e&&o.set(s,e)}return t};var ia="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,n){const r=ra(e);let i=r.data;const s=hi.from(r.headers).normalize();let a,o,c,l,u,{responseType:d,onUploadProgress:p,onDownloadProgress:h}=r;function m(){l&&l(),u&&u(),r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}let f=new XMLHttpRequest;function g(){if(!f)return;const r=hi.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());yi(function(e){t(e),m()},function(e){n(e),m()},{data:d&&"text"!==d&&"json"!==d?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:r,config:e,request:f}),f=null}f.open(r.method.toUpperCase(),r.url,!0),f.timeout=r.timeout,"onloadend"in f?f.onloadend=g:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(g)},f.onabort=function(){f&&(n(new Re("Request aborted",Re.ECONNABORTED,e,f)),f=null)},f.onerror=function(){n(new Re("Network Error",Re.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const i=r.transitional||Vr;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new Re(t,i.clarifyTimeoutError?Re.ETIMEDOUT:Re.ECONNABORTED,e,f)),f=null},void 0===i&&s.setContentType(null),"setRequestHeader"in f&&Pe.forEach(s.toJSON(),function(e,t){f.setRequestHeader(t,e)}),Pe.isUndefined(r.withCredentials)||(f.withCredentials=!!r.withCredentials),d&&"json"!==d&&(f.responseType=r.responseType),h&&([c,u]=Ds(h,!0),f.addEventListener("progress",c)),p&&f.upload&&([o,l]=Ds(p),f.upload.addEventListener("progress",o),f.upload.addEventListener("loadend",l)),(r.cancelToken||r.signal)&&(a=t=>{f&&(n(!t||t.type?new gi(null,e,f):t),f.abort(),f=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));const y=Ss(r.url);y&&-1===si.protocols.indexOf(y)?n(new Re("Unsupported protocol "+y+":",Re.ERR_BAD_REQUEST,e)):f.send(i||null)})};const sa=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const i=function(e){if(!n){n=!0,a();const t=e instanceof Error?e:this.reason;r.abort(t instanceof Re?t:new gi(t instanceof Error?t.message:t))}};let s=t&&setTimeout(()=>{s=null,i(new Re(`timeout ${t} of ms exceeded`,Re.ETIMEDOUT))},t);const a=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)}),e=null)};e.forEach(e=>e.addEventListener("abort",i));const{signal:o}=r;return o.unsubscribe=()=>Pe.asap(a),o}},aa=function*(e,t){let n=e.byteLength;if(n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},oa=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:n}=await t.read();if(e)break;yield n}}finally{await t.cancel()}},ca=(e,t,n,r)=>{const i=async function*(e,t){for await(const n of oa(e))yield*aa(n,t)}(e,t);let s,a=0,o=e=>{s||(s=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await i.next();if(t)return o(),void e.close();let s=r.byteLength;if(n){let e=a+=s;n(e)}e.enqueue(new Uint8Array(r))}catch(e){throw o(e),e}},cancel:e=>(o(e),i.return())},{highWaterMark:2})},la="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,ua=la&&"function"==typeof ReadableStream,da=la&&("function"==typeof TextEncoder?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),pa=(e,...t)=>{try{return!!e(...t)}catch(e){return!1}},ha=ua&&pa(()=>{let e=!1;const t=new Request(si.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),ma=ua&&pa(()=>Pe.isReadableStream(new Response("").body)),fa={stream:ma&&(e=>e.body)};var ga;la&&(ga=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!fa[e]&&(fa[e]=Pe.isFunction(ga[e])?t=>t[e]():(t,n)=>{throw new Re(`Response type '${e}' is not supported`,Re.ERR_NOT_SUPPORT,n)})}));const ya=async(e,t)=>{const n=Pe.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(Pe.isBlob(e))return e.size;if(Pe.isSpecCompliantForm(e)){const t=new Request(si.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return Pe.isArrayBufferView(e)||Pe.isArrayBuffer(e)?e.byteLength:(Pe.isURLSearchParams(e)&&(e+=""),Pe.isString(e)?(await da(e)).byteLength:void 0)})(t):n};var va=la&&(async e=>{let{url:t,method:n,data:r,signal:i,cancelToken:s,timeout:a,onDownloadProgress:o,onUploadProgress:c,responseType:l,headers:u,withCredentials:d="same-origin",fetchOptions:p}=ra(e);l=l?(l+"").toLowerCase():"text";let h,m=sa([i,s&&s.toAbortSignal()],a);const f=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let g;try{if(c&&ha&&"get"!==n&&"head"!==n&&0!==(g=await ya(u,r))){let e,n=new Request(t,{method:"POST",body:r,duplex:"half"});if(Pe.isFormData(r)&&(e=n.headers.get("content-type"))&&u.setContentType(e),n.body){const[e,t]=Us(g,Ds(Ms(c)));r=ca(n.body,65536,e,t)}}Pe.isString(d)||(d=d?"include":"omit");const i="credentials"in Request.prototype;h=new Request(t,{...p,signal:m,method:n.toUpperCase(),headers:u.normalize().toJSON(),body:r,duplex:"half",credentials:i?d:void 0});let s=await fetch(h,p);const a=ma&&("stream"===l||"response"===l);if(ma&&(o||a&&f)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=s[t]});const t=Pe.toFiniteNumber(s.headers.get("content-length")),[n,r]=o&&Us(t,Ds(Ms(o),!0))||[];s=new Response(ca(s.body,65536,n,()=>{r&&r(),f&&f()}),e)}l=l||"text";let y=await fa[Pe.findKey(fa,l)||"text"](s,e);return!a&&f&&f(),await new Promise((t,n)=>{yi(t,n,{data:y,headers:hi.from(s.headers),status:s.status,statusText:s.statusText,config:e,request:h})})}catch(t){if(f&&f(),t&&"TypeError"===t.name&&/Load failed|fetch/i.test(t.message))throw Object.assign(new Re("Network Error",Re.ERR_NETWORK,e,h),{cause:t.cause||t});throw Re.from(t,t&&t.code,e,h)}});const ba={http:Xs,xhr:ia,fetch:va};Pe.forEach(ba,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}});const wa=e=>`- ${e}`,_a=e=>Pe.isFunction(e)||null===e||!1===e;var xa=e=>{e=Pe.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let s=0;s<t;s++){let t;if(n=e[s],r=n,!_a(n)&&(r=ba[(t=String(n)).toLowerCase()],void 0===r))throw new Re(`Unknown adapter '${t}'`);if(r)break;i[t||"#"+s]=r}if(!r){const e=Object.entries(i).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new Re("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(wa).join("\n"):" "+wa(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r};function Ea(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new gi(null,e)}function Sa(e){Ea(e),e.headers=hi.from(e.headers),e.data=mi.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return xa(e.adapter||oi.adapter)(e).then(function(t){return Ea(e),t.data=mi.call(e,e.transformResponse,t),t.headers=hi.from(t.headers),t},function(t){return fi(t)||(Ea(e),t&&t.response&&(t.response.data=mi.call(e,e.transformResponse,t.response),t.response.headers=hi.from(t.response.headers))),Promise.reject(t)})}const ka={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{ka[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const Aa={};ka.transitional=function(e,t,n){function r(e,t){return"[Axios v"+Es+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,s)=>{if(!1===e)throw new Re(r(i," has been removed"+(t?" in "+t:"")),Re.ERR_DEPRECATED);return t&&!Aa[i]&&(Aa[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,s)}},ka.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};var Oa={assertOptions:function(e,t,n){if("object"!=typeof e)throw new Re("options must be an object",Re.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const s=r[i],a=t[s];if(a){const t=e[s],n=void 0===t||a(t,s,e);if(!0!==n)throw new Re("option "+s+" must be "+n,Re.ERR_BAD_OPTION_VALUE);continue}if(!0!==n)throw new Re("Unknown option "+s,Re.ERR_BAD_OPTION)}},validators:ka};const Ca=Oa.validators;let Ia=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Gr,response:new Gr}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const n=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?n&&!String(e.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+n):e.stack=n}catch(e){}}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=na(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&Oa.assertOptions(n,{silentJSONParsing:Ca.transitional(Ca.boolean),forcedJSONParsing:Ca.transitional(Ca.boolean),clarifyTimeoutError:Ca.transitional(Ca.boolean)},!1),null!=r&&(Pe.isFunction(r)?t.paramsSerializer={serialize:r}:Oa.assertOptions(r,{encode:Ca.function,serialize:Ca.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Oa.assertOptions(t,{baseUrl:Ca.spelling("baseURL"),withXsrfToken:Ca.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&Pe.merge(i.common,i[t.method]);i&&Pe.forEach(["delete","get","head","post","put","patch","common"],e=>{delete i[e]}),t.headers=hi.concat(s,i);const a=[];let o=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,a.unshift(e.fulfilled,e.rejected))});const c=[];let l;this.interceptors.response.forEach(function(e){c.push(e.fulfilled,e.rejected)});let u,d=0;if(!o){const e=[Sa.bind(this),void 0];for(e.unshift(...a),e.push(...c),u=e.length,l=Promise.resolve(t);d<u;)l=l.then(e[d++],e[d++]);return l}u=a.length;let p=t;for(d=0;d<u;){const e=a[d++],t=a[d++];try{p=e(p)}catch(e){t.call(this,e);break}}try{l=Sa.call(this,p)}catch(e){return Promise.reject(e)}for(d=0,u=c.length;d<u;)l=l.then(c[d++],c[d++]);return l}getUri(e){return Kr(vi((e=na(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Pe.forEach(["delete","get","head","options"],function(e){Ia.prototype[e]=function(t,n){return this.request(na(n||{},{method:e,url:t,data:(n||{}).data}))}}),Pe.forEach(["post","put","patch"],function(e){function t(t){return function(n,r,i){return this.request(na(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Ia.prototype[e]=t(),Ia.prototype[e+"Form"]=t(!0)});const Ta={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ta).forEach(([e,t])=>{Ta[t]=e});const Pa=function e(t){const n=new Ia(t),r=q(Ia.prototype.request,n);return Pe.extend(r,Ia.prototype,n,{allOwnKeys:!0}),Pe.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(na(t,n))},r}(oi);Pa.Axios=Ia,Pa.CanceledError=gi,Pa.CancelToken=class e{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t;const r=new Promise(e=>{n.subscribe(e),t=e}).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e(function(e,r,i){n.reason||(n.reason=new gi(e,r,i),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;const n=new e(function(e){t=e});return{token:n,cancel:t}}},Pa.isCancel=fi,Pa.VERSION=Es,Pa.toFormData=zr,Pa.AxiosError=Re,Pa.Cancel=Pa.CanceledError,Pa.all=function(e){return Promise.all(e)},Pa.spread=function(e){return function(t){return e.apply(null,t)}},Pa.isAxiosError=function(e){return Pe.isObject(e)&&!0===e.isAxiosError},Pa.mergeConfig=na,Pa.AxiosHeaders=hi,Pa.formToJSON=e=>ai(Pe.isHTMLForm(e)?new FormData(e):e),Pa.getAdapter=xa,Pa.HttpStatusCode=Ta,Pa.default=Pa;const{Axios:Ra,AxiosError:ja,CanceledError:Na,isCancel:$a,CancelToken:La,VERSION:Da,all:Ua,Cancel:Ma,isAxiosError:Fa,spread:za,toFormData:Ba,AxiosHeaders:qa,HttpStatusCode:Wa,formToJSON:Ha,getAdapter:Ka,mergeConfig:Ga}=Pa,Va=()=>`${process.env.QDRANT_HOST||"http://host.docker.internal"}:${process.env.QDRANT_PORT||"6333"}`;async function Za({collection_name:e=null}){try{if(!e)throw new Error("Collection collection_name is required");const{data:{result:t}}=await Pa.get(`${Va()}/collections/${e}/exists`);return t}catch(e){if(e.response&&404===e.response.status)return!1;throw console.error("@collection_exists",e),e}}async function Ja({distance:e="Cosine",collection_name:t=null,size:n=1536,init_from:r=null,optimizers_config:i=null,hnsw_config:s=null,quantization_config:a=null,params:o=null,on_disk:c=!0,on_disk_payload:l=!0}){try{if(!t)throw new Error("Collection collection_name is required");const{exists:u}=await Za({collection_name:t});if(!0===u)return console.log(`Collection ${t} already exists`),{status:"exists",message:`Collection ${t} already exists`};const d={vectors:{size:n,distance:e},on_disk:c,on_disk_payload:l};i&&(d.optimizers_config=i),s&&(d.hnsw_config=s),a&&(d.quantization_config=a),o&&(d.params=o),r&&(d.init_from={collection:r});return(await Pa.put(`${Va()}/collections/${t}`,d)).data}catch(e){throw console.error("@create_collection",e),e}}async function Ya({collection_name:e=null}){try{if(!e)throw new Error("Collection collection_name is required");return(await Pa.delete(`${Va()}/collections/${e}`)).data}catch(e){throw console.error("@delete_collection",e),e}}var Xa={getStatus:async function(){try{const{data:e}=await Pa.get(`${Va()}`);return e}catch(e){return console.error("@status",e),!1}},listCollections:async function(){try{const{data:{result:{collections:e}}}=await Pa.get(`${Va()}/collections?wait=true`);return e}catch(e){return console.error("@list_collections",e),[]}},listAliases:async function(){try{const{data:{result:{aliases:e}}}=await Pa.get(`${Va()}/aliases`);return e}catch(e){return console.error("@list_aliases",e),[]}},createCollection:Ja,createCollectionMultivector:async function({collection_name:e=null,vectors:t=null}){try{if(!e)throw new Error("Collection name is required");if(!t||"object"!=typeof t||0===Object.keys(t).length)throw new Error("Vector configurations are required");const{exists:n}=await Za({collection_name:e});if(!0===n)return console.log(`Collection ${e} already exists`),{status:"exists",message:`Collection ${e} already exists`};for(const[e,n]of Object.entries(t)){const t=n;if(!t.size||!t.distance)throw new Error(`Invalid configuration for vector field "${e}": size and distance are required`)}return(await Pa.put(`${Va()}/collections/${e}`,{vectors:t})).data}catch(e){throw console.error("@create_collection_multivector",e),e}},updateCollection:async function({collection_name:e=null,optimizers_config:t=null,hnsw_config:n=null,quantization_config:r=null,vectors_config:i=null,params:s=null}){try{if(!e)throw new Error("Collection collection_name is required");const a={};if(t&&(a.optimizers_config=t),n&&(a.hnsw_config=n),r&&(a.quantization_config=r),i&&(a.vectors_config=i),s&&(a.params=s),Object.keys(a).length>0){return(await Pa.patch(`${Va()}/collections/${e}`,a)).data}throw new Error("No configuration provided for update")}catch(e){throw console.error("@update_collection",e),e}},deleteCollection:Ya,collectionExists:Za,getCollectionInfo:async function({collection_name:e=null}){try{if(!e)throw new Error("Collection collection_name is required");return(await Pa.get(`${Va()}/collections/${e}`)).data.result}catch(e){throw console.error("@collection_info",e),e}},rebuildCollection:async function({distance:e="Cosine",collection_name:t=null,size:n=1536,init_from:r=null,optimizers_config:i=null,hnsw_config:s=null,quantization_config:a=null,params:o=null}){try{if(!t)throw new Error("Collection collection_name is required");await Za({collection_name:t})&&(await Ya({collection_name:t}),await new Promise(e=>setTimeout(e,1e3)));return await Ja({collection_name:t,distance:e,size:n,init_from:r,optimizers_config:i,hnsw_config:s,quantization_config:a,params:o})}catch(e){throw console.error("@rebuild_collection",e),e}},listPoints:async function({collection_name:e=null,ids:t=[]}){try{if(!e)throw new Error("Collection collection_name is required");const n=t.length?{ids:t}:{},{data:r}=await Pa.post(`${Va()}/collections/${e}/points`,n);return r}catch(e){return console.error("@list_points error:",e),{result:[]}}},scrollPoints:async function({name:e=null,limit:t=1,with_payload:n=!0,with_vector:r=!1,order_by:i=null}){},getPoint:async function({collection_name:e=null,id:t=null}){try{if(!e)throw new Error("Collection collection_name is required");if(null==t)throw new Error("Point id is required");const{data:n}=await Pa.get(`${Va()}/collections/${e}/points/${t}`);return n}catch(e){return console.error("@get_point error:",e),{result:null}}},countPoints:async function({collection_name:e=null,filter:t=null}){try{if(!e)throw new Error("Collection collection_name is required");const{data:{result:n}}=await Pa.post(`${Va()}/collections/${e}/points/count`,{...t?{filter:t}:{},exact:!0});return n}catch(e){return console.error("@count_points error"),null}},deletePoints:async function({collection_name:e=null,ids:t=[],filter:n=null}){try{if(!e)throw new Error("Collection name is required");if(!t.length&&!n)throw new Error("Either points ids or filter is required");const r=t.length?{points:t}:{filter:n};return(await Pa.post(`${Va()}/collections/${e}/points/delete`,r)).data}catch(e){return console.error("@delete_points error:",e),null}},upsertPointsRecords:async function({collection_name:e=null,points:t=[]}){try{if(!e)throw new Error("Collection collection_name is required");if(!Array.isArray(t)||0===t.length)throw new Error("Points array is required and must not be empty");const{data:{result:n}}=await Pa.put(`${Va()}/collections/${e}/points`,{points:t},{params:{wait:!0}});return n}catch(e){throw console.error("@upsert_points_records error"),e}},upsertPointsBatch:async function({collection_name:e=null,ids:t=[],payloads:n=[],vectors:r=[]}){try{if(!e)throw new Error("Collection name is required");if(!t.length||!n.length||!r.length)throw new Error("ids, payloads, and vectors arrays are required and must not be empty");if(t.length!==n.length||t.length!==r.length)throw new Error("ids, payloads, and vectors arrays must have the same length");const{data:{result:i}}=await Pa.put(`${Va()}/collections/${e}/points`,{batch:{ids:t,payloads:n,vectors:r}},{params:{wait:!0}});return i}catch(e){return console.error("@upsert_points_batch error:",e),null}},setPointsPayload:async function({collection_name:e=null,ids:t=[],payload:n=null,filter:r=null}){try{if(!e)throw new Error("Collection name is required");if(!n||"object"!=typeof n)throw new Error("Payload must be a valid object");const{data:{result:i}}=await Pa.post(`${Va()}/collections/${e}/points/payload`,{payload:n,points:t,...r?{filter:r}:{}});return i}catch(e){return null}},overwritePointsPayload:async function({collection_name:e=null,payload:t=null,ids:n=[]}){try{if(!e)throw new Error("Collection name is required");if(!t||"object"!=typeof t)throw new Error("Payload must be a valid object");if(!Array.isArray(n)||0===n.length)throw new Error("Points ids array is required and must not be empty");const{data:{result:r}}=await Pa.put(`${Va()}/collections/${e}/points/payload`,{payload:t,points:n});return r}catch(e){return console.error("@overwrite_points_payload error:",e),null}},indexPointsPayload:async function({collection_name:e=null,field_name:t=null,type:n="keyword",on_disk:r=!1,is_tenant:i=!0,is_principal:s=!0,field_schema:a=null}){try{if(!e)throw new Error("Collection name is required");if(!t)throw new Error("Field name is required");const o=a||{type:n,..."text"===n&&{tokenizer:"word",min_token_len:2,max_token_len:20,lowercase:!0},on_disk:r,is_tenant:i,is_principal:s},{data:{result:c}}=await Pa.put(`${Va()}/collections/${e}/index`,{field_name:t,field_schema:o});return c}catch(e){return console.error("@index_points_payload error:",e),null}},facetCountPointsPayload:async function({collection_name:e=null,key:t=null,filter:n=null}){try{if(!e)throw new Error("Collection name is required");if(!t)throw new Error("Facet key is required");const{data:{result:r}}=await Pa.post(`${Va()}/collections/${e}/facet`,{key:t,...n?{filter:n}:{}});return r}catch(e){return console.error("@facet_count_points_payload error:",e),null}},clearPointsPayload:async function({collection_name:e=null,ids:t=[]}){try{if(!e)throw new Error("Collection name is required");if(!Array.isArray(t)||0===t.length)throw new Error("ids array is required and must not be empty");const{data:{result:n}}=await Pa.post(`${Va()}/collections/${e}/points/payload/clear`,{points:t});return n}catch(e){return console.error("@clear_points_payload error:",e),null}},searchKnn:async function({collection_name:e=null,mode:t="default",filter:n=null,params:r=null,using:i=null,with_vectors:s=null,with_payload:a=!0,limit:o=10,offset:c=0,group_by:l=null,vector:u=null,lookup_strategy:d="average_vector",lookup_positive_vectors:p=[],lookup_negative_vectors:h=[],lookup_external_collection_name:m=null,lookup_external_vector_name:f=null}){try{if(!e)throw new Error("Collection name is required");let g={limit:o,offset:c,with_vectors:s,with_payload:a};switch(n&&(g.filter=n),r&&(g.params=r),i&&(g.using=i),t){case"default":if(!u)throw new Error("Vector is required for default mode");g.query=u;break;case"lookup":g.query={recommend:{strategy:d,positive:p,negative:h}},m&&f&&(g.lookup_from={collection:m,vector:f});break;case"random":g.query={sample:"random"};break;default:throw new Error("Invalid search mode")}if(l){const t=`${Va()}/collections/${e}/points/query/groups`;g.group_by=l;return(await Pa.post(t,g)).data.result}const y=`${Va()}/collections/${e}/points/query`,{data:{result:{points:v}}}=await Pa.post(y,g);return v}catch(e){return console.error("@search_knn",e.message),!1}},searchLookupGroups:async function({vector:e=null,group_by:t=null,limit:n=2,group_size:r=2,with_lookup:i=null}){try{if(!e)throw new Error("Query vector is required");if(!t)throw new Error("group_by field is required");const s={query:e,group_by:t,limit:n,group_size:r};i&&(s.with_lookup={collection:i.collection,with_payload:i.with_payload??!0,with_vectors:i.with_vectors??!1});const{data:{result:a}}=await Pa.post(`${Va()}/collections/chunks/points/query/groups`,s);return a}catch(e){return console.error("@search_lookup_groups error:",e.message),null}},searchKnnBatch:async function({collection_name:e=null,searches:t=[]}){try{if(!e)throw new Error("Collection name is required");if(!Array.isArray(t)||0===t.length)throw new Error("Searches array is required and must not be empty");const{data:{result:n}}=await Pa.post(`${Va()}/collections/${e}/points/query/batch?`,{searches:t},{params:{wait:!0}});return n.map(e=>e.points)}catch(e){return console.error("@search_knn_batch error:",e),null}},searchById:async function({collection_name:e=null,id:t=null,with_payload:n=!1,with_vector:r=!1}){try{if(!e)throw new Error("Collection name is required");if(null===t)throw new Error("Point ID is required");const{data:{result:{points:i}}}=await Pa.post(`${Va()}/collections/${e}/points/query`,{query:t,with_payload:n,with_vector:r});return i?.[0]||null}catch(e){return console.error("@search_id error:",e),null}},updateVectors:async function({collection_name:e=null}){},deleteVectors:async function({collection_name:e=null}){}},Qa="1.0.0";function eo(e,t=to){const n=(e=e.trim()).indexOf("```");if(-1===n)return t(e);let r=e.substring(n+3);r.startsWith("json\n")?r=r.substring(5):r.startsWith("json")?r=r.substring(4):r.startsWith("\n")&&(r=r.substring(1));const i=r.indexOf("```");let s=r;return-1!==i&&(s=r.substring(0,i)),t(s.trim())}function to(e){if(void 0===e)return null;try{return JSON.parse(e)}catch(e){}let t="";const n=[];let r=!1,i=!1;for(let s of e){if(r)'"'!==s||i?"\n"!==s||i?i="\\"===s&&!i:s="\\n":r=!1;else if('"'===s)r=!0,i=!1;else if("{"===s)n.push("}");else if("["===s)n.push("]");else if("}"===s||"]"===s){if(!n||n[n.length-1]!==s)return null;n.pop()}t+=s}r&&(t+='"');for(let e=n.length-1;e>=0;e-=1)t+=n[e];try{return JSON.parse(t)}catch(e){return null}}var no=function(e,t){if("string"!=typeof e)throw new TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()},ro=Le(no),io={exports:{}};const so=/[\p{Lu}]/u,ao=/[\p{Ll}]/u,oo=/^[\p{Lu}](?![\p{Lu}])/gu,co=/([\p{Alpha}\p{N}_]|$)/u,lo=/[_.\- ]+/,uo=new RegExp("^"+lo.source),po=new RegExp(lo.source+co.source,"gu"),ho=new RegExp("\\d+"+co.source,"gu"),mo=(e,t)=>{if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");if(t={pascalCase:!1,preserveConsecutiveUppercase:!1,...t},e=Array.isArray(e)?e.map(e=>e.trim()).filter(e=>e.length).join("-"):e.trim(),0===e.length)return"";const n=!1===t.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(t.locale),r=!1===t.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(t.locale);if(1===e.length)return t.pascalCase?r(e):n(e);return e!==n(e)&&(e=((e,t,n)=>{let r=!1,i=!1,s=!1;for(let a=0;a<e.length;a++){const o=e[a];r&&so.test(o)?(e=e.slice(0,a)+"-"+e.slice(a),r=!1,s=i,i=!0,a++):i&&s&&ao.test(o)?(e=e.slice(0,a-1)+"-"+e.slice(a-1),s=i,i=!1,r=!0):(r=t(o)===o&&n(o)!==o,s=i,i=n(o)===o&&t(o)!==o)}return e})(e,n,r)),e=e.replace(uo,""),e=t.preserveConsecutiveUppercase?((e,t)=>(oo.lastIndex=0,e.replace(oo,e=>t(e))))(e,n):n(e),t.pascalCase&&(e=r(e.charAt(0))+e.slice(1)),((e,t)=>(po.lastIndex=0,ho.lastIndex=0,e.replace(po,(e,n)=>t(n)).replace(ho,e=>t(e))))(e,r)};function fo(e,t){return t?.[e]||ro(e)}function go(e,t,n){const r={};for(const i in e)Object.hasOwn(e,i)&&(r[t(i,n)]=e[i]);return r}function yo(e){return Array.isArray(e)?[...e]:{...e}}function vo(e,t){const n=yo(e);for(const[e,r]of Object.entries(t)){const[t,...i]=e.split(".").reverse();let s=n;for(const e of i.reverse()){if(void 0===s[e])break;s[e]=yo(s[e]),s=s[e]}void 0!==s[t]&&(s[t]={lc:1,type:"secret",id:[r]})}return n}function bo(e){const t=Object.getPrototypeOf(e);return"function"==typeof e.lc_name&&("function"!=typeof t.lc_name||e.lc_name()!==t.lc_name())?e.lc_name():e.name}io.exports=mo,io.exports.default=mo;class wo{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,bo(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),void 0!==this.lc_serializable_keys?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([e])=>this.lc_serializable_keys?.includes(e))):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof wo||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e),{});for(let r=Object.getPrototypeOf(this);r;r=Object.getPrototypeOf(r))Object.assign(e,Reflect.get(r,"lc_aliases",this)),Object.assign(t,Reflect.get(r,"lc_secrets",this)),Object.assign(n,Reflect.get(r,"lc_attributes",this));return Object.keys(t).forEach(e=>{let t=this,r=n;const[i,...s]=e.split(".").reverse();for(const e of s.reverse()){if(!(e in t)||void 0===t[e])return;e in r&&void 0!==r[e]||("object"==typeof t[e]&&null!=t[e]?r[e]={}:Array.isArray(t[e])&&(r[e]=[])),t=t[e],r=r[e]}i in t&&void 0!==t[i]&&(r[i]=r[i]||t[i])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:go(Object.keys(t).length?vo(n,t):n,fo,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function _o(e){return"object"==typeof e&&null!==e&&"type"in e&&"string"==typeof e.type&&"source_type"in e&&("url"===e.source_type||"base64"===e.source_type||"text"===e.source_type||"id"===e.source_type)}function xo(e){return _o(e)&&"url"===e.source_type&&"url"in e&&"string"==typeof e.url}function Eo(e){return _o(e)&&"base64"===e.source_type&&"data"in e&&"string"==typeof e.data}function So(e){if(_o(e)){if("url"===e.source_type)return{type:"image_url",image_url:{url:e.url}};if("base64"===e.source_type){if(!e.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${e.mime_type};base64,${e.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function ko(e){const t=e.split(";")[0].split("/");if(2!==t.length)throw new Error(`Invalid mime type: "${e}" - does not match type/subtype format.`);const n=t[0].trim(),r=t[1].trim();if(""===n||""===r)throw new Error(`Invalid mime type: "${e}" - type or subtype is empty.`);const i={};for(const t of e.split(";").slice(1)){const n=t.split("=");if(2!==n.length)throw new Error(`Invalid parameter syntax in mime type: "${e}".`);const r=n[0].trim(),s=n[1].trim();if(""===r)throw new Error(`Invalid parameter syntax in mime type: "${e}".`);i[r]=s}return{type:n,subtype:r,parameters:i}}function Ao({dataUrl:e,asTypedArray:t=!1}){const n=e.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);let r;if(n){r=n[1].toLowerCase();const e=t?Uint8Array.from(atob(n[2]),e=>e.charCodeAt(0)):n[2];return{mime_type:r,data:e}}}function Oo(e,t){if("text"===e.type){if(!t.fromStandardTextBlock)throw new Error(`Converter for ${t.providerName} does not implement \`fromStandardTextBlock\` method.`);return t.fromStandardTextBlock(e)}if("image"===e.type){if(!t.fromStandardImageBlock)throw new Error(`Converter for ${t.providerName} does not implement \`fromStandardImageBlock\` method.`);return t.fromStandardImageBlock(e)}if("audio"===e.type){if(!t.fromStandardAudioBlock)throw new Error(`Converter for ${t.providerName} does not implement \`fromStandardAudioBlock\` method.`);return t.fromStandardAudioBlock(e)}if("file"===e.type){if(!t.fromStandardFileBlock)throw new Error(`Converter for ${t.providerName} does not implement \`fromStandardFileBlock\` method.`);return t.fromStandardFileBlock(e)}throw new Error(`Unable to convert content block type '${e.type}' to provider-specific format: not recognized.`)}function Co(e,t){return"string"==typeof e?""===e?t:"string"==typeof t?e+t:Array.isArray(t)&&t.some(e=>_o(e))?[{type:"text",source_type:"text",text:e},...t]:[{type:"text",text:e},...t]:Array.isArray(t)?Po(e,t)??[...e,...t]:""===t?e:Array.isArray(e)&&e.some(e=>_o(e))?[...e,{type:"file",source_type:"text",text:t}]:[...e,{type:"text",text:t}]}class Io extends wo{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return"string"==typeof this.content?this.content:Array.isArray(this.content)?this.content.map(e=>"string"==typeof e?e:"text"===e.type?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(null===e)return this;const t=(n=this._printableFields,r=Math.max(4,e),JSON.stringify(function e(t,n){if("object"!=typeof t||null==t)return t;if(n>=r)return Array.isArray(t)?"[Array]":"[Object]";if(Array.isArray(t))return t.map(t=>e(t,n+1));const i={};for(const r of Object.keys(t))i[r]=e(t[r],n+1);return i}(n,0),null,2));var n,r;return`${this.constructor.lc_name()} ${t}`}}function To(e,t){const n={...e};for(const[e,r]of Object.entries(t))if(null==n[e])n[e]=r;else{if(null==r)continue;if(typeof n[e]!=typeof r||Array.isArray(n[e])!==Array.isArray(r))throw new Error(`field[${e}] already exists in the message chunk, but with a different type.`);if("string"==typeof n[e]){if("type"===e)continue;n[e]+=r}else if("object"!=typeof n[e]||Array.isArray(n[e]))if(Array.isArray(n[e]))n[e]=Po(n[e],r);else{if(n[e]===r)continue;console.warn(`field[${e}] already exists in this message chunk and value has unsupported type.`)}else n[e]=To(n[e],r)}return n}function Po(e,t){if(void 0!==e||void 0!==t){if(void 0===e||void 0===t)return e||t;{const n=[...e];for(const e of t)if("object"==typeof e&&"index"in e&&"number"==typeof e.index){const t=n.findIndex(t=>t.index===e.index);-1!==t?n[t]=To(n[t],e):n.push(e)}else{if("object"==typeof e&&"text"in e&&""===e.text)continue;n.push(e)}return n}}}function Ro(e,t){if(!e&&!t)throw new Error("Cannot merge two undefined objects.");if(e&&t){if(typeof e!=typeof t)throw new Error(`Cannot merge objects of different types.\nLeft ${typeof e}\nRight ${typeof t}`);if("string"==typeof e&&"string"==typeof t)return e+t;if(Array.isArray(e)&&Array.isArray(t))return Po(e,t);if("object"==typeof e&&"object"==typeof t)return To(e,t);if(e===t)return e;throw new Error(`Can not merge objects of different types.\nLeft ${e}\nRight ${t}`)}return e||t}class jo extends Io{}function No(e){return"function"==typeof e?._getType}function $o(e){return No(e)&&"function"==typeof e.concat}class Lo extends Io{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,n){"string"==typeof e&&(e={content:e,name:n,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return"tool"===e._getType()}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class Do extends jo{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new Do({content:Co(this.content,e.content),additional_kwargs:To(this.additional_kwargs,e.additional_kwargs),response_metadata:To(this.response_metadata,e.response_metadata),artifact:Ro(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:(t=this.status,n=e.status,"error"===t||"error"===n?"error":"success")});var t,n}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class Uo extends Io{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let n;if("string"==typeof e)n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;const t=n.additional_kwargs?.tool_calls,r=n.tool_calls;null!=t&&t.length>0&&(void 0===r||0===r.length)&&console.warn(["New LangChain packages are available that more efficiently handle","tool calling.\n\nPlease upgrade your packages to versions that set","message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(null!=t&&void 0===r){const[e,r]=function(e){const t=[],n=[];for(const r of e)if(r.function){const e=r.function.name;try{const n={name:e||"",args:JSON.parse(r.function.arguments)||{},id:r.id};t.push(n)}catch(t){n.push({name:e,args:r.function.arguments,id:r.id,error:"Malformed args."})}}return[t,n]}(t);n.tool_calls=e??[],n.invalid_tool_calls=r??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch(e){n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"string"!=typeof n&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=n.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function Mo(e){return"ai"===e._getType()}function Fo(e){return"ai"===e._getType()}class zo extends jo{constructor(e){let t;if("string"==typeof e)t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(void 0===e.tool_call_chunks)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0};else{const n=[],r=[];for(const t of e.tool_call_chunks){let e={};try{if(e=to(t.args||"{}"),null===e||"object"!=typeof e||Array.isArray(e))throw new Error("Malformed tool call chunk args.");n.push({name:t.name??"",args:e,id:t.id,type:"tool_call"})}catch(e){r.push({name:t.name,args:t.args,id:t.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:n,invalid_tool_calls:r,usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){const t={content:Co(this.content,e.content),additional_kwargs:To(this.additional_kwargs,e.additional_kwargs),response_metadata:To(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(void 0!==this.tool_call_chunks||void 0!==e.tool_call_chunks){const n=Po(this.tool_call_chunks,e.tool_call_chunks);void 0!==n&&n.length>0&&(t.tool_call_chunks=n)}if(void 0!==this.usage_metadata||void 0!==e.usage_metadata){const n={...(void 0!==this.usage_metadata?.input_token_details?.audio||void 0!==e.usage_metadata?.input_token_details?.audio)&&{audio:(this.usage_metadata?.input_token_details?.audio??0)+(e.usage_metadata?.input_token_details?.audio??0)},...(void 0!==this.usage_metadata?.input_token_details?.cache_read||void 0!==e.usage_metadata?.input_token_details?.cache_read)&&{cache_read:(this.usage_metadata?.input_token_details?.cache_read??0)+(e.usage_metadata?.input_token_details?.cache_read??0)},...(void 0!==this.usage_metadata?.input_token_details?.cache_creation||void 0!==e.usage_metadata?.input_token_details?.cache_creation)&&{cache_creation:(this.usage_metadata?.input_token_details?.cache_creation??0)+(e.usage_metadata?.input_token_details?.cache_creation??0)}},r={...(void 0!==this.usage_metadata?.output_token_details?.audio||void 0!==e.usage_metadata?.output_token_details?.audio)&&{audio:(this.usage_metadata?.output_token_details?.audio??0)+(e.usage_metadata?.output_token_details?.audio??0)},...(void 0!==this.usage_metadata?.output_token_details?.reasoning||void 0!==e.usage_metadata?.output_token_details?.reasoning)&&{reasoning:(this.usage_metadata?.output_token_details?.reasoning??0)+(e.usage_metadata?.output_token_details?.reasoning??0)}},i=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},s=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},a={input_tokens:i.input_tokens+s.input_tokens,output_tokens:i.output_tokens+s.output_tokens,total_tokens:i.total_tokens+s.total_tokens,...Object.keys(n).length>0&&{input_token_details:n},...Object.keys(r).length>0&&{output_token_details:r}};t.usage_metadata=a}return new zo(t)}}class Bo extends Io{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Bo}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}get _printableFields(){return{...super._printableFields,role:this.role}}}class qo extends jo{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new qo({content:Co(this.content,e.content),additional_kwargs:To(this.additional_kwargs,e.additional_kwargs),response_metadata:To(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class Wo extends jo{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new Wo({content:Co(this.content,e.content),additional_kwargs:To(this.additional_kwargs,e.additional_kwargs),response_metadata:To(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class Ho extends Io{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(e,t){super(e,t)}}class Ko extends jo{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(e,t){super(e,t)}concat(e){return new Ko({content:Co(this.content,e.content),additional_kwargs:To(this.additional_kwargs,e.additional_kwargs),response_metadata:To(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class Go extends Io{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(e,t){super(e,t)}}class Vo extends jo{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(e,t){super(e,t)}concat(e){return new Vo({content:Co(this.content,e.content),additional_kwargs:To(this.additional_kwargs,e.additional_kwargs),response_metadata:To(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function Zo(e,t){return e.lc_error_code=t,e.message=`${e.message}\n\nTroubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${t}/\n`,e}function Jo(e){return!(!e||"object"!=typeof e||!("type"in e)||"tool_call"!==e.type)}class Yo extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function Xo(e){return Jo(e)?e:"string"==typeof e.id&&"function"===e.type&&"object"==typeof e.function&&null!==e.function&&"arguments"in e.function&&"string"==typeof e.function.arguments&&"name"in e.function&&"string"==typeof e.function.name?{id:e.id,args:JSON.parse(e.function.arguments),name:e.function.name,type:"tool_call"}:e}function Qo(e){let t,n;if(function(e){return"object"==typeof e&&null!=e&&1===e.lc&&Array.isArray(e.id)&&null!=e.kwargs&&"object"==typeof e.kwargs}(e)){const r=e.id.at(-1);t="HumanMessage"===r||"HumanMessageChunk"===r?"user":"AIMessage"===r||"AIMessageChunk"===r?"assistant":"SystemMessage"===r||"SystemMessageChunk"===r?"system":"FunctionMessage"===r||"FunctionMessageChunk"===r?"function":"ToolMessage"===r||"ToolMessageChunk"===r?"tool":"unknown",n=e.kwargs}else{const{type:r,...i}=e;t=r,n=i}if("human"===t||"user"===t)return new Ho(n);if("ai"===t||"assistant"===t){const{tool_calls:e,...t}=n;if(!Array.isArray(e))return new Uo(n);const r=e.map(Xo);return new Uo({...t,tool_calls:r})}if("system"===t)return new Go(n);if("developer"===t)return new Go({...n,additional_kwargs:{...n.additional_kwargs,__openai_role__:"developer"}});if("tool"===t&&"tool_call_id"in n)return new Lo({...n,content:n.content,tool_call_id:n.tool_call_id,name:n.name});throw Zo(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.\n\nReceived: ${JSON.stringify(e,null,2)}`),"MESSAGE_COERCION_FAILURE")}function ec(e){if("string"==typeof e)return new Ho(e);if(No(e))return e;if(Array.isArray(e)){const[t,n]=e;return Qo({type:t,content:n})}if(function(e){return"string"==typeof e.role}(e)){const{role:t,...n}=e;return Qo({...n,type:t})}return Qo(e)}function tc(e,t="Human",n="AI"){const r=[];for(const i of e){let e;if("human"===i._getType())e=t;else if("ai"===i._getType())e=n;else if("system"===i._getType())e="System";else if("function"===i._getType())e="Function";else if("tool"===i._getType())e="Tool";else{if("generic"!==i._getType())throw new Error(`Got unsupported message type: ${i._getType()}`);e=i.role}const s=i.name?`${i.name}, `:"",a="string"==typeof i.content?i.content:JSON.stringify(i.content,null,2);r.push(`${e}: ${s}${a}`)}return r.join("\n")}function nc(e){const t=e._getType();if("human"===t)return new Ko({...e});if("ai"===t){let t={...e};return"tool_calls"in t&&(t={...t,tool_call_chunks:t.tool_calls?.map(e=>({...e,type:"tool_call_chunk",index:void 0,args:JSON.stringify(e.args)}))}),new zo({...t})}if("system"===t)return new Vo({...e});if("function"===t)return new Wo({...e});if(Bo.isInstance(e))return new qo({...e});throw new Error("Unknown message type.")}var rc,ic;!function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},e.getValidEnumValues=t=>{const n=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),r={};for(const e of n)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(const n of e)if(t(n))return n},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(rc||(rc={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(ic||(ic={}));const sc=rc.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ac=e=>{switch(typeof e){case"undefined":return sc.undefined;case"string":return sc.string;case"number":return Number.isNaN(e)?sc.nan:sc.number;case"boolean":return sc.boolean;case"function":return sc.function;case"bigint":return sc.bigint;case"symbol":return sc.symbol;case"object":return Array.isArray(e)?sc.array:null===e?sc.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?sc.promise:"undefined"!=typeof Map&&e instanceof Map?sc.map:"undefined"!=typeof Set&&e instanceof Set?sc.set:"undefined"!=typeof Date&&e instanceof Date?sc.date:sc.object;default:return sc.unknown}},oc=rc.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class cc extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},n={_errors:[]},r=e=>{for(const i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(r);else if("invalid_return_type"===i.code)r(i.returnTypeError);else if("invalid_arguments"===i.code)r(i.argumentsError);else if(0===i.path.length)n._errors.push(t(i));else{let e=n,r=0;for(;r<i.path.length;){const n=i.path[r];r===i.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(i))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(this),n}static assert(e){if(!(e instanceof cc))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,rc.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},n=[];for(const r of this.issues)if(r.path.length>0){const n=r.path[0];t[n]=t[n]||[],t[n].push(e(r))}else n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}cc.create=e=>new cc(e);const lc=(e,t)=>{let n;switch(e.code){case oc.invalid_type:n=e.received===sc.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case oc.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,rc.jsonStringifyReplacer)}`;break;case oc.unrecognized_keys:n=`Unrecognized key(s) in object: ${rc.joinValues(e.keys,", ")}`;break;case oc.invalid_union:n="Invalid input";break;case oc.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${rc.joinValues(e.options)}`;break;case oc.invalid_enum_value:n=`Invalid enum value. Expected ${rc.joinValues(e.options)}, received '${e.received}'`;break;case oc.invalid_arguments:n="Invalid function arguments";break;case oc.invalid_return_type:n="Invalid function return type";break;case oc.invalid_date:n="Invalid date";break;case oc.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:rc.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case oc.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case oc.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case oc.custom:n="Invalid input";break;case oc.invalid_intersection_types:n="Intersection results could not be merged";break;case oc.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case oc.not_finite:n="Number must be finite";break;default:n=t.defaultError,rc.assertNever(e)}return{message:n}};let uc=lc;function dc(e,t){const n=uc,r=(e=>{const{data:t,path:n,errorMaps:r,issueData:i}=e,s=[...n,...i.path||[]],a={...i,path:s};if(void 0!==i.message)return{...i,path:s,message:i.message};let o="";const c=r.filter(e=>!!e).slice().reverse();for(const e of c)o=e(a,{data:t,defaultError:o}).message;return{...i,path:s,message:o}})({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===lc?void 0:lc].filter(e=>!!e)});e.common.issues.push(r)}class pc{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const r of t){if("aborted"===r.status)return hc;"dirty"===r.status&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const e of t){const t=await e.key,r=await e.value;n.push({key:t,value:r})}return pc.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const r of t){const{key:t,value:i}=r;if("aborted"===t.status)return hc;if("aborted"===i.status)return hc;"dirty"===t.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"===t.value||void 0===i.value&&!r.alwaysSet||(n[t.value]=i.value)}return{status:e.value,value:n}}}const hc=Object.freeze({status:"aborted"}),mc=e=>({status:"dirty",value:e}),fc=e=>({status:"valid",value:e}),gc=e=>"aborted"===e.status,yc=e=>"dirty"===e.status,vc=e=>"valid"===e.status,bc=e=>"undefined"!=typeof Promise&&e instanceof Promise;var wc;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(wc||(wc={}));class _c{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const xc=(e,t)=>{if(vc(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new cc(e.common.issues);return this._error=t,this._error}}};function Ec(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:i}=e;if(t&&(n||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:i};return{errorMap:(t,i)=>{const{message:s}=e;return"invalid_enum_value"===t.code?{message:s??i.defaultError}:void 0===i.data?{message:s??r??i.defaultError}:"invalid_type"!==t.code?{message:i.defaultError}:{message:s??n??i.defaultError}},description:i}}class Sc{get description(){return this._def.description}_getType(e){return ac(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ac(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new pc,ctx:{common:e.parent.common,data:e.data,parsedType:ac(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(bc(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ac(e)},r=this._parseSync({data:e,path:n.path,parent:n});return xc(n,r)}"~validate"(e){const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ac(e)};if(!this["~standard"].async)try{const n=this._parseSync({data:e,path:[],parent:t});return vc(n)?{value:n.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>vc(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ac(e)},r=this._parse({data:e,path:n.path,parent:n}),i=await(bc(r)?r:Promise.resolve(r));return xc(n,i)}refine(e,t){const n=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,r)=>{const i=e(t),s=()=>r.addIssue({code:oc.custom,...n(t)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then(e=>!!e||(s(),!1)):!!i||(s(),!1)})}refinement(e,t){return this._refinement((n,r)=>!!e(n)||(r.addIssue("function"==typeof t?t(n,r):t),!1))}_refinement(e){return new xl({schema:this,typeName:Pl.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return El.create(this,this._def)}nullable(){return Sl.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ol.create(this)}promise(){return _l.create(this,this._def)}or(e){return ul.create([this,e],this._def)}and(e){return pl.create(this,e,this._def)}transform(e){return new xl({...Ec(this._def),schema:this,typeName:Pl.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new kl({...Ec(this._def),innerType:this,defaultValue:t,typeName:Pl.ZodDefault})}brand(){return new Cl({typeName:Pl.ZodBranded,type:this,...Ec(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new Al({...Ec(this._def),innerType:this,catchValue:t,typeName:Pl.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Il.create(this,e)}readonly(){return Tl.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const kc=/^c[^\s-]{8,}$/i,Ac=/^[0-9a-z]+$/,Oc=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Cc=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Ic=/^[a-z0-9_-]{21}$/i,Tc=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Pc=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Rc=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let jc;const Nc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,$c=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Lc=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Dc=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Uc=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Mc=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Fc="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",zc=new RegExp(`^${Fc}$`);function Bc(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${e.precision?"+":"?"}`}function qc(e){return new RegExp(`^${Bc(e)}$`)}function Wc(e){let t=`${Fc}T${Bc(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function Hc(e,t){return!("v4"!==t&&t||!Nc.test(e))||!("v6"!==t&&t||!Lc.test(e))}function Kc(e,t){if(!Tc.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),i=JSON.parse(atob(r));return"object"==typeof i&&null!==i&&((!("typ"in i)||"JWT"===i?.typ)&&(!!i.alg&&(!t||i.alg===t)))}catch{return!1}}function Gc(e,t){return!("v4"!==t&&t||!$c.test(e))||!("v6"!==t&&t||!Dc.test(e))}class Vc extends Sc{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==sc.string){const t=this._getOrReturnCtx(e);return dc(t,{code:oc.invalid_type,expected:sc.string,received:t.parsedType}),hc}const t=new pc;let n;for(const r of this._def.checks)if("min"===r.kind)e.data.length<r.value&&(n=this._getOrReturnCtx(e,n),dc(n,{code:oc.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),t.dirty());else if("max"===r.kind)e.data.length>r.value&&(n=this._getOrReturnCtx(e,n),dc(n,{code:oc.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),t.dirty());else if("length"===r.kind){const i=e.data.length>r.value,s=e.data.length<r.value;(i||s)&&(n=this._getOrReturnCtx(e,n),i?dc(n,{code:oc.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):s&&dc(n,{code:oc.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),t.dirty())}else if("email"===r.kind)Rc.test(e.data)||(n=this._getOrReturnCtx(e,n),dc(n,{validation:"email",code:oc.invalid_string,message:r.message}),t.dirty());else if("emoji"===r.kind)jc||(jc=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),jc.test(e.data)||(n=this._getOrReturnCtx(e,n),dc(n,{validation:"emoji",code:oc.invalid_string,message:r.message}),t.dirty());else if("uuid"===r.kind)Cc.test(e.data)||(n=this._getOrReturnCtx(e,n),dc(n,{validation:"uuid",code:oc.invalid_string,message:r.message}),t.dirty());else if("nanoid"===r.kind)Ic.test(e.data)||(n=this._getOrReturnCtx(e,n),dc(n,{validation:"nanoid",code:oc.invalid_string,message:r.message}),t.dirty());else if("cuid"===r.kind)kc.test(e.data)||(n=this._getOrReturnCtx(e,n),dc(n,{validation:"cuid",code:oc.invalid_string,message:r.message}),t.dirty());else if("cuid2"===r.kind)Ac.test(e.data)||(n=this._getOrReturnCtx(e,n),dc(n,{validation:"cuid2",code:oc.invalid_string,message:r.message}),t.dirty());else if("ulid"===r.kind)Oc.test(e.data)||(n=this._getOrReturnCtx(e,n),dc(n,{validation:"ulid",code:oc.invalid_string,message:r.message}),t.dirty());else if("url"===r.kind)try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),dc(n,{validation:"url",code:oc.invalid_string,message:r.message}),t.dirty()}else if("regex"===r.kind){r.regex.lastIndex=0;r.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),dc(n,{validation:"regex",code:oc.invalid_string,message:r.message}),t.dirty())}else if("trim"===r.kind)e.data=e.data.trim();else if("includes"===r.kind)e.data.includes(r.value,r.position)||(n=this._getOrReturnCtx(e,n),dc(n,{code:oc.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),t.dirty());else if("toLowerCase"===r.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===r.kind)e.data=e.data.toUpperCase();else if("startsWith"===r.kind)e.data.startsWith(r.value)||(n=this._getOrReturnCtx(e,n),dc(n,{code:oc.invalid_string,validation:{startsWith:r.value},message:r.message}),t.dirty());else if("endsWith"===r.kind)e.data.endsWith(r.value)||(n=this._getOrReturnCtx(e,n),dc(n,{code:oc.invalid_string,validation:{endsWith:r.value},message:r.message}),t.dirty());else if("datetime"===r.kind){Wc(r).test(e.data)||(n=this._getOrReturnCtx(e,n),dc(n,{code:oc.invalid_string,validation:"datetime",message:r.message}),t.dirty())}else if("date"===r.kind){zc.test(e.data)||(n=this._getOrReturnCtx(e,n),dc(n,{code:oc.invalid_string,validation:"date",message:r.message}),t.dirty())}else if("time"===r.kind){qc(r).test(e.data)||(n=this._getOrReturnCtx(e,n),dc(n,{code:oc.invalid_string,validation:"time",message:r.message}),t.dirty())}else"duration"===r.kind?Pc.test(e.data)||(n=this._getOrReturnCtx(e,n),dc(n,{validation:"duration",code:oc.invalid_string,message:r.message}),t.dirty()):"ip"===r.kind?Hc(e.data,r.version)||(n=this._getOrReturnCtx(e,n),dc(n,{validation:"ip",code:oc.invalid_string,message:r.message}),t.dirty()):"jwt"===r.kind?Kc(e.data,r.alg)||(n=this._getOrReturnCtx(e,n),dc(n,{validation:"jwt",code:oc.invalid_string,message:r.message}),t.dirty()):"cidr"===r.kind?Gc(e.data,r.version)||(n=this._getOrReturnCtx(e,n),dc(n,{validation:"cidr",code:oc.invalid_string,message:r.message}),t.dirty()):"base64"===r.kind?Uc.test(e.data)||(n=this._getOrReturnCtx(e,n),dc(n,{validation:"base64",code:oc.invalid_string,message:r.message}),t.dirty()):"base64url"===r.kind?Mc.test(e.data)||(n=this._getOrReturnCtx(e,n),dc(n,{validation:"base64url",code:oc.invalid_string,message:r.message}),t.dirty()):rc.assertNever(r);return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement(t=>e.test(t),{validation:t,code:oc.invalid_string,...wc.errToObj(n)})}_addCheck(e){return new Vc({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...wc.errToObj(e)})}url(e){return this._addCheck({kind:"url",...wc.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...wc.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...wc.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...wc.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...wc.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...wc.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...wc.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...wc.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...wc.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...wc.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...wc.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...wc.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...wc.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...wc.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...wc.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...wc.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...wc.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...wc.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...wc.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...wc.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...wc.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...wc.errToObj(t)})}nonempty(e){return this.min(1,wc.errToObj(e))}trim(){return new Vc({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Vc({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Vc({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function Zc(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,i=n>r?n:r;return Number.parseInt(e.toFixed(i).replace(".",""))%Number.parseInt(t.toFixed(i).replace(".",""))/10**i}Vc.create=e=>new Vc({checks:[],typeName:Pl.ZodString,coerce:e?.coerce??!1,...Ec(e)});class Jc extends Sc{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==sc.number){const t=this._getOrReturnCtx(e);return dc(t,{code:oc.invalid_type,expected:sc.number,received:t.parsedType}),hc}let t;const n=new pc;for(const r of this._def.checks)if("int"===r.kind)rc.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),dc(t,{code:oc.invalid_type,expected:"integer",received:"float",message:r.message}),n.dirty());else if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),dc(t,{code:oc.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),dc(t,{code:oc.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty())}else"multipleOf"===r.kind?0!==Zc(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),dc(t,{code:oc.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),dc(t,{code:oc.not_finite,message:r.message}),n.dirty()):rc.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,wc.toString(t))}gt(e,t){return this.setLimit("min",e,!1,wc.toString(t))}lte(e,t){return this.setLimit("max",e,!0,wc.toString(t))}lt(e,t){return this.setLimit("max",e,!1,wc.toString(t))}setLimit(e,t,n,r){return new Jc({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:wc.toString(r)}]})}_addCheck(e){return new Jc({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:wc.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:wc.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:wc.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:wc.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:wc.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:wc.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:wc.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:wc.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:wc.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&rc.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Jc.create=e=>new Jc({checks:[],typeName:Pl.ZodNumber,coerce:e?.coerce||!1,...Ec(e)});class Yc extends Sc{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==sc.bigint)return this._getInvalidInput(e);let t;const n=new pc;for(const r of this._def.checks)if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),dc(t,{code:oc.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),dc(t,{code:oc.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty())}else"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),dc(t,{code:oc.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):rc.assertNever(r);return{status:n.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return dc(t,{code:oc.invalid_type,expected:sc.bigint,received:t.parsedType}),hc}gte(e,t){return this.setLimit("min",e,!0,wc.toString(t))}gt(e,t){return this.setLimit("min",e,!1,wc.toString(t))}lte(e,t){return this.setLimit("max",e,!0,wc.toString(t))}lt(e,t){return this.setLimit("max",e,!1,wc.toString(t))}setLimit(e,t,n,r){return new Yc({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:wc.toString(r)}]})}_addCheck(e){return new Yc({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:wc.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:wc.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:wc.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:wc.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:wc.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}Yc.create=e=>new Yc({checks:[],typeName:Pl.ZodBigInt,coerce:e?.coerce??!1,...Ec(e)});class Xc extends Sc{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==sc.boolean){const t=this._getOrReturnCtx(e);return dc(t,{code:oc.invalid_type,expected:sc.boolean,received:t.parsedType}),hc}return fc(e.data)}}Xc.create=e=>new Xc({typeName:Pl.ZodBoolean,coerce:e?.coerce||!1,...Ec(e)});class Qc extends Sc{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==sc.date){const t=this._getOrReturnCtx(e);return dc(t,{code:oc.invalid_type,expected:sc.date,received:t.parsedType}),hc}if(Number.isNaN(e.data.getTime())){return dc(this._getOrReturnCtx(e),{code:oc.invalid_date}),hc}const t=new pc;let n;for(const r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(n=this._getOrReturnCtx(e,n),dc(n,{code:oc.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),t.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(n=this._getOrReturnCtx(e,n),dc(n,{code:oc.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),t.dirty()):rc.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Qc({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:wc.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:wc.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}Qc.create=e=>new Qc({checks:[],coerce:e?.coerce||!1,typeName:Pl.ZodDate,...Ec(e)});class el extends Sc{_parse(e){if(this._getType(e)!==sc.symbol){const t=this._getOrReturnCtx(e);return dc(t,{code:oc.invalid_type,expected:sc.symbol,received:t.parsedType}),hc}return fc(e.data)}}el.create=e=>new el({typeName:Pl.ZodSymbol,...Ec(e)});class tl extends Sc{_parse(e){if(this._getType(e)!==sc.undefined){const t=this._getOrReturnCtx(e);return dc(t,{code:oc.invalid_type,expected:sc.undefined,received:t.parsedType}),hc}return fc(e.data)}}tl.create=e=>new tl({typeName:Pl.ZodUndefined,...Ec(e)});class nl extends Sc{_parse(e){if(this._getType(e)!==sc.null){const t=this._getOrReturnCtx(e);return dc(t,{code:oc.invalid_type,expected:sc.null,received:t.parsedType}),hc}return fc(e.data)}}nl.create=e=>new nl({typeName:Pl.ZodNull,...Ec(e)});class rl extends Sc{constructor(){super(...arguments),this._any=!0}_parse(e){return fc(e.data)}}rl.create=e=>new rl({typeName:Pl.ZodAny,...Ec(e)});class il extends Sc{constructor(){super(...arguments),this._unknown=!0}_parse(e){return fc(e.data)}}il.create=e=>new il({typeName:Pl.ZodUnknown,...Ec(e)});class sl extends Sc{_parse(e){const t=this._getOrReturnCtx(e);return dc(t,{code:oc.invalid_type,expected:sc.never,received:t.parsedType}),hc}}sl.create=e=>new sl({typeName:Pl.ZodNever,...Ec(e)});class al extends Sc{_parse(e){if(this._getType(e)!==sc.undefined){const t=this._getOrReturnCtx(e);return dc(t,{code:oc.invalid_type,expected:sc.void,received:t.parsedType}),hc}return fc(e.data)}}al.create=e=>new al({typeName:Pl.ZodVoid,...Ec(e)});class ol extends Sc{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==sc.array)return dc(t,{code:oc.invalid_type,expected:sc.array,received:t.parsedType}),hc;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,i=t.data.length<r.exactLength.value;(e||i)&&(dc(t,{code:e?oc.too_big:oc.too_small,minimum:i?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(dc(t,{code:oc.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(dc(t,{code:oc.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((e,n)=>r.type._parseAsync(new _c(t,e,t.path,n)))).then(e=>pc.mergeArray(n,e));const i=[...t.data].map((e,n)=>r.type._parseSync(new _c(t,e,t.path,n)));return pc.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new ol({...this._def,minLength:{value:e,message:wc.toString(t)}})}max(e,t){return new ol({...this._def,maxLength:{value:e,message:wc.toString(t)}})}length(e,t){return new ol({...this._def,exactLength:{value:e,message:wc.toString(t)}})}nonempty(e){return this.min(1,e)}}function cl(e){if(e instanceof ll){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=El.create(cl(r))}return new ll({...e._def,shape:()=>t})}return e instanceof ol?new ol({...e._def,type:cl(e.element)}):e instanceof El?El.create(cl(e.unwrap())):e instanceof Sl?Sl.create(cl(e.unwrap())):e instanceof hl?hl.create(e.items.map(e=>cl(e))):e}ol.create=(e,t)=>new ol({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Pl.ZodArray,...Ec(t)});class ll extends Sc{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=rc.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==sc.object){const t=this._getOrReturnCtx(e);return dc(t,{code:oc.invalid_type,expected:sc.object,received:t.parsedType}),hc}const{status:t,ctx:n}=this._processInputParams(e),{shape:r,keys:i}=this._getCached(),s=[];if(!(this._def.catchall instanceof sl&&"strip"===this._def.unknownKeys))for(const e in n.data)i.includes(e)||s.push(e);const a=[];for(const e of i){const t=r[e],i=n.data[e];a.push({key:{status:"valid",value:e},value:t._parse(new _c(n,i,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof sl){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of s)a.push({key:{status:"valid",value:e},value:{status:"valid",value:n.data[e]}});else if("strict"===e)s.length>0&&(dc(n,{code:oc.unrecognized_keys,keys:s}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of s){const r=n.data[t];a.push({key:{status:"valid",value:t},value:e._parse(new _c(n,r,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const e=[];for(const t of a){const n=await t.key,r=await t.value;e.push({key:n,value:r,alwaysSet:t.alwaysSet})}return e}).then(e=>pc.mergeObjectSync(t,e)):pc.mergeObjectSync(t,a)}get shape(){return this._def.shape()}strict(e){return wc.errToObj,new ll({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,n)=>{const r=this._def.errorMap?.(t,n).message??n.defaultError;return"unrecognized_keys"===t.code?{message:wc.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new ll({...this._def,unknownKeys:"strip"})}passthrough(){return new ll({...this._def,unknownKeys:"passthrough"})}extend(e){return new ll({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ll({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Pl.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ll({...this._def,catchall:e})}pick(e){const t={};for(const n of rc.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new ll({...this._def,shape:()=>t})}omit(e){const t={};for(const n of rc.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new ll({...this._def,shape:()=>t})}deepPartial(){return cl(this)}partial(e){const t={};for(const n of rc.objectKeys(this.shape)){const r=this.shape[n];e&&!e[n]?t[n]=r:t[n]=r.optional()}return new ll({...this._def,shape:()=>t})}required(e){const t={};for(const n of rc.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof El;)e=e._def.innerType;t[n]=e}return new ll({...this._def,shape:()=>t})}keyof(){return vl(rc.objectKeys(this.shape))}}ll.create=(e,t)=>new ll({shape:()=>e,unknownKeys:"strip",catchall:sl.create(),typeName:Pl.ZodObject,...Ec(t)}),ll.strictCreate=(e,t)=>new ll({shape:()=>e,unknownKeys:"strict",catchall:sl.create(),typeName:Pl.ZodObject,...Ec(t)}),ll.lazycreate=(e,t)=>new ll({shape:e,unknownKeys:"strip",catchall:sl.create(),typeName:Pl.ZodObject,...Ec(t)});class ul extends Sc{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map(async e=>{const n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}})).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const n of e)if("dirty"===n.result.status)return t.common.issues.push(...n.ctx.common.issues),n.result;const n=e.map(e=>new cc(e.ctx.common.issues));return dc(t,{code:oc.invalid_union,unionErrors:n}),hc});{let e;const r=[];for(const i of n){const n={...t,common:{...t.common,issues:[]},parent:null},s=i._parseSync({data:t.data,path:t.path,parent:n});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const i=r.map(e=>new cc(e));return dc(t,{code:oc.invalid_union,unionErrors:i}),hc}}get options(){return this._def.options}}function dl(e,t){const n=ac(e),r=ac(t);if(e===t)return{valid:!0,data:e};if(n===sc.object&&r===sc.object){const n=rc.objectKeys(t),r=rc.objectKeys(e).filter(e=>-1!==n.indexOf(e)),i={...e,...t};for(const n of r){const r=dl(e[n],t[n]);if(!r.valid)return{valid:!1};i[n]=r.data}return{valid:!0,data:i}}if(n===sc.array&&r===sc.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let r=0;r<e.length;r++){const i=dl(e[r],t[r]);if(!i.valid)return{valid:!1};n.push(i.data)}return{valid:!0,data:n}}return n===sc.date&&r===sc.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}ul.create=(e,t)=>new ul({options:e,typeName:Pl.ZodUnion,...Ec(t)});class pl extends Sc{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(e,r)=>{if(gc(e)||gc(r))return hc;const i=dl(e.value,r.value);return i.valid?((yc(e)||yc(r))&&t.dirty(),{status:t.value,value:i.data}):(dc(n,{code:oc.invalid_intersection_types}),hc)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([e,t])=>r(e,t)):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}pl.create=(e,t,n)=>new pl({left:e,right:t,typeName:Pl.ZodIntersection,...Ec(n)});class hl extends Sc{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==sc.array)return dc(n,{code:oc.invalid_type,expected:sc.array,received:n.parsedType}),hc;if(n.data.length<this._def.items.length)return dc(n,{code:oc.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),hc;!this._def.rest&&n.data.length>this._def.items.length&&(dc(n,{code:oc.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...n.data].map((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new _c(n,e,n.path,t)):null}).filter(e=>!!e);return n.common.async?Promise.all(r).then(e=>pc.mergeArray(t,e)):pc.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new hl({...this._def,rest:e})}}hl.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new hl({items:e,typeName:Pl.ZodTuple,rest:null,...Ec(t)})};class ml extends Sc{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==sc.map)return dc(n,{code:oc.invalid_type,expected:sc.map,received:n.parsedType}),hc;const r=this._def.keyType,i=this._def.valueType,s=[...n.data.entries()].map(([e,t],s)=>({key:r._parse(new _c(n,e,n.path,[s,"key"])),value:i._parse(new _c(n,t,n.path,[s,"value"]))}));if(n.common.async){const e=new Map;return Promise.resolve().then(async()=>{for(const n of s){const r=await n.key,i=await n.value;if("aborted"===r.status||"aborted"===i.status)return hc;"dirty"!==r.status&&"dirty"!==i.status||t.dirty(),e.set(r.value,i.value)}return{status:t.value,value:e}})}{const e=new Map;for(const n of s){const r=n.key,i=n.value;if("aborted"===r.status||"aborted"===i.status)return hc;"dirty"!==r.status&&"dirty"!==i.status||t.dirty(),e.set(r.value,i.value)}return{status:t.value,value:e}}}}ml.create=(e,t,n)=>new ml({valueType:t,keyType:e,typeName:Pl.ZodMap,...Ec(n)});class fl extends Sc{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==sc.set)return dc(n,{code:oc.invalid_type,expected:sc.set,received:n.parsedType}),hc;const r=this._def;null!==r.minSize&&n.data.size<r.minSize.value&&(dc(n,{code:oc.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&n.data.size>r.maxSize.value&&(dc(n,{code:oc.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const i=this._def.valueType;function s(e){const n=new Set;for(const r of e){if("aborted"===r.status)return hc;"dirty"===r.status&&t.dirty(),n.add(r.value)}return{status:t.value,value:n}}const a=[...n.data.values()].map((e,t)=>i._parse(new _c(n,e,n.path,t)));return n.common.async?Promise.all(a).then(e=>s(e)):s(a)}min(e,t){return new fl({...this._def,minSize:{value:e,message:wc.toString(t)}})}max(e,t){return new fl({...this._def,maxSize:{value:e,message:wc.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}fl.create=(e,t)=>new fl({valueType:e,minSize:null,maxSize:null,typeName:Pl.ZodSet,...Ec(t)});class gl extends Sc{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}gl.create=(e,t)=>new gl({getter:e,typeName:Pl.ZodLazy,...Ec(t)});class yl extends Sc{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return dc(t,{received:t.data,code:oc.invalid_literal,expected:this._def.value}),hc}return{status:"valid",value:e.data}}get value(){return this._def.value}}function vl(e,t){return new bl({values:e,typeName:Pl.ZodEnum,...Ec(t)})}yl.create=(e,t)=>new yl({value:e,typeName:Pl.ZodLiteral,...Ec(t)});class bl extends Sc{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return dc(t,{expected:rc.joinValues(n),received:t.parsedType,code:oc.invalid_type}),hc}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return dc(t,{received:t.data,code:oc.invalid_enum_value,options:n}),hc}return fc(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return bl.create(e,{...this._def,...t})}exclude(e,t=this._def){return bl.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}bl.create=vl;class wl extends Sc{_parse(e){const t=rc.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==sc.string&&n.parsedType!==sc.number){const e=rc.objectValues(t);return dc(n,{expected:rc.joinValues(e),received:n.parsedType,code:oc.invalid_type}),hc}if(this._cache||(this._cache=new Set(rc.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const e=rc.objectValues(t);return dc(n,{received:n.data,code:oc.invalid_enum_value,options:e}),hc}return fc(e.data)}get enum(){return this._def.values}}wl.create=(e,t)=>new wl({values:e,typeName:Pl.ZodNativeEnum,...Ec(t)});class _l extends Sc{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==sc.promise&&!1===t.common.async)return dc(t,{code:oc.invalid_type,expected:sc.promise,received:t.parsedType}),hc;const n=t.parsedType===sc.promise?t.data:Promise.resolve(t.data);return fc(n.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}_l.create=(e,t)=>new _l({type:e,typeName:Pl.ZodPromise,...Ec(t)});class xl extends Sc{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Pl.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,i={addIssue:e=>{dc(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===r.type){const e=r.transform(n.data,i);if(n.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return hc;const r=await this._def.schema._parseAsync({data:e,path:n.path,parent:n});return"aborted"===r.status?hc:"dirty"===r.status||"dirty"===t.value?mc(r.value):r});{if("aborted"===t.value)return hc;const r=this._def.schema._parseSync({data:e,path:n.path,parent:n});return"aborted"===r.status?hc:"dirty"===r.status||"dirty"===t.value?mc(r.value):r}}if("refinement"===r.type){const e=e=>{const t=r.refinement(e,i);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===r.status?hc:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(n=>"aborted"===n.status?hc:("dirty"===n.status&&t.dirty(),e(n.value).then(()=>({status:t.value,value:n.value}))))}if("transform"===r.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!vc(e))return hc;const s=r.transform(e.value,i);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(e=>vc(e)?Promise.resolve(r.transform(e.value,i)).then(e=>({status:t.value,value:e})):hc)}rc.assertNever(r)}}xl.create=(e,t,n)=>new xl({schema:e,typeName:Pl.ZodEffects,effect:t,...Ec(n)}),xl.createWithPreprocess=(e,t,n)=>new xl({schema:t,effect:{type:"preprocess",transform:e},typeName:Pl.ZodEffects,...Ec(n)});class El extends Sc{_parse(e){return this._getType(e)===sc.undefined?fc(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}El.create=(e,t)=>new El({innerType:e,typeName:Pl.ZodOptional,...Ec(t)});class Sl extends Sc{_parse(e){return this._getType(e)===sc.null?fc(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Sl.create=(e,t)=>new Sl({innerType:e,typeName:Pl.ZodNullable,...Ec(t)});class kl extends Sc{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===sc.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}kl.create=(e,t)=>new kl({innerType:e,typeName:Pl.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...Ec(t)});class Al extends Sc{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return bc(r)?r.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new cc(n.common.issues)},input:n.data})})):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new cc(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Al.create=(e,t)=>new Al({innerType:e,typeName:Pl.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...Ec(t)});class Ol extends Sc{_parse(e){if(this._getType(e)!==sc.nan){const t=this._getOrReturnCtx(e);return dc(t,{code:oc.invalid_type,expected:sc.nan,received:t.parsedType}),hc}return{status:"valid",value:e.data}}}Ol.create=e=>new Ol({typeName:Pl.ZodNaN,...Ec(e)});class Cl extends Sc{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Il extends Sc{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?hc:"dirty"===e.status?(t.dirty(),mc(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})()}{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?hc:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new Il({in:e,out:t,typeName:Pl.ZodPipeline})}}class Tl extends Sc{_parse(e){const t=this._def.innerType._parse(e),n=e=>(vc(e)&&(e.value=Object.freeze(e.value)),e);return bc(t)?t.then(e=>n(e)):n(t)}unwrap(){return this._def.innerType}}var Pl;Tl.create=(e,t)=>new Tl({innerType:e,typeName:Pl.ZodReadonly,...Ec(t)}),function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(Pl||(Pl={}));const Rl=Vc.create,jl=rl.create;sl.create,ol.create;const Nl=ll.create;ul.create,pl.create,hl.create,bl.create,_l.create,El.create,Sl.create;var $l={exports:{}},Ll={};function Dl(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var Ul=Dl;Dl.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},Dl.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},Dl.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1)}var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},n),this._options.unref&&this._timer.unref(),!0},Dl.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},Dl.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},Dl.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},Dl.prototype.start=Dl.prototype.try,Dl.prototype.errors=function(){return this._errors},Dl.prototype.attempts=function(){return this._attempts},Dl.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,n=0,r=0;r<this._errors.length;r++){var i=this._errors[r],s=i.message,a=(e[s]||0)+1;e[s]=a,a>=n&&(t=i,n=a)}return t},function(e){var t=Ul;e.operation=function(n){var r=e.timeouts(n);return new t(r,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})},e.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in e)t[n]=e[n];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],i=0;i<t.retries;i++)r.push(this.createTimeout(i,t));return e&&e.forever&&!r.length&&r.push(this.createTimeout(i,t)),r.sort(function(e,t){return e-t}),r},e.createTimeout=function(e,t){var n=t.randomize?Math.random()+1:1,r=Math.round(n*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return r=Math.min(r,t.maxTimeout)},e.wrap=function(t,n,r){if(n instanceof Array&&(r=n,n=null),!r)for(var i in r=[],t)"function"==typeof t[i]&&r.push(i);for(var s=0;s<r.length;s++){var a=r[s],o=t[a];t[a]=function(r){var i=e.operation(n),s=Array.prototype.slice.call(arguments,1),a=s.pop();s.push(function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),a.apply(this,arguments))}),i.attempt(function(){r.apply(t,s)})}.bind(t,o),t[a].options=n}}}(Ll);const Ml=Ll,Fl=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class zl extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const Bl=(e,t)=>new Promise((n,r)=>{t={onFailedAttempt:()=>{},retries:10,...t};const i=Ml.operation(t);i.attempt(async s=>{try{n(await e(s))}catch(e){if(!(e instanceof Error))return void r(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof zl)i.stop(),r(e.originalError);else if(e instanceof TypeError&&(a=e.message,!Fl.includes(a)))i.stop(),r(e);else{((e,t,n)=>{const r=n.retries-(t-1);e.attemptNumber=t,e.retriesLeft=r})(e,s,t);try{await t.onFailedAttempt(e)}catch(e){return void r(e)}i.retry(e)||r(i.mainError())}}var a})});$l.exports=Bl,$l.exports.default=Bl,$l.exports.AbortError=zl;var ql=Le($l.exports),Wl=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Hl(e){return"string"==typeof e&&Wl.test(e)}for(var Kl,Gl=[],Vl=0;Vl<256;++Vl)Gl.push((Vl+256).toString(16).slice(1));function Zl(e,t=0){return(Gl[e[t+0]]+Gl[e[t+1]]+Gl[e[t+2]]+Gl[e[t+3]]+"-"+Gl[e[t+4]]+Gl[e[t+5]]+"-"+Gl[e[t+6]]+Gl[e[t+7]]+"-"+Gl[e[t+8]]+Gl[e[t+9]]+"-"+Gl[e[t+10]]+Gl[e[t+11]]+Gl[e[t+12]]+Gl[e[t+13]]+Gl[e[t+14]]+Gl[e[t+15]]).toLowerCase()}var Jl=new Uint8Array(16);function Yl(){if(!Kl&&!(Kl="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Kl(Jl)}var Xl={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ql(e,t,n){if(Xl.randomUUID&&!e)return Xl.randomUUID();var r=(e=e||{}).random||(e.rng||Yl)();return r[6]=15&r[6]|64,r[8]=63&r[8]|128,Zl(r)}function eu(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function tu(e,t){return e<<t|e>>>32-t}var nu=function(e,t,n){function r(e,r,i,s){var a;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=function(e){if(!Hl(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n}(r)),16!==(null===(a=r)||void 0===a?void 0:a.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var o=new Uint8Array(16+e.length);if(o.set(r),o.set(e,r.length),(o=n(o))[6]=15&o[6]|t,o[8]=63&o[8]|128,i){s=s||0;for(var c=0;c<16;++c)i[s+c]=o[c];return i}return Zl(o)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}("v5",80,function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var i=0;i<r.length;++i)e.push(r.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var s=e.length/4+2,a=Math.ceil(s/16),o=new Array(a),c=0;c<a;++c){for(var l=new Uint32Array(16),u=0;u<16;++u)l[u]=e[64*c+4*u]<<24|e[64*c+4*u+1]<<16|e[64*c+4*u+2]<<8|e[64*c+4*u+3];o[c]=l}o[a-1][14]=8*(e.length-1)/Math.pow(2,32),o[a-1][14]=Math.floor(o[a-1][14]),o[a-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<a;++d){for(var p=new Uint32Array(80),h=0;h<16;++h)p[h]=o[d][h];for(var m=16;m<80;++m)p[m]=tu(p[m-3]^p[m-8]^p[m-14]^p[m-16],1);for(var f=n[0],g=n[1],y=n[2],v=n[3],b=n[4],w=0;w<80;++w){var _=Math.floor(w/20),x=tu(f,5)+eu(_,g,y,v)+b+t[_]+p[w]>>>0;b=v,v=y,y=tu(g,30)>>>0,g=f,f=x}n[0]=n[0]+f>>>0,n[1]=n[1]+g>>>0,n[2]=n[2]+y>>>0,n[3]=n[3]+v>>>0,n[4]=n[4]+b>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]});const ru=Symbol.for("ls:tracing_async_local_storage"),iu=new class{getStore(){}run(e,t){return t()}};const su=new class{getInstance(){return globalThis[ru]??iu}initializeGlobalInstance(e){void 0===globalThis[ru]&&(globalThis[ru]=e)}};function au(e){return"function"==typeof e&&"langsmith:traceable"in e}
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const ou=Object.prototype.hasOwnProperty;function cu(e,t){return ou.call(e,t)}function lu(e){if(Array.isArray(e)){const t=new Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let n in e)cu(e,n)&&t.push(n);return t}function uu(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function du(e){let t=0;const n=e.length;let r;for(;t<n;){if(r=e.charCodeAt(t),!(r>=48&&r<=57))return!1;t++}return!0}function pu(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function hu(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function mu(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(mu(e[t]))return!0}else if("object"==typeof e){const n=lu(e),r=n.length;for(var t=0;t<r;t++)if(mu(e[n[t]]))return!0}return!1}function fu(e,t){const n=[e];for(const e in t){const r="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==r&&n.push(`${e}: ${r}`)}return n.join("\n")}class gu extends Error{constructor(e,t,n,r,i){super(fu(e,{name:t,index:n,operation:r,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=fu(e,{name:t,index:n,operation:r,tree:i})}}const yu=gu,vu={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){let r=wu(n,this.path);r&&(r=uu(r));const i=_u(n,{op:"remove",path:this.from}).removed;return _u(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){const r=wu(n,this.from);return _u(n,{op:"add",path:this.path,value:uu(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Su(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}};var bu={add:function(e,t,n){return du(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:vu.move,copy:vu.copy,test:vu.test,_get:vu._get};function wu(e,t){if(""==t)return e;var n={op:"_get",path:t};return _u(e,n),n.value}function _u(e,t,n=!1,r=!0,i=!0,s=0){if(n&&("function"==typeof n?n(t,0,e,t.path):Eu(t,0)),""===t.path){let r={newDocument:e};if("add"===t.op)return r.newDocument=t.value,r;if("replace"===t.op)return r.newDocument=t.value,r.removed=e,r;if("move"===t.op||"copy"===t.op)return r.newDocument=wu(e,t.from),"move"===t.op&&(r.removed=e),r;if("test"===t.op){if(r.test=Su(e,t.value),!1===r.test)throw new yu("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return r.newDocument=e,r}if("remove"===t.op)return r.removed=e,r.newDocument=null,r;if("_get"===t.op)return t.value=e,r;if(n)throw new yu("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return r}{r||(e=uu(e));const a=(t.path||"").split("/");let o,c,l,u=e,d=1,p=a.length;for(l="function"==typeof n?n:Eu;;){if(c=a[d],c&&-1!=c.indexOf("~")&&(c=hu(c)),i&&("__proto__"==c||"prototype"==c&&d>0&&"constructor"==a[d-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===o&&(void 0===u[c]?o=a.slice(0,d).join("/"):d==p-1&&(o=t.path),void 0!==o&&l(t,0,e,o)),d++,Array.isArray(u)){if("-"===c)c=u.length;else{if(n&&!du(c))throw new yu("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);du(c)&&(c=~~c)}if(d>=p){if(n&&"add"===t.op&&c>u.length)throw new yu("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);const r=bu[t.op].call(t,u,c,e);if(!1===r.test)throw new yu("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return r}}else if(d>=p){const n=vu[t.op].call(t,u,c,e);if(!1===n.test)throw new yu("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return n}if(u=u[c],n&&d<p&&(!u||"object"!=typeof u))throw new yu("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function xu(e,t,n,r=!0,i=!0){if(n&&!Array.isArray(t))throw new yu("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=uu(e));const s=new Array(t.length);for(let r=0,a=t.length;r<a;r++)s[r]=_u(e,t[r],n,!0,i,r),e=s[r].newDocument;return s.newDocument=e,s}function Eu(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new yu("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!vu[e.op])throw new yu("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new yu("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new yu('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new yu("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new yu("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&mu(e.value))throw new yu("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new yu("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new yu("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var a=function(e,t,n){try{if(!Array.isArray(e))throw new yu("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)xu(uu(t),uu(e),n||!0);else{n=n||Eu;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(e){if(e instanceof yu)return e;throw e}}([{op:"_get",path:e.from,value:void 0}],n);if(a&&"OPERATION_PATH_UNRESOLVABLE"===a.name)throw new yu("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function Su(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,i,s=Array.isArray(e),a=Array.isArray(t);if(s&&a){if((r=e.length)!=t.length)return!1;for(n=r;0!==n--;)if(!Su(e[n],t[n]))return!1;return!0}if(s!=a)return!1;var o=Object.keys(e);if((r=o.length)!==Object.keys(t).length)return!1;for(n=r;0!==n--;)if(!t.hasOwnProperty(o[n]))return!1;for(n=r;0!==n--;)if(!Su(e[i=o[n]],t[i]))return!1;return!0}return e!=e&&t!=t}
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function ku(e,t,n,r,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var s=lu(t),a=lu(e),o=!1,c=a.length-1;c>=0;c--){var l=e[d=a[c]];if(!cu(t,d)||void 0===t[d]&&void 0!==l&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+pu(d),value:uu(l)}),n.push({op:"remove",path:r+"/"+pu(d)}),o=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var u=t[d];"object"==typeof l&&null!=l&&"object"==typeof u&&null!=u&&Array.isArray(l)===Array.isArray(u)?ku(l,u,n,r+"/"+pu(d),i):l!==u&&(i&&n.push({op:"test",path:r+"/"+pu(d),value:uu(l)}),n.push({op:"replace",path:r+"/"+pu(d),value:uu(u)}))}}if(o||s.length!=a.length)for(c=0;c<s.length;c++){var d;cu(e,d=s[c])||void 0===t[d]||n.push({op:"add",path:r+"/"+pu(d),value:uu(t[d])})}}}function Au(e,t,n=!1){var r=[];return ku(e,t,r,"",n),r}const Ou=()=>"undefined"!=typeof Deno,Cu=()=>{let e;return e="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||Ou()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":Ou()?"deno":"other":"node",e};let Iu;async function Tu(){if(void 0===Iu){const e=Cu();Iu={library:"langchain-js",runtime:e}}return Iu}function Pu(e){try{return"undefined"!=typeof process?process.env?.[e]:Ou()?Deno?.env.get(e):void 0}catch(e){return}}class Ru{}function ju(e){return"lc_prefer_streaming"in e&&e.lc_prefer_streaming}class Nu extends Ru{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,bo(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"false"===Pu("LANGCHAIN_CALLBACKS_BACKGROUND")}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return wo.prototype.toJSON.call(this)}toJSONNotImplemented(){return wo.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends Nu{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Ql()}),Object.assign(this,e)}}}}const $u=e=>{const t=e;return void 0!==t&&"function"==typeof t.copy&&"string"==typeof t.name&&"boolean"==typeof t.awaitHandlers};function Lu(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}function Du(e){return"function"==typeof e._addRunToRunMap}class Uu extends Nu{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`\n\n${e.stack}`:""):"string"==typeof e?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=function(e,t,n){const r=n.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(e).toISOString().slice(0,-1)}${r}Z`.replace(/[-:.]/g,"")+t}(e.start_time,e.id,e.execution_order),n={...e};if(void 0!==n.parent_run_id){const e=this.runMap.get(n.parent_run_id);e&&(this._addChildRun(e,n),e.child_execution_order=Math.max(e.child_execution_order,n.child_execution_order),n.trace_id=e.trace_id,void 0!==e.dotted_order&&(n.dotted_order=[e.dotted_order,t].join(".")))}else n.trace_id=n.id,n.dotted_order=t;return this.runMap.set(n.id,n),n}async _endTrace(e){const t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await(this.onRunUpdate?.(e))}_getExecutionOrder(e){const t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,r,i,s,a,o){const c=this._getExecutionOrder(r),l=Date.now(),u=a?{...i,metadata:a}:i,d={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:u??{},tags:s||[]};return this._addRunToRunMap(d)}async handleLLMStart(e,t,n,r,i,s,a,o){const c=this.runMap.get(n)??this._createRunForLLMStart(e,t,n,r,i,s,a,o);return await(this.onRunCreate?.(c)),await(this.onLLMStart?.(c)),c}_createRunForChatModelStart(e,t,n,r,i,s,a,o){const c=this._getExecutionOrder(r),l=Date.now(),u=a?{...i,metadata:a}:i,d={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:u??{},tags:s||[]};return this._addRunToRunMap(d)}async handleChatModelStart(e,t,n,r,i,s,a,o){const c=this.runMap.get(n)??this._createRunForChatModelStart(e,t,n,r,i,s,a,o);return await(this.onRunCreate?.(c)),await(this.onLLMStart?.(c)),c}async handleLLMEnd(e,t,n,r,i){const s=this.runMap.get(t);if(!s||"llm"!==s?.run_type)throw new Error("No LLM run to end.");return s.end_time=Date.now(),s.outputs=e,s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),s.extra={...s.extra,...i},await(this.onLLMEnd?.(s)),await this._endTrace(s),s}async handleLLMError(e,t,n,r,i){const s=this.runMap.get(t);if(!s||"llm"!==s?.run_type)throw new Error("No LLM run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),s.extra={...s.extra,...i},await(this.onLLMError?.(s)),await this._endTrace(s),s}_createRunForChainStart(e,t,n,r,i,s,a,o){const c=this._getExecutionOrder(r),l=Date.now(),u={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:a??"chain",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};return this._addRunToRunMap(u)}async handleChainStart(e,t,n,r,i,s,a,o){const c=this.runMap.get(n)??this._createRunForChainStart(e,t,n,r,i,s,a,o);return await(this.onRunCreate?.(c)),await(this.onChainStart?.(c)),c}async handleChainEnd(e,t,n,r,i){const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=Lu(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),void 0!==i?.inputs&&(s.inputs=Lu(i.inputs,"input")),await(this.onChainEnd?.(s)),await this._endTrace(s),s}async handleChainError(e,t,n,r,i){const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),void 0!==i?.inputs&&(s.inputs=Lu(i.inputs,"input")),await(this.onChainError?.(s)),await this._endTrace(s),s}_createRunForToolStart(e,t,n,r,i,s,a){const o=this._getExecutionOrder(r),c=Date.now(),l={id:n,name:a??e.id[e.id.length-1],parent_run_id:r,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};return this._addRunToRunMap(l)}async handleToolStart(e,t,n,r,i,s,a){const o=this.runMap.get(n)??this._createRunForToolStart(e,t,n,r,i,s,a);return await(this.onRunCreate?.(o)),await(this.onToolStart?.(o)),o}async handleToolEnd(e,t){const n=this.runMap.get(t);if(!n||"tool"!==n?.run_type)throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await(this.onToolEnd?.(n)),await this._endTrace(n),n}async handleToolError(e,t){const n=this.runMap.get(t);if(!n||"tool"!==n?.run_type)throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await(this.onToolError?.(n)),await this._endTrace(n),n}async handleAgentAction(e,t){const n=this.runMap.get(t);if(!n||"chain"!==n?.run_type)return;const r=n;r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentAction?.(n))}async handleAgentEnd(e,t){const n=this.runMap.get(t);n&&"chain"===n?.run_type&&(n.events.push({name:"agent_end",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentEnd?.(n)))}_createRunForRetrieverStart(e,t,n,r,i,s,a){const o=this._getExecutionOrder(r),c=Date.now(),l={id:n,name:a??e.id[e.id.length-1],parent_run_id:r,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};return this._addRunToRunMap(l)}async handleRetrieverStart(e,t,n,r,i,s,a){const o=this.runMap.get(n)??this._createRunForRetrieverStart(e,t,n,r,i,s,a);return await(this.onRunCreate?.(o)),await(this.onRetrieverStart?.(o)),o}async handleRetrieverEnd(e,t){const n=this.runMap.get(t);if(!n||"retriever"!==n?.run_type)throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await(this.onRetrieverEnd?.(n)),await this._endTrace(n),n}async handleRetrieverError(e,t){const n=this.runMap.get(t);if(!n||"retriever"!==n?.run_type)throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await(this.onRetrieverError?.(n)),await this._endTrace(n),n}async handleText(e,t){const n=this.runMap.get(t);n&&"chain"===n?.run_type&&(n.events.push({name:"text",time:(new Date).toISOString(),kwargs:{text:e}}),await(this.onText?.(n)))}async handleLLMNewToken(e,t,n,r,i,s){const a=this.runMap.get(n);if(!a||"llm"!==a?.run_type)throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return a.events.push({name:"new_token",time:(new Date).toISOString(),kwargs:{token:e,idx:t,chunk:s?.chunk}}),await(this.onLLMNewToken?.(a,e,{chunk:s?.chunk})),a}}var Mu={exports:{}};!function(e){const t=(e=0)=>t=>`[${38+e};5;${t}m`,n=(e=0)=>(t,n,r)=>`[${38+e};2;${t};${n};${r}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,r={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};r.color.gray=r.color.blackBright,r.bgColor.bgGray=r.bgColor.bgBlackBright,r.color.grey=r.color.blackBright,r.bgColor.bgGrey=r.bgColor.bgBlackBright;for(const[t,n]of Object.entries(r)){for(const[t,i]of Object.entries(n))r[t]={open:`[${i[0]}m`,close:`[${i[1]}m`},n[t]=r[t],e.set(i[0],i[1]);Object.defineProperty(r,t,{value:n,enumerable:!1})}return Object.defineProperty(r,"codes",{value:e,enumerable:!1}),r.color.close="[39m",r.bgColor.close="[49m",r.color.ansi256=t(),r.color.ansi16m=n(),r.bgColor.ansi256=t(10),r.bgColor.ansi16m=n(10),Object.defineProperties(r,{rgbToAnsi256:{value:(e,t,n)=>e===t&&t===n?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(n/255*5),enumerable:!1},hexToRgb:{value:e=>{const t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:n}=t.groups;3===n.length&&(n=n.split("").map(e=>e+e).join(""));const r=Number.parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},enumerable:!1},hexToAnsi256:{value:e=>r.rgbToAnsi256(...r.hexToRgb(e)),enumerable:!1}}),r}})}(Mu);var Fu=Le(Mu.exports);function zu(e,t){return`${e.open}${t}${e.close}`}function Bu(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function qu(e){return"string"==typeof e?e.trim():null==e?e:Bu(e,e.toString())}function Wu(e){if(!e.end_time)return"";const t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}const{color:Hu}=Fu;class Ku extends Uu{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const e=this.runMap.get(n.parent_run_id);if(!e)break;t.push(e),n=e}return t}getBreadcrumbs(e){const t=[...this.getParents(e).reverse(),e].map((e,t,n)=>{const r=`${e.execution_order}:${e.run_type}:${e.name}`;return t===n.length-1?zu(Fu.bold,r):r}).join(" > ");return zu(Hu.grey,t)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${zu(Hu.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Bu(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${zu(Hu.cyan,"[chain/end]")} [${t}] [${Wu(e)}] Exiting Chain run with output: ${Bu(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${zu(Hu.red,"[chain/error]")} [${t}] [${Wu(e)}] Chain run errored with error: ${Bu(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(e=>e.trim())}:e.inputs;console.log(`${zu(Hu.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Bu(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${zu(Hu.cyan,"[llm/end]")} [${t}] [${Wu(e)}] Exiting LLM run with output: ${Bu(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${zu(Hu.red,"[llm/error]")} [${t}] [${Wu(e)}] LLM run errored with error: ${Bu(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${zu(Hu.green,"[tool/start]")} [${t}] Entering Tool run with input: "${qu(e.inputs.input)}"`)}onToolEnd(e){const t=this.getBreadcrumbs(e);console.log(`${zu(Hu.cyan,"[tool/end]")} [${t}] [${Wu(e)}] Exiting Tool run with output: "${qu(e.outputs?.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${zu(Hu.red,"[tool/error]")} [${t}] [${Wu(e)}] Tool run errored with error: ${Bu(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${zu(Hu.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Bu(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${zu(Hu.cyan,"[retriever/end]")} [${t}] [${Wu(e)}] Exiting Retriever run with output: ${Bu(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${zu(Hu.red,"[retriever/error]")} [${t}] [${Wu(e)}] Retriever run errored with error: ${Bu(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${zu(Hu.blue,"[agent/action]")} [${n}] Agent selected action: ${Bu(t.actions[t.actions.length-1],"[action]")}`)}}const Gu="gen_ai.request.model",Vu="gen_ai.usage.input_tokens",Zu="gen_ai.usage.output_tokens",Ju="gen_ai.usage.total_tokens",Yu="langsmith.span.tags",Xu=(...e)=>fetch(...e),Qu=Symbol.for("ls:fetch_implementation"),ed=e=>async(...t)=>{if(e||"true"===ud("DEBUG")){const[e,n]=t;console.log(` ${n?.method||"GET"} ${e}`)}const n=await(globalThis[Qu]??Xu)(...t);return(e||"true"===ud("DEBUG"))&&console.log(` ${n.status} ${n.statusText} ${n.url}`),n},td="0.3.60";let nd;const rd=()=>"undefined"!=typeof Deno,id=()=>nd||(nd="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||rd()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom")?"jsdom":rd()?"deno":"other":"node",nd);let sd,ad;function od(){if(void 0===sd){const e=id(),t=function(){if(void 0!==ad)return ad;const e=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],t={};for(const n of e){const e=ld(n);void 0!==e&&(t[n]=e)}return ad=t,t}();sd={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:td,...t}}return sd}function cd(){const e=function(){try{return"undefined"!=typeof process&&process.env?Object.entries(process.env).reduce((e,[t,n])=>(e[t]=String(n),e),{}):void 0}catch(e){return}}()||{},t={},n=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[r,i]of Object.entries(e))!r.startsWith("LANGCHAIN_")&&!r.startsWith("LANGSMITH_")||"string"!=typeof i||n.includes(r)||r.toLowerCase().includes("key")||r.toLowerCase().includes("secret")||r.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===r?t.revision_id=i:t[r]=i);return t}function ld(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}function ud(e){return ld(`LANGSMITH_${e}`)||ld(`LANGCHAIN_${e}`)}function dd(){return"true"===ld("OTEL_ENABLED")||"true"===ud("OTEL_ENABLED")}class pd{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){let n;if(!this.hasWarned&&dd()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0),1===t.length&&"function"==typeof t[0]?n=t[0]:2===t.length&&"function"==typeof t[1]?n=t[1]:3===t.length&&"function"==typeof t[2]&&(n=t[2]),"function"==typeof n)return n()}}const hd=Symbol.for("ls:otel_trace"),md=Symbol.for("ls:otel_context"),fd=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),gd=new class{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new pd})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}},yd=new class{active(){return{}}with(e,t){return t()}};const vd=new class{getTraceInstance(){return globalThis[hd]??gd}getContextInstance(){return globalThis[md]??yd}initializeGlobalInstances(e){void 0===globalThis[hd]&&(globalThis[hd]=e.trace),void 0===globalThis[md]&&(globalThis[md]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[fd]=e}getDefaultOTLPTracerComponents(){return globalThis[fd]??void 0}};function bd(){return vd.getTraceInstance()}const wd={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};class _d{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(const n of e)try{if(!n.run)continue;if("post"===n.operation){const e=this.createSpanForRun(n,n.run,t.get(n.id));e&&!n.run.end_time&&this.spans.set(n.id,e)}else this.updateSpanForRun(n,n.run)}catch(e){console.error(`Error processing operation ${n.id}:`,e)}}createSpanForRun(e,t,n){const r=n&&bd().getSpan(n);if(r)try{return this.finishSpanSetup(r,t,e)}catch(t){return void console.error(`Failed to create span for run ${e.id}:`,t)}}finishSpanSetup(e,t,n){return this.setSpanAttributes(e,t,n),t.error?(e.setStatus({code:2}),e.recordException(new Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{const n=this.spans.get(e.id);if(!n)return void console.debug(`No span found for run ${e.id} during update`);this.setSpanAttributes(n,t,e),t.error?(n.setStatus({code:2}),n.recordException(new Error(t.error))):n.setStatus({code:1});const r=t.end_time;r&&(n.end(new Date(r)),this.spans.delete(e.id))}catch(t){console.error(`Failed to update span for run ${e.id}:`,t)}}extractModelName(e){if(e.extra?.metadata){const t=e.extra.metadata;if(t.ls_model_name)return t.ls_model_name;if(t.invocation_params){const e=t.invocation_params;if(e.model)return e.model;if(e.model_name)return e.model_name}}}setSpanAttributes(e,t,n){if("run_type"in t&&t.run_type){e.setAttribute("langsmith.span.kind",t.run_type);const n=(r=t.run_type||"chain",wd[r]||r);e.setAttribute("gen_ai.operation.name",n)}var r;"name"in t&&t.name&&e.setAttribute("langsmith.trace.name",t.name),"session_id"in t&&t.session_id&&e.setAttribute("langsmith.trace.session_id",t.session_id),"session_name"in t&&t.session_name&&e.setAttribute("langsmith.trace.session_name",t.session_name),this.setGenAiSystem(e,t);const i=this.extractModelName(t);i&&e.setAttribute(Gu,i),"prompt_tokens"in t&&"number"==typeof t.prompt_tokens&&e.setAttribute(Vu,t.prompt_tokens),"completion_tokens"in t&&"number"==typeof t.completion_tokens&&e.setAttribute(Zu,t.completion_tokens),"total_tokens"in t&&"number"==typeof t.total_tokens&&e.setAttribute(Ju,t.total_tokens),this.setInvocationParameters(e,t);const s=t.extra?.metadata||{};for(const[t,n]of Object.entries(s))null!=n&&e.setAttribute(`langsmith.metadata.${t}`,String(n));const a=t.tags;if(a&&Array.isArray(a)?e.setAttribute(Yu,a.join(", ")):a&&e.setAttribute(Yu,String(a)),"serialized"in t&&"object"==typeof t.serialized){const n=t.serialized;n.name&&e.setAttribute("gen_ai.serialized.name",String(n.name)),n.signature&&e.setAttribute("gen_ai.serialized.signature",String(n.signature)),n.doc&&e.setAttribute("gen_ai.serialized.doc",String(n.doc))}this.setIOAttributes(e,n)}setGenAiSystem(e,t){let n="langchain";const r=this.extractModelName(t);if(r){const e=r.toLowerCase();e.includes("anthropic")||e.startsWith("claude")?n="anthropic":e.includes("bedrock")?n="aws.bedrock":e.includes("azure")&&e.includes("openai")?n="az.ai.openai":e.includes("azure")&&e.includes("inference")?n="az.ai.inference":e.includes("cohere")?n="cohere":e.includes("deepseek")?n="deepseek":e.includes("gemini")?n="gemini":e.includes("groq")?n="groq":e.includes("watson")||e.includes("ibm")?n="ibm.watsonx.ai":e.includes("mistral")?n="mistral_ai":e.includes("gpt")||e.includes("openai")?n="openai":e.includes("perplexity")||e.includes("sonar")?n="perplexity":e.includes("vertex")?n="vertex_ai":(e.includes("xai")||e.includes("grok"))&&(n="xai")}e.setAttribute("gen_ai.system",n)}setInvocationParameters(e,t){if(!t.extra?.metadata?.invocation_params)return;const n=t.extra.metadata.invocation_params;void 0!==n.max_tokens&&e.setAttribute("gen_ai.request.max_tokens",n.max_tokens),void 0!==n.temperature&&e.setAttribute("gen_ai.request.temperature",n.temperature),void 0!==n.top_p&&e.setAttribute("gen_ai.request.top_p",n.top_p),void 0!==n.frequency_penalty&&e.setAttribute("gen_ai.request.frequency_penalty",n.frequency_penalty),void 0!==n.presence_penalty&&e.setAttribute("gen_ai.request.presence_penalty",n.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{const n=t.run.inputs;"object"==typeof n&&null!==n&&(n.model&&Array.isArray(n.messages)&&e.setAttribute(Gu,n.model),void 0!==n.stream&&e.setAttribute("langsmith.request.streaming",n.stream),n.extra_headers&&e.setAttribute("langsmith.request.headers",JSON.stringify(n.extra_headers)),n.extra_query&&e.setAttribute("gen_ai.request.extra_query",JSON.stringify(n.extra_query)),n.extra_body&&e.setAttribute("gen_ai.request.extra_body",JSON.stringify(n.extra_body))),e.setAttribute("gen_ai.prompt",JSON.stringify(n))}catch(e){console.debug(`Failed to process inputs for run ${t.id}`,e)}if(t.run.outputs)try{const n=t.run.outputs,r=this.getUnifiedRunTokens(n);if(r&&(e.setAttribute(Vu,r[0]),e.setAttribute(Zu,r[1]),e.setAttribute(Ju,r[0]+r[1])),n&&"object"==typeof n){if(n.model&&e.setAttribute("gen_ai.response.model",String(n.model)),n.id&&e.setAttribute("gen_ai.response.id",n.id),n.choices&&Array.isArray(n.choices)){const t=n.choices.map(e=>e.finish_reason).filter(e=>e).map(String);t.length>0&&e.setAttribute("gen_ai.response.finish_reasons",t.join(", "))}if(n.service_tier&&e.setAttribute("gen_ai.response.service_tier",n.service_tier),n.system_fingerprint&&e.setAttribute("gen_ai.response.system_fingerprint",n.system_fingerprint),n.usage_metadata&&"object"==typeof n.usage_metadata){const t=n.usage_metadata;t.input_token_details&&e.setAttribute("gen_ai.usage.input_token_details",JSON.stringify(t.input_token_details)),t.output_token_details&&e.setAttribute("gen_ai.usage.output_token_details",JSON.stringify(t.output_token_details))}}e.setAttribute("gen_ai.completion",JSON.stringify(n))}catch(e){console.debug(`Failed to process outputs for run ${t.id}`,e)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;const n=Object.keys(e);for(const r of n){const n=e[r];if(n&&"object"==typeof n){if(t=this.extractUnifiedRunTokens(n.usage_metadata),t)return t;if(1===n.lc&&n.kwargs&&"object"==typeof n.kwargs&&(t=this.extractUnifiedRunTokens(n.kwargs.usage_metadata),t))return t}}const r=e.generations||[];if(!Array.isArray(r))return null;const i=Array.isArray(r[0])?r.flat():r;for(const e of i)if("object"==typeof e&&e.message&&"object"==typeof e.message&&e.message.kwargs&&"object"==typeof e.message.kwargs&&(t=this.extractUnifiedRunTokens(e.message.kwargs.usage_metadata),t))return t;return null}extractUnifiedRunTokens(e){return e&&"object"==typeof e?"number"!=typeof e.input_tokens||"number"!=typeof e.output_tokens?null:[e.input_tokens,e.output_tokens]:null}}var xd={},Ed={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,r,s,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new i(r,s||e,a),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],o]:e._events[c].push(o):(e._events[c]=o,e._eventsCount++),e}function a(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,a=new Array(s);i<s;i++)a[i]=r[i].fn;return a},o.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,i,s,a){var o=n?n+e:e;if(!this._events[o])return!1;var c,l,u=this._events[o],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,s),!0;case 6:return u.fn.call(u.context,t,r,i,s,a),!0}for(l=1,c=new Array(d-1);l<d;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var p,h=u.length;for(l=0;l<h;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,r);break;case 4:u[l].fn.call(u[l].context,t,r,i);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];u[l].fn.apply(u[l].context,c)}}return!0},o.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,r,i){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||i&&!o.once||r&&o.context!==r||a(this,s);else{for(var c=0,l=[],u=o.length;c<u;c++)(o[c].fn!==t||i&&!o[c].once||r&&o[c].context!==r)&&l.push(o[c]);l.length?this._events[s]=1===l.length?l[0]:l:a(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o}(Ed);var Sd=Ed.exports,kd={exports:{}};const Ad=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})));class Od extends Error{constructor(e){super(e),this.name="TimeoutError"}}const Cd=(e,t,n)=>new Promise((r,i)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void r(e);const s=setTimeout(()=>{if("function"==typeof n){try{r(n())}catch(e){i(e)}return}const s=n instanceof Error?n:new Od("string"==typeof n?n:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),i(s)},t);Ad(e.then(r,i),()=>{clearTimeout(s)})});kd.exports=Cd,kd.exports.default=Cd,kd.exports.TimeoutError=Od;var Id=kd.exports,Td={},Pd={};Object.defineProperty(Pd,"__esModule",{value:!0}),Pd.default=function(e,t,n){let r=0,i=e.length;for(;i>0;){const s=i/2|0;let a=r+s;n(e[a],t)<=0?(r=++a,i-=s+1):i=s}return r},Object.defineProperty(Td,"__esModule",{value:!0});const Rd=Pd;Td.default=class{constructor(){this._queue=[]}enqueue(e,t){const n={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(n);const r=Rd.default(this._queue,n,(e,t)=>t.priority-e.priority);this._queue.splice(r,0,n)}dequeue(){const e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}},Object.defineProperty(xd,"__esModule",{value:!0});const jd=Sd,Nd=Id,$d=Td,Ld=()=>{},Dd=new Nd.TimeoutError;var Ud=xd.default=class extends jd{constructor(e){var t,n,r,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Ld,this._resolveIdle=Ld,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:$d.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(n=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==n?n:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(r=e.interval)||void 0===r?void 0:r.toString())&&void 0!==i?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Ld,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=Ld,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((n,r)=>{this._queue.enqueue(async()=>{this._pendingCount++,this._intervalCount++;try{const i=void 0===this._timeout&&void 0===t.timeout?e():Nd.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&r(Dd)});n(await i)}catch(e){r(e)}this._next()},t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};const Md=[400,401,403,404,405,406,407,408],Fd=[409];let zd=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.debug=e.debug,this.queue="default"in Ud?new Ud.default({concurrency:this.maxConcurrency}):new Ud({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){const n=this.onFailedResponseHook;return this.queue.add(()=>ql(()=>e(...t).catch(e=>{throw e instanceof Error?e:new Error(e)}),{async onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError"))throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response,r=t?.status;if(r){if(Md.includes(+r))throw e;if(Fd.includes(+r))return;n&&await n(t)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((t,n)=>{e.signal?.addEventListener("abort",()=>{n(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>ed(this.debug)(...e).then(e=>e.ok?e:Promise.reject(e)))}};function Bd(e){return"function"==typeof e?._getType}function qd(e){const t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}const Wd=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function Hd(e,t){if(!Wd.test(e)){throw new Error(void 0!==t?`Invalid UUID for ${t}: ${e}`:`Invalid UUID: ${e}`)}return e}const Kd={};function Gd(e){Kd[e]||(console.warn(e),Kd[e]=!0)}var Vd={exports:{}};var Zd={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};var Jd="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};!function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:i}=Zd,s=Jd,a=(t=e.exports={}).re=[],o=t.safeRe=[],c=t.src=[],l=t.safeSrc=[],u=t.t={};let d=0;const p="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",i],[p,r]],m=(e,t,n)=>{const r=(e=>{for(const[t,n]of h)e=e.split(`${t}*`).join(`${t}{0,${n}}`).split(`${t}+`).join(`${t}{1,${n}}`);return e})(t),i=d++;s(e,i,t),u[e]=i,c[i]=t,l[i]=r,a[i]=new RegExp(t,n?"g":void 0),o[i]=new RegExp(r,n?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),m("MAINVERSION",`(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${c[u.NONNUMERICIDENTIFIER]}|${c[u.NUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${c[u.NONNUMERICIDENTIFIER]}|${c[u.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASE",`(?:-(${c[u.PRERELEASEIDENTIFIER]}(?:\\.${c[u.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${c[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[u.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${p}+`),m("BUILD",`(?:\\+(${c[u.BUILDIDENTIFIER]}(?:\\.${c[u.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${c[u.MAINVERSION]}${c[u.PRERELEASE]}?${c[u.BUILD]}?`),m("FULL",`^${c[u.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${c[u.MAINVERSIONLOOSE]}${c[u.PRERELEASELOOSE]}?${c[u.BUILD]}?`),m("LOOSE",`^${c[u.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${c[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${c[u.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:${c[u.PRERELEASE]})?${c[u.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:${c[u.PRERELEASELOOSE]})?${c[u.BUILD]}?)?)?`),m("XRANGE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),m("COERCE",`${c[u.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",c[u.COERCEPLAIN]+`(?:${c[u.PRERELEASE]})?`+`(?:${c[u.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",c[u.COERCE],!0),m("COERCERTLFULL",c[u.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${c[u.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",m("TILDE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${c[u.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",m("CARET",`^${c[u.LONECARET]}${c[u.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${c[u.LONECARET]}${c[u.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${c[u.GTLT]}\\s*(${c[u.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]}|${c[u.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${c[u.XRANGEPLAIN]})\\s+-\\s+(${c[u.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${c[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[u.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Vd,Vd.exports);var Yd=Vd.exports;const Xd=Object.freeze({loose:!0}),Qd=Object.freeze({});var ep=e=>e?"object"!=typeof e?Xd:e:Qd;const tp=/^[0-9]+$/,np=(e,t)=>{const n=tp.test(e),r=tp.test(t);return n&&r&&(e=+e,t=+t),e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1};var rp={compareIdentifiers:np,rcompareIdentifiers:(e,t)=>np(t,e)};const ip=Jd,{MAX_LENGTH:sp,MAX_SAFE_INTEGER:ap}=Zd,{safeRe:op,t:cp}=Yd,lp=ep,{compareIdentifiers:up}=rp;var dp=class e{constructor(t,n){if(n=lp(n),t instanceof e){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease)return t;t=t.version}else if("string"!=typeof t)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>sp)throw new TypeError(`version is longer than ${sp} characters`);ip("SemVer",t,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const r=t.trim().match(n.loose?op[cp.LOOSE]:op[cp.FULL]);if(!r)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>ap||this.major<0)throw new TypeError("Invalid major version");if(this.minor>ap||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>ap||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<ap)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(ip("SemVer.compare",this.version,this.options,t),!(t instanceof e)){if("string"==typeof t&&t===this.version)return 0;t=new e(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof e||(t=new e(t,this.options)),up(this.major,t.major)||up(this.minor,t.minor)||up(this.patch,t.patch)}comparePre(t){if(t instanceof e||(t=new e(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let n=0;do{const e=this.prerelease[n],r=t.prerelease[n];if(ip("prerelease compare",n,e,r),void 0===e&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===e)return-1;if(e!==r)return up(e,r)}while(++n)}compareBuild(t){t instanceof e||(t=new e(t,this.options));let n=0;do{const e=this.build[n],r=t.build[n];if(ip("build compare",n,e,r),void 0===e&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===e)return-1;if(e!==r)return up(e,r)}while(++n)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&!1===n)throw new Error("invalid increment argument: identifier is empty");if(t){const e=`-${t}`.match(this.options.loose?op[cp.PRERELEASELOOSE]:op[cp.PRERELEASE]);if(!e||e[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(n)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let r=this.prerelease.length;for(;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);if(-1===r){if(t===this.prerelease.join(".")&&!1===n)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let r=[t,e];!1===n&&(r=[t]),0===up(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=r):this.prerelease=r}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};const pp=dp;var hp=(e,t,n)=>new pp(e,n).compare(new pp(t,n));const mp=hp;var fp=(e,t,n)=>mp(e,t,n)>0;const gp=hp;var yp=(e,t,n)=>gp(e,t,n)<0;const vp=hp;var bp=(e,t,n)=>0===vp(e,t,n);const wp=hp;var _p=(e,t,n)=>0!==wp(e,t,n);const xp=hp;var Ep=(e,t,n)=>xp(e,t,n)>=0;const Sp=hp;var kp=(e,t,n)=>Sp(e,t,n)<=0;const Ap=bp,Op=_p,Cp=fp,Ip=Ep,Tp=yp,Pp=kp;var Rp=(e,t,n,r)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return Ap(e,n,r);case"!=":return Op(e,n,r);case">":return Cp(e,n,r);case">=":return Ip(e,n,r);case"<":return Tp(e,n,r);case"<=":return Pp(e,n,r);default:throw new TypeError(`Invalid operator: ${t}`)}};const{safeRe:jp,t:Np}=Yd;var $p,Lp,Dp,Up,Mp=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}};function Fp(){if(Lp)return $p;Lp=1;const e=/\s+/g;class t{constructor(n,s){if(s=r(s),n instanceof t)return n.loose===!!s.loose&&n.includePrerelease===!!s.includePrerelease?n:new t(n.raw,s);if(n instanceof i)return this.raw=n.value,this.set=[[n]],this.formatted=void 0,this;if(this.options=s,this.loose=!!s.loose,this.includePrerelease=!!s.includePrerelease,this.raw=n.trim().replace(e," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!m(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&f(e[0])){this.set=[e];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&p)|(this.options.loose&&h))+":"+e,r=n.get(t);if(r)return r;const a=this.options.loose,f=a?o[c.HYPHENRANGELOOSE]:o[c.HYPHENRANGE];e=e.replace(f,O(this.options.includePrerelease)),s("hyphen replace",e),e=e.replace(o[c.COMPARATORTRIM],l),s("comparator trim",e),e=e.replace(o[c.TILDETRIM],u),s("tilde trim",e),e=e.replace(o[c.CARETTRIM],d),s("caret trim",e);let g=e.split(" ").map(e=>y(e,this.options)).join(" ").split(/\s+/).map(e=>A(e,this.options));a&&(g=g.filter(e=>(s("loose invalid filter",e,this.options),!!e.match(o[c.COMPARATORLOOSE])))),s("range list",g);const v=new Map,b=g.map(e=>new i(e,this.options));for(const e of b){if(m(e))return[e];v.set(e.value,e)}v.size>1&&v.has("")&&v.delete("");const w=[...v.values()];return n.set(t,w),w}intersects(e,n){if(!(e instanceof t))throw new TypeError("a Range is required");return this.set.some(t=>g(t,n)&&e.set.some(e=>g(e,n)&&t.every(t=>e.every(e=>t.intersects(e,n)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new a(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(C(this.set[t],e,this.options))return!0;return!1}}$p=t;const n=new Mp,r=ep,i=zp(),s=Jd,a=dp,{safeRe:o,t:c,comparatorTrimReplace:l,tildeTrimReplace:u,caretTrimReplace:d}=Yd,{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:h}=Zd,m=e=>"<0.0.0-0"===e.value,f=e=>""===e.value,g=(e,t)=>{let n=!0;const r=e.slice();let i=r.pop();for(;n&&r.length;)n=r.every(e=>i.intersects(e,t)),i=r.pop();return n},y=(e,t)=>(s("comp",e,t),e=_(e,t),s("caret",e),e=b(e,t),s("tildes",e),e=E(e,t),s("xrange",e),e=k(e,t),s("stars",e),e),v=e=>!e||"x"===e.toLowerCase()||"*"===e,b=(e,t)=>e.trim().split(/\s+/).map(e=>w(e,t)).join(" "),w=(e,t)=>{const n=t.loose?o[c.TILDELOOSE]:o[c.TILDE];return e.replace(n,(t,n,r,i,a)=>{let o;return s("tilde",e,t,n,r,i,a),v(n)?o="":v(r)?o=`>=${n}.0.0 <${+n+1}.0.0-0`:v(i)?o=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:a?(s("replaceTilde pr",a),o=`>=${n}.${r}.${i}-${a} <${n}.${+r+1}.0-0`):o=`>=${n}.${r}.${i} <${n}.${+r+1}.0-0`,s("tilde return",o),o})},_=(e,t)=>e.trim().split(/\s+/).map(e=>x(e,t)).join(" "),x=(e,t)=>{s("caret",e,t);const n=t.loose?o[c.CARETLOOSE]:o[c.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,(t,n,i,a,o)=>{let c;return s("caret",e,t,n,i,a,o),v(n)?c="":v(i)?c=`>=${n}.0.0${r} <${+n+1}.0.0-0`:v(a)?c="0"===n?`>=${n}.${i}.0${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.0${r} <${+n+1}.0.0-0`:o?(s("replaceCaret pr",o),c="0"===n?"0"===i?`>=${n}.${i}.${a}-${o} <${n}.${i}.${+a+1}-0`:`>=${n}.${i}.${a}-${o} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${a}-${o} <${+n+1}.0.0-0`):(s("no pr"),c="0"===n?"0"===i?`>=${n}.${i}.${a}${r} <${n}.${i}.${+a+1}-0`:`>=${n}.${i}.${a}${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${a} <${+n+1}.0.0-0`),s("caret return",c),c})},E=(e,t)=>(s("replaceXRanges",e,t),e.split(/\s+/).map(e=>S(e,t)).join(" ")),S=(e,t)=>{e=e.trim();const n=t.loose?o[c.XRANGELOOSE]:o[c.XRANGE];return e.replace(n,(n,r,i,a,o,c)=>{s("xRange",e,n,r,i,a,o,c);const l=v(i),u=l||v(a),d=u||v(o),p=d;return"="===r&&p&&(r=""),c=t.includePrerelease?"-0":"",l?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&p?(u&&(a=0),o=0,">"===r?(r=">=",u?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):"<="===r&&(r="<",u?i=+i+1:a=+a+1),"<"===r&&(c="-0"),n=`${r+i}.${a}.${o}${c}`):u?n=`>=${i}.0.0${c} <${+i+1}.0.0-0`:d&&(n=`>=${i}.${a}.0${c} <${i}.${+a+1}.0-0`),s("xRange return",n),n})},k=(e,t)=>(s("replaceStars",e,t),e.trim().replace(o[c.STAR],"")),A=(e,t)=>(s("replaceGTE0",e,t),e.trim().replace(o[t.includePrerelease?c.GTE0PRE:c.GTE0],"")),O=e=>(t,n,r,i,s,a,o,c,l,u,d,p)=>`${n=v(r)?"":v(i)?`>=${r}.0.0${e?"-0":""}`:v(s)?`>=${r}.${i}.0${e?"-0":""}`:a?`>=${n}`:`>=${n}${e?"-0":""}`} ${c=v(l)?"":v(u)?`<${+l+1}.0.0-0`:v(d)?`<${l}.${+u+1}.0-0`:p?`<=${l}.${u}.${d}-${p}`:e?`<${l}.${u}.${+d+1}-0`:`<=${c}`}`.trim(),C=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(s(e[n].semver),e[n].semver!==i.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0};return $p}function zp(){if(Up)return Dp;Up=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(r,i){if(i=n(i),r instanceof t){if(r.loose===!!i.loose)return r;r=r.value}r=r.trim().split(/\s+/).join(" "),a("comparator",r,i),this.options=i,this.loose=!!i.loose,this.parse(r),this.semver===e?this.value="":this.value=this.operator+this.semver.version,a("comp",this)}parse(t){const n=this.options.loose?r[i.COMPARATORLOOSE]:r[i.COMPARATOR],s=t.match(n);if(!s)throw new TypeError(`Invalid comparator: ${t}`);this.operator=void 0!==s[1]?s[1]:"","="===this.operator&&(this.operator=""),s[2]?this.semver=new o(s[2],this.options.loose):this.semver=e}toString(){return this.value}test(t){if(a("Comparator.test",t,this.options.loose),this.semver===e||t===e)return!0;if("string"==typeof t)try{t=new o(t,this.options)}catch(e){return!1}return s(t,this.operator,this.semver,this.options)}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new c(e.value,r).test(this.value):""===e.operator?""===e.value||new c(this.value,r).test(e.semver):(!(r=n(r)).includePrerelease||"<0.0.0-0"!==this.value&&"<0.0.0-0"!==e.value)&&(!(!r.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&(!(!this.operator.startsWith(">")||!e.operator.startsWith(">"))||(!(!this.operator.startsWith("<")||!e.operator.startsWith("<"))||(!(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))||(!!(s(this.semver,"<",e.semver,r)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))||!!(s(this.semver,">",e.semver,r)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))))))}}Dp=t;const n=ep,{safeRe:r,t:i}=Yd,s=Rp,a=Jd,o=dp,c=Fp();return Dp}Fp(),Fp(),Fp(),Fp(),Fp(),Fp();const Bp=zp(),{ANY:qp}=Bp;Fp(),Fp(),Fp();const Wp=zp(),{ANY:Hp}=Wp;new Wp(">=0.0.0-0"),new Wp(">=0.0.0");const Kp=Yd;function Gp(e){if(!e||e.split("/").length>2||e.startsWith("/")||e.endsWith("/")||e.split(":").length>2)throw new Error(`Invalid identifier format: ${e}`);const[t,n]=e.split(":"),r=n||"latest";if(t.includes("/")){const[n,i]=t.split("/",2);if(!n||!i)throw new Error(`Invalid identifier format: ${e}`);return[n,i,r]}if(!t)throw new Error(`Invalid identifier format: ${e}`);return["-",t,r]}zp(),Fp(),Kp.re,Kp.src,Kp.t;class Vp extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function Zp(e,t,n){let r;if(e.ok)return void(n&&(r=await e.text()));r=await e.text();const i=`Failed to ${t}. Received status [${e.status}]: ${e.statusText}. Server response: ${r}`;if(409===e.status)throw new Vp(i);const s=new Error(i);throw s.status=e.status,s}const Jp="ERR_CONFLICTING_ENDPOINTS";class Yp extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:Jp}),this.name="ConflictingEndpointsError"}}var Xp="[...]",Qp={result:"[Circular]"},eh=[],th=[];const nh=new TextEncoder;function rh(e){return nh.encode(e)}function ih(e){if(e&&"object"==typeof e&&null!==e){if(e instanceof Map)return Object.fromEntries(e);if(e instanceof Set)return Array.from(e);if(e instanceof Date)return e.toISOString();if(e instanceof RegExp)return e.toString();if(e instanceof Error)return{name:e.name,message:e.message}}else if("bigint"==typeof e)return e.toString();return e}function sh(e,t,n,r,i){try{return rh(JSON.stringify(e,function(e,t){return ih(t)},r))}catch(s){if(!s.message?.includes("Converting circular structure to JSON"))return console.warn("[WARNING]: LangSmith received unserializable value."+(t?`\nContext: ${t}`:"")),rh("[Unserializable]");let a;"true"!==ud("SUPPRESS_CIRCULAR_JSON_WARNINGS")&&console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. "+(t?`\nContext: ${t}`:"")),void 0===i&&(i={depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}),oh(e,"",0,[],void 0,0,i);try{a=0===th.length?JSON.stringify(e,n,r):JSON.stringify(e,function(e){return e=void 0!==e?e:function(e,t){return t},function(t,n){if(th.length>0)for(var r=0;r<th.length;r++){var i=th[r];if(i[1]===t&&i[0]===n){n=i[2],th.splice(r,1);break}}return e.call(this,t,n)}}(n),r)}catch(e){return rh("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==eh.length;){const e=eh.pop();4===e.length?Object.defineProperty(e[0],e[1],e[3]):e[0][e[1]]=e[2]}}return rh(a)}}function ah(e,t,n,r){var i=Object.getOwnPropertyDescriptor(r,n);void 0!==i.get?i.configurable?(Object.defineProperty(r,n,{value:e}),eh.push([r,n,t,i])):th.push([t,n,e]):(r[n]=e,eh.push([r,n,t]))}function oh(e,t,n,r,i,s,a){var o;if(s+=1,"object"==typeof e&&null!==e){for(o=0;o<r.length;o++)if(r[o]===e)return void ah(Qp,e,t,i);if(void 0!==a.depthLimit&&s>a.depthLimit)return void ah(Xp,e,t,i);if(void 0!==a.edgesLimit&&n+1>a.edgesLimit)return void ah(Xp,e,t,i);if(r.push(e),Array.isArray(e))for(o=0;o<e.length;o++)oh(e[o],o,o,r,e,s,a);else{e=ih(e);var c=Object.keys(e);for(o=0;o<c.length;o++){var l=c[o];oh(e[l],l,o,r,e,s,a)}}r.pop()}}function ch(e){const t=od(),n=cd(),r=e.extra??{},i=r.metadata;return e.extra={...r,runtime:{...t,...r?.runtime},metadata:{...n,...n.revision_id||"revision_id"in e&&e.revision_id?{revision_id:("revision_id"in e?e.revision_id:void 0)??n.revision_id}:{},...i}},e}function lh(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const uh=async e=>{if(429===e?.status){const t=1e3*parseInt(e.headers.get("retry-after")??"30",10);if(t>0)return await new Promise(e=>setTimeout(e,t)),!0}return!1};function dh(e){return"number"==typeof e?Number(e.toFixed(4)):e}class ph{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const n=new Promise(e=>{t=e}),r=sh(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:n,size:r}),this.sizeBytes+=r,n}pop(e){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let n=0;for(;n+(this.peek()?.size??0)<e&&this.items.length>0;){const e=this.items.shift();e&&(t.push(e),n+=e.size,this.sizeBytes-=e.size)}if(0===t.length&&this.items.length>0){const e=this.items.shift();t.push(e),n+=e.size,this.sizeBytes-=e.size}return[t.map(e=>({action:e.action,item:e.payload,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl})),()=>t.forEach(e=>e.itemPromiseResolve())]}}const hh="https://api.smith.langchain.com";let mh=class e{constructor(t={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new ph}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:"false"===ld("LANGSMITH_TRACING_BACKGROUND")}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:"true"===ld("LANGSMITH_DEBUG")});const n=e.getDefaultClientConfig();if(this.tracingSampleRate=(e=>{const t=e?.toString()??ud("TRACING_SAMPLING_RATE");if(void 0===t)return;const n=parseFloat(t);if(n<0||n>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${n}`);return n})(t.tracingSamplingRate),this.apiUrl=lh(t.apiUrl??n.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=lh(t.apiKey??n.apiKey),this.webUrl=lh(t.webUrl??n.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=t.timeout_ms??9e4,this.caller=new zd({...t.callerOptions??{},debug:t.debug??this.debug}),this.traceBatchConcurrency=t.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=t.debug??this.debug,this.batchIngestCaller=new zd({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...t.callerOptions??{},onFailedResponseHook:uh,debug:t.debug??this.debug}),this.hideInputs=t.hideInputs??t.anonymizer??n.hideInputs,this.hideOutputs=t.hideOutputs??t.anonymizer??n.hideOutputs,this.autoBatchTracing=t.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=t.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=t.batchSizeBytesLimit,this.fetchOptions=t.fetchOptions||{},this.manualFlushMode=t.manualFlushMode??this.manualFlushMode,dd()&&(this.langSmithToOTELTranslator=new _d)}static getDefaultClientConfig(){const e=ud("API_KEY");return{apiUrl:ud("ENDPOINT")??hh,apiKey:e,webUrl:void 0,hideInputs:"true"===ud("HIDE_INPUTS"),hideOutputs:"true"===ud("HIDE_OUTPUTS")}}getHostUrl(){return this.webUrl?this.webUrl:(e=>{const t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t})(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${td}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}_getPlatformEndpointPath(e){return"/v1"!==this.apiUrl.slice(-3)&&"/v1/"!==this.apiUrl.slice(-4)?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}async processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){const t={...e};return void 0!==t.inputs&&(t.inputs=await this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){const n=t?.toString()??"",r=`${this.apiUrl}${e}?${n}`,i=await this.caller.call(ed(this.debug),r,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Zp(i,`Failed to fetch ${e}`),i}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,n){let r=Number(t.get("offset"))||0;const i=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(i));const s=`${this.apiUrl}${e}?${t}`,a=await this.caller.call(ed(this.debug),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(a,`Failed to fetch ${e}`);const o=n?n(await a.json()):await a.json();if(0===o.length)break;if(yield o,o.length<i)break;r+=o.length}}async*_getCursorPaginatedList(e,t=null,n="POST",r="runs"){const i=t?{...t}:{};for(;;){const t=await this.caller.call(ed(this.debug),`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(i)}),s=await t.json();if(!s)break;if(!s[r])break;yield s[r];const a=s.cursors;if(!a)break;if(!a.next)break;i.cursor=a.next}}_shouldSample(){return void 0===this.tracingSampleRate||Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){const t=[];for(const n of e)this.filteredPostUuids.has(n.trace_id)?n.id===n.trace_id&&this.filteredPostUuids.delete(n.trace_id):t.push(n);return t}{const t=[];for(const n of e){const e=n.trace_id??n.id;this.filteredPostUuids.has(e)||(n.id===e?this._shouldSample()?t.push(n):this.filteredPostUuids.add(e):t.push(n))}return t}}async _getBatchSizeLimitBytes(){const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??20971520}async _getMultiPartSupport(){const e=await this._ensureServerInfo();return e.instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[n,r]=this.autoBatchQueue.pop(e);if(!n.length){r();break}const i=n.reduce((e,t)=>{const n=t.apiUrl??this.apiUrl,r=t.apiKey??this.apiKey,i=t.apiKey===this.apiKey&&t.apiUrl===this.apiUrl?"default":`${n}|${r}`;return e[i]||(e[i]=[]),e[i].push(t),e},{}),s=[];for(const[e,t]of Object.entries(i)){const n=this._processBatch(t,{apiUrl:"default"===e?void 0:e.split("|")[0],apiKey:"default"===e?void 0:e.split("|")[1]});s.push(n)}const a=Promise.all(s).finally(r);t.push(a)}return Promise.all(t)}async _processBatch(e,t){if(e.length)try{if(void 0!==this.langSmithToOTELTranslator)this._sendBatchToOTELTranslator(e);else{const n={runCreates:e.filter(e=>"create"===e.action).map(e=>e.item),runUpdates:e.filter(e=>"update"===e.action).map(e=>e.item)},r=await this._ensureServerInfo();r?.batch_ingest_config?.use_multipart_endpoint?await this.multipartIngestRuns(n,t):await this.batchIngestRuns(n,t)}}catch(e){console.error("Error exporting batch:",e)}}_sendBatchToOTELTranslator(e){if(void 0!==this.langSmithToOTELTranslator){const t=new Map,n=[];for(const r of e)r.item.id&&r.otelContext&&(t.set(r.item.id,r.otelContext),"create"===r.action?n.push({operation:"post",id:r.item.id,trace_id:r.item.trace_id??r.item.id,run:r.item}):n.push({operation:"patch",id:r.item.id,trace_id:r.item.trace_id??r.item.id,run:r.item}));this.langSmithToOTELTranslator.exportBatch(n,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=ch(e.item);const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const n=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>n&&this.drainAutoBatchQueue(n),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(n)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await this.caller.call(ed(this.debug),`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(2500),...this.fetchOptions});await Zp(e,"get server info");const t=await e.json();return this.debug&&console.log("\n=== LangSmith Server Configuration ===\n"+JSON.stringify(t,null,2)+"\n"),t}async _ensureServerInfo(){return void 0===this._getServerInfoPromise&&(this._getServerInfoPromise=(async()=>{if(void 0===this._serverInfo)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[WARNING]: LangSmith failed to fetch info on supported operations with status code ${e.status}. Falling back to batch operations and default limits.`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(void 0===this._serverInfo&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}_cloneCurrentOTELContext(){const e=bd(),t=vd.getContextInstance();if(void 0!==this.langSmithToOTELTranslator){const n=e.getActiveSpan();if(n)return e.setSpan(t.active(),n)}}async createRun(e,t){if(!this._filterForSampling([e]).length)return;const n={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const i=await this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==i.trace_id&&void 0!==i.dotted_order){const e=this._cloneCurrentOTELContext();return void this.processRunOperation({action:"create",item:i,otelContext:e,apiKey:t?.apiKey,apiUrl:t?.apiUrl}).catch(console.error)}const s=ch(i);void 0!==t?.apiKey&&(n["x-api-key"]=t.apiKey);const a=await this.caller.call(ed(this.debug),`${t?.apiUrl??this.apiUrl}/runs`,{method:"POST",headers:n,body:sh(s,`Creating run with id: ${s.id}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(a,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t},n){if(void 0===e&&void 0===t)return;let r=await Promise.all(e?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]),i=await Promise.all(t?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]);if(r.length>0&&i.length>0){const e=r.reduce((e,t)=>t.id?(e[t.id]=t,e):e,{}),t=[];for(const n of i)void 0!==n.id&&e[n.id]?e[n.id]={...e[n.id],...n}:t.push(n);r=Object.values(e),i=t}const s={post:r,patch:i};if(!s.post.length&&!s.patch.length)return;const a={post:[],patch:[]};for(const e of["post","patch"]){const t=e,n=s[t].reverse();let r=n.pop();for(;void 0!==r;)a[t].push(r),r=n.pop()}if(a.post.length>0||a.patch.length>0){const e=a.post.map(e=>e.id).concat(a.patch.map(e=>e.id)).join(",");await this._postBatchIngestRuns(sh(a,`Ingesting runs with ids: ${e}`),n)}}async _postBatchIngestRuns(e,t){const n={...this.headers,"Content-Type":"application/json",Accept:"application/json"};void 0!==t?.apiKey&&(n["x-api-key"]=t.apiKey);const r=await this.batchIngestCaller.call(ed(this.debug),`${t?.apiUrl??this.apiUrl}/runs/batch`,{method:"POST",headers:n,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t},n){if(void 0===e&&void 0===t)return;const r={};let i=[];for(const t of e??[]){const e=await this.prepareRunCreateOrUpdateInputs(t);void 0!==e.id&&void 0!==e.attachments&&(r[e.id]=e.attachments),delete e.attachments,i.push(e)}let s=[];for(const e of t??[])s.push(await this.prepareRunCreateOrUpdateInputs(e));if(void 0!==i.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(void 0!==s.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(i.length>0&&s.length>0){const e=i.reduce((e,t)=>t.id?(e[t.id]=t,e):e,{}),t=[];for(const n of s)void 0!==n.id&&e[n.id]?e[n.id]={...e[n.id],...n}:t.push(n);i=Object.values(e),s=t}if(0===i.length&&0===s.length)return;const a=[],o=[];for(const[e,t]of[["post",i],["patch",s]])for(const n of t){const{inputs:t,outputs:i,events:s,extra:c,error:l,serialized:u,attachments:d,...p}=n,h={inputs:t,outputs:i,events:s,extra:c,error:l,serialized:u},m=sh(p,`Serializing for multipart ingestion of run with id: ${p.id}`);o.push({name:`${e}.${p.id}`,payload:new Blob([m],{type:`application/json; length=${m.length}`})});for(const[t,n]of Object.entries(h)){if(void 0===n)continue;const r=sh(n,`Serializing ${t} for multipart ingestion of run with id: ${p.id}`);o.push({name:`${e}.${p.id}.${t}`,payload:new Blob([r],{type:`application/json; length=${r.length}`})})}if(void 0!==p.id){const e=r[p.id];if(e){delete r[p.id];for(const[t,n]of Object.entries(e)){let e,r;Array.isArray(n)?[e,r]=n:(e=n.mimeType,r=n.data),t.includes(".")?console.warn(`Skipping attachment '${t}' for run ${p.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`):o.push({name:`attachment.${p.id}.${t}`,payload:new Blob([r],{type:`${e}; length=${r.byteLength}`})})}}}a.push(`trace=${p.trace_id},id=${p.id}`)}await this._sendMultipartRequest(o,a.join("; "),n)}async _createNodeFetchBody(e,t){const n=[];for(const r of e)n.push(new Blob([`--${t}\r\n`])),n.push(new Blob([`Content-Disposition: form-data; name="${r.name}"\r\n`,`Content-Type: ${r.payload.type}\r\n\r\n`])),n.push(r.payload),n.push(new Blob(["\r\n"]));n.push(new Blob([`--${t}--\r\n`]));const r=new Blob(n);return await r.arrayBuffer()}async _createMultipartStream(e,t){const n=new TextEncoder;return new ReadableStream({async start(r){const i=async e=>{"string"==typeof e?r.enqueue(n.encode(e)):r.enqueue(e)};for(const n of e){await i(`--${t}\r\n`),await i(`Content-Disposition: form-data; name="${n.name}"\r\n`),await i(`Content-Type: ${n.payload.type}\r\n\r\n`);const e=n.payload.stream().getReader();try{let t;for(;!(t=await e.read()).done;)r.enqueue(t.value)}finally{e.releaseLock()}await i("\r\n")}await i(`--${t}--\r\n`),r.close()}})}async _sendMultipartRequest(e,t,n){const r="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),i=(()=>{const e=globalThis[Qu];return!!e&&"function"==typeof e&&"Headers"in e&&"Request"in e&&"Response"in e})(),s=()=>this._createNodeFetchBody(e,r),a=()=>this._createMultipartStream(e,r),o=async e=>{const t={...this.headers,"Content-Type":`multipart/form-data; boundary=${r}`};return void 0!==n?.apiKey&&(t["x-api-key"]=n.apiKey),this.batchIngestCaller.call(ed(this.debug),`${n?.apiUrl??this.apiUrl}/runs/multipart`,{method:"POST",headers:t,body:e,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})};try{let e,r=!1;i||this.multipartStreamingDisabled?e=await o(await s()):(r=!0,e=await o(await a())),this.multipartStreamingDisabled&&!r||422!==e.status||(n?.apiUrl??this.apiUrl)===hh||(console.warn(`Streaming multipart upload to ${n?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,e=await o(await s())),await Zp(e,"ingest multipart runs",!0)}catch(e){console.warn(`${e.message.trim()}\n\nContext: ${t}`)}}async updateRun(e,t,n){Hd(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));const r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order){const e=this._cloneCurrentOTELContext();return void 0!==t.end_time&&void 0===r.parent_run_id&&this.blockOnRootRunFinalization&&!this.manualFlushMode?void await this.processRunOperation({action:"update",item:r,otelContext:e,apiKey:n?.apiKey,apiUrl:n?.apiUrl}).catch(console.error):void this.processRunOperation({action:"update",item:r,otelContext:e,apiKey:n?.apiKey,apiUrl:n?.apiUrl}).catch(console.error)}const i={...this.headers,"Content-Type":"application/json"};void 0!==n?.apiKey&&(i["x-api-key"]=n.apiKey);const s=await this.caller.call(ed(this.debug),`${n?.apiUrl??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:i,body:sh(t,`Serializing payload to update run with id: ${e}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(s,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){Hd(e);let n=await this._get(`/runs/${e}`);return t&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(void 0!==t){let e;if(t.session_id)e=t.session_id;else if(n?.projectName)e=(await this.readProject({projectName:n?.projectName})).id;else if(n?.projectId)e=n?.projectId;else{e=(await this.readProject({projectName:ud("PROJECT")||"default"})).id}const r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){const t=await this.readRun(e);if(!t.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${t.app_path}`}throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await async function(e){const t=[];for await(const n of e)t.push(n);return t}(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),n={},r={};t.sort((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??""));for(const i of t){if(null===i.parent_run_id||void 0===i.parent_run_id)throw new Error(`Child run ${i.id} has no parent`);i.dotted_order?.startsWith(e.dotted_order??"")&&i.id!==e.id&&(i.parent_run_id in n||(n[i.parent_run_id]=[]),n[i.parent_run_id].push(i),r[i.id]=i)}e.child_runs=n[e.id]||[];for(const t in n)t!==e.id&&(r[t].child_runs=n[t]);return e}async*listRuns(e){const{projectId:t,projectName:n,parentRunId:r,traceId:i,referenceExampleId:s,startTime:a,executionOrder:o,isRoot:c,runType:l,error:u,id:d,query:p,filter:h,traceFilter:m,treeFilter:f,limit:g,select:y,order:v}=e;let b=[];if(t&&(b=Array.isArray(t)?t:[t]),n){const e=Array.isArray(n)?n:[n],t=await Promise.all(e.map(e=>this.readProject({projectName:e}).then(e=>e.id)));b.push(...t)}const w={session:b.length?b:null,run_type:l,reference_example:s,query:p,filter:h,trace_filter:m,tree_filter:f,execution_order:o,parent_run:r,start_time:a?a.toISOString():null,error:u,id:d,limit:g,trace:i,select:y||["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:c,order:v};let _=0;for await(const e of this._getCursorPaginatedList("/runs/query",w))if(g){if(_>=g)break;if(e.length+_>g){const t=e.slice(0,g-_);yield*t;break}_+=e.length,yield*e}else yield*e}async*listGroupRuns(e){const{projectId:t,projectName:n,groupBy:r,filter:i,startTime:s,endTime:a,limit:o,offset:c}=e,l={session_id:t||(await this.readProject({projectName:n})).id,group_by:r,filter:i,start_time:s?s.toISOString():null,end_time:a?a.toISOString():null,limit:Number(o)||100};let u=Number(c)||0;const d="/runs/group",p=`${this.apiUrl}${d}`;for(;;){const e={...l,offset:u},t=Object.fromEntries(Object.entries(e).filter(([e,t])=>void 0!==t)),n=await this.caller.call(ed(),p,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(n,`Failed to fetch ${d}`);const r=await n.json(),{groups:i,total:s}=r;if(0===i.length)break;for(const e of i)yield e;if(u+=i.length,u>=s)break}}async getRunStats({id:e,trace:t,parentRun:n,runType:r,projectNames:i,projectIds:s,referenceExampleIds:a,startTime:o,endTime:c,error:l,query:u,filter:d,traceFilter:p,treeFilter:h,isRoot:m,dataSourceType:f}){let g=s||[];i&&(g=[...s||[],...await Promise.all(i.map(e=>this.readProject({projectName:e}).then(e=>e.id)))]);const y={id:e,trace:t,parent_run:n,run_type:r,session:g,reference_example:a,start_time:o,end_time:c,error:l,query:u,filter:d,trace_filter:p,tree_filter:h,is_root:m,data_source_type:f},v=Object.fromEntries(Object.entries(y).filter(([e,t])=>void 0!==t)),b=await this.caller.call(ed(this.debug),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(v),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await b.json()}async shareRun(e,{shareId:t}={}){const n={run_id:e,share_token:t||Ql()};Hd(e);const r=await this.caller.call(ed(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await r.json();if(null===i||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){Hd(e);const t=await this.caller.call(ed(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(t,"unshare run",!0)}async readRunSharedLink(e){Hd(e);const t=await this.caller.call(ed(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await t.json();if(null!==n&&"share_token"in n)return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const n=new URLSearchParams({share_token:e});if(void 0!==t)for(const e of t)n.append("id",e);Hd(e);const r=await this.caller.call(ed(this.debug),`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await r.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");if(!e){e=(await this.readDataset({datasetName:t})).id}Hd(e);const n=await this.caller.call(ed(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await n.json();return r.url=`${this.getHostUrl()}/public/${r.share_token}/d`,r}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");if(!e){e=(await this.readDataset({datasetName:t})).id}const n={dataset_id:e};Hd(e);const r=await this.caller.call(ed(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await r.json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){Hd(e);const t=await this.caller.call(ed(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(t,"unshare dataset",!0)}async readSharedDataset(e){Hd(e);const t=await this.caller.call(ed(this.debug),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await t.json()}async listSharedExamples(e,t){const n={};t?.exampleIds&&(n.id=t.exampleIds);const r=new URLSearchParams;Object.entries(n).forEach(([e,t])=>{Array.isArray(t)?t.forEach(t=>r.append(e,t)):r.append(e,t)});const i=await this.caller.call(ed(this.debug),`${this.apiUrl}/public/${e}/examples?${r.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),s=await i.json();if(!i.ok){if("detail"in s)throw new Error(`Failed to list shared examples.\nStatus: ${i.status}\nMessage: ${Array.isArray(s.detail)?s.detail.join("\n"):"Unspecified error"}`);throw new Error(`Failed to list shared examples: ${i.status} ${i.statusText}`)}return s.map(e=>({...e,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:r=!1,projectExtra:i=null,referenceDatasetId:s=null}){const a=r?"?upsert=true":"",o=`${this.apiUrl}/sessions${a}`,c=i||{};n&&(c.metadata=n);const l={name:e,extra:c,description:t};null!==s&&(l.reference_dataset_id=s);const u=await this.caller.call(ed(this.debug),o,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(u,"create project");return await u.json()}async updateProject(e,{name:t=null,description:n=null,metadata:r=null,projectExtra:i=null,endTime:s=null}){const a=`${this.apiUrl}/sessions/${e}`;let o=i;r&&(o={...o||{},metadata:r});const c={name:t,extra:o,description:n,end_time:s?new Date(s).toISOString():null},l=await this.caller.call(ed(this.debug),a,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(l,"update project");return await l.json()}async hasProject({projectId:e,projectName:t}){let n="/sessions";const r=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)Hd(e),n+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");r.append("name",t)}const i=await this.caller.call(ed(this.debug),`${this.apiUrl}${n}?${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const e=await i.json();return!!i.ok&&(!Array.isArray(e)||e.length>0)}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let r="/sessions";const i=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)Hd(e),r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");i.append("name",t)}void 0!==n&&i.append("include_stats",n.toString());const s=await this._get(r,i);let a;if(Array.isArray(s)){if(0===s.length)throw new Error(`Project[id=${e}, name=${t}] not found`);a=s[0]}else a=s;return a}async getProjectUrl({projectId:e,projectName:t}){if(void 0===e&&void 0===t)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:t}),r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(void 0===e&&void 0===t)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:t}),r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/datasets/${n.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:r,referenceDatasetName:i,referenceFree:s,metadata:a}={}){const o=new URLSearchParams;if(void 0!==e)for(const t of e)o.append("id",t);if(void 0!==t&&o.append("name",t),void 0!==n&&o.append("name_contains",n),void 0!==r)o.append("reference_dataset",r);else if(void 0!==i){const e=await this.readDataset({datasetName:i});o.append("reference_dataset",e.id)}void 0!==s&&o.append("reference_free",s.toString()),void 0!==a&&o.append("metadata",JSON.stringify(a));for await(const e of this._getPaginated("/sessions",o))yield*e}async deleteProject({projectId:e,projectName:t}){let n;if(void 0===e&&void 0===t)throw new Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");n=void 0===e?(await this.readProject({projectName:t})).id:e,Hd(n);const r=await this.caller.call(ed(this.debug),`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(r,`delete session ${n} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:r,description:i,dataType:s,name:a}){const o=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),n.forEach(e=>{c.append("input_keys",e)}),r.forEach(e=>{c.append("output_keys",e)}),i&&c.append("description",i),s&&c.append("data_type",s),a&&c.append("name",a);const l=await this.caller.call(ed(this.debug),o,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(l,"upload CSV");return await l.json()}async createDataset(e,{description:t,dataType:n,inputsSchema:r,outputsSchema:i,metadata:s}={}){const a={name:e,description:t,extra:s?{metadata:s}:void 0};n&&(a.data_type=n),r&&(a.inputs_schema_definition=r),i&&(a.outputs_schema_definition=i);const o=await this.caller.call(ed(this.debug),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(o,"create dataset");return await o.json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets";const r=new URLSearchParams({limit:"1"});if(e&&t)throw new Error("Must provide either datasetName or datasetId, not both");if(e)Hd(e),n+=`/${e}`;else{if(!t)throw new Error("Must provide datasetName or datasetId");r.append("name",t)}const i=await this._get(n,r);let s;if(Array.isArray(i)){if(0===i.length)throw new Error(`Dataset[id=${e}, name=${t}] not found`);s=i[0]}else s=i;return s}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(e){if(e instanceof Error&&e.message.toLocaleLowerCase().includes("not found"))return!1;throw e}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:r}){let i=e;if(void 0===i&&void 0===t)throw new Error("Must provide either datasetName or datasetId");if(void 0!==i&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===i){i=(await this.readDataset({datasetName:t})).id}const s=new URLSearchParams({from_version:"string"==typeof n?n:n.toISOString(),to_version:"string"==typeof r?r:r.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,s)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else{if(void 0===t)throw new Error("Must provide either datasetName or datasetId");e=(await this.readDataset({datasetName:t})).id}const n=await this._getResponse(`/datasets/${e}/openai_ft`);return(await n.text()).trim().split("\n").map(e=>JSON.parse(e))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:r,datasetNameContains:i,metadata:s}={}){const a=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==n)for(const e of n)a.append("id",e);void 0!==r&&a.append("name",r),void 0!==i&&a.append("name_contains",i),void 0!==s&&a.append("metadata",JSON.stringify(s));for await(const e of this._getPaginated("/datasets",a))yield*e}async updateDataset(e){const{datasetId:t,datasetName:n,...r}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:n})).id;Hd(i);const s=await this.caller.call(ed(this.debug),`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Zp(s,"update dataset"),await s.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:n,asOf:r,tag:i}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const s=t??(await this.readDataset({datasetName:n})).id;Hd(s);const a=await this.caller.call(ed(this.debug),`${this.apiUrl}/datasets/${s}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:"string"==typeof r?r:r.toISOString(),tag:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(a,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",r=e;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==t){r=(await this.readDataset({datasetName:t})).id}if(void 0===r)throw new Error("Must provide datasetName or datasetId");Hd(r),n+=`/${r}`;const i=await this.caller.call(ed(this.debug),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(i,`delete ${n}`),await i.json()}async indexDataset({datasetId:e,datasetName:t,tag:n}){let r=e;if(!r&&!t)throw new Error("Must provide either datasetName or datasetId");if(r&&t)throw new Error("Must provide either datasetName or datasetId, not both");if(!r){r=(await this.readDataset({datasetName:t})).id}Hd(r);const i={tag:n},s=await this.caller.call(ed(this.debug),`${this.apiUrl}/datasets/${r}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(s,"index dataset"),await s.json()}async similarExamples(e,t,n,{filter:r}={}){const i={limit:n,inputs:e};void 0!==r&&(i.filter=r),Hd(t);const s=await this.caller.call(ed(this.debug),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(s,"fetch similar examples");return(await s.json()).examples}async createExample(e,t,n){if(fh(e)&&(void 0!==t||void 0!==n))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let r=t?n?.datasetId:e.dataset_id;const i=t?n?.datasetName:e.dataset_name;if(void 0===r&&void 0===i)throw new Error("Must provide either datasetName or datasetId");if(void 0!==r&&void 0!==i)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===r){r=(await this.readDataset({datasetName:i})).id}const s=(t?n?.createdAt:e.created_at)||new Date;let a;a=fh(e)?e:{inputs:e,outputs:t,created_at:s?.toISOString(),id:n?.exampleId,metadata:n?.metadata,split:n?.split,source_run_id:n?.sourceRunId,use_source_run_io:n?.useSourceRunIO,use_source_run_attachments:n?.useSourceRunAttachments,attachments:n?.attachments};const o=await this._uploadExamplesMultipart(r,[a]);return await this.readExample(o.example_ids?.[0]??Ql())}async createExamples(e){if(Array.isArray(e)){if(0===e.length)return[];const t=e;let n=t[0].dataset_id;const r=t[0].dataset_name;if(void 0===n&&void 0===r)throw new Error("Must provide either datasetName or datasetId");if(void 0!==n&&void 0!==r)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===n){n=(await this.readDataset({datasetName:r})).id}const i=await this._uploadExamplesMultipart(n,t);return await Promise.all(i.example_ids.map(e=>this.readExample(e)))}const{inputs:t,outputs:n,metadata:r,splits:i,sourceRunIds:s,useSourceRunIOs:a,useSourceRunAttachments:o,attachments:c,exampleIds:l,datasetId:u,datasetName:d}=e;if(void 0===t)throw new Error("Must provide inputs when using legacy parameters");let p=u;const h=d;if(void 0===p&&void 0===h)throw new Error("Must provide either datasetName or datasetId");if(void 0!==p&&void 0!==h)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===p){const e=await this.readDataset({datasetName:h});p=e.id}const m=t.map((e,t)=>({dataset_id:p,inputs:e,outputs:n?.[t],metadata:r?.[t],split:i?.[t],id:l?.[t],attachments:c?.[t],source_run_id:s?.[t],use_source_run_io:a?.[t],use_source_run_attachments:o?.[t]})),f=await this._uploadExamplesMultipart(p,m);return await Promise.all(f.example_ids.map(e=>this.readExample(e)))}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){const r=e.map(e=>Bd(e)?qd(e):e),i=Bd(t)?qd(t):t;return this.createExample({input:r},{output:i},n)}async readExample(e){Hd(e);const t=`/examples/${e}`,n=await this._get(t),{attachment_urls:r,...i}=n,s=i;return r&&(s.attachments=Object.entries(r).reduce((e,[t,n])=>(e[t.slice(11)]={presigned_url:n.presigned_url,mime_type:n.mime_type},e),{})),s}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:r,splits:i,inlineS3Urls:s,metadata:a,limit:o,offset:c,filter:l,includeAttachments:u}={}){let d;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)d=e;else{if(void 0===t)throw new Error("Must provide a datasetName or datasetId");d=(await this.readDataset({datasetName:t})).id}const p=new URLSearchParams({dataset:d}),h=r?"string"==typeof r?r:r?.toISOString():void 0;h&&p.append("as_of",h);const m=s??!0;if(p.append("inline_s3_urls",m.toString()),void 0!==n)for(const e of n)p.append("id",e);if(void 0!==i)for(const e of i)p.append("splits",e);if(void 0!==a){const e=JSON.stringify(a);p.append("metadata",e)}void 0!==o&&p.append("limit",o.toString()),void 0!==c&&p.append("offset",c.toString()),void 0!==l&&p.append("filter",l),!0===u&&["attachment_urls","outputs","metadata"].forEach(e=>p.append("select",e));let f=0;for await(const e of this._getPaginated("/examples",p)){for(const t of e){const{attachment_urls:e,...n}=t,r=n;e&&(r.attachments=Object.entries(e).reduce((e,[t,n])=>(e[t.slice(11)]={presigned_url:n.presigned_url,mime_type:n.mime_type||void 0},e),{})),yield r,f++}if(void 0!==o&&f>=o)break}}async deleteExample(e){Hd(e);const t=`/examples/${e}`,n=await this.caller.call(ed(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(n,`delete ${t}`),await n.json()}async updateExample(e,t){let n,r,i;if(n=t?e:e.id,Hd(n),r=t?{id:n,...t}:e,void 0!==r.dataset_id)i=r.dataset_id;else{i=(await this.readExample(n)).dataset_id}return this._updateExamplesMultipart(i,[r])}async updateExamples(e){let t;if(void 0===e[0].dataset_id){t=(await this.readExample(e[0].id)).dataset_id}else t=e[0].dataset_id;return this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:n,tag:r}){let i;if(e)i=e;else{i=(await this.readDataset({datasetName:t})).id}if(Hd(i),n&&r||!n&&!r)throw new Error("Exactly one of asOf and tag must be specified.");const s=new URLSearchParams;void 0!==n&&s.append("as_of","string"==typeof n?n:n.toISOString()),void 0!==r&&s.append("tag",r);const a=await this.caller.call(ed(this.debug),`${this.apiUrl}/datasets/${i}/version?${s.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Zp(a,"read dataset version"),await a.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:n}){let r;if(void 0===e&&void 0===t)throw new Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===e){r=(await this.readDataset({datasetName:t})).id}else r=e;Hd(r);const i=new URLSearchParams,s=n?"string"==typeof n?n:n?.toISOString():void 0;s&&i.append("as_of",s);return await this._get(`/datasets/${r}/splits`,i)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:n,exampleIds:r,remove:i=!1}){let s;if(void 0===e&&void 0===t)throw new Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===e){s=(await this.readDataset({datasetName:t})).id}else s=e;Hd(s);const a={split_name:n,examples:r.map(e=>(Hd(e),e)),remove:i},o=await this.caller.call(ed(this.debug),`${this.apiUrl}/datasets/${s}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(o,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:r,referenceExample:i}={loadChildRuns:!1}){let s;if(Gd("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead."),"string"==typeof e)s=await this.readRun(e,{loadChildRuns:r});else{if("object"!=typeof e||!("id"in e))throw new Error("Invalid run type: "+typeof e);s=e}null!==s.reference_example_id&&void 0!==s.reference_example_id&&(i=await this.readExample(s.reference_example_id));const a=await t.evaluateRun(s,i),[o,c]=await this._logEvaluationFeedback(a,s,n);return c[0]}async createFeedback(e,t,{score:n,value:r,correction:i,comment:s,sourceInfo:a,feedbackSourceType:o="api",sourceRunId:c,feedbackId:l,feedbackConfig:u,projectId:d,comparativeExperimentId:p}){if(!e&&!d)throw new Error("One of runId or projectId must be provided");if(e&&d)throw new Error("Only one of runId or projectId can be provided");const h={type:o??"api",metadata:a??{}};void 0===c||void 0===h?.metadata||h.metadata.__run||(h.metadata.__run={run_id:c}),void 0!==h?.metadata&&void 0!==h.metadata.__run?.run_id&&Hd(h.metadata.__run.run_id);const m={id:l??Ql(),run_id:e,key:t,score:dh(n),value:r,correction:i,comment:s,feedback_source:h,comparative_experiment_id:p,feedbackConfig:u,session_id:d},f=`${this.apiUrl}/feedback`,g=await this.caller.call(ed(this.debug),f,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Zp(g,"create feedback",!0),m}async updateFeedback(e,{score:t,value:n,correction:r,comment:i}){const s={};null!=t&&(s.score=dh(t)),null!=n&&(s.value=n),null!=r&&(s.correction=r),null!=i&&(s.comment=i),Hd(e);const a=await this.caller.call(ed(this.debug),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(a,"update feedback",!0)}async readFeedback(e){Hd(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){Hd(e);const t=`/feedback/${e}`,n=await this.caller.call(ed(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(n,`delete ${t}`),await n.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){const r=new URLSearchParams;if(e&&r.append("run",e.join(",")),t)for(const e of t)r.append("key",e);if(n)for(const e of n)r.append("source",e);for await(const e of this._getPaginated("/feedback",r))yield*e}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:r}={}){const i={run_id:e,feedback_key:t,feedback_config:r};n?"string"==typeof n?i.expires_at=n:(n?.hours||n?.minutes||n?.days)&&(i.expires_in=n):i.expires_in={hours:3};const s=await this.caller.call(ed(this.debug),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await s.json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:n,createdAt:r,description:i,metadata:s,id:a}){if(0===t.length)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:t[0]})).reference_dataset_id),null==!n)throw new Error("A reference dataset is required");const o={id:a,name:e,experiment_ids:t,reference_dataset_id:n,description:i,created_at:(r??new Date)?.toISOString(),extra:{}};s&&(o.extra.metadata=s);const c=await this.caller.call(ed(this.debug),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await c.json()}async*listPresignedFeedbackTokens(e){Hd(e);const t=new URLSearchParams({run_id:e});for await(const e of this._getPaginated("/feedback/tokens",t))yield*e}_selectEvalResults(e){let t;return t="results"in e?e.results:Array.isArray(e)?e:[e],t}async _logEvaluationFeedback(e,t,n){const r=this._selectEvalResults(e),i=[];for(const e of r){let r=n||{};e.evaluatorInfo&&(r={...e.evaluatorInfo,...r});let s=null;e.targetRunId?s=e.targetRunId:t&&(s=t.id),i.push(await this.createFeedback(s,e.key,{score:e.score,value:e.value,comment:e.comment,correction:e.correction,sourceInfo:r,sourceRunId:e.sourceRunId,feedbackConfig:e.feedbackConfig,feedbackSourceType:"model"}))}return[r,i]}async logEvaluationFeedback(e,t,n){const[r]=await this._logEvaluationFeedback(e,t,n);return r}async*listAnnotationQueues(e={}){const{queueIds:t,name:n,nameContains:r,limit:i}=e,s=new URLSearchParams;t&&t.forEach((e,t)=>{Hd(e,`queueIds[${t}]`),s.append("ids",e)}),n&&s.append("name",n),r&&s.append("name_contains",r),s.append("limit",(void 0!==i?Math.min(i,100):100).toString());let a=0;for await(const e of this._getPaginated("/annotation-queues",s))if(yield*e,a++,void 0!==i&&a>=i)break}async createAnnotationQueue(e){const{name:t,description:n,queueId:r,rubricInstructions:i}=e,s={name:t,description:n,id:r||Ql(),rubric_instructions:i},a=await this.caller.call(ed(this.debug),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(s).filter(([e,t])=>void 0!==t))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(a,"create annotation queue");return await a.json()}async readAnnotationQueue(e){const t=await this.caller.call(ed(this.debug),`${this.apiUrl}/annotation-queues/${Hd(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(t,"read annotation queue");return await t.json()}async updateAnnotationQueue(e,t){const{name:n,description:r,rubricInstructions:i}=t,s=await this.caller.call(ed(this.debug),`${this.apiUrl}/annotation-queues/${Hd(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:n,description:r,rubric_instructions:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(s,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(ed(this.debug),`${this.apiUrl}/annotation-queues/${Hd(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const n=await this.caller.call(ed(this.debug),`${this.apiUrl}/annotation-queues/${Hd(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((e,t)=>Hd(e,`runIds[${t}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(n,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const n=`/annotation-queues/${Hd(e,"queueId")}/run`,r=await this.caller.call(ed(this.debug),`${this.apiUrl}${n}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Zp(r,"get run from annotation queue"),await r.json()}async deleteRunFromAnnotationQueue(e,t){const n=await this.caller.call(ed(this.debug),`${this.apiUrl}/annotation-queues/${Hd(e,"queueId")}/runs/${Hd(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(n,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(ed(this.debug),`${this.apiUrl}/annotation-queues/${Hd(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Zp(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return"-"==e||t.tenant_handle===e}async _ownerConflictError(e,t){const n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.\n\n      Current tenant: ${n.tenant_handle}\n\n      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(ed(this.debug),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await t.json();if(!t.ok){const e="string"==typeof n.detail?n.detail:JSON.stringify(n.detail),r=new Error(`Error ${t.status}: ${t.statusText}\n${e}`);throw r.statusCode=t.status,r}if(0!==n.commits.length)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[n,r,i]=Gp(e),s=await this.caller.call(ed(this.debug),`${this.apiUrl}/likes/${n}/${r}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Zp(s,(t?"like":"unlike")+" prompt"),await s.json()}async _getPromptUrl(e){const[t,n,r]=Gp(e);if(await this._currentTenantIsOwner(t)){const e=await this._getSettings();return"latest"!==r?`${this.getHostUrl()}/prompts/${n}/${r.substring(0,8)}?organizationId=${e.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${e.id}`}return"latest"!==r?`${this.getHostUrl()}/hub/${t}/${n}/${r.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,e=>e.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),void 0!==e?.isPublic&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);for await(const e of this._getPaginated("/repos",t,e=>e.repos))yield*e}async getPrompt(e){const[t,n,r]=Gp(e),i=await this.caller.call(ed(this.debug),`${this.apiUrl}/repos/${t}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(404===i.status)return null;await Zp(i,"get prompt");const s=await i.json();return s.repo?s.repo:null}async createPrompt(e,t){const n=await this._getSettings();if(t?.isPublic&&!n.tenant_handle)throw new Error("Cannot create a public prompt without first\n\n        creating a LangChain Hub handle.\n        You can add a handle by creating a public prompt at:\n\n        https://smith.langchain.com/prompts");const[r,i,s]=Gp(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("create a prompt",r);const a={repo_handle:i,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic},o=await this.caller.call(ed(this.debug),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(o,"create prompt");const{repo:c}=await o.json();return c}async createCommit(e,t,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,i,s]=Gp(e),a="latest"!==n?.parentCommitHash&&n?.parentCommitHash?n?.parentCommitHash:await this._getLatestCommitHash(`${r}/${i}`),o={manifest:JSON.parse(JSON.stringify(t)),parent_commit:a},c=await this.caller.call(ed(this.debug),`${this.apiUrl}/commits/${r}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(c,"create commit");const l=await c.json();return this._getPromptUrl(`${r}/${i}${l.commit_hash?`:${l.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const e of t){const t=e.id,r=sh({...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split}},`Serializing body for example with id: ${t}`),i=new Blob([r],{type:"application/json"});if(n.append(t,i),e.inputs){const r=sh(e.inputs,`Serializing inputs for example with id: ${t}`),i=new Blob([r],{type:"application/json"});n.append(`${t}.inputs`,i)}if(e.outputs){const r=sh(e.outputs,`Serializing outputs whle updating example with id: ${t}`),i=new Blob([r],{type:"application/json"});n.append(`${t}.outputs`,i)}if(e.attachments)for(const[r,i]of Object.entries(e.attachments)){let e,s;Array.isArray(i)?[e,s]=i:(e=i.mimeType,s=i.data);const a=new Blob([s],{type:`${e}; length=${s.byteLength}`});n.append(`${t}.attachment.${r}`,a)}if(e.attachments_operations){const r=sh(e.attachments_operations,`Serializing attachments while updating example with id: ${t}`),i=new Blob([r],{type:"application/json"});n.append(`${t}.attachments_operations`,i)}}const r=e??t[0]?.dataset_id,i=await this.caller.call(ed(this.debug),`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${r}/examples`)}`,{method:"PATCH",headers:this.headers,body:n});return await i.json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const e of t){const t=(e.id??Ql()).toString(),r=sh({created_at:e.created_at,...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split},...e.source_run_id&&{source_run_id:e.source_run_id},...e.use_source_run_io&&{use_source_run_io:e.use_source_run_io},...e.use_source_run_attachments&&{use_source_run_attachments:e.use_source_run_attachments}},`Serializing body for uploaded example with id: ${t}`),i=new Blob([r],{type:"application/json"});if(n.append(t,i),e.inputs){const r=sh(e.inputs,`Serializing inputs for uploaded example with id: ${t}`),i=new Blob([r],{type:"application/json"});n.append(`${t}.inputs`,i)}if(e.outputs){const r=sh(e.outputs,`Serializing outputs for uploaded example with id: ${t}`),i=new Blob([r],{type:"application/json"});n.append(`${t}.outputs`,i)}if(e.attachments)for(const[r,i]of Object.entries(e.attachments)){let e,s;Array.isArray(i)?[e,s]=i:(e=i.mimeType,s=i.data);const a=new Blob([s],{type:`${e}; length=${s.byteLength}`});n.append(`${t}.attachment.${r}`,a)}}const r=await this.caller.call(ed(this.debug),`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,body:n});await Zp(r,"upload examples");return await r.json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,r]=Gp(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);const i={};if(void 0!==t?.description&&(i.description=t.description),void 0!==t?.readme&&(i.readme=t.readme),void 0!==t?.tags&&(i.tags=t.tags),void 0!==t?.isPublic&&(i.is_public=t.isPublic),void 0!==t?.isArchived&&(i.is_archived=t.isArchived),0===Object.keys(i).length)throw new Error("No valid update options provided");const s=await this.caller.call(ed(this.debug),`${this.apiUrl}/repos/${n}/${r}`,{method:"PATCH",body:JSON.stringify(i),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Zp(s,"update prompt"),s.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,n,r]=Gp(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);const i=await this.caller.call(ed(this.debug),`${this.apiUrl}/repos/${t}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await i.json()}async pullPromptCommit(e,t){const[n,r,i]=Gp(e),s=await this.caller.call(ed(this.debug),`${this.apiUrl}/commits/${n}/${r}/${i}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Zp(s,"pull prompt commit");const a=await s.json();return{owner:n,repo:r,commit_hash:a.commit_hash,manifest:a.manifest,examples:a.examples}}async _pullPrompt(e,t){const n=await this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,t){if(await this.promptExists(e)?t&&Object.keys(t).some(e=>"object"!==e)&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),!t?.object)return await this._getPromptUrl(e);return await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash})}async clonePublicDataset(t,n={}){const{sourceApiUrl:r=this.apiUrl,datasetName:i}=n,[s,a]=this.parseTokenOrUrl(t,r),o=new e({apiUrl:s,apiKey:"placeholder"}),c=await o.readSharedDataset(a),l=i||c.name;try{if(await this.hasDataset({datasetId:l}))return void console.log(`Dataset ${l} already exists in your tenant. Skipping.`)}catch(e){}const u=await o.listSharedExamples(a),d=await this.createDataset(l,{description:c.description,dataType:c.data_type||"kv",inputsSchema:c.inputs_schema_definition??void 0,outputsSchema:c.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(e=>e.inputs),outputs:u.flatMap(e=>e.outputs?[e.outputs]:[]),datasetId:d.id})}catch(e){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),e}}parseTokenOrUrl(e,t,n=2,r="dataset"){try{return Hd(e),[t,e]}catch(e){}try{const i=new URL(e).pathname.split("/").filter(e=>""!==e);if(i.length>=n){return[t,i[i.length-n]]}throw new Error(`Invalid public ${r} URL: ${e}`)}catch(t){throw new Error(`Invalid public ${r} URL or token: ${e}`)}}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()]),void 0!==this.langSmithToOTELTranslator&&await(vd.getDefaultOTLPTracerComponents()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush())}};function fh(e){return"dataset_id"in e||"dataset_name"in e}const gh=Symbol.for("lc:context_variables");class yh{constructor(e,t,n,r){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=n,this.replicas=r}static fromHeader(e){const t=e.split(",");let n,r,i={},s=[];for(const e of t){const[t,a]=e.split("="),o=decodeURIComponent(a);"langsmith-metadata"===t?i=JSON.parse(o):"langsmith-tags"===t?s=o.split(","):"langsmith-project"===t?n=o:"langsmith-replicas"===t&&(r=JSON.parse(o))}return new yh(i,s,n,r)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class vh{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),function(e){return void 0!==e&&"function"==typeof e.createChild&&"function"==typeof e.postRun}(e))return void Object.assign(this,{...e});const t=vh.getDefaultConfig(),{metadata:n,...r}=e,i=r.client??vh.getSharedClient(),s={...n,...r?.extra?.metadata};if(r.extra={...r.extra,metadata:s},Object.assign(this,{...t,...r,client:i}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=function(e){if(e)return e.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e);return function(){const e=ld("LANGSMITH_RUNS_ENDPOINTS");if(!e)return[];try{const t=JSON.parse(e);if(Array.isArray(t)){const e=[];for(const n of t)"object"==typeof n&&null!==n?"string"==typeof n.api_url?"string"==typeof n.api_key?e.push({apiUrl:n.api_url.replace(/\/$/,""),apiKey:n.api_key}):console.warn("Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got "+typeof n.api_key):console.warn("Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got "+typeof n.api_url):console.warn("Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got "+typeof n);return e}if("object"==typeof t&&null!==t){!function(e){if(Object.keys(e).length>0&&ud("ENDPOINT"))throw new Yp}(t);const e=[];for(const[n,r]of Object.entries(t)){const t=n.replace(/\/$/,"");"string"==typeof r?e.push({apiUrl:t,apiKey:r}):console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${n}: expected string, got `+typeof r)}return e}return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got "+typeof t),[]}catch(e){if("object"==typeof(t=e)&&null!==t&&t.code===Jp)throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}var t}()}(this.replicas),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){const{dottedOrder:e,microsecondPrecisionDatestring:t}=function(e,t,n=1){const r=n.toFixed(0).slice(0,3).padStart(3,"0"),i=`${new Date(e).toISOString().slice(0,-1)}${r}Z`;return{dottedOrder:(s=i,s.replace(/[-:.]/g,"")+t),microsecondPrecisionDatestring:i};var s}(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e,this._serialized_start_time=t}}set metadata(e){this.extra={...this.extra,metadata:{...this.extra?.metadata,...e}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){return{id:Ql(),run_type:"chain",project_name:ud("PROJECT")??ld("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:ld("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:ld("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return vh.sharedClient||(vh.sharedClient=new mh),vh.sharedClient}createChild(e){const t=this.child_execution_order+1,n=new vh({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});gh in this&&(n[gh]=this[gh]);const r=Symbol.for("lc:child_config"),i=e.extra?.[r]??this.extra[r];if(function(e){return void 0!==e&&"object"==typeof e.callbacks&&(wh(e.callbacks?.handlers)||wh(e.callbacks))}(i)){const e={...i},t=function(e){return"object"==typeof e&&null!=e&&Array.isArray(e.handlers)}(e.callbacks)?e.callbacks.copy?.():void 0;t&&(Object.assign(t,{_parentRunId:n.id}),t.handlers?.find(bh)?.updateFromRunTree?.(n),e.callbacks=t),n.extra[r]=e}const s=new Set;let a=this;for(;null!=a&&!s.has(a.id);)s.add(a.id),a.child_execution_order=Math.max(a.child_execution_order,t),a=a.parent_run;return this.child_runs.push(n),n}async end(e,t,n=Date.now(),r){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,r&&Object.keys(r).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...r}}:{metadata:r})}_convertToCreate(e,t,n=!0){const r=e.extra??{};if(void 0===r?.runtime?.library&&(r.runtime||(r.runtime={}),t))for(const[e,n]of Object.entries(t))r.runtime[e]||(r.runtime[e]=n);let i,s;return n?(s=e.parent_run?.id??e.parent_run_id,i=[]):(i=e.child_runs.map(e=>this._convertToCreate(e,t,n)),s=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:r,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:s,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,n=!0){const r=this._convertToCreate(this,t,n);if(e===this.project_name)return r;const i=t=>nu(`${t}:${e}`,nu.DNS),s=i(r.id),a=r.trace_id?i(r.trace_id):void 0,o=r.parent_run_id?i(r.parent_run_id):void 0;let c;if(r.dotted_order){const e=r.dotted_order.split(".").map(e=>{const t=e.slice(0,-36),n=e.slice(-36),r=parseInt(t.slice(0,4)),i=parseInt(t.slice(4,6))-1,s=parseInt(t.slice(6,8)),a=parseInt(t.slice(9,11)),o=parseInt(t.slice(11,13)),c=parseInt(t.slice(13,15)),l=parseInt(t.slice(15,21));return[new Date(r,i,s,a,o,c,l/1e3),n]}),t=[];for(let n=0;n<e.length-1;n++){const[r,s]=e[n],a=i(s);t.push(r.toISOString().replace(/[-:]/g,"").replace(".","")+a)}const[n]=e[e.length-1];t.push(n.toISOString().replace(/[-:]/g,"").replace(".","")+s),c=t.join(".")}else c=void 0;return{...r,id:s,trace_id:a,parent_run_id:o,dotted_order:c,session_name:e}}async postRun(e=!0){try{const t=od();if(this.replicas&&this.replicas.length>0)for(const{projectName:e,apiKey:n,apiUrl:r}of this.replicas){const i=this._remapForProject(e??this.project_name,t,!0);await this.client.createRun(i,{apiKey:n,apiUrl:r})}else{const n=this._convertToCreate(this,t,e);await this.client.createRun(n)}if(!e){Gd("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const e of this.child_runs)await e.postRun(!1)}}catch(e){console.error(`Error in postRun for run ${this.id}:`,e)}}async patchRun(){if(this.replicas&&this.replicas.length>0)for(const{projectName:e,apiKey:t,apiUrl:n,updates:r}of this.replicas){const i=this._remapForProject(e??this.project_name);await this.client.updateRun(i.id,{inputs:i.inputs,outputs:i.outputs,error:i.error,parent_run_id:i.parent_run_id,session_name:i.session_name,reference_example_id:i.reference_example_id,end_time:i.end_time,dotted_order:i.dotted_order,trace_id:i.trace_id,events:i.events,tags:i.tags,extra:i.extra,attachments:this.attachments,...r},{apiKey:t,apiUrl:n})}else try{const e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};await this.client.updateRun(this.id,e)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),"string"==typeof e?this.events.push({name:"event",time:(new Date).toISOString(),message:e}):this.events.push({...e,time:e.time??(new Date).toISOString()})}static fromRunnableConfig(e,t){const n=e?.callbacks;let r,i,s,a=!!["TRACING_V2","TRACING"].find(e=>"true"===ud(e));if(n){const e=n?.getParentRunId?.()??"",t=n?.handlers?.find(e=>"langchain_tracer"==e?.name);r=t?.getRun?.(e),i=t?.projectName,s=t?.client,a=a||!!t}if(!r)return new vh({...t,client:s,tracingEnabled:a,project_name:i});return new vh({name:r.name,id:r.id,trace_id:r.trace_id,dotted_order:r.dotted_order,client:s,tracingEnabled:a,project_name:i,tags:[...new Set((r?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...r?.extra?.metadata,...e?.metadata}}}).createChild(t)}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){const n="get"in e&&"function"==typeof e.get?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,r=n["langsmith-trace"];if(!r||"string"!=typeof r)return;const i=r.trim(),s=i.split(".").map(e=>{const[t,n]=e.split("Z");return{strTime:t,time:Date.parse(t+"Z"),uuid:n}}),a=s[0].uuid,o={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:s.at(-1)?.uuid,trace_id:a,dotted_order:i};if(n.baggage&&"string"==typeof n.baggage){const e=yh.fromHeader(n.baggage);o.metadata=e.metadata,o.tags=e.tags,o.project_name=e.project_name,o.replicas=e.replicas}return new vh(o)}toHeaders(e){const t={"langsmith-trace":this.dotted_order,baggage:new yh(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(const[n,r]of Object.entries(t))e.set(n,r);return t}}function bh(e){return"object"==typeof e&&null!=e&&"string"==typeof e.name&&"langchain_tracer"===e.name}function wh(e){return Array.isArray(e)&&e.some(e=>bh(e))}let _h;Object.defineProperty(vh,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});const xh=()=>{if(void 0===_h){const e="false"===Pu("LANGCHAIN_CALLBACKS_BACKGROUND")?{blockOnRootRunFinalization:!0}:{};_h=new mh(e)}return _h};class Eh extends Uu{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:n,client:r}=e;this.projectName=n??Pu("LANGCHAIN_PROJECT")??Pu("LANGCHAIN_SESSION"),this.exampleId=t,this.client=r??xh();const i=Eh.getTraceableRunTree();i&&this.updateFromRunTree(i)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await Tu()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id,extra:e.extra,session_name:this.projectName};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e;const n=new Set;for(;t.parent_run&&!n.has(t.id)&&(n.add(t.id),t.parent_run);)t=t.parent_run;n.clear();const r=[t];for(;r.length>0;){const e=r.shift();e&&!n.has(e.id)&&(n.add(e.id),this.runMap.set(e.id,e),e.child_runs&&r.push(...e.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const t={},n=[];for(const[e,r]of this.runMap){const i=new vh({...r,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[e]=i,n.push([e,r.dotted_order])}n.sort((e,t)=>e[1]&&t[1]?e[1].localeCompare(t[1]):0);for(const[e]of n){const n=this.runMap.get(e),r=t[e];if(n&&r&&n.parent_run_id){const e=t[n.parent_run_id];e&&(e.child_runs.push(r),r.parent_run=e)}}return t[e]}static getTraceableRunTree(){try{return function(e=!1){const t=su.getInstance().getStore();if(!e&&void 0===t)throw new Error("Could not get the current run tree.\n\nPlease make sure you are calling this method within a traceable function and that tracing is enabled.");return t}(!0)}catch{return}}}const Sh=Symbol.for("ls:tracing_async_local_storage"),kh=Symbol.for("lc:context_variables"),Ah=()=>globalThis[Sh];let Oh;function Ch(){return void 0===Oh&&(Oh=new("default"in Ud?Ud.default:Ud)({autoStart:!0,concurrency:1})),Oh}async function Ih(e,t){if(!0===t){const t=Ah();void 0!==t?await t.run(void 0,async()=>e()):await e()}else Oh=Ch(),Oh.add(async()=>{const t=Ah();void 0!==t?await t.run(void 0,async()=>e()):await e()})}function Th(e){const t=Ah();if(void 0===t)return;const n=t.getStore();return n?.[kh]?.[e]}const Ph=Symbol("lc:configure_hooks");class Rh{setHandler(e){return this.setHandlers([e])}}class jh{constructor(e,t,n,r,i,s,a,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>Ih(async()=>{try{await(t.handleText?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleCustomEvent(e,t,n,r,i){await Promise.all(this.handlers.map(n=>Ih(async()=>{try{await(n.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata))}catch(e){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleCustomEvent: ${e}`),n.raiseError)throw e}},n.awaitHandlers)))}}class Nh extends jh{getChild(e){const t=new Uh(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>Ih(async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw e}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>Ih(async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags))}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${n}`),t.raiseError)throw e}},t.awaitHandlers)))}}class $h extends jh{async handleLLMNewToken(e,t,n,r,i,s){await Promise.all(this.handlers.map(n=>Ih(async()=>{if(!n.ignoreLLM)try{await(n.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,s))}catch(e){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleLLMNewToken: ${e}`),n.raiseError)throw e}},n.awaitHandlers)))}async handleLLMError(e,t,n,r,i){await Promise.all(this.handlers.map(t=>Ih(async()=>{if(!t.ignoreLLM)try{await(t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,i))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleLLMEnd(e,t,n,r,i){await Promise.all(this.handlers.map(t=>Ih(async()=>{if(!t.ignoreLLM)try{await(t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,i))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}}class Lh extends jh{getChild(e){const t=new Uh(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,r,i){await Promise.all(this.handlers.map(t=>Ih(async()=>{if(!t.ignoreChain)try{await(t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,i))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleChainEnd(e,t,n,r,i){await Promise.all(this.handlers.map(t=>Ih(async()=>{if(!t.ignoreChain)try{await(t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,i))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>Ih(async()=>{if(!t.ignoreAgent)try{await(t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>Ih(async()=>{if(!t.ignoreAgent)try{await(t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}}class Dh extends jh{getChild(e){const t=new Uh(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>Ih(async()=>{if(!t.ignoreAgent)try{await(t.handleToolError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>Ih(async()=>{if(!t.ignoreAgent)try{await(t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}}class Uh extends Rh{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,r=void 0,i=void 0,s=void 0,a=void 0,o=void 0){return Promise.all(t.map(async(t,r)=>{const s=0===r&&n?n:Ql();return await Promise.all(this.handlers.map(n=>{if(!n.ignoreLLM)return Du(n)&&n._createRunForLLMStart(e,[t],s,this._parentRunId,i,this.tags,this.metadata,o),Ih(async()=>{try{await(n.handleLLMStart?.(e,[t],s,this._parentRunId,i,this.tags,this.metadata,o))}catch(e){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleLLMStart: ${e}`),n.raiseError)throw e}},n.awaitHandlers)})),new $h(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,n=void 0,r=void 0,i=void 0,s=void 0,a=void 0,o=void 0){return Promise.all(t.map(async(t,r)=>{const s=0===r&&n?n:Ql();return await Promise.all(this.handlers.map(n=>{if(!n.ignoreLLM)return Du(n)&&n._createRunForChatModelStart(e,[t],s,this._parentRunId,i,this.tags,this.metadata,o),Ih(async()=>{try{if(n.handleChatModelStart)await(n.handleChatModelStart?.(e,[t],s,this._parentRunId,i,this.tags,this.metadata,o));else if(n.handleLLMStart){const r=tc(t);await(n.handleLLMStart?.(e,[r],s,this._parentRunId,i,this.tags,this.metadata,o))}}catch(e){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleLLMStart: ${e}`),n.raiseError)throw e}},n.awaitHandlers)})),new $h(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,n=Ql(),r=void 0,i=void 0,s=void 0,a=void 0){return await Promise.all(this.handlers.map(i=>{if(!i.ignoreChain)return Du(i)&&i._createRunForChainStart(e,t,n,this._parentRunId,this.tags,this.metadata,r,a),Ih(async()=>{try{await(i.handleChainStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,r,a))}catch(e){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainStart: ${e}`),i.raiseError)throw e}},i.awaitHandlers)})),new Lh(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=Ql(),r=void 0,i=void 0,s=void 0,a=void 0){return await Promise.all(this.handlers.map(r=>{if(!r.ignoreAgent)return Du(r)&&r._createRunForToolStart(e,t,n,this._parentRunId,this.tags,this.metadata,a),Ih(async()=>{try{await(r.handleToolStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,a))}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleToolStart: ${e}`),r.raiseError)throw e}},r.awaitHandlers)})),new Dh(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=Ql(),r=void 0,i=void 0,s=void 0,a=void 0){return await Promise.all(this.handlers.map(r=>{if(!r.ignoreRetriever)return Du(r)&&r._createRunForRetrieverStart(e,t,n,this._parentRunId,this.tags,this.metadata,a),Ih(async()=>{try{await(r.handleRetrieverStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,a))}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleRetrieverStart: ${e}`),r.raiseError)throw e}},r.awaitHandlers)})),new Nh(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,n,r,i){await Promise.all(this.handlers.map(r=>Ih(async()=>{if(!r.ignoreCustomEvent)try{await(r.handleCustomEvent?.(e,t,n,this.tags,this.metadata))}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleCustomEvent: ${e}`),r.raiseError)throw e}},r.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const n=new Uh(this._parentRunId);for(const e of this.handlers){const t=this.inheritableHandlers.includes(e);n.addHandler(e,t)}for(const e of this.tags){const t=this.inheritableTags.includes(e);n.addTags([e],t)}for(const e of Object.keys(this.metadata)){const t=Object.keys(this.inheritableMetadata).includes(e);n.addMetadata({[e]:this.metadata[e]},t)}for(const r of e)n.handlers.filter(e=>"console_callback_handler"===e.name).some(e=>e.name===r.name)||n.addHandler(r,t);return n}static fromHandlers(e){const t=new this;return t.addHandler(new class extends Nu{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Ql()}),Object.assign(this,e)}}),t}static configure(e,t,n,r,i,s,a){return this._configureSync(e,t,n,r,i,s,a)}static _configureSync(e,t,n,r,i,s,a){let o;(e||t)&&(Array.isArray(e)||!e?(o=new Uh,o.setHandlers(e?.map(Mh)??[],!0)):o=e,o=o.copy(Array.isArray(t)?t.map(Mh):t?.handlers,!1));const c="true"===Pu("LANGCHAIN_VERBOSE")||a?.verbose,l=Eh.getTraceableRunTree()?.tracingEnabled||!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(e=>"true"===Pu(e)),u=l||(Pu("LANGCHAIN_TRACING")??!1);if(c||u){if(o||(o=new Uh),c&&!o.handlers.some(e=>e.name===Ku.prototype.name)){const e=new Ku;o.addHandler(e,!0)}if(u&&!o.handlers.some(e=>"langchain_tracer"===e.name)&&l){const e=new Eh;o.addHandler(e,!0),o._parentRunId=Eh.getTraceableRunTree()?.id??o._parentRunId}}for(const{contextVar:e,inheritable:t=!0,handlerClass:n,envVar:r}of Th(Ph)||[]){const i=r&&"true"===Pu(r)&&n;let s;const a=void 0!==e?Th(e):void 0;a&&$u(a)?s=a:i&&(s=new n({})),void 0!==s&&(o||(o=new Uh),o.handlers.some(e=>e.name===s.name)||o.addHandler(s,t))}return(n||r)&&o&&(o.addTags(n??[]),o.addTags(r??[],!1)),(i||s)&&o&&(o.addMetadata(i??{}),o.addMetadata(s??{},!1)),o}}function Mh(e){return"name"in e?e:Nu.fromMethods(e)}const Fh=new class{getStore(){}run(e,t){return t()}enterWith(e){}},zh=Symbol.for("lc:child_config");const Bh=new class{getInstance(){return Ah()??Fh}getRunnableConfig(){const e=this.getInstance();return e.getStore()?.extra?.[zh]}runWithConfig(e,t,n){const r=Uh._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),i=this.getInstance(),s=i.getStore(),a=r?.getParentRunId(),o=r?.handlers?.find(e=>"langchain_tracer"===e?.name);let c;return o&&a?c=o.convertToRunTree(a):n||(c=new vh({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[zh]:e}),void 0!==s&&void 0!==s[kh]&&(void 0===c&&(c={}),c[kh]=s[kh]),i.run(c,t)}initializeGlobalInstance(e){void 0===Ah()&&(e=>{globalThis[Sh]=e})(e)}};async function qh(e){return Uh._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function Wh(...e){const t={};for(const n of e.filter(e=>!!e))for(const e of Object.keys(n))if("metadata"===e)t[e]={...t[e],...n[e]};else if("tags"===e){const r=t[e]??[];t[e]=[...new Set(r.concat(n[e]??[]))]}else if("configurable"===e)t[e]={...t[e],...n[e]};else if("timeout"===e)void 0===t.timeout?t.timeout=n.timeout:void 0!==n.timeout&&(t.timeout=Math.min(t.timeout,n.timeout));else if("signal"===e)void 0===t.signal?t.signal=n.signal:void 0!==n.signal&&("any"in AbortSignal?t.signal=AbortSignal.any([t.signal,n.signal]):t.signal=n.signal);else if("callbacks"===e){const e=t.callbacks,r=n.callbacks;if(Array.isArray(r))if(e)if(Array.isArray(e))t.callbacks=e.concat(r);else{const n=e.copy();for(const e of r)n.addHandler(Mh(e),!0);t.callbacks=n}else t.callbacks=r;else if(r)if(e)if(Array.isArray(e)){const n=r.copy();for(const t of e)n.addHandler(Mh(t),!0);t.callbacks=n}else t.callbacks=new Uh(r._parentRunId,{handlers:e.handlers.concat(r.handlers),inheritableHandlers:e.inheritableHandlers.concat(r.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(r.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(r.inheritableTags))),metadata:{...e.metadata,...r.metadata}});else t.callbacks=r}else{const r=e;t[r]=n[r]??t[r]}return t}const Hh=new Set(["string","number","boolean"]);function Kh(e){const t=Bh.getRunnableConfig();let n={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(t){const{runId:e,runName:r,...i}=t;n=Object.entries(i).reduce((e,[t,n])=>(void 0!==n&&(e[t]=n),e),n)}if(e&&(n=Object.entries(e).reduce((e,[t,n])=>(void 0!==n&&(e[t]=n),e),n)),n?.configurable)for(const e of Object.keys(n.configurable))Hh.has(typeof n.configurable[e])&&!n.metadata?.[e]&&(n.metadata||(n.metadata={}),n.metadata[e]=n.configurable[e]);if(void 0!==n.timeout){if(n.timeout<=0)throw new Error("Timeout must be a positive number");const e=AbortSignal.timeout(n.timeout);void 0!==n.signal?"any"in AbortSignal&&(n.signal=AbortSignal.any([n.signal,e])):n.signal=e,delete n.timeout}return n}function Gh(e={},{callbacks:t,maxConcurrency:n,recursionLimit:r,runName:i,configurable:s,runId:a}={}){const o=Kh(e);return void 0!==t&&(delete o.runName,o.callbacks=t),void 0!==r&&(o.recursionLimit=r),void 0!==n&&(o.maxConcurrency=n),void 0!==i&&(o.runName=i),void 0!==s&&(o.configurable={...o.configurable,...s}),void 0!==a&&delete o.runId,o}function Vh(e){return e?{configurable:e.configurable,recursionLimit:e.recursionLimit,callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,maxConcurrency:e.maxConcurrency,timeout:e.timeout,signal:e.signal}:void 0}async function Zh(e,t){if(void 0===t)return e;let n;return Promise.race([e.catch(e=>{if(!t?.aborted)throw e}),new Promise((e,r)=>{n=()=>{r(new Error("Aborted"))},t.addEventListener("abort",n),t.aborted&&r(new Error("Aborted"))})]).finally(()=>t.removeEventListener("abort",n))}class Jh extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new Jh({start:e=>function n(){return t.read().then(({done:t,value:r})=>{if(!t)return e.enqueue(r),n();e.close()})}(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new Jh({async pull(t){const{value:n,done:r}=await e.next();r&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}}function Yh(e,t=2){const n=Array.from({length:t},()=>[]);return n.map(async function*(t){for(;;)if(0===t.length){const t=await e.next();for(const e of n)e.push(t)}else{if(t[0].done)return;yield t.shift().value}})}function Xh(e,t){if(Array.isArray(e)&&Array.isArray(t))return e.concat(t);if("string"==typeof e&&"string"==typeof t)return e+t;if("number"==typeof e&&"number"==typeof t)return e+t;if("concat"in e&&"function"==typeof e.concat)return e.concat(t);if("object"==typeof e&&"object"==typeof t){const n={...e};for(const[e,r]of Object.entries(t))e in n&&!Array.isArray(n[e])?n[e]=Xh(n[e],r):n[e]=r;return n}throw new Error(`Cannot concat ${typeof e} and ${typeof t}`)}class Qh{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,n)=>{Bh.runWithConfig(Vh(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,n):this.firstResult.then(e=>t(void 0),n)},!0)})}async next(...e){return this.signal?.throwIfAborted(),this.firstResultUsed?Bh.runWithConfig(Vh(this.config),this.signal?async()=>Zh(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}class em{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),n=xu({},t);return new tm({ops:t,state:n[n.length-1].newDocument})}}class tm extends em{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),n=xu(this.state,e.ops);return new tm({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const t=xu({},e.ops);return new tm({ops:e.ops,state:t[t.length-1].newDocument})}}const nm=e=>"log_stream_tracer"===e.name;async function rm(e,t){if("original"===t)throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:n}=e;return["retriever","llm","prompt"].includes(e.run_type)?n:1!==Object.keys(n).length||""!==n?.input?n.input:void 0}async function im(e,t){const{outputs:n}=e;return"original"===t||["retriever","llm","prompt"].includes(e.run_type)?n:void 0!==n&&1===Object.keys(n).length&&void 0!==n?.output?n.output:n}class sm extends Uu{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Jh.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(n=n||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(n=n||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(n=n||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(n=n&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(n=n&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(n=n&&t.every(e=>!this.excludeTags?.includes(e))),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const t=this.keyMapByRunId[e];t&&await this.writer.write(new em({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new em({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(n.inputs=await rm(e,this._schemaFormat)),await this.writer.write(new em({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(void 0===t)return;const n=[];"streaming_events"===this._schemaFormat&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await rm(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await im(e,this._schemaFormat)}),void 0!==e.end_time&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const r=new em({ops:n});await this.writer.write(r)}finally{if(e.id===this.rootId){const t=new em({ops:[{op:"replace",path:"/final_output",value:await im(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){const r=this.keyMapByRunId[e.id];if(void 0===r)return;let i;i=void 0!==e.inputs.messages?function(e){return void 0!==e&&void 0!==e.message}(n?.chunk)?n?.chunk:new zo({id:`run-${e.id}`,content:t}):t;const s=new em({ops:[{op:"add",path:`/logs/${r}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${r}/streamed_output/-`,value:i}]});await this.writer.write(s)}}const am="__run";class om{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new om({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class cm extends om{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new cm({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function lm({name:e,serialized:t}){return void 0!==e?e:void 0!==t?.name?t.name:void 0!==t?.id&&Array.isArray(t?.id)?t.id[t.id.length-1]:"Unnamed"}const um=e=>"event_stream_tracer"===e.name;class dm extends Uu{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Jh.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let n=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(n=n||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(n=n||this.includeTypes.includes(e.runType)),void 0!==this.includeTags&&(n=n||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(n=n&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(n=n&&!this.excludeTypes.includes(e.runType)),void 0!==this.excludeTags&&(n=n&&t.every(e=>!this.excludeTags?.includes(e))),n}async*tapOutputIterable(e,t){const n=await t.next();if(n.done)return;const r=this.runInfoMap.get(e);if(void 0===r)return void(yield n.value);function i(e,t){return"llm"===e&&"string"==typeof t?new om({text:t}):t}let s=this.tappedPromises.get(e);if(void 0===s){let a;s=new Promise(e=>{a=e}),this.tappedPromises.set(e,s);try{const s={event:`on_${r.runType}_stream`,run_id:e,name:r.name,tags:r.tags,metadata:r.metadata,data:{}};await this.send({...s,data:{chunk:i(r.runType,n.value)}},r),yield n.value;for await(const e of t)"tool"!==r.runType&&"retriever"!==r.runType&&await this.send({...s,data:{chunk:i(r.runType,e)}},r),yield e}finally{a()}}else{yield n.value;for await(const e of t)yield e}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const n=this.tappedPromises.get(e.run_id);void 0!==n?n.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){const t=lm(e),n=void 0!==e.inputs.messages?"chat_model":"llm",r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,r);const i=`on_${n}_start`;await this.send({event:i,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},r)}async onLLMNewToken(e,t,n){const r=this.runInfoMap.get(e.id);let i,s;if(void 0===r)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(1!==this.runInfoMap.size){if("chat_model"===r.runType)s="on_chat_model_stream",i=void 0===n?.chunk?new zo({content:t,id:`run-${e.id}`}):n.chunk.message;else{if("llm"!==r.runType)throw new Error(`Unexpected run type ${r.runType}`);s="on_llm_stream",i=void 0===n?.chunk?new om({text:t}):n.chunk}await this.send({event:s,data:{chunk:i},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}}async onLLMEnd(e){const t=this.runInfoMap.get(e.id);let n;if(this.runInfoMap.delete(e.id),void 0===t)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const r=e.outputs?.generations;let i;if("chat_model"===t.runType){for(const e of r??[]){if(void 0!==i)break;i=e[0]?.message}n="on_chat_model_end"}else{if("llm"!==t.runType)throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);i={generations:r?.map(e=>e.map(e=>({text:e.text,generationInfo:e.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},n="on_llm_end"}await this.sendEndEvent({event:n,data:{output:i,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){const t=lm(e),n=e.run_type??"chain",r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type};let i={};""===e.inputs.input&&1===Object.keys(e.inputs).length?(i={},r.inputs={}):void 0!==e.inputs.input?(i.input=e.inputs.input,r.inputs=e.inputs.input):(i.input=e.inputs,r.inputs=e.inputs),this.runInfoMap.set(e.id,r),await this.send({event:`on_${n}_start`,data:i,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},r)}async onChainEnd(e){const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,r=e.inputs??t.inputs??{},i={output:e.outputs?.output??e.outputs,input:r};r.input&&1===Object.keys(r).length&&(i.input=r.input,t.inputs=r.input),await this.sendEndEvent({event:n,data:i,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){const t=lm(e),n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},n)}async onToolEnd(e){const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(void 0===t.inputs)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=void 0===e.outputs?.output?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){const t=lm(e),n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,n),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},n)}async onRetrieverEnd(e){const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,n){const r=this.runInfoMap.get(n);if(void 0===r)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:r.tags,metadata:r.metadata,data:t},r)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const pm=[400,401,402,403,404,405,406,407,409],hm=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name)throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status??e?.status;if(t&&pm.includes(+t))throw e;if("insufficient_quota"===e?.error?.code){const t=new Error(e?.message);throw t.name="InsufficientQuotaError",t}};class mm{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??hm;const t="default"in Ud?Ud.default:Ud;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>ql(()=>e(...t).catch(e=>{throw e instanceof Error?e:new Error(e)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((t,n)=>{e.signal?.addEventListener("abort",()=>{n(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}}class fm extends Uu{constructor({config:e,onStart:t,onEnd:n,onError:r}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=r}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function gm(e){return!!e&&e.lc_runnable}class ym{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags;const r=e.tags??[];return void 0!==this.includeNames&&(n=n||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(n=n||this.includeTypes.includes(t)),void 0!==this.includeTags&&(n=n||r.some(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(n=n&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(n=n&&!this.excludeTypes.includes(t)),void 0!==this.excludeTags&&(n=n&&r.every(e=>!this.excludeTags?.includes(e))),n}}const vm=Symbol("Let zodToJsonSchema decide on which parser to use"),bm={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},wm=e=>{const t=(e=>({...bm,...e}))(e),n=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,n])=>[n._def,{def:n._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}};function _m(e,t,n,r){r?.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function xm(e,t,n,r,i){e[t]=n,_m(e,t,r,i)}const Em=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")};function Sm(e){if("openAi"!==e.target)return{};const t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===e.$refStrategy?Em(t,e.currentPath):t.join("/")}}function km(e,t){return Xm(e.type._def,t)}function Am(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((n,r)=>Am(e,t,n))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Om(e,t)}}const Om=(e,t)=>{const n={type:"integer",format:"unix-time"};if("openApi3"===t.target)return n;for(const r of e.checks)switch(r.kind){case"min":xm(n,"minimum",r.value,r.message,t);break;case"max":xm(n,"maximum",r.value,r.message,t)}return n};let Cm;const Im=/^[cC][^\s-]{8,}$/,Tm=/^[0-9a-z]+$/,Pm=/^[0-9A-HJKMNP-TV-Z]{26}$/,Rm=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,jm=()=>(void 0===Cm&&(Cm=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Cm),Nm=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,$m=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Lm=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Dm=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Um=/^[a-zA-Z0-9_-]{21}$/,Mm=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function Fm(e,t){const n={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":xm(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,r.value):r.value,r.message,t);break;case"max":xm(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"email":switch(t.emailStrategy){case"format:email":qm(n,"email",r.message,t);break;case"format:idn-email":qm(n,"idn-email",r.message,t);break;case"pattern:zod":Wm(n,Rm,r.message,t)}break;case"url":qm(n,"uri",r.message,t);break;case"uuid":qm(n,"uuid",r.message,t);break;case"regex":Wm(n,r.regex,r.message,t);break;case"cuid":Wm(n,Im,r.message,t);break;case"cuid2":Wm(n,Tm,r.message,t);break;case"startsWith":Wm(n,RegExp(`^${zm(r.value,t)}`),r.message,t);break;case"endsWith":Wm(n,RegExp(`${zm(r.value,t)}$`),r.message,t);break;case"datetime":qm(n,"date-time",r.message,t);break;case"date":qm(n,"date",r.message,t);break;case"time":qm(n,"time",r.message,t);break;case"duration":qm(n,"duration",r.message,t);break;case"length":xm(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,r.value):r.value,r.message,t),xm(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"includes":Wm(n,RegExp(zm(r.value,t)),r.message,t);break;case"ip":"v6"!==r.version&&qm(n,"ipv4",r.message,t),"v4"!==r.version&&qm(n,"ipv6",r.message,t);break;case"base64url":Wm(n,Dm,r.message,t);break;case"jwt":Wm(n,Mm,r.message,t);break;case"cidr":"v6"!==r.version&&Wm(n,Nm,r.message,t),"v4"!==r.version&&Wm(n,$m,r.message,t);break;case"emoji":Wm(n,jm(),r.message,t);break;case"ulid":Wm(n,Pm,r.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":qm(n,"binary",r.message,t);break;case"contentEncoding:base64":xm(n,"contentEncoding","base64",r.message,t);break;case"pattern:zod":Wm(n,Lm,r.message,t)}break;case"nanoid":Wm(n,Um,r.message,t)}return n}function zm(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let n=0;n<e.length;n++)Bm.has(e[n])||(t+="\\"),t+=e[n];return t}(e):e}const Bm=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function qm(e,t,n,r){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):xm(e,"format",t,n,r)}function Wm(e,t,n,r){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:Hm(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):xm(e,"pattern",Hm(t,r),n,r)}function Hm(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;const n=e.flags.includes("i"),r=e.flags.includes("m"),i=e.flags.includes("s"),s=n?e.source.toLowerCase():e.source;let a="",o=!1,c=!1,l=!1;for(let e=0;e<s.length;e++)if(o)a+=s[e],o=!1;else{if(n)if(c){if(s[e].match(/[a-z]/)){l?(a+=s[e],a+=`${s[e-2]}-${s[e]}`.toUpperCase(),l=!1):"-"===s[e+1]&&s[e+2]?.match(/[a-z]/)?(a+=s[e],l=!0):a+=`${s[e]}${s[e].toUpperCase()}`;continue}}else if(s[e].match(/[a-z]/)){a+=`[${s[e]}${s[e].toUpperCase()}]`;continue}if(r){if("^"===s[e]){a+="(^|(?<=[\r\n]))";continue}if("$"===s[e]){a+="($|(?=[\r\n]))";continue}}i&&"."===s[e]?a+=c?`${s[e]}\r\n`:`[${s[e]}\r\n]`:(a+=s[e],"\\"===s[e]?o=!0:c&&"]"===s[e]?c=!1:c||"["!==s[e]||(c=!0))}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return a}function Km(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===Pl.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((n,r)=>({...n,[r]:Xm(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",r]})??Sm(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};const n={type:"object",additionalProperties:Xm(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return n;if(e.keyType?._def.typeName===Pl.ZodString&&e.keyType._def.checks?.length){const{type:r,...i}=Fm(e.keyType._def,t);return{...n,propertyNames:i}}if(e.keyType?._def.typeName===Pl.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===Pl.ZodBranded&&e.keyType._def.type._def.typeName===Pl.ZodString&&e.keyType._def.type._def.checks?.length){const{type:r,...i}=km(e.keyType._def,t);return{...n,propertyNames:i}}return n}const Gm={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};const Vm=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,n)=>Xm(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${n}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return n.length?{anyOf:n}:void 0};function Zm(e,t){const n="openAi"===t.target,r={type:"object",properties:{}},i=[],s=e.shape();for(const e in s){let a=s[e];if(void 0===a||void 0===a._def)continue;let o=Jm(a);o&&n&&("ZodOptional"===a._def.typeName&&(a=a._def.innerType),a.isNullable()||(a=a.nullable()),o=!1);const c=Xm(a._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==c&&(r.properties[e]=c,o||i.push(e))}i.length&&(r.required=i);const a=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return Xm(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==a&&(r.additionalProperties=a),r}function Jm(e){try{return e.isOptional()}catch{return!0}}const Ym=(e,t,n)=>{switch(t){case Pl.ZodString:return Fm(e,n);case Pl.ZodNumber:return function(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",_m(n,"type",r.message,t);break;case"min":"jsonSchema7"===t.target?r.inclusive?xm(n,"minimum",r.value,r.message,t):xm(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),xm(n,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?xm(n,"maximum",r.value,r.message,t):xm(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),xm(n,"maximum",r.value,r.message,t));break;case"multipleOf":xm(n,"multipleOf",r.value,r.message,t)}return n}(e,n);case Pl.ZodObject:return Zm(e,n);case Pl.ZodBigInt:return function(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":"jsonSchema7"===t.target?r.inclusive?xm(n,"minimum",r.value,r.message,t):xm(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),xm(n,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?xm(n,"maximum",r.value,r.message,t):xm(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),xm(n,"maximum",r.value,r.message,t));break;case"multipleOf":xm(n,"multipleOf",r.value,r.message,t)}return n}(e,n);case Pl.ZodBoolean:return{type:"boolean"};case Pl.ZodDate:return Am(e,n);case Pl.ZodUndefined:return function(e){return{not:Sm(e)}}(n);case Pl.ZodNull:return function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}(n);case Pl.ZodArray:return function(e,t){const n={type:"array"};return e.type?._def&&e.type?._def?.typeName!==Pl.ZodAny&&(n.items=Xm(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&xm(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&xm(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(xm(n,"minItems",e.exactLength.value,e.exactLength.message,t),xm(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}(e,n);case Pl.ZodUnion:case Pl.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return Vm(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(e=>e._def.typeName in Gm&&(!e._def.checks||!e._def.checks.length))){const e=n.reduce((e,t)=>{const n=Gm[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e},[]);return{type:e.length>1?e:e[0]}}if(n.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){const e=n.reduce((e,t)=>{const n=typeof t._def.value;switch(n){case"string":case"number":case"boolean":return[...e,n];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===n.length){const t=e.filter((e,t,n)=>n.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:n.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(n.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:n.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return Vm(e,t)}(e,n);case Pl.ZodIntersection:return function(e,t){const n=[Xm(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),Xm(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e);let r="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0;const i=[];return n.forEach(e=>{if((e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e)(e))i.push(...e.allOf),void 0===e.unevaluatedProperties&&(r=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:n,...r}=e;t=r}else r=void 0;i.push(t)}}),i.length?{allOf:i,...r}:void 0}(e,n);case Pl.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,n)=>Xm(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:Xm(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,n)=>Xm(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,n);case Pl.ZodRecord:return Km(e,n);case Pl.ZodLiteral:return function(e,t){const n=typeof e.value;return"bigint"!==n&&"number"!==n&&"boolean"!==n&&"string"!==n?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===n?"integer":n,enum:[e.value]}:{type:"bigint"===n?"integer":n,const:e.value}}(e,n);case Pl.ZodEnum:return function(e){return{type:"string",enum:Array.from(e.values)}}(e);case Pl.ZodNativeEnum:return function(e){const t=e.values,n=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),r=Array.from(new Set(n.map(e=>typeof e)));return{type:1===r.length?"string"===r[0]?"string":"number":["string","number"],enum:n}}(e);case Pl.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:Gm[e.innerType._def.typeName],nullable:!0}:{type:[Gm[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){const n=Xm(e.innerType._def,{...t,currentPath:[...t.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const n=Xm(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}(e,n);case Pl.ZodOptional:return((e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return Xm(e.innerType._def,t);const n=Xm(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:Sm(t)},n]}:Sm(t)})(e,n);case Pl.ZodMap:return function(e,t){return"record"===t.mapStrategy?Km(e,t):{type:"array",maxItems:125,items:{type:"array",items:[Xm(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||Sm(t),Xm(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||Sm(t)],minItems:2,maxItems:2}}}(e,n);case Pl.ZodSet:return function(e,t){const n={type:"array",uniqueItems:!0,items:Xm(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&xm(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&xm(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}(e,n);case Pl.ZodLazy:return()=>e.getter()._def;case Pl.ZodPromise:return function(e,t){return Xm(e.type._def,t)}(e,n);case Pl.ZodNaN:case Pl.ZodNever:return function(e){return"openAi"===e.target?void 0:{not:Sm({...e,currentPath:[...e.currentPath,"not"]})}}(n);case Pl.ZodEffects:return function(e,t){return"input"===t.effectStrategy?Xm(e.schema._def,t):Sm(t)}(e,n);case Pl.ZodAny:return Sm(n);case Pl.ZodUnknown:return function(e){return Sm(e)}(n);case Pl.ZodDefault:return function(e,t){return{...Xm(e.innerType._def,t),default:e.defaultValue()}}(e,n);case Pl.ZodBranded:return km(e,n);case Pl.ZodReadonly:case Pl.ZodCatch:return((e,t)=>Xm(e.innerType._def,t))(e,n);case Pl.ZodPipeline:return((e,t)=>{if("input"===t.pipeStrategy)return Xm(e.in._def,t);if("output"===t.pipeStrategy)return Xm(e.out._def,t);const n=Xm(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[n,Xm(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]})].filter(e=>void 0!==e)}})(e,n);case Pl.ZodFunction:case Pl.ZodVoid:case Pl.ZodSymbol:default:return}};function Xm(e,t,n=!1){const r=t.seen.get(e);if(t.override){const i=t.override?.(e,t,r,n);if(i!==vm)return i}if(r&&!n){const e=Qm(r,t);if(void 0!==e)return e}const i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);const s=Ym(e,e.typeName,t),a="function"==typeof s?Xm(s(),t):s;if(a&&ef(e,t,a),t.postProcess){const n=t.postProcess(a,e,t);return i.jsonSchema=a,n}return i.jsonSchema=a,a}const Qm=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Em(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((e,n)=>t.currentPath[n]===e)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),Sm(t)):"seen"===t.$refStrategy?Sm(t):void 0}},ef=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),tf=(e,t)=>{const n=wm(t);let r;const i=t?.name,s=Xm(e._def,n,!1)??Sm(n);n.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[n.openAiAnyTypeName]||(r[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===n.$refStrategy?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));const a=void 0===i?r?{...s,[n.definitionPath]:r}:s:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,i].join("/"),[n.definitionPath]:{...r,[i]:s}};return"jsonSchema7"===n.target?a.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"!==n.target&&"openAi"!==n.target||(a.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===n.target&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function nf(e){return e.replace(/[^a-zA-Z-_0-9]/g,"_")}const rf=["*","_","`"];function sf(e,t,n){const{firstNode:r,lastNode:i,nodeColors:s,withStyles:a=!0,curveStyle:o="linear",wrapLabelNWords:c=9}=n??{};let l=a?`%%{init: {'flowchart': {'curve': '${o}'}}}%%\ngraph TD;\n`:"graph TD;\n";if(a){const t="default",n={[t]:"{0}({1})"};void 0!==r&&(n[r]="{0}([{1}]):::first"),void 0!==i&&(n[i]="{0}([{1}]):::last");for(const[r,i]of Object.entries(e)){const e=i.name.split(":").pop()??"";let s=rf.some(t=>e.startsWith(t)&&e.endsWith(t))?`<p>${e}</p>`:e;Object.keys(i.metadata??{}).length&&(s+=`<hr/><small><em>${Object.entries(i.metadata??{}).map(([e,t])=>`${e} = ${t}`).join("\n")}</em></small>`);const a=(n[r]??n[t]).replace("{0}",nf(r)).replace("{1}",s);l+=`\t${a}\n`}}const u={};for(const e of t){const t=e.source.split(":"),n=e.target.split(":"),r=t.filter((e,t)=>e===n[t]).join(":");u[r]||(u[r]=[]),u[r].push(e)}const d=new Set;function p(e,t){const n=1===e.length&&e[0].source===e[0].target;if(t&&!n){const e=t.split(":").pop();if(d.has(e))throw new Error(`Found duplicate subgraph '${e}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(e),l+=`\tsubgraph ${e}\n`}for(const t of e){const{source:e,target:n,data:r,conditional:i}=t;let s="";if(void 0!==r){let e=r;const t=e.split(" ");t.length>c&&(e=Array.from({length:Math.ceil(t.length/c)},(e,n)=>t.slice(n*c,(n+1)*c).join(" ")).join("&nbsp;<br>&nbsp;")),s=i?` -. &nbsp;${e}&nbsp; .-> `:` -- &nbsp;${e}&nbsp; --\x3e `}else s=i?" -.-> ":" --\x3e ";l+=`\t${nf(e)}${s}${nf(n)};\n`}for(const e in u)e.startsWith(`${t}:`)&&e!==t&&p(u[e],e);t&&!n&&(l+="\tend\n")}p(u[""]??[],"");for(const e in u)e.includes(":")||""===e||p(u[e],e);return a&&(l+=function(e){let t="";for(const[n,r]of Object.entries(e))t+=`\tclassDef ${n} ${r};\n`;return t}(s??{})),l}function af(e,t){if(void 0!==e&&!Hl(e))return e;if(!gm(t))return t.name??"UnknownSchema";try{let e=t.getName();return e=e.startsWith("Runnable")?e.slice(8):e,e}catch(e){return t.getName()}}function of(e){return gm(e.data)?{type:"runnable",data:{id:e.data.lc_id,name:e.data.getName()}}:{type:"schema",data:{...tf(e.data.schema),title:e.data.name}}}class cf{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=Hl(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...of(t)})),edges:this.edges.map(t=>{const n={source:e[t.source],target:e[t.target]};return void 0!==t.data&&(n.data=t.data),void 0!==t.conditional&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(void 0!==t&&void 0!==this.nodes[t])throw new Error(`Node with id ${t} already exists`);const r=t??Ql(),i={id:r,data:e,name:af(t,e),metadata:n};return this.nodes[r]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,r){if(void 0===this.nodes[e.id])throw new Error(`Source node ${e.id} not in graph`);if(void 0===this.nodes[t.id])throw new Error(`Target node ${t.id} not in graph`);const i={source:e.id,target:t.id,data:n,conditional:r};return this.edges.push(i),i}firstNode(){return lf(this)}lastNode(){return uf(this)}extend(e,t=""){let n=t;const r=Object.values(e.nodes).map(e=>e.id);r.every(Hl)&&(n="");const i=e=>n?`${n}:${e}`:e;Object.entries(e.nodes).forEach(([e,t])=>{this.nodes[i(e)]={...t,id:i(e)}});const s=e.edges.map(e=>({...e,source:i(e.source),target:i(e.target)}));this.edges=[...this.edges,...s];const a=e.firstNode(),o=e.lastNode();return[a?{id:i(a.id),data:a.data}:void 0,o?{id:i(o.id),data:o.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&lf(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&uf(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(e=>[e.id,e.name])),t=new Map;Object.values(e).forEach(e=>{t.set(e,(t.get(e)||0)+1)});const n=n=>{const r=e[n];return Hl(n)&&1===t.get(r)?r:n};return new cf({nodes:Object.fromEntries(Object.entries(this.nodes).map(([e,t])=>[n(e),{...t,id:n(e)}])),edges:this.edges.map(e=>({...e,source:n(e.source),target:n(e.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:n,nodeColors:r={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:i}=e??{},s=this.reid(),a=s.firstNode(),o=s.lastNode();return sf(s.nodes,s.edges,{firstNode:a?.id,lastNode:o?.id,withStyles:t,curveStyle:n,nodeColors:r,wrapLabelNWords:i})}async drawMermaidPng(e){return async function(e,t){let{backgroundColor:n="white"}=t??{};const r=btoa(e);void 0!==n&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(n)||(n=`!${n}`));const i=`https://mermaid.ink/img/${r}?bgColor=${n}`,s=await fetch(i);if(!s.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${s.status}`,`Status text: ${s.statusText}`].join("\n"));return await s.blob()}(this.drawMermaid(e),{backgroundColor:e?.backgroundColor})}}function lf(e,t=[]){const n=new Set(e.edges.filter(e=>!t.includes(e.source)).map(e=>e.target)),r=[];for(const i of Object.values(e.nodes))t.includes(i.id)||n.has(i.id)||r.push(i);return 1===r.length?r[0]:void 0}function uf(e,t=[]){const n=new Set(e.edges.filter(e=>!t.includes(e.target)).map(e=>e.source)),r=[];for(const i of Object.values(e.nodes))t.includes(i.id)||n.has(i.id)||r.push(i);return 1===r.length?r[0]:void 0}function df(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.iterator]&&"function"==typeof e.next}function pf(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.asyncIterator]}function*hf(e,t){for(;;){const{value:n,done:r}=Bh.runWithConfig(Vh(e),t.next.bind(t),!0);if(r)break;yield n}}async function*mf(e,t){const n=t[Symbol.asyncIterator]();for(;;){const{value:r,done:i}=await Bh.runWithConfig(Vh(e),n.next.bind(t),!0);if(i)break;yield r}}function ff(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}class gf extends wo{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new yf({bound:this,kwargs:e,config:{}})}map(){return new vf({bound:this})}withRetry(e){return new bf({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new yf({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new Sf({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Kh);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter(([e])=>"runId"!==e));return Array.from({length:t},(t,r)=>Kh(0===r?e:n))}return Array.from({length:t},()=>Kh(e))}async batch(e,t,n){const r=this._getOptionsList(t??{},e.length),i=r[0]?.maxConcurrency??n?.maxConcurrency,s=new mm({maxConcurrency:i,onFailedAttempt:e=>{throw e}}),a=e.map((e,t)=>s.call(async()=>{try{return await this.invoke(e,r[t])}catch(e){if(n?.returnExceptions)return e;throw e}}));return Promise.all(a)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=Kh(t),r=new Qh({generator:this._streamIterator(e,n),config:n});return await r.setup,Jh.fromAsyncGenerator(r)}_separateRunnableConfigFromCallOptions(e){let t;t=Kh(void 0===e?e:{callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}async _callWithConfig(e,t,n){const r=Kh(n),i=await qh(r),s=await(i?.handleChainStart(this.toJSON(),ff(t,"input"),r.runId,r?.runType,void 0,void 0,r?.runName??this.getName()));let a;delete r.runId;try{const i=e.call(this,t,r,s);a=await Zh(i,n?.signal)}catch(e){throw await(s?.handleChainError(e)),e}return await(s?.handleChainEnd(ff(a,"output"))),a}async _batchWithConfig(e,t,n,r){const i=this._getOptionsList(n??{},t.length),s=await Promise.all(i.map(qh)),a=await Promise.all(s.map(async(e,n)=>{const r=await(e?.handleChainStart(this.toJSON(),ff(t[n],"input"),i[n].runId,i[n].runType,void 0,void 0,i[n].runName??this.getName()));return delete i[n].runId,r}));let o;try{const n=e.call(this,t,i,a,r);o=await Zh(n,i?.[0]?.signal)}catch(e){throw await Promise.all(a.map(t=>t?.handleChainError(e))),e}return await Promise.all(a.map(e=>e?.handleChainEnd(ff(o,"output")))),o}async*_transformStreamWithConfig(e,t,n){let r,i,s=!0,a=!0;const o=Kh(n),c=await qh(o);let l;try{const u=await async function(e,t,n,r,...i){const s=new Qh({generator:t,startSetup:n,signal:r}),a=await s.setup;return{output:e(s,a,...i),setup:a}}(t.bind(this),async function*(){for await(const t of e){if(s)if(void 0===r)r=t;else try{r=Xh(r,t)}catch{r=void 0,s=!1}yield t}}(),async()=>c?.handleChainStart(this.toJSON(),{input:""},o.runId,o.runType,void 0,void 0,o.runName??this.getName()),n?.signal,o);delete o.runId,l=u.setup;const d=l?.handlers.find(um);let p=u.output;void 0!==d&&void 0!==l&&(p=d.tapOutputIterable(l.runId,p));const h=l?.handlers.find(nm);void 0!==h&&void 0!==l&&(p=h.tapOutputIterable(l.runId,p));for await(const e of p)if(yield e,a)if(void 0===i)i=e;else try{i=Xh(i,e)}catch{i=void 0,a=!1}}catch(e){throw await(l?.handleChainError(e,void 0,void 0,void 0,{inputs:ff(r,"input")})),e}await(l?.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:ff(r,"input")}))}getGraph(e){const t=new cf,n=t.addNode({name:`${this.getName()}Input`,schema:jl()}),r=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:jl()});return t.addEdge(n,r),t.addEdge(r,i),t}pipe(e){return new wf({first:this,last:kf(e)})}pick(e){return this.pipe(new Of(e))}assign(e){return this.pipe(new Af(new _f({steps:e})))}async*transform(e,t){let n;for await(const t of e)n=void 0===n?t:Xh(n,t);yield*this._streamIterator(n,Kh(t))}async*streamLog(e,t,n){const r=new sm({...n,autoClose:!1,_schemaFormat:"original"}),i=Kh(t);yield*this._streamLog(e,r,i)}async*_streamLog(e,t,n){const{callbacks:r}=n;if(void 0===r)n.callbacks=[t];else if(Array.isArray(r))n.callbacks=r.concat([t]);else{const e=r.copy();e.addHandler(t,!0),n.callbacks=e}const i=this.stream(e,n);const s=async function(){try{const e=await i;for await(const n of e){const e=new em({ops:[{op:"add",path:"/streamed_output/-",value:n}]});await t.writer.write(e)}}finally{await t.writer.close()}}();try{for await(const e of t)yield e}finally{await s}}streamEvents(e,t,n){let r;if("v1"===t.version)r=this._streamEventsV1(e,t,n);else{if("v2"!==t.version)throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');r=this._streamEventsV2(e,t,n)}return"text/event-stream"===t.encoding?function(e){const t=new TextEncoder,n=new ReadableStream({async start(n){for await(const r of e)n.enqueue(t.encode(`event: data\ndata: ${JSON.stringify(r)}\n\n`));n.enqueue(t.encode("event: end\n\n")),n.close()}});return Jh.fromReadableStream(n)}(r):Jh.fromAsyncGenerator(r)}async*_streamEventsV2(e,t,n){const r=new dm({...n,autoClose:!1}),i=Kh(t),s=i.runId??Ql();i.runId=s;const a=i.callbacks;if(void 0===a)i.callbacks=[r];else if(Array.isArray(a))i.callbacks=a.concat(r);else{const e=a.copy();e.addHandler(r,!0),i.callbacks=e}const o=new AbortController,c=this;const l=async function(){try{let n;t?.signal?"any"in AbortSignal?n=AbortSignal.any([o.signal,t.signal]):(n=t.signal,t.signal.addEventListener("abort",()=>{o.abort()},{once:!0})):n=o.signal;const a=await c.stream(e,{...i,signal:n}),l=r.tapOutputIterable(s,a);for await(const e of l)if(o.signal.aborted)break}finally{await r.finish()}}();let u,d=!1;try{for await(const t of r)d?(t.run_id===u&&t.event.endsWith("_end")&&t.data?.input&&delete t.data.input,yield t):(t.data.input=e,d=!0,u=t.run_id,yield t)}finally{o.abort(),await l}}async*_streamEventsV1(e,t,n){let r,i=!1;const s=Kh(t),a=s.tags??[],o=s.metadata??{},c=s.runName??this.getName(),l=new sm({...n,autoClose:!1,_schemaFormat:"streaming_events"}),u=new ym({...n}),d=this._streamLog(e,l,s);for await(const t of d){if(r=r?r.concat(t):tm.fromRunLogPatch(t),void 0===r.state)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;const t={...r.state},n={run_id:t.id,event:`on_${t.type}_start`,name:c,tags:a,metadata:o,data:{input:e}};u.includeEvent(n,t.type)&&(yield n)}const n=t.ops.filter(e=>e.path.startsWith("/logs/")).map(e=>e.path.split("/")[2]),s=[...new Set(n)];for(const e of s){let t,n={};const i=r.state.logs[e];if(t=void 0===i.end_time?i.streamed_output.length>0?"stream":"start":"end","start"===t)void 0!==i.inputs&&(n.input=i.inputs);else if("end"===t)void 0!==i.inputs&&(n.input=i.inputs),n.output=i.final_output;else if("stream"===t){const e=i.streamed_output.length;if(1!==e)throw new Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${i.name}"`);n={chunk:i.streamed_output[0]},i.streamed_output=[]}yield{event:`on_${i.type}_${t}`,name:i.name,run_id:i.id,tags:i.tags,metadata:i.metadata,data:n}}const{state:l}=r;if(l.streamed_output.length>0){const e=l.streamed_output.length;if(1!==e)throw new Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${l.name}"`);const t={chunk:l.streamed_output[0]};l.streamed_output=[];const n={event:`on_${l.type}_stream`,run_id:l.id,tags:a,metadata:o,name:c,data:t};u.includeEvent(n,l.type)&&(yield n)}}const p=r?.state;if(void 0!==p){const e={event:`on_${p.type}_end`,name:c,run_id:p.id,tags:a,metadata:o,data:{output:p.final_output}};u.includeEvent(e,p.type)&&(yield e)}}static isRunnable(e){return gm(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new yf({bound:this,config:{},configFactories:[r=>({callbacks:[new fm({config:r,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return function(e,t){const n=t.name??e.getName(),r=t.description??t.schema?.description;if(t.schema.constructor===Vc)return new Cf({name:n,description:r,schema:Nl({input:Rl()}).transform(e=>e.input),bound:e});return new Cf({name:n,description:r,schema:t.schema,bound:e})}
/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */(this,e)}}class yf extends gf{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=Wh(this.config,...e);return Wh(t,...this.configFactories?await Promise.all(this.configFactories.map(async e=>await e(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new bf({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e?.stopAfterAttempt,...e})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(Kh(t),this.kwargs))}async batch(e,t,n){const r=Array.isArray(t)?await Promise.all(t.map(async e=>this._mergeConfig(Kh(e),this.kwargs))):await this._mergeConfig(Kh(t),this.kwargs);return this.bound.batch(e,r,n)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(Kh(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(Kh(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(Kh(t),this.kwargs))}streamEvents(e,t,n){const r=this;return Jh.fromAsyncGenerator(async function*(){yield*r.bound.streamEvents(e,{...await r._mergeConfig(Kh(t),r.kwargs),version:t.version},n)}())}static isRunnableBinding(e){return e.bound&&gf.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new yf({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[r=>({callbacks:[new fm({config:r,onStart:e,onEnd:t,onError:n})]})]})}}class vf extends gf{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new vf({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,n){return this.bound.batch(e,Gh(t,{callbacks:n?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new vf({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}}class bf extends yf{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){const r=e>1?`retry:attempt:${e}`:void 0;return Gh(t,{callbacks:n?.getChild(r)})}async _invoke(e,t,n){return ql(r=>super.invoke(e,this._patchConfigForRetry(r,t,n)),{onFailedAttempt:t=>this.onFailedAttempt(t,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,n,r){const i={};try{await ql(async s=>{const a=e.map((e,t)=>t).filter(e=>void 0===i[e.toString()]||i[e.toString()]instanceof Error),o=a.map(t=>e[t]),c=a.map(e=>this._patchConfigForRetry(s,t?.[e],n?.[e])),l=await super.batch(o,c,{...r,returnExceptions:!0});let u;for(let e=0;e<l.length;e+=1){const t=l[e],n=a[e];t instanceof Error&&void 0===u&&(u=t,u.input=o[e]),i[n.toString()]=t}if(u)throw u;return l},{onFailedAttempt:e=>this.onFailedAttempt(e,e.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(!0!==r?.returnExceptions)throw e}return Object.keys(i).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>i[parseInt(e,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}}class wf extends gf{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const n=Kh(t),r=await qh(n),i=await(r?.handleChainStart(this.toJSON(),ff(e,"input"),n.runId,void 0,void 0,void 0,n?.runName));delete n.runId;let s,a=e;try{const e=[this.first,...this.middle];for(let r=0;r<e.length;r+=1){const s=e[r].invoke(a,Gh(n,{callbacks:i?.getChild(this.omitSequenceTags?void 0:`seq:step:${r+1}`)}));a=await Zh(s,t?.signal)}if(t?.signal?.aborted)throw new Error("Aborted");s=await this.last.invoke(a,Gh(n,{callbacks:i?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(e){throw await(i?.handleChainError(e)),e}return await(i?.handleChainEnd(ff(s,"output"))),s}async batch(e,t,n){const r=this._getOptionsList(t??{},e.length),i=await Promise.all(r.map(qh)),s=await Promise.all(i.map(async(t,n)=>{const i=await(t?.handleChainStart(this.toJSON(),ff(e[n],"input"),r[n].runId,void 0,void 0,void 0,r[n].runName));return delete r[n].runId,i}));let a=e;try{for(let e=0;e<this.steps.length;e+=1){const t=this.steps[e].batch(a,s.map((t,n)=>{const i=t?.getChild(this.omitSequenceTags?void 0:`seq:step:${e+1}`);return Gh(r[n],{callbacks:i})}),n);a=await Zh(t,r[0]?.signal)}}catch(e){throw await Promise.all(s.map(t=>t?.handleChainError(e))),e}return await Promise.all(s.map(e=>e?.handleChainEnd(ff(a,"output")))),a}async*_streamIterator(e,t){const n=await qh(t),{runId:r,...i}=t??{},s=await(n?.handleChainStart(this.toJSON(),ff(e,"input"),r,void 0,void 0,void 0,i?.runName)),a=[this.first,...this.middle,this.last];let o,c=!0;try{let n=a[0].transform(async function*(){yield e}(),Gh(i,{callbacks:s?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let e=1;e<a.length;e+=1){const t=a[e];n=await t.transform(n,Gh(i,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${e+1}`)}))}for await(const e of n)if(t?.signal?.throwIfAborted(),yield e,c)if(void 0===o)o=e;else try{o=Xh(o,e)}catch(e){o=void 0,c=!1}}catch(e){throw await(s?.handleChainError(e)),e}await(s?.handleChainEnd(ff(o,"output")))}getGraph(e){const t=new cf;let n=null;return this.steps.forEach((r,i)=>{const s=r.getGraph(e);0!==i&&s.trimFirstNode(),i!==this.steps.length-1&&s.trimLastNode(),t.extend(s);const a=s.firstNode();if(!a)throw new Error(`Runnable ${r} has no first node`);n&&t.addEdge(n,a),n=s.lastNode()}),t}pipe(e){return wf.isRunnableSequence(e)?new wf({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new wf({first:this.first,middle:[...this.middle,this.last],last:kf(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&gf.isRunnable(e)}static from([e,...t],n){let r={};return"string"==typeof n?r.name=n:void 0!==n&&(r=n),new wf({...r,first:kf(e),middle:t.slice(0,-1).map(kf),last:kf(t[t.length-1])})}}class _f extends gf{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,n]of Object.entries(e.steps))this.steps[t]=kf(n)}static from(e){return new _f({steps:e})}async invoke(e,t){const n=Kh(t),r=await qh(n),i=await(r?.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n?.runName));delete n.runId;const s={};try{const r=Object.entries(this.steps).map(async([t,r])=>{s[t]=await r.invoke(e,Gh(n,{callbacks:i?.getChild(`map:key:${t}`)}))});await Zh(Promise.all(r),t?.signal)}catch(e){throw await(i?.handleChainError(e)),e}return await(i?.handleChainEnd(s)),s}async*_transform(e,t,n){const r={...this.steps},i=Yh(e,Object.keys(r).length),s=new Map(Object.entries(r).map(([e,r],s)=>{const a=r.transform(i[s],Gh(n,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,a.next().then(t=>({key:e,gen:a,result:t}))]}));for(;s.size;){const e=Promise.race(s.values()),{key:t,result:r,gen:i}=await Zh(e,n?.signal);s.delete(t),r.done||(yield{[t]:r.value},s.set(t,i.next().then(e=>({key:t,gen:i,result:e}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=Kh(t),r=new Qh({generator:this.transform(async function*(){yield e}(),n),config:n});return await r.setup,Jh.fromAsyncGenerator(r)}}class xf extends gf{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!au(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[n]=this._getOptionsList(t??{},1),r=await qh(n);return Zh(this.func(Gh(n,{callbacks:r}),e),n?.signal)}async*_streamIterator(e,t){const[n]=this._getOptionsList(t??{},1),r=await this.invoke(e,t);if(pf(r))for await(const e of r)n?.signal?.throwIfAborted(),yield e;else if((e=>null!=e&&"object"==typeof e&&"next"in e&&"function"==typeof e.next)(r))for(;;){n?.signal?.throwIfAborted();const e=r.next();if(e.done)break;yield e.value}else yield r}static from(e){return new xf({func:e})}}class Ef extends gf{static lc_name(){return"RunnableLambda"}constructor(e){if(au(e.func))return xf.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),function(e){if(au(e))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}(e.func),this.func=e.func}static from(e){return new Ef({func:e})}async _invoke(e,t,n){return new Promise((r,i)=>{const s=Gh(t,{callbacks:n?.getChild(),recursionLimit:(t?.recursionLimit??25)-1});Bh.runWithConfig(Vh(s),async()=>{try{let n=await this.func(e,{...s});if(n&&gf.isRunnable(n)){if(0===t?.recursionLimit)throw new Error("Recursion limit reached.");n=await n.invoke(e,{...s,recursionLimit:(s.recursionLimit??25)-1})}else if(pf(n)){let e;for await(const r of mf(s,n))if(t?.signal?.throwIfAborted(),void 0===e)e=r;else try{e=Xh(e,r)}catch(t){e=r}n=e}else if(df(n)){let e;for(const r of hf(s,n))if(t?.signal?.throwIfAborted(),void 0===e)e=r;else try{e=Xh(e,r)}catch(t){e=r}n=e}r(n)}catch(e){i(e)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,n){let r;for await(const t of e)if(void 0===r)r=t;else try{r=Xh(r,t)}catch(e){r=t}const i=Gh(n,{callbacks:t?.getChild(),recursionLimit:(n?.recursionLimit??25)-1}),s=await new Promise((e,t)=>{Bh.runWithConfig(Vh(i),async()=>{try{const t=await this.func(r,{...i,config:i});e(t)}catch(e){t(e)}})});if(s&&gf.isRunnable(s)){if(0===n?.recursionLimit)throw new Error("Recursion limit reached.");const e=await s.stream(r,i);for await(const t of e)yield t}else if(pf(s))for await(const e of mf(i,s))n?.signal?.throwIfAborted(),yield e;else if(df(s))for(const e of hf(i,s))n?.signal?.throwIfAborted(),yield e;else yield s}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=Kh(t),r=new Qh({generator:this.transform(async function*(){yield e}(),n),config:n});return await r.setup,Jh.fromAsyncGenerator(r)}}class Sf extends gf{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=Kh(t),r=await qh(n),{runId:i,...s}=n,a=await(r?.handleChainStart(this.toJSON(),ff(e,"input"),i,void 0,void 0,void 0,s?.runName)),o=Gh(s,{callbacks:a?.getChild()}),c=await Bh.runWithConfig(o,async()=>{let t;for(const r of this.runnables()){n?.signal?.throwIfAborted();try{const t=await r.invoke(e,o);return await(a?.handleChainEnd(ff(t,"output"))),t}catch(e){void 0===t&&(t=e)}}if(void 0===t)throw new Error("No error stored at end of fallback.");throw await(a?.handleChainError(t)),t});return c}async*_streamIterator(e,t){const n=Kh(t),r=await qh(n),{runId:i,...s}=n,a=await(r?.handleChainStart(this.toJSON(),ff(e,"input"),i,void 0,void 0,void 0,s?.runName));let o,c,l;for(const t of this.runnables()){n?.signal?.throwIfAborted();const r=Gh(s,{callbacks:a?.getChild()});try{c=mf(r,await t.stream(e,r));break}catch(e){void 0===o&&(o=e)}}if(void 0===c){const e=o??new Error("No error stored at end of fallback.");throw await(a?.handleChainError(e)),e}try{for await(const e of c){yield e;try{l=void 0===l?l:Xh(l,e)}catch(e){l=void 0}}}catch(e){throw await(a?.handleChainError(e)),e}await(a?.handleChainEnd(ff(l,"output")))}async batch(e,t,n){if(n?.returnExceptions)throw new Error("Not implemented.");const r=this._getOptionsList(t??{},e.length),i=await Promise.all(r.map(e=>qh(e))),s=await Promise.all(i.map(async(t,n)=>{const i=await(t?.handleChainStart(this.toJSON(),ff(e[n],"input"),r[n].runId,void 0,void 0,void 0,r[n].runName));return delete r[n].runId,i}));let a;for(const t of this.runnables()){r[0].signal?.throwIfAborted();try{const i=await t.batch(e,s.map((e,t)=>Gh(r[t],{callbacks:e?.getChild()})),n);return await Promise.all(s.map((e,t)=>e?.handleChainEnd(ff(i[t],"output")))),i}catch(e){void 0===a&&(a=e)}}if(!a)throw new Error("No error stored at end of fallbacks.");throw await Promise.all(s.map(e=>e?.handleChainError(a))),a}}function kf(e){if("function"==typeof e)return new Ef({func:e});if(gf.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw new Error("Expected a Runnable, function or object.\nInstead got an unsupported type.");{const t={};for(const[n,r]of Object.entries(e))t[n]=kf(r);return new _f({steps:t})}}class Af extends gf{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof _f&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const r=this.mapper.getStepsKeys(),[i,s]=Yh(e),a=this.mapper.transform(s,Gh(n,{callbacks:t?.getChild()})),o=a.next();for await(const e of i){if("object"!=typeof e||Array.isArray(e))throw new Error("RunnableAssign can only be used with objects as input, got "+typeof e);const t=Object.fromEntries(Object.entries(e).filter(([e])=>!r.includes(e)));Object.keys(t).length>0&&(yield t)}yield(await o).value;for await(const e of a)yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=Kh(t),r=new Qh({generator:this.transform(async function*(){yield e}(),n),config:n});return await r.setup,Jh.fromAsyncGenerator(r)}}class Of extends gf{static lc_name(){return"RunnablePick"}constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{const t=this.keys.map(t=>[t,e[t]]).filter(e=>void 0!==e[1]);return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=Kh(t),r=new Qh({generator:this.transform(async function*(){yield e}(),n),config:n});return await r.setup,Jh.fromAsyncGenerator(r)}}class Cf extends yf{constructor(e){super({bound:wf.from([Ef.from(async e=>{let t;if(Jo(e))try{t=await this.schema.parseAsync(e.args)}catch(t){throw new Yo("Received tool input did not match expected schema",JSON.stringify(e.args))}else t=e;return t}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name}),config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}var If="object"==typeof window?window:{},Tf="0123456789abcdef".split(""),Pf=[-2147483648,8388608,32768,128],Rf=[24,16,8,0],jf=[];function Nf(e){e?(jf[0]=jf[16]=jf[1]=jf[2]=jf[3]=jf[4]=jf[5]=jf[6]=jf[7]=jf[8]=jf[9]=jf[10]=jf[11]=jf[12]=jf[13]=jf[14]=jf[15]=0,this.blocks=jf):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Nf.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===If.ArrayBuffer&&(e=new Uint8Array(e));for(var n,r,i=0,s=e.length||0,a=this.blocks;i<s;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),t)for(r=this.start;i<s&&r<64;++i)a[r>>2]|=e[i]<<Rf[3&r++];else for(r=this.start;i<s&&r<64;++i)(n=e.charCodeAt(i))<128?a[r>>2]|=n<<Rf[3&r++]:n<2048?(a[r>>2]|=(192|n>>6)<<Rf[3&r++],a[r>>2]|=(128|63&n)<<Rf[3&r++]):n<55296||n>=57344?(a[r>>2]|=(224|n>>12)<<Rf[3&r++],a[r>>2]|=(128|n>>6&63)<<Rf[3&r++],a[r>>2]|=(128|63&n)<<Rf[3&r++]):(n=65536+((1023&n)<<10|1023&e.charCodeAt(++i)),a[r>>2]|=(240|n>>18)<<Rf[3&r++],a[r>>2]|=(128|n>>12&63)<<Rf[3&r++],a[r>>2]|=(128|n>>6&63)<<Rf[3&r++],a[r>>2]|=(128|63&n)<<Rf[3&r++]);this.lastByteIndex=r,this.bytes+=r-this.start,r>=64?(this.block=a[16],this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296|0,this.bytes=this.bytes%4294967296),this}},Nf.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=Pf[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},Nf.prototype.hash=function(){var e,t,n=this.h0,r=this.h1,i=this.h2,s=this.h3,a=this.h4,o=this.blocks;for(e=16;e<80;++e)t=o[e-3]^o[e-8]^o[e-14]^o[e-16],o[e]=t<<1|t>>>31;for(e=0;e<20;e+=5)n=(t=(r=(t=(i=(t=(s=(t=(a=(t=n<<5|n>>>27)+(r&i|~r&s)+a+1518500249+o[e]|0)<<5|a>>>27)+(n&(r=r<<30|r>>>2)|~n&i)+s+1518500249+o[e+1]|0)<<5|s>>>27)+(a&(n=n<<30|n>>>2)|~a&r)+i+1518500249+o[e+2]|0)<<5|i>>>27)+(s&(a=a<<30|a>>>2)|~s&n)+r+1518500249+o[e+3]|0)<<5|r>>>27)+(i&(s=s<<30|s>>>2)|~i&a)+n+1518500249+o[e+4]|0,i=i<<30|i>>>2;for(;e<40;e+=5)n=(t=(r=(t=(i=(t=(s=(t=(a=(t=n<<5|n>>>27)+(r^i^s)+a+1859775393+o[e]|0)<<5|a>>>27)+(n^(r=r<<30|r>>>2)^i)+s+1859775393+o[e+1]|0)<<5|s>>>27)+(a^(n=n<<30|n>>>2)^r)+i+1859775393+o[e+2]|0)<<5|i>>>27)+(s^(a=a<<30|a>>>2)^n)+r+1859775393+o[e+3]|0)<<5|r>>>27)+(i^(s=s<<30|s>>>2)^a)+n+1859775393+o[e+4]|0,i=i<<30|i>>>2;for(;e<60;e+=5)n=(t=(r=(t=(i=(t=(s=(t=(a=(t=n<<5|n>>>27)+(r&i|r&s|i&s)+a-1894007588+o[e]|0)<<5|a>>>27)+(n&(r=r<<30|r>>>2)|n&i|r&i)+s-1894007588+o[e+1]|0)<<5|s>>>27)+(a&(n=n<<30|n>>>2)|a&r|n&r)+i-1894007588+o[e+2]|0)<<5|i>>>27)+(s&(a=a<<30|a>>>2)|s&n|a&n)+r-1894007588+o[e+3]|0)<<5|r>>>27)+(i&(s=s<<30|s>>>2)|i&a|s&a)+n-1894007588+o[e+4]|0,i=i<<30|i>>>2;for(;e<80;e+=5)n=(t=(r=(t=(i=(t=(s=(t=(a=(t=n<<5|n>>>27)+(r^i^s)+a-899497514+o[e]|0)<<5|a>>>27)+(n^(r=r<<30|r>>>2)^i)+s-899497514+o[e+1]|0)<<5|s>>>27)+(a^(n=n<<30|n>>>2)^r)+i-899497514+o[e+2]|0)<<5|i>>>27)+(s^(a=a<<30|a>>>2)^n)+r-899497514+o[e+3]|0)<<5|r>>>27)+(i^(s=s<<30|s>>>2)^a)+n-899497514+o[e+4]|0,i=i<<30|i>>>2;this.h0=this.h0+n|0,this.h1=this.h1+r|0,this.h2=this.h2+i|0,this.h3=this.h3+s|0,this.h4=this.h4+a|0},Nf.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,i=this.h4;return Tf[e>>28&15]+Tf[e>>24&15]+Tf[e>>20&15]+Tf[e>>16&15]+Tf[e>>12&15]+Tf[e>>8&15]+Tf[e>>4&15]+Tf[15&e]+Tf[t>>28&15]+Tf[t>>24&15]+Tf[t>>20&15]+Tf[t>>16&15]+Tf[t>>12&15]+Tf[t>>8&15]+Tf[t>>4&15]+Tf[15&t]+Tf[n>>28&15]+Tf[n>>24&15]+Tf[n>>20&15]+Tf[n>>16&15]+Tf[n>>12&15]+Tf[n>>8&15]+Tf[n>>4&15]+Tf[15&n]+Tf[r>>28&15]+Tf[r>>24&15]+Tf[r>>20&15]+Tf[r>>16&15]+Tf[r>>12&15]+Tf[r>>8&15]+Tf[r>>4&15]+Tf[15&r]+Tf[i>>28&15]+Tf[i>>24&15]+Tf[i>>20&15]+Tf[i>>16&15]+Tf[i>>12&15]+Tf[i>>8&15]+Tf[i>>4&15]+Tf[15&i]},Nf.prototype.toString=Nf.prototype.hex,Nf.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,i=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24&255,n>>16&255,n>>8&255,255&n,r>>24&255,r>>16&255,r>>8&255,255&r,i>>24&255,i>>16&255,i>>8&255,255&i]},Nf.prototype.array=Nf.prototype.digest,Nf.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};const $f=(...e)=>{return t=e.join("_"),new Nf(!0).update(t).hex();var t};class Lf{}const Df=new Map;class Uf extends Lf{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get($f(e,t))??null)}async update(e,t,n){this.cache.set($f(e,t),n)}static global(){return new Uf(Df)}}class Mf extends wo{}class Ff extends Mf{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Ho(this.value)]}}class zf extends Mf{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return tc(this.messages)}toChatMessages(){return this.messages}}for(var Bf={byteLength:function(e){var t=Vf(e),n=t[0],r=t[1];return 3*(n+r)/4-r},toByteArray:function(e){var t,n,r=Vf(e),i=r[0],s=r[1],a=new Hf(function(e,t,n){return 3*(t+n)/4-n}(0,i,s)),o=0,c=s>0?i-4:i;for(n=0;n<c;n+=4)t=Wf[e.charCodeAt(n)]<<18|Wf[e.charCodeAt(n+1)]<<12|Wf[e.charCodeAt(n+2)]<<6|Wf[e.charCodeAt(n+3)],a[o++]=t>>16&255,a[o++]=t>>8&255,a[o++]=255&t;2===s&&(t=Wf[e.charCodeAt(n)]<<2|Wf[e.charCodeAt(n+1)]>>4,a[o++]=255&t);1===s&&(t=Wf[e.charCodeAt(n)]<<10|Wf[e.charCodeAt(n+1)]<<4|Wf[e.charCodeAt(n+2)]>>2,a[o++]=t>>8&255,a[o++]=255&t);return a},fromByteArray:function(e){for(var t,n=e.length,r=n%3,i=[],s=16383,a=0,o=n-r;a<o;a+=s)i.push(Jf(e,a,a+s>o?o:a+s));1===r?(t=e[n-1],i.push(qf[t>>2]+qf[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(qf[t>>10]+qf[t>>4&63]+qf[t<<2&63]+"="));return i.join("")}},qf=[],Wf=[],Hf="undefined"!=typeof Uint8Array?Uint8Array:Array,Kf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Gf=0;Gf<64;++Gf)qf[Gf]=Kf[Gf],Wf[Kf.charCodeAt(Gf)]=Gf;function Vf(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function Zf(e){return qf[e>>18&63]+qf[e>>12&63]+qf[e>>6&63]+qf[63&e]}function Jf(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),i.push(Zf(r));return i.join("")}Wf["-".charCodeAt(0)]=62,Wf["_".charCodeAt(0)]=63;var Yf=Object.defineProperty;function Xf(e,t){return 1===e.length?[t.get(e.join(","))]:function(e,t){let n=Array.from({length:e.length},(e,t)=>({start:t,end:t+1}));for(;n.length>1;){let r=null;for(let i=0;i<n.length-1;i++){const s=e.slice(n[i].start,n[i+1].end),a=t.get(s.join(","));null!=a&&(null==r||a<r[0])&&(r=[a,i])}if(null==r)break;{const e=r[1];n[e]={start:n[e].start,end:n[e+1].end},n.splice(e+1,1)}}return n}(e,t).map(n=>t.get(e.slice(n.start,n.end).join(","))).filter(e=>null!=e)}var Qf,eg=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){this.patStr=e.pat_str;const n=e.bpe_ranks.split("\n").filter(Boolean).reduce((e,t)=>{const[n,r,...i]=t.split(" "),s=Number.parseInt(r,10);return i.forEach((t,n)=>e[t]=s+n),e},{});for(const[e,t]of Object.entries(n)){const n=Bf.toByteArray(e);this.rankMap.set(n.join(","),t),this.textMap.set(t,n)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,n])=>(e[n]=this.textEncoder.encode(t),e),{})}encode(e,t=[],n="all"){const r=new RegExp(this.patStr,"ug"),i=eg.specialTokenRegex(Object.keys(this.specialTokens)),s=[],a=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===n?Object.keys(this.specialTokens).filter(e=>!a.has(e)):n);if(o.size>0){const t=eg.specialTokenRegex([...o]),n=e.match(t);if(null!=n)throw new Error(`The text contains a special token that is not allowed: ${n[0]}`)}let c=0;for(;;){let t=null,n=c;for(;i.lastIndex=n,t=i.exec(e),null!=t&&!a.has(t[0]);)n=t.index+1;const o=t?.index??e.length;for(const t of e.substring(c,o).matchAll(r)){const e=this.textEncoder.encode(t[0]),n=this.rankMap.get(e.join(","));null==n?s.push(...Xf(e,this.rankMap)):s.push(n)}if(null==t)break;let l=this.specialTokens[t[0]];s.push(l),c=t.index+t[0].length}return s}decode(e){const t=[];let n=0;for(let r=0;r<e.length;++r){const i=e[r],s=this.textMap.get(i)??this.inverseSpecialTokens[i];null!=s&&(t.push(s),n+=s.length)}const r=new Uint8Array(n);let i=0;for(const e of t)r.set(e,i),i+=e.length;return this.textDecoder.decode(r)}},tg=eg;Qf=e=>new RegExp(e.map(e=>function(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}(e)).join("|"),"g"),((e,t,n)=>{t in e?Yf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(tg,"specialTokenRegex"+"",Qf);const ng={},rg=new mm({});async function ig(e){return async function(e){return e in ng||(ng[e]=rg.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then(e=>e.json()).then(e=>new tg(e)).catch(t=>{throw delete ng[e],t})),await ng[e]}(function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}(e))}function sg(e){return!("object"!=typeof e||!e)&&!!("type"in e&&"function"===e.type&&"function"in e&&"object"==typeof e.function&&e.function&&"name"in e.function&&"parameters"in e.function)}class ag extends gf{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??!1,this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class og extends ag{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){const{cache:r,...i}=n;super({callbacks:e??t,...i}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache="object"==typeof r?r:r?Uf.global():void 0,this.caller=new mm(n??{})}async getNumTokens(e){if("string"!=typeof e)return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await ig("modelName"in this?(n=this.modelName,n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n.startsWith("gpt-4o")?"gpt-4o":n):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}var n;if(this._encoding)try{t=this._encoding.encode(e).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return t}static _convertInputToPromptValue(e){return"string"==typeof e?new Ff(e):Array.isArray(e)?new zf(e.map(ec)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()},r=Object.entries(n).filter(([e,t])=>void 0!==t),i=r.map(([e,t])=>`${e}:${JSON.stringify(t)}`).sort().join(",");return i}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class cg extends gf{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const n=Kh(t);return this.func&&await this.func(e,n),this._callWithConfig(e=>Promise.resolve(e),e,n)}async*transform(e,t){const n=Kh(t);let r,i=!0;for await(const t of this._transformStreamWithConfig(e,e=>e,n))if(yield t,i)if(void 0===r)r=t;else try{r=Xh(r,t)}catch{r=void 0,i=!1}this.func&&void 0!==r&&await this.func(r,n)}static assign(e){return new Af(new _f({steps:e}))}}function lg(e){if(!e)return!1;if("object"!=typeof e)return!1;if(Array.isArray(e))return!1;const t=e;if(t._def)return!0;return!!Object.values(Pl).includes(t.constructor?.name??"NOT_INCLUDED")||"function"==typeof t.parse&&"function"==typeof t.parseAsync&&"function"==typeof t.safeParse&&"function"==typeof t.safeParseAsync}function ug(e){const t=[];for(const n of e){let e=n;if(Array.isArray(n.content))for(let t=0;t<n.content.length;t++){const r=n.content[t];(xo(r)||Eo(r))&&e===n&&(e=new n.constructor({...e,content:[...n.content.slice(0,t),So(r),...n.content.slice(t+1)]}))}t.push(e)}return t}class dg extends og{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[t,n]=super._separateRunnableConfigFromCallOptions(e);return n.signal=t.signal,[t,n]}async invoke(e,t){const n=dg._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===dg.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{const n=dg._convertInputToPromptValue(e).toChatMessages(),[r,i]=this._separateRunnableConfigFromCallOptionsCompat(t),s={...r.metadata,...this.getLsParams(i)},a=await Uh.configure(r.callbacks,this.callbacks,r.tags,this.tags,s,this.metadata,{verbose:this.verbose}),o={options:i,invocation_params:this?.invocationParams(i),batch_size:1},c=await(a?.handleChatModelStart(this.toJSON(),[ug(n)],r.runId,void 0,o,void 0,void 0,r.runName));let l,u;try{for await(const e of this._streamResponseChunks(n,i,c?.[0])){if(null==e.message.id){const t=c?.at(0)?.runId;null!=t&&e.message._updateId(`run-${t}`)}e.message.response_metadata={...e.generationInfo,...e.message.response_metadata},yield e.message,l=l?l.concat(e):e,Fo(e.message)&&void 0!==e.message.usage_metadata&&(u={tokenUsage:{promptTokens:e.message.usage_metadata.input_tokens,completionTokens:e.message.usage_metadata.output_tokens,totalTokens:e.message.usage_metadata.total_tokens}})}}catch(e){throw await Promise.all((c??[]).map(t=>t?.handleLLMError(e))),e}await Promise.all((c??[]).map(e=>e?.handleLLMEnd({generations:[[l]],llmOutput:u})))}}getLsParams(e){const t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,n,r){const i=e.map(e=>e.map(ec));let s;if(void 0!==r&&r.length===i.length)s=r;else{const e={...n.metadata,...this.getLsParams(t)},r=await Uh.configure(n.callbacks,this.callbacks,n.tags,this.tags,e,this.metadata,{verbose:this.verbose}),a={options:t,invocation_params:this?.invocationParams(t),batch_size:1};s=await(r?.handleChatModelStart(this.toJSON(),i.map(ug),n.runId,void 0,a,void 0,void 0,n.runName))}const a=[],o=[];if(!!s?.[0].handlers.find(ju)&&!this.disableStreaming&&1===i.length&&this._streamResponseChunks!==dg.prototype._streamResponseChunks)try{const e=await this._streamResponseChunks(i[0],t,s?.[0]);let n,r;for await(const t of e){if(null==t.message.id){const e=s?.at(0)?.runId;null!=e&&t.message._updateId(`run-${e}`)}n=void 0===n?t:Xh(n,t),Fo(t.message)&&void 0!==t.message.usage_metadata&&(r={tokenUsage:{promptTokens:t.message.usage_metadata.input_tokens,completionTokens:t.message.usage_metadata.output_tokens,totalTokens:t.message.usage_metadata.total_tokens}})}if(void 0===n)throw new Error("Received empty response from chat model call.");a.push([n]),await(s?.[0].handleLLMEnd({generations:a,llmOutput:r}))}catch(e){throw await(s?.[0].handleLLMError(e)),e}else{const e=await Promise.allSettled(i.map((e,n)=>this._generate(e,{...t,promptIndex:n},s?.[n])));await Promise.all(e.map(async(e,t)=>{if("fulfilled"===e.status){const n=e.value;for(const e of n.generations){if(null==e.message.id){const t=s?.at(0)?.runId;null!=t&&e.message._updateId(`run-${t}`)}e.message.response_metadata={...e.generationInfo,...e.message.response_metadata}}return 1===n.generations.length&&(n.generations[0].message.response_metadata={...n.llmOutput,...n.generations[0].message.response_metadata}),a[t]=n.generations,o[t]=n.llmOutput,s?.[t]?.handleLLMEnd({generations:[n.generations],llmOutput:n.llmOutput})}return await(s?.[t]?.handleLLMError(e.reason)),Promise.reject(e.reason)}))}const c={generations:a,llmOutput:o.length?this._combineLLMOutput?.(...o):void 0};return Object.defineProperty(c,am,{value:s?{runIds:s?.map(e=>e.runId)}:void 0,configurable:!0}),c}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:r,handledOptions:i}){const s=e.map(e=>e.map(ec)),a={...i.metadata,...this.getLsParams(r)},o=await Uh.configure(i.callbacks,this.callbacks,i.tags,this.tags,a,this.metadata,{verbose:this.verbose}),c={options:r,invocation_params:this?.invocationParams(r),batch_size:1},l=await(o?.handleChatModelStart(this.toJSON(),s.map(ug),i.runId,void 0,c,void 0,void 0,i.runName)),u=[],d=await Promise.allSettled(s.map(async(e,r)=>{const i=dg._convertInputToPromptValue(e).toString(),s=await t.lookup(i,n);return null==s&&u.push(r),s})),p=d.map((e,t)=>({result:e,runManager:l?.[t]})).filter(({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status),h=[];await Promise.all(p.map(async({result:e,runManager:t},n)=>{if("fulfilled"===e.status){const r=e.value;return h[n]=r.map(e=>("message"in e&&No(e.message)&&Mo(e.message)&&(e.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),e.generationInfo={...e.generationInfo,tokenUsage:{}},e)),r.length&&await(t?.handleLLMNewToken(r[0].text)),t?.handleLLMEnd({generations:[r]},void 0,void 0,void 0,{cached:!0})}return await(t?.handleLLMError(e.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(e.reason)}));const m={generations:h,missingPromptIndices:u,startedRunManagers:l};return Object.defineProperty(m,am,{value:l?{runIds:l?.map(e=>e.runId)}:void 0,configurable:!0}),m}async generate(e,t,n){let r;r=Array.isArray(t)?{stop:t}:t;const i=e.map(e=>e.map(ec)),[s,a]=this._separateRunnableConfigFromCallOptionsCompat(r);if(s.callbacks=s.callbacks??n,!this.cache)return this._generateUncached(i,a,s);const{cache:o}=this,c=this._getSerializedCacheKeyParametersForCall(a),{generations:l,missingPromptIndices:u,startedRunManagers:d}=await this._generateCached({messages:i,cache:o,llmStringKey:c,parsedOptions:a,handledOptions:s});let p={};if(u.length>0){const e=await this._generateUncached(u.map(e=>i[e]),a,s,void 0!==d?u.map(e=>d?.[e]):void 0);await Promise.all(e.generations.map(async(e,t)=>{const n=u[t];l[n]=e;const r=dg._convertInputToPromptValue(i[n]).toString();return o.update(r,c,e)})),p=e.llmOutput??{}}return{generations:l,llmOutput:p}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){const r=e.map(e=>e.toChatMessages());return this.generate(r,t,n)}async call(e,t,n){return(await this.generate([e.map(ec)],t,n)).generations[0][0].message}async callPrompt(e,t,n){const r=e.toChatMessages();return this.call(r,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){const r=new Ho(e),i=await this.call([r],t,n);if("string"!=typeof i.content)throw new Error("Cannot use predict when output is not a string.");return i.content}withStructuredOutput(e,t){if("function"!=typeof this.bindTools)throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t?.strict)throw new Error('"strict" mode is not supported for this model by default.');const n=e,r=t?.name,i=n.description??"A function available to call.",s=t?.method,a=t?.includeRaw;if("jsonMode"===s)throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let o,c=r??"extract";lg(n)?o=[{type:"function",function:{name:c,description:i,parameters:tf(n)}}]:("name"in n&&(c=n.name),o=[{type:"function",function:{name:c,description:i,parameters:n}}]);const l=this.bindTools(o),u=Ef.from(e=>{if(!e.tool_calls||0===e.tool_calls.length)throw new Error("No tool calls found in the response.");const t=e.tool_calls.find(e=>e.name===c);if(!t)throw new Error(`No tool call found with name ${c}.`);return t.args});if(!a)return l.pipe(u).withConfig({runName:"StructuredOutput"});const d=cg.assign({parsed:(e,t)=>u.invoke(e.raw,t)}),p=cg.assign({parsed:()=>null}),h=d.withFallbacks({fallbacks:[p]});return wf.from([{raw:l},h]).withConfig({runName:"StructuredOutputRunnable"})}}const pg=e=>({setHttpHandler(t){e.httpHandler=t},httpHandler:()=>e.httpHandler,updateHttpClientConfig(t,n){e.httpHandler?.updateHttpClientConfig(t,n)},httpHandlerConfigs:()=>e.httpHandler.httpHandlerConfigs()}),hg=e=>({httpHandler:e.httpHandler()});var mg,fg,gg,yg,vg;!function(e){e.HEADER="header",e.QUERY="query"}(mg||(mg={})),function(e){e.HEADER="header",e.QUERY="query"}(fg||(fg={})),function(e){e.HTTP="http",e.HTTPS="https"}(gg||(gg={})),function(e){e.MD5="md5",e.CRC32="crc32",e.CRC32C="crc32c",e.SHA1="sha1",e.SHA256="sha256"}(yg||(yg={})),function(e){e[e.HEADER=0]="HEADER",e[e.TRAILER=1]="TRAILER"}(vg||(vg={}));const bg="__smithy_context";var wg,_g;!function(e){e.PROFILE="profile",e.SSO_SESSION="sso-session",e.SERVICES="services"}(wg||(wg={})),function(e){e.HTTP_0_9="http/0.9",e.HTTP_1_0="http/1.0",e.TDS_8_0="tds/8.0"}(_g||(_g={}));class xg{constructor(e){this.method=e.method||"GET",this.hostname=e.hostname||"localhost",this.port=e.port,this.query=e.query||{},this.headers=e.headers||{},this.body=e.body,this.protocol=e.protocol?":"!==e.protocol.slice(-1)?`${e.protocol}:`:e.protocol:"https:",this.path=e.path?"/"!==e.path.charAt(0)?`/${e.path}`:e.path:"/",this.username=e.username,this.password=e.password,this.fragment=e.fragment}static clone(e){const t=new xg({...e,headers:{...e.headers}});var n;return t.query&&(t.query=(n=t.query,Object.keys(n).reduce((e,t)=>{const r=n[t];return{...e,[t]:Array.isArray(r)?[...r]:r}},{}))),t}static isInstance(e){if(!e)return!1;const t=e;return"method"in t&&"protocol"in t&&"hostname"in t&&"path"in t&&"object"==typeof t.query&&"object"==typeof t.headers}clone(){return xg.clone(this)}}class Eg{constructor(e){this.statusCode=e.statusCode,this.reason=e.reason,this.headers=e.headers||{},this.body=e.body}static isInstance(e){if(!e)return!1;const t=e;return"number"==typeof t.statusCode&&"object"==typeof t.headers}}const Sg={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},kg=e=>({applyToStack:t=>{t.add((e=>t=>async n=>{if(!xg.isInstance(n.request))return t(n);const{request:r}=n,{handlerProtocol:i=""}=e.requestHandler.metadata||{};if(i.indexOf("h2")>=0&&!r.headers[":authority"])delete r.headers.host,r.headers[":authority"]=r.hostname+(r.port?":"+r.port:"");else if(!r.headers.host){let e=r.hostname;null!=r.port&&(e+=`:${r.port}`),r.headers.host=e}return t(n)})(e),Sg)}}),Ag={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},Og=e=>({applyToStack:e=>{e.add((e,t)=>async n=>{try{const r=await e(n),{clientName:i,commandName:s,logger:a,dynamoDbDocumentClientOptions:o={}}=t,{overrideInputFilterSensitiveLog:c,overrideOutputFilterSensitiveLog:l}=o,u=c??t.inputFilterSensitiveLog,d=l??t.outputFilterSensitiveLog,{$metadata:p,...h}=r.output;return a?.info?.({clientName:i,commandName:s,input:u(n.input),output:d(h),metadata:p}),r}catch(e){const{clientName:r,commandName:i,logger:s,dynamoDbDocumentClientOptions:a={}}=t,{overrideInputFilterSensitiveLog:o}=a,c=o??t.inputFilterSensitiveLog;throw s?.error?.({clientName:r,commandName:i,input:c(n.input),error:e,metadata:e.$metadata}),e}},Ag)}}),Cg="X-Amzn-Trace-Id",Ig={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},Tg=e=>({applyToStack:t=>{t.add((e=>t=>async n=>{const{request:r}=n;if(!xg.isInstance(r)||"node"!==e.runtime)return t(n);const i=Object.keys(r.headers??{}).find(e=>e.toLowerCase()===Cg.toLowerCase())??Cg;if(r.headers.hasOwnProperty(i))return t(n);const s=process.env.AWS_LAMBDA_FUNCTION_NAME,a=process.env._X_AMZN_TRACE_ID,o=e=>"string"==typeof e&&e.length>0;return o(s)&&o(a)&&(r.headers[Cg]=a),t({...n,request:r})})(e),Ig)}}),Pg=e=>e[bg]||(e[bg]={}),Rg=e=>{if("function"==typeof e)return e;const t=Promise.resolve(e);return()=>t};const jg=(e,t)=>(n,r)=>async i=>{const s=((e,t)=>{if(!t||0===t.length)return e;const n=[];for(const r of t)for(const t of e)t.schemeId.split("#")[1]===r&&n.push(t);for(const t of e)n.find(({schemeId:e})=>e===t.schemeId)||n.push(t);return n})(e.httpAuthSchemeProvider(await t.httpAuthSchemeParametersProvider(e,r,i.input)),e.authSchemePreference?await e.authSchemePreference():[]),a=function(e){const t=new Map;for(const n of e)t.set(n.schemeId,n);return t}(e.httpAuthSchemes),o=Pg(r),c=[];for(const n of s){const i=a.get(n.schemeId);if(!i){c.push(`HttpAuthScheme \`${n.schemeId}\` was not enabled for this service.`);continue}const s=i.identityProvider(await t.identityProviderConfigProvider(e));if(!s){c.push(`HttpAuthScheme \`${n.schemeId}\` did not have an IdentityProvider configured.`);continue}const{identityProperties:l={},signingProperties:u={}}=n.propertiesExtractor?.(e,r)||{};n.identityProperties=Object.assign(n.identityProperties||{},l),n.signingProperties=Object.assign(n.signingProperties||{},u),o.selectedHttpAuthScheme={httpAuthOption:n,identity:await s(n.identityProperties),signer:i.signer};break}if(!o.selectedHttpAuthScheme)throw new Error(c.join("\n"));return n(i)},Ng={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},$g=(e,{httpAuthSchemeParametersProvider:t,identityProviderConfigProvider:n})=>({applyToStack:r=>{r.addRelativeTo(jg(e,{httpAuthSchemeParametersProvider:t,identityProviderConfigProvider:n}),Ng)}}),Lg=(e,t)=>(t.find(([t])=>t.match(e))||[void 0,void 0])[1],Dg={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},Ug={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function Mg(e,t,n){return{applyToStack:r=>{r.add(((e,t)=>(n,r)=>async i=>{const{response:s}=await n(i);try{return{response:s,output:await t(s,e)}}catch(e){if(Object.defineProperty(e,"$response",{value:s}),!("$metadata"in e)){const t="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";try{e.message+="\n  "+t}catch(e){r.logger&&"NoOpLogger"!==r.logger?.constructor?.name?r.logger?.warn?.(t):console.warn(t)}void 0!==e.$responseBodyText&&e.$response&&(e.$response.body=e.$responseBodyText);try{if(Eg.isInstance(s)){const{headers:t={}}=s,n=Object.entries(t);e.$metadata={httpStatusCode:s.statusCode,requestId:Lg(/^x-[\w-]+-request-?id$/,n),extendedRequestId:Lg(/^x-[\w-]+-id-2$/,n),cfId:Lg(/^x-[\w-]+-cf-id$/,n)}}}catch(e){}}throw e}})(e,n),Dg),r.add(((e,t)=>(n,r)=>async i=>{const s=e,a=r.endpointV2?.url&&s.urlParser?async()=>s.urlParser(r.endpointV2.url):s.endpoint;if(!a)throw new Error("No valid endpoint provider available.");const o=await t(i.input,{...e,endpoint:a});return n({...i,request:o})})(e,t),Ug)}}}const Fg=e=>e=>{throw e},zg=(e,t)=>{},Bg={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},qg=e=>({applyToStack:e=>{e.addRelativeTo((e,t)=>async n=>{if(!xg.isInstance(n.request))return e(n);const r=Pg(t).selectedHttpAuthScheme;if(!r)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:i={}},identity:s,signer:a}=r,o=await e({...n,request:await a.sign(n.request,s,i)}).catch((a.errorHandler||Fg)(i));return(a.successHandler||zg)(o.response,i),o},Bg)}}),Wg=e=>{if("function"==typeof e)return e;const t=Promise.resolve(e);return()=>t},Hg=e=>"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(e),Kg=(e,t=0,n=e.byteLength-t)=>{if(!Hg(e))throw new TypeError(`The "input" argument must be ArrayBuffer. Received type ${typeof e} (${e})`);return $.from(e,t,n)},Gg=(e,t)=>{if("string"!=typeof e)throw new TypeError(`The "input" argument must be of type string. Received type ${typeof e} (${e})`);return t?$.from(e,t):$.from(e)},Vg=/^[A-Za-z0-9+/]*={0,2}$/,Zg=e=>{if(3*e.length%4!=0)throw new TypeError("Incorrect padding on base64 string.");if(!Vg.exec(e))throw new TypeError("Invalid base64 string.");const t=Gg(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)},Jg=e=>{const t=Gg(e,"utf8");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT)},Yg=e=>"string"==typeof e?Jg(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e),Xg=e=>{if("string"==typeof e)return e;if("object"!=typeof e||"number"!=typeof e.byteOffset||"number"!=typeof e.byteLength)throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return Kg(e.buffer,e.byteOffset,e.byteLength).toString("utf8")},Qg=e=>{let t;if(t="string"==typeof e?Jg(e):e,"object"!=typeof t||"number"!=typeof t.byteOffset||"number"!=typeof t.byteLength)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");return Kg(t.buffer,t.byteOffset,t.byteLength).toString("base64")};class ey extends Uint8Array{static fromString(e,t="utf-8"){if("string"==typeof e)return function(e,t){return"base64"===t?ey.mutate(Zg(e)):ey.mutate(Jg(e))}(e,t);throw new Error(`Unsupported conversion from ${typeof e} to Uint8ArrayBlobAdapter.`)}static mutate(e){return Object.setPrototypeOf(e,ey.prototype),e}transformToString(e="utf-8"){return function(e,t="utf-8"){return"base64"===t?Qg(e):Xg(e)}(this,e)}}const ty=e=>"function"==typeof ReadableStream&&(e?.constructor?.name===ReadableStream.name||e instanceof ReadableStream),ny=e=>encodeURIComponent(e).replace(/[!'()*]/g,ry),ry=e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`;function iy(e){const t=[];for(let n of Object.keys(e).sort()){const r=e[n];if(n=ny(n),Array.isArray(r))for(let e=0,i=r.length;e<i;e++)t.push(`${n}=${ny(r[e])}`);else{let e=n;(r||"string"==typeof r)&&(e+=`=${ny(r)}`),t.push(e)}}return t.join("&")}const sy=["ECONNRESET","EPIPE","ETIMEDOUT"],ay=e=>{const t={};for(const n of Object.keys(e)){const r=e[n];t[n]=Array.isArray(r)?r.join(","):r}return t},oy=(e,t)=>setTimeout(e,t),cy=e=>clearTimeout(e);async function ly(e,t,n=6e3){const i=t.headers??{},s=i.Expect||i.expect;let a=-1,o=!0;"100-continue"===s&&(o=await Promise.race([new Promise(e=>{a=Number(oy(()=>e(!0),Math.max(6e3,n)))}),new Promise(t=>{e.on("continue",()=>{cy(a),t(!0)}),e.on("response",()=>{cy(a),t(!1)}),e.on("error",()=>{cy(a),t(!1)})})])),o&&function(e,t){if(t instanceof r)return void t.pipe(e);if(t){if(Buffer.isBuffer(t)||"string"==typeof t)return void e.end(t);const n=t;return"object"==typeof n&&n.buffer&&"number"==typeof n.byteOffset&&"number"==typeof n.byteLength?void e.end(Buffer.from(n.buffer,n.byteOffset,n.byteLength)):void e.end(Buffer.from(t))}e.end()}(e,t.body)}const uy=0;class dy{static create(e){return"function"==typeof e?.handle?e:new dy(e)}static checkSocketUsage(e,t,n=console){const{sockets:r,requests:i,maxSockets:s}=e;if("number"!=typeof s||s===1/0)return t;if(Date.now()-15e3<t)return t;if(r&&i)for(const e in r){const t=r[e]?.length??0,a=i[e]?.length??0;if(t>=s&&a>=2*s)return n?.warn?.(`@smithy/node-http-handler:WARN - socket usage at capacity=${t} and ${a} additional requests are enqueued.\nSee https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/node-configuring-maxsockets.html\nor increase socketAcquisitionWarningTimeout=(millis) in the NodeHttpHandler config.`),Date.now()}return t}constructor(e){this.socketWarningTimestamp=0,this.metadata={handlerProtocol:"http/1.1"},this.configProvider=new Promise((t,n)=>{"function"==typeof e?e().then(e=>{t(this.resolveDefaultConfig(e))}).catch(n):t(this.resolveDefaultConfig(e))})}resolveDefaultConfig(e){const{requestTimeout:t,connectionTimeout:n,socketTimeout:r,socketAcquisitionWarningTimeout:i,httpAgent:s,httpsAgent:a}=e||{},o=!0;return{connectionTimeout:n,requestTimeout:t??r,socketAcquisitionWarningTimeout:i,httpAgent:s instanceof p||"function"==typeof s?.destroy?s:new p({keepAlive:o,maxSockets:50,...s}),httpsAgent:a instanceof f||"function"==typeof a?.destroy?a:new f({keepAlive:o,maxSockets:50,...a}),logger:console}}destroy(){this.config?.httpAgent?.destroy(),this.config?.httpsAgent?.destroy()}async handle(e,{abortSignal:t,requestTimeout:n}={}){return this.config||(this.config=await this.configProvider),new Promise((r,i)=>{let s;const a=[],o=async e=>{await s,a.forEach(cy),i(e)};if(!this.config)throw new Error("Node HTTP request handler config is not resolved");if(t?.aborted){const e=new Error("Request aborted");return e.name="AbortError",void o(e)}const c="https:"===e.protocol,l=c?this.config.httpsAgent:this.config.httpAgent;a.push(oy(()=>{this.socketWarningTimestamp=dy.checkSocketUsage(l,this.socketWarningTimestamp,this.config.logger)},this.config.socketAcquisitionWarningTimeout??(this.config.requestTimeout??2e3)+(this.config.connectionTimeout??1e3)));const u=iy(e.query||{});let d;if(null!=e.username||null!=e.password){d=`${e.username??""}:${e.password??""}`}let p=e.path;u&&(p+=`?${u}`),e.fragment&&(p+=`#${e.fragment}`);let m=e.hostname??"";m="["===m[0]&&m.endsWith("]")?e.hostname.slice(1,-1):e.hostname;const f={headers:e.headers,host:m,method:e.method,path:p,port:e.port,agent:l,auth:d},y=(c?g:h)(f,e=>{(async e=>{await s,a.forEach(cy),r(e)})({response:new Eg({statusCode:e.statusCode||-1,reason:e.statusMessage,headers:ay(e.headers),body:e})})});if(y.on("error",e=>{sy.includes(e.code)?o(Object.assign(e,{name:"TimeoutError"})):o(e)}),t){const e=()=>{y.destroy();const e=new Error("Request aborted");e.name="AbortError",o(e)};if("function"==typeof t.addEventListener){const n=t;n.addEventListener("abort",e,{once:!0}),y.once("close",()=>n.removeEventListener("abort",e))}else t.onabort=e}const v=n??this.config.requestTimeout;a.push(((e,t,n=0)=>{if(!n)return-1;const r=r=>{const i=oy(()=>{e.destroy(),t(Object.assign(new Error(`Socket timed out without establishing a connection within ${n} ms`),{name:"TimeoutError"}))},n-r),s=e=>{e?.connecting?e.on("connect",()=>{cy(i)}):cy(i)};e.socket?s(e.socket):e.on("socket",s)};return n<2e3?(r(0),0):oy(r.bind(null,1e3),1e3)})(y,o,this.config.connectionTimeout)),a.push(((e,t,n=uy)=>{const r=r=>{const i=n-r,s=()=>{e.destroy(),t(Object.assign(new Error(`Connection timed out after ${n} ms`),{name:"TimeoutError"}))};e.socket?(e.socket.setTimeout(i,s),e.on("close",()=>e.socket?.removeListener("timeout",s))):e.setTimeout(i,s)};return 0<n&&n<6e3?(r(0),0):oy(r.bind(null,0===n?0:3e3),3e3)})(y,o,v));const b=f.agent;"object"==typeof b&&"keepAlive"in b&&a.push(((e,{keepAlive:t,keepAliveMsecs:n},r=3e3)=>{if(!0!==t)return-1;const i=()=>{e.socket?e.socket.setKeepAlive(t,n||0):e.on("socket",e=>{e.setKeepAlive(t,n||0)})};return 0===r?(i(),0):oy(i,r)})(y,{keepAlive:b.keepAlive,keepAliveMsecs:b.keepAliveMsecs})),s=ly(y,e,v).catch(e=>(a.forEach(cy),i(e)))})}updateHttpClientConfig(e,t){this.config=void 0,this.configProvider=this.configProvider.then(n=>({...n,[e]:t}))}httpHandlerConfigs(){return this.config??{}}}class py{constructor(e){this.sessions=[],this.sessions=e??[]}poll(){if(this.sessions.length>0)return this.sessions.shift()}offerLast(e){this.sessions.push(e)}contains(e){return this.sessions.includes(e)}remove(e){this.sessions=this.sessions.filter(t=>t!==e)}[Symbol.iterator](){return this.sessions[Symbol.iterator]()}destroy(e){for(const t of this.sessions)t===e&&(t.destroyed||t.destroy())}}class hy{constructor(e){if(this.sessionCache=new Map,this.config=e,this.config.maxConcurrency&&this.config.maxConcurrency<=0)throw new RangeError("maxConcurrency must be greater than zero.")}lease(e,t){const n=this.getUrlString(e),r=this.sessionCache.get(n);if(r){const e=r.poll();if(e&&!this.config.disableConcurrency)return e}const i=L.connect(n);this.config.maxConcurrency&&i.settings({maxConcurrentStreams:this.config.maxConcurrency},t=>{if(t)throw new Error("Fail to set maxConcurrentStreams to "+this.config.maxConcurrency+"when creating new session for "+e.destination.toString())}),i.unref();const s=()=>{i.destroy(),this.deleteSession(n,i)};i.on("goaway",s),i.on("error",s),i.on("frameError",s),i.on("close",()=>this.deleteSession(n,i)),t.requestTimeout&&i.setTimeout(t.requestTimeout,s);const a=this.sessionCache.get(n)||new py;return a.offerLast(i),this.sessionCache.set(n,a),i}deleteSession(e,t){const n=this.sessionCache.get(e);n&&n.contains(t)&&(n.remove(t),this.sessionCache.set(e,n))}release(e,t){const n=this.getUrlString(e);this.sessionCache.get(n)?.offerLast(t)}destroy(){for(const[e,t]of this.sessionCache){for(const e of t)e.destroyed||e.destroy(),t.remove(e);this.sessionCache.delete(e)}}setMaxConcurrentStreams(e){if(e&&e<=0)throw new RangeError("maxConcurrentStreams must be greater than zero.");this.config.maxConcurrency=e}setDisableConcurrentStreams(e){this.config.disableConcurrency=e}getUrlString(e){return e.destination.toString()}}class my{static create(e){return"function"==typeof e?.handle?e:new my(e)}constructor(e){this.metadata={handlerProtocol:"h2"},this.connectionManager=new hy({}),this.configProvider=new Promise((t,n)=>{"function"==typeof e?e().then(e=>{t(e||{})}).catch(n):t(e||{})})}destroy(){this.connectionManager.destroy()}async handle(e,{abortSignal:t,requestTimeout:n}={}){this.config||(this.config=await this.configProvider,this.connectionManager.setDisableConcurrentStreams(this.config.disableConcurrentStreams||!1),this.config.maxConcurrentStreams&&this.connectionManager.setMaxConcurrentStreams(this.config.maxConcurrentStreams));const{requestTimeout:r,disableConcurrentStreams:i}=this.config,s=n??r;return new Promise((n,r)=>{let a,o=!1;const c=async e=>{await a,r(e)};if(t?.aborted){o=!0;const e=new Error("Request aborted");return e.name="AbortError",void c(e)}const{hostname:l,method:u,port:d,protocol:p,query:h}=e;let m="";if(null!=e.username||null!=e.password){m=`${e.username??""}:${e.password??""}@`}const f=`${p}//${m}${l}${d?`:${d}`:""}`,g={destination:new URL(f)},y=this.connectionManager.lease(g,{requestTimeout:this.config?.sessionTimeout,disableConcurrentStreams:i||!1}),v=e=>{i&&this.destroySession(y),o=!0,c(e)},b=iy(h||{});let w=e.path;b&&(w+=`?${b}`),e.fragment&&(w+=`#${e.fragment}`);const _=y.request({...e.headers,[D.HTTP2_HEADER_PATH]:w,[D.HTTP2_HEADER_METHOD]:u});if(y.ref(),_.on("response",e=>{const t=new Eg({statusCode:e[":status"]||-1,headers:ay(e),body:_});o=!0,(async e=>{await a,n(e)})({response:t}),i&&(y.close(),this.connectionManager.deleteSession(f,y))}),s&&_.setTimeout(s,()=>{_.close();const e=new Error(`Stream timed out because of no activity for ${s} ms`);e.name="TimeoutError",v(e)}),t){const e=()=>{_.close();const e=new Error("Request aborted");e.name="AbortError",v(e)};if("function"==typeof t.addEventListener){const n=t;n.addEventListener("abort",e,{once:!0}),_.once("close",()=>n.removeEventListener("abort",e))}else t.onabort=e}_.on("frameError",(e,t,n)=>{v(new Error(`Frame type id ${e} in stream id ${n} has failed with code ${t}.`))}),_.on("error",v),_.on("aborted",()=>{v(new Error(`HTTP/2 stream is abnormally aborted in mid-communication with result code ${_.rstCode}.`))}),_.on("close",()=>{y.unref(),i&&y.destroy(),o||v(new Error("Unexpected error: http2 request did not get a response"))}),a=ly(_,e,s)})}updateHttpClientConfig(e,t){this.config=void 0,this.configProvider=this.configProvider.then(n=>({...n,[e]:t}))}httpHandlerConfigs(){return this.config??{}}destroySession(e){e.destroyed||e.destroy()}}class fy extends i{constructor(){super(...arguments),this.bufferedBytes=[]}_write(e,t,n){this.bufferedBytes.push(e),n()}}const gy=e=>yy(e)?async function(e){const t=[],n=e.getReader();let r=!1,i=0;for(;!r;){const{done:e,value:s}=await n.read();s&&(t.push(s),i+=s.length),r=e}const s=new Uint8Array(i);let a=0;for(const e of t)s.set(e,a),a+=e.length;return s}(e):new Promise((t,n)=>{const r=new fy;e.pipe(r),e.on("error",e=>{r.end(),n(e)}),r.on("error",n),r.on("finish",function(){const e=new Uint8Array(Buffer.concat(this.bufferedBytes));t(e)})}),yy=e=>"function"==typeof ReadableStream&&e instanceof ReadableStream;const vy=async e=>"function"==typeof Blob&&e instanceof Blob||"Blob"===e.constructor?.name?void 0!==Blob.prototype.arrayBuffer?new Uint8Array(await e.arrayBuffer()):async function(e){const t=await function(e){return new Promise((t,n)=>{const r=new FileReader;r.onloadend=()=>{if(2!==r.readyState)return n(new Error("Reader aborted too early"));const e=r.result??"",i=e.indexOf(","),s=i>-1?i+1:e.length;t(e.substring(s))},r.onabort=()=>n(new Error("Read aborted")),r.onerror=()=>n(r.error),r.readAsDataURL(e)})}(e),n=Zg(t);return new Uint8Array(n)}(e):async function(e){const t=[],n=e.getReader();let r=!1,i=0;for(;!r;){const{done:e,value:s}=await n.read();s&&(t.push(s),i+=s.length),r=e}const s=new Uint8Array(i);let a=0;for(const e of t)s.set(e,a),a+=e.length;return s}(e);const by={},wy={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();1===t.length&&(t=`0${t}`),by[e]=t,wy[t]=e}function _y(e){if(e.length%2!=0)throw new Error("Hex encoded strings must have an even number length");const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2){const r=e.slice(n,n+2).toLowerCase();if(!(r in wy))throw new Error(`Cannot decode unrecognized sequence ${r} as hexadecimal`);t[n/2]=wy[r]}return t}function xy(e){let t="";for(let n=0;n<e.byteLength;n++)t+=by[e[n]];return t}const Ey="The stream has already been transformed.",Sy=e=>{if(!ky(e)&&!ty(e)){throw new Error(`Unexpected stream implementation, expect Blob or ReadableStream, got ${e?.__proto__?.constructor?.name||e}`)}let t=!1;const n=async()=>{if(t)throw new Error(Ey);return t=!0,await vy(e)};return Object.assign(e,{transformToByteArray:n,transformToString:async e=>{const t=await n();if("base64"===e)return Qg(t);if("hex"===e)return xy(t);if(void 0===e||"utf8"===e||"utf-8"===e)return Xg(t);if("function"==typeof TextDecoder)return new TextDecoder(e).decode(t);throw new Error("TextDecoder is not available, please make sure polyfill is provided.")},transformToWebStream:()=>{if(t)throw new Error(Ey);if(t=!0,ky(e))return(e=>{if("function"!=typeof e.stream)throw new Error("Cannot transform payload Blob to web stream. Please make sure the Blob.stream() is polyfilled.\nIf you are using React Native, this API is not yet supported, see: https://react-native.canny.io/feature-requests/p/fetch-streaming-body");return e.stream()})(e);if(ty(e))return e;throw new Error(`Cannot transform payload to web stream, got ${e}`)}})},ky=e=>"function"==typeof Blob&&e instanceof Blob,Ay="The stream has already been transformed.",Oy=e=>{if(!(e instanceof r))try{return Sy(e)}catch(t){throw new Error(`Unexpected stream implementation, expect Stream.Readable instance, got ${e?.__proto__?.constructor?.name||e}`)}let t=!1;const n=async()=>{if(t)throw new Error(Ay);return t=!0,await gy(e)};return Object.assign(e,{transformToByteArray:n,transformToString:async e=>{const t=await n();if(void 0===e||Buffer.isEncoding(e))return Kg(t.buffer,t.byteOffset,t.byteLength).toString(e);return new TextDecoder(e).decode(t)},transformToWebStream:()=>{if(t)throw new Error(Ay);if(null!==e.readableFlowing)throw new Error("The stream has been consumed by other callbacks.");if("function"!=typeof r.toWeb)throw new Error("Readable.toWeb() is not supported. Please ensure a polyfill is available.");return t=!0,r.toWeb(e)}})},Cy=async(e=new Uint8Array,t)=>{if(e instanceof Uint8Array)return ey.mutate(e);if(!e)return ey.mutate(new Uint8Array);const n=t.streamCollector(e);return ey.mutate(await n)};function Iy(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}const Ty=e=>{if(null!=e){if("number"==typeof e){if(0!==e&&1!==e||Zy.warn(Vy(`Expected boolean, got ${typeof e}: ${e}`)),0===e)return!1;if(1===e)return!0}if("string"==typeof e){const t=e.toLowerCase();if("false"!==t&&"true"!==t||Zy.warn(Vy(`Expected boolean, got ${typeof e}: ${e}`)),"false"===t)return!1;if("true"===t)return!0}if("boolean"==typeof e)return e;throw new TypeError(`Expected boolean, got ${typeof e}: ${e}`)}},Py=e=>{if(null!=e){if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return String(t)!==String(e)&&Zy.warn(Vy(`Expected number but observed string: ${e}`)),t}if("number"==typeof e)return e;throw new TypeError(`Expected number, got ${typeof e}: ${e}`)}},Ry=Math.ceil(2**127*(2-2**-23)),jy=e=>{const t=Py(e);if(void 0!==t&&!Number.isNaN(t)&&t!==1/0&&t!==-1/0&&Math.abs(t)>Ry)throw new TypeError(`Expected 32-bit float, got ${e}`);return t},Ny=e=>Dy(e,32),$y=e=>Dy(e,16),Ly=e=>Dy(e,8),Dy=(e,t)=>{const n=(e=>{if(null!=e){if(Number.isInteger(e)&&!Number.isNaN(e))return e;throw new TypeError(`Expected integer, got ${typeof e}: ${e}`)}})(e);if(void 0!==n&&Uy(n,t)!==n)throw new TypeError(`Expected ${t}-bit integer, got ${e}`);return n},Uy=(e,t)=>{switch(t){case 32:return Int32Array.of(e)[0];case 16:return Int16Array.of(e)[0];case 8:return Int8Array.of(e)[0]}},My=(e,t)=>{if(null==e){if(t)throw new TypeError(`Expected a non-null value for ${t}`);throw new TypeError("Expected a non-null value")}return e},Fy=e=>{if(null==e)return;if("object"==typeof e&&!Array.isArray(e))return e;const t=Array.isArray(e)?"array":typeof e;throw new TypeError(`Expected object, got ${t}: ${e}`)},zy=e=>{if(null!=e){if("string"==typeof e)return e;if(["boolean","number","bigint"].includes(typeof e))return Zy.warn(Vy(`Expected string, got ${typeof e}: ${e}`)),String(e);throw new TypeError(`Expected string, got ${typeof e}: ${e}`)}},By=/(-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)|(-?Infinity)|(NaN)/g,qy=e=>{const t=e.match(By);if(null===t||t[0].length!==e.length)throw new TypeError("Expected real number, got implicit NaN");return parseFloat(e)},Wy=e=>"string"==typeof e?Hy(e):Py(e),Hy=e=>{switch(e){case"NaN":return NaN;case"Infinity":return 1/0;case"-Infinity":return-1/0;default:throw new Error(`Unable to parse float value: ${e}`)}},Ky=e=>Ny("string"==typeof e?qy(e):e),Gy=e=>$y("string"==typeof e?qy(e):e),Vy=e=>String(new TypeError(e).stack||e).split("\n").slice(0,5).filter(e=>!e.includes("stackTraceWarning")).join("\n"),Zy={warn:console.warn},Jy=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Yy=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?[zZ]$/),Xy=e=>{if(null==e)return;if("string"!=typeof e)throw new TypeError("RFC-3339 date-times must be expressed as strings");const t=Yy.exec(e);if(!t)throw new TypeError("Invalid RFC-3339 date-time value");const[n,r,i,s,a,o,c,l]=t,u=Gy(cv(r)),d=sv(i,"month",1,12),p=sv(s,"day",1,31);return tv(u,d,p,{hours:a,minutes:o,seconds:c,fractionalMilliseconds:l})},Qy=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(([-+]\d{2}\:\d{2})|[zZ])$/),ev=e=>{if(null==e)return;if("string"!=typeof e)throw new TypeError("RFC-3339 date-times must be expressed as strings");const t=Qy.exec(e);if(!t)throw new TypeError("Invalid RFC-3339 date-time value");const[n,r,i,s,a,o,c,l,u]=t,d=Gy(cv(r)),p=sv(i,"month",1,12),h=sv(s,"day",1,31),m=tv(d,p,h,{hours:a,minutes:o,seconds:c,fractionalMilliseconds:l});return"Z"!=u.toUpperCase()&&m.setTime(m.getTime()-ov(u)),m},tv=(e,t,n,r)=>{const i=t-1;return rv(e,i,n),new Date(Date.UTC(e,i,n,sv(r.hours,"hour",0,23),sv(r.minutes,"minute",0,59),sv(r.seconds,"seconds",0,60),av(r.fractionalMilliseconds)))},nv=[31,28,31,30,31,30,31,31,30,31,30,31],rv=(e,t,n)=>{let r=nv[t];if(1===t&&iv(e)&&(r=29),n>r)throw new TypeError(`Invalid day for ${Jy[t]} in ${e}: ${n}`)},iv=e=>e%4==0&&(e%100!=0||e%400==0),sv=(e,t,n,r)=>{const i=(e=>Ly("string"==typeof e?qy(e):e))(cv(e));if(i<n||i>r)throw new TypeError(`${t} must be between ${n} and ${r}, inclusive`);return i},av=e=>null==e?0:1e3*(e=>jy("string"==typeof e?qy(e):e))("0."+e),ov=e=>{const t=e[0];let n=1;if("+"==t)n=1;else{if("-"!=t)throw new TypeError(`Offset direction, ${t}, must be "+" or "-"`);n=-1}return n*(60*Number(e.substring(1,3))+Number(e.substring(4,6)))*60*1e3},cv=e=>{let t=0;for(;t<e.length-1&&"0"===e.charAt(t);)t++;return 0===t?e:e.slice(t)};let lv;const uv=new Uint8Array(16);function dv(){if(!lv&&(lv="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!lv))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return lv(uv)}const pv=[];for(let e=0;e<256;++e)pv.push((e+256).toString(16).slice(1));var hv={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function mv(e,t,n){if(hv.randomUUID&&!e)return hv.randomUUID();const r=(e=e||{}).random||(e.rng||dv)();return r[6]=15&r[6]|64,r[8]=63&r[8]|128,function(e,t=0){return pv[e[t+0]]+pv[e[t+1]]+pv[e[t+2]]+pv[e[t+3]]+"-"+pv[e[t+4]]+pv[e[t+5]]+"-"+pv[e[t+6]]+pv[e[t+7]]+"-"+pv[e[t+8]]+pv[e[t+9]]+"-"+pv[e[t+10]]+pv[e[t+11]]+pv[e[t+12]]+pv[e[t+13]]+pv[e[t+14]]+pv[e[t+15]]}(r)}function fv(e,t){return new gv(e,t)}class gv{constructor(e,t){this.input=e,this.context=t,this.query={},this.method="",this.headers={},this.path="",this.body=null,this.hostname="",this.resolvePathStack=[]}async build(){const{hostname:e,protocol:t="https",port:n,path:r}=await this.context.endpoint();this.path=r;for(const e of this.resolvePathStack)e(this.path);return new xg({protocol:t,hostname:this.hostname||e,port:n,method:this.method,path:this.path,query:this.query,body:this.body,headers:this.headers})}hn(e){return this.hostname=e,this}bp(e){return this.resolvePathStack.push(t=>{this.path=`${t?.endsWith("/")?t.slice(0,-1):t||""}`+e}),this}p(e,t,n,r){return this.resolvePathStack.push(i=>{this.path=((e,t,n,r,i,s)=>{if(null==t||void 0===t[n])throw new Error("No value provided for input HTTP label: "+n+".");{const t=r();if(t.length<=0)throw new Error("Empty value provided for input HTTP label: "+n+".");e=e.replace(i,s?t.split("/").map(e=>Iy(e)).join("/"):Iy(t))}return e})(i,this.input,e,t,n,r)}),this}h(e){return this.headers=e,this}q(e){return this.query=e,this}b(e){return this.body=e,this}m(e){return this.method=e,this}}class yv{constructor(e){this.authSchemes=new Map;for(const[t,n]of Object.entries(e))void 0!==n&&this.authSchemes.set(t,n)}getIdentityProvider(e){return this.authSchemes.get(e)}}class vv{async sign(e,t,n){return e}}const bv=(wv=3e5,e=>_v(e)&&e.expiration.getTime()-Date.now()<wv);var wv;const _v=e=>void 0!==e.expiration,xv=(e,t,n)=>{if(void 0===e)return;const r="function"!=typeof e?async()=>Promise.resolve(e):e;let i,s,a,o=!1;const c=async e=>{s||(s=r(e));try{i=await s,a=!0,o=!1}finally{s=void 0}return i};return void 0===t?async e=>(a&&!e?.forceRefresh||(i=await c(e)),i):async e=>(a&&!e?.forceRefresh||(i=await c(e)),o?i:n(i)?t(i)?(await c(e),i):i:(o=!0,i))},Ev=void 0;function Sv(e){const t=Wg(e.userAgentAppId??Ev),{customUserAgent:n}=e;return Object.assign(e,{customUserAgent:"string"==typeof n?[[n]]:n,userAgentAppId:async()=>{const n=await t();if(!function(e){return void 0===e||"string"==typeof e&&e.length<=50}(n)){const t="NoOpLogger"!==e.logger?.constructor?.name&&e.logger?e.logger:console;"string"!=typeof n?t?.warn("userAgentAppId must be a string or undefined."):n.length>50&&t?.warn("The provided userAgentAppId exceeds the maximum length of 50 characters.")}return n}})}class kv{constructor({size:e,params:t}){this.data=new Map,this.parameters=[],this.capacity=e??50,t&&(this.parameters=t)}get(e,t){const n=this.hash(e);if(!1===n)return t();if(!this.data.has(n)){if(this.data.size>this.capacity+10){const e=this.data.keys();let t=0;for(;;){const{value:n,done:r}=e.next();if(this.data.delete(n),r||++t>10)break}}this.data.set(n,t())}return this.data.get(n)}size(){return this.data.size}hash(e){let t="";const{parameters:n}=this;if(0===n.length)return!1;for(const r of n){const n=String(e[r]??"");if(n.includes("|;"))return!1;t+=n+"|;"}return t}}const Av=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),Ov=e=>Av.test(e)||e.startsWith("[")&&e.endsWith("]"),Cv=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),Iv=(e,t=!1)=>{if(!t)return Cv.test(e);const n=e.split(".");for(const e of n)if(!Iv(e))return!1;return!0},Tv={},Pv="endpoints";function Rv(e){return"object"!=typeof e||null==e?e:"ref"in e?`$${Rv(e.ref)}`:"fn"in e?`${e.fn}(${(e.argv||[]).map(Rv).join(", ")})`:JSON.stringify(e,null,2)}class jv extends Error{constructor(e){super(e),this.name="EndpointError"}}const Nv=(e,t)=>(e=>{const t=e.split("."),n=[];for(const r of t){const t=r.indexOf("[");if(-1!==t){if(r.indexOf("]")!==r.length-1)throw new jv(`Path: '${e}' does not end with ']'`);const i=r.slice(t+1,-1);if(Number.isNaN(parseInt(i)))throw new jv(`Invalid array index: '${i}' in path: '${e}'`);0!==t&&n.push(r.slice(0,t)),n.push(i)}else n.push(r)}return n})(t).reduce((n,r)=>{if("object"!=typeof n)throw new jv(`Index '${r}' in '${t}' not found in '${JSON.stringify(e)}'`);return Array.isArray(n)?n[parseInt(r)]:n[r]},e),$v={[gg.HTTP]:80,[gg.HTTPS]:443},Lv={booleanEquals:(e,t)=>e===t,getAttr:Nv,isSet:e=>null!=e,isValidHostLabel:Iv,not:e=>!e,parseURL:e=>{const t=(()=>{try{if(e instanceof URL)return e;if("object"==typeof e&&"hostname"in e){const{hostname:t,port:n,protocol:r="",path:i="",query:s={}}=e,a=new URL(`${r}//${t}${n?`:${n}`:""}${i}`);return a.search=Object.entries(s).map(([e,t])=>`${e}=${t}`).join("&"),a}return new URL(e)}catch(e){return null}})();if(!t)return console.error(`Unable to parse ${JSON.stringify(e)} as a whatwg URL.`),null;const n=t.href,{host:r,hostname:i,pathname:s,protocol:a,search:o}=t;if(o)return null;const c=a.slice(0,-1);if(!Object.values(gg).includes(c))return null;const l=Ov(i);return{scheme:c,authority:`${r}${n.includes(`${r}:${$v[c]}`)||"string"==typeof e&&e.includes(`${r}:${$v[c]}`)?`:${$v[c]}`:""}`,path:s,normalizedPath:s.endsWith("/")?s:`${s}/`,isIp:l}},stringEquals:(e,t)=>e===t,substring:(e,t,n,r)=>t>=n||e.length<n?null:r?e.substring(e.length-n,e.length-t):e.substring(t,n),uriEncode:e=>encodeURIComponent(e).replace(/[!*'()]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)},Dv=(e,t)=>{const n=[],r={...t.endpointParams,...t.referenceRecord};let i=0;for(;i<e.length;){const t=e.indexOf("{",i);if(-1===t){n.push(e.slice(i));break}n.push(e.slice(i,t));const s=e.indexOf("}",t);if(-1===s){n.push(e.slice(t));break}"{"===e[t+1]&&"}"===e[s+1]&&(n.push(e.slice(t+1,s)),i=s+2);const a=e.substring(t+1,s);if(a.includes("#")){const[e,t]=a.split("#");n.push(Nv(r[e],t))}else n.push(r[a]);i=s+1}return n.join("")},Uv=(e,t,n)=>{if("string"==typeof e)return Dv(e,n);if(e.fn)return Mv(e,n);if(e.ref)return(({ref:e},t)=>({...t.endpointParams,...t.referenceRecord}[e]))(e,n);throw new jv(`'${t}': ${String(e)} is not a string, function or reference.`)},Mv=({fn:e,argv:t},n)=>{const r=t.map(e=>["boolean","number"].includes(typeof e)?e:Uv(e,"arg",n)),i=e.split(".");return i[0]in Tv&&null!=i[1]?Tv[i[0]][i[1]](...r):Lv[e](...r)},Fv=({assign:e,...t},n)=>{if(e&&e in n.referenceRecord)throw new jv(`'${e}' is already defined in Reference Record.`);const r=Mv(t,n);return n.logger?.debug?.(`${Pv} evaluateCondition: ${Rv(t)} = ${Rv(r)}`),{result:""===r||!!r,...null!=e&&{toAssign:{name:e,value:r}}}},zv=(e=[],t)=>{const n={};for(const r of e){const{result:e,toAssign:i}=Fv(r,{...t,referenceRecord:{...t.referenceRecord,...n}});if(!e)return{result:e};i&&(n[i.name]=i.value,t.logger?.debug?.(`${Pv} assign: ${i.name} := ${Rv(i.value)}`))}return{result:!0,referenceRecord:n}},Bv=(e,t)=>Object.entries(e).reduce((e,[n,r])=>({...e,[n]:r.map(e=>{const r=Uv(e,"Header value entry",t);if("string"!=typeof r)throw new jv(`Header '${n}' value '${r}' is not a string`);return r})}),{}),qv=(e,t)=>{if(Array.isArray(e))return e.map(e=>qv(e,t));switch(typeof e){case"string":return Dv(e,t);case"object":if(null===e)throw new jv(`Unexpected endpoint property: ${e}`);return Wv(e,t);case"boolean":return e;default:throw new jv("Unexpected endpoint property type: "+typeof e)}},Wv=(e,t)=>Object.entries(e).reduce((e,[n,r])=>({...e,[n]:qv(r,t)}),{}),Hv=(e,t)=>{const n=Uv(e,"Endpoint URL",t);if("string"==typeof n)try{return new URL(n)}catch(e){throw console.error(`Failed to construct URL with ${n}`,e),e}throw new jv("Endpoint URL must be a string, got "+typeof n)},Kv=(e,t)=>{const{conditions:n,endpoint:r}=e,{result:i,referenceRecord:s}=zv(n,t);if(!i)return;const a={...t,referenceRecord:{...t.referenceRecord,...s}},{url:o,properties:c,headers:l}=r;return t.logger?.debug?.(`${Pv} Resolving endpoint from template: ${Rv(r)}`),{...null!=l&&{headers:Bv(l,a)},...null!=c&&{properties:Wv(c,a)},url:Hv(o,a)}},Gv=(e,t)=>{const{conditions:n,error:r}=e,{result:i,referenceRecord:s}=zv(n,t);if(i)throw new jv(Uv(r,"Error",{...t,referenceRecord:{...t.referenceRecord,...s}}))},Vv=(e,t)=>{const{conditions:n,rules:r}=e,{result:i,referenceRecord:s}=zv(n,t);if(i)return Zv(r,{...t,referenceRecord:{...t.referenceRecord,...s}})},Zv=(e,t)=>{for(const n of e)if("endpoint"===n.type){const e=Kv(n,t);if(e)return e}else if("error"===n.type)Gv(n,t);else{if("tree"!==n.type)throw new jv(`Unknown endpoint rule: ${n}`);{const e=Vv(n,t);if(e)return e}}throw new jv("Rules evaluation failed")},Jv=(e,t)=>{const{endpointParams:n,logger:r}=t,{parameters:i,rules:s}=e;t.logger?.debug?.(`${Pv} Initial EndpointParams: ${Rv(n)}`);const a=Object.entries(i).filter(([,e])=>null!=e.default).map(([e,t])=>[e,t.default]);if(a.length>0)for(const[e,t]of a)n[e]=n[e]??t;const o=Object.entries(i).filter(([,e])=>e.required).map(([e])=>e);for(const e of o)if(null==n[e])throw new jv(`Missing required parameter: '${e}'`);const c=Zv(s,{endpointParams:n,logger:r,referenceRecord:{}});return t.logger?.debug?.(`${Pv} Resolved endpoint: ${Rv(c)}`),c},Yv=(e,t=!1)=>{if(t){for(const t of e.split("."))if(!Yv(t))return!1;return!0}return!!Iv(e)&&(!(e.length<3||e.length>63)&&(e===e.toLowerCase()&&!Ov(e)))};let Xv={partitions:[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il|mx)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"ap-southeast-5":{description:"Asia Pacific (Malaysia)"},"ap-southeast-7":{description:"Asia Pacific (Thailand)"},"aws-global":{description:"AWS Standard global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"mx-central-1":{description:"Mexico (Central)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"AWS China global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"AWS GovCloud (US) global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"c2s.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"AWS ISO (US) global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"sc2s.sgov.gov",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"AWS ISOB (US) global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"cloud.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{"aws-iso-e-global":{description:"AWS ISOE (Europe) global region"},"eu-isoe-west-1":{description:"EU ISOE West"}}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"csp.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{"aws-iso-f-global":{description:"AWS ISOF global region"},"us-isof-east-1":{description:"US ISOF EAST"},"us-isof-south-1":{description:"US ISOF SOUTH"}}},{id:"aws-eusc",outputs:{dnsSuffix:"amazonaws.eu",dualStackDnsSuffix:"amazonaws.eu",implicitGlobalRegion:"eusc-de-east-1",name:"aws-eusc",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eusc\\-(de)\\-\\w+\\-\\d+$",regions:{"eusc-de-east-1":{description:"EU (Germany)"}}}]};const Qv={isVirtualHostableS3Bucket:Yv,parseArn:e=>{const t=e.split(":");if(t.length<6)return null;const[n,r,i,s,a,...o]=t;if("arn"!==n||""===r||""===i||""===o.join(":"))return null;return{partition:r,service:i,region:s,accountId:a,resourceId:o.map(e=>e.split("/")).flat()}},partition:e=>{const{partitions:t}=Xv;for(const n of t){const{regions:t,outputs:r}=n;for(const[n,i]of Object.entries(t))if(n===e)return{...r,...i}}for(const n of t){const{regionRegex:t,outputs:r}=n;if(new RegExp(t).test(e))return{...r}}const n=t.find(e=>"aws"===e.id);if(!n)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...n.outputs}}};Tv.aws=Qv;const eb={warningEmitted:!1},tb=e=>{e&&!eb.warningEmitted&&parseInt(e.substring(1,e.indexOf(".")))<18&&(eb.warningEmitted=!0,process.emitWarning("NodeDeprecationWarning: The AWS SDK for JavaScript (v3) will\nno longer support Node.js 16.x on January 6, 2025.\n\nTo continue receiving updates to AWS services, bug fixes, and security\nupdates please upgrade to a supported Node.js LTS version.\n\nMore information can be found at: https://a.co/74kJMmI"))};function nb(e,t,n){return e.$source||(e.$source={}),e.$source[t]=n,e}function rb(e,t,n){e.__aws_sdk_context?e.__aws_sdk_context.features||(e.__aws_sdk_context.features={}):e.__aws_sdk_context={features:{}},e.__aws_sdk_context.features[t]=n}const ib=e=>Eg.isInstance(e)?e.headers?.date??e.headers?.Date:void 0,sb=e=>new Date(Date.now()+e),ab=(e,t)=>{const n=Date.parse(e);return((e,t)=>Math.abs(sb(t).getTime()-e)>=3e5)(n,t)?n-Date.now():t},ob=(e,t)=>{if(!t)throw new Error(`Property \`${e}\` is not resolved for AWS SDK SigV4Auth`);return t};let cb=class{async sign(e,t,n){if(!xg.isInstance(e))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const r=await(async e=>{const t=ob("context",e.context),n=ob("config",e.config),r=t.endpointV2?.properties?.authSchemes?.[0],i=ob("signer",n.signer),s=await i(r),a=e?.signingRegion,o=e?.signingRegionSet,c=e?.signingName;return{config:n,signer:s,signingRegion:a,signingRegionSet:o,signingName:c}})(n),{config:i,signer:s}=r;let{signingRegion:a,signingName:o}=r;const c=n.context;if(c?.authSchemes?.length){const[e,t]=c.authSchemes;"sigv4a"===e?.name&&"sigv4"===t?.name&&(a=t?.signingRegion??a,o=t?.signingName??o)}return await s.sign(e,{signingDate:sb(i.systemClockOffset),signingRegion:a,signingService:o})}errorHandler(e){return t=>{const n=t.ServerTime??ib(t.$response);if(n){const r=ob("config",e.config),i=r.systemClockOffset;r.systemClockOffset=ab(n,r.systemClockOffset);r.systemClockOffset!==i&&t.$metadata&&(t.$metadata.clockSkewCorrected=!0)}throw t}}successHandler(e,t){const n=ib(e);if(n){const e=ob("config",t.config);e.systemClockOffset=ab(n,e.systemClockOffset)}}};const lb=e=>"string"==typeof e&&e.length>0?e.split(",").map(e=>e.trim()):[],ub="AWS_AUTH_SCHEME_PREFERENCE",db="auth_scheme_preference",pb={environmentVariableSelector:(e,t)=>{if(t?.signingName){if(`AWS_BEARER_TOKEN_${t.signingName.replace(/[\s-]/g,"_").toUpperCase()}`in e)return["httpBearerAuth"]}if(ub in e)return lb(e[ub])},configFileSelector:e=>{if(db in e)return lb(e[db])},default:[]};class hb extends Error{constructor(e,t=!0){let n,r=!0;"boolean"==typeof t?(n=void 0,r=t):null!=t&&"object"==typeof t&&(n=t.logger,r=t.tryNextLink??!0),super(e),this.name="ProviderError",this.tryNextLink=r,Object.setPrototypeOf(this,hb.prototype),n?.debug?.(`@smithy/property-provider ${r?"->":"(!)"} ${e}`)}static from(e,t=!0){return Object.assign(new this(e.message,t),e)}}class mb extends hb{constructor(e,t=!0){super(e,t),this.name="CredentialsProviderError",Object.setPrototypeOf(this,mb.prototype)}}class fb extends hb{constructor(e,t=!0){super(e,t),this.name="TokenProviderError",Object.setPrototypeOf(this,fb.prototype)}}const gb=(...e)=>async()=>{if(0===e.length)throw new hb("No providers in chain");let t;for(const n of e)try{return await n()}catch(e){if(t=e,e?.tryNextLink)continue;throw e}throw t},yb=(e,t,n)=>{let r,i,s,a=!1;const o=async()=>{i||(i=e());try{r=await i,s=!0,a=!1}finally{i=void 0}return r};return void 0===t?async e=>(s&&!e?.forceRefresh||(r=await o()),r):async e=>(s&&!e?.forceRefresh||(r=await o()),a?r:n&&!n(r)?(a=!0,r):t(r)?(await o(),r):r)},vb="X-Amz-Date",bb="X-Amz-Signature",wb="X-Amz-Security-Token",_b="authorization",xb=vb.toLowerCase(),Eb=[_b,xb,"date"],Sb=bb.toLowerCase(),kb="x-amz-content-sha256",Ab=wb.toLowerCase(),Ob={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},Cb=/^proxy-/,Ib=/^sec-/,Tb="AWS4-HMAC-SHA256",Pb="AWS4-HMAC-SHA256-PAYLOAD",Rb="aws4_request",jb={},Nb=[],$b=(e,t,n)=>`${e}/${t}/${n}/${Rb}`,Lb=(e,t,n)=>{const r=new e(t);return r.update(Yg(n)),r.digest()},Db=({headers:e},t,n)=>{const r={};for(const i of Object.keys(e).sort()){if(null==e[i])continue;const s=i.toLowerCase();(s in Ob||t?.has(s)||Cb.test(s)||Ib.test(s))&&(!n||n&&!n.has(s))||(r[s]=e[i].trim().replace(/\s+/g," "))}return r},Ub=async({headers:e,body:t},n)=>{for(const t of Object.keys(e))if(t.toLowerCase()===kb)return e[t];if(null==t)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if("string"==typeof t||ArrayBuffer.isView(t)||Hg(t)){const e=new n;return e.update(Yg(t)),xy(await e.digest())}return"UNSIGNED-PAYLOAD"};class Mb{format(e){const t=[];for(const n of Object.keys(e)){const r=Jg(n);t.push(Uint8Array.from([r.byteLength]),r,this.formatHeaderValue(e[n]))}const n=new Uint8Array(t.reduce((e,t)=>e+t.byteLength,0));let r=0;for(const e of t)n.set(e,r),r+=e.byteLength;return n}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const t=new DataView(new ArrayBuffer(3));return t.setUint8(0,3),t.setInt16(1,e.value,!1),new Uint8Array(t.buffer);case"integer":const n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,e.value,!1),new Uint8Array(n.buffer);case"long":const r=new Uint8Array(9);return r[0]=5,r.set(e.value.bytes,1),r;case"binary":const i=new DataView(new ArrayBuffer(3+e.value.byteLength));i.setUint8(0,6),i.setUint16(1,e.value.byteLength,!1);const s=new Uint8Array(i.buffer);return s.set(e.value,3),s;case"string":const a=Jg(e.value),o=new DataView(new ArrayBuffer(3+a.byteLength));o.setUint8(0,7),o.setUint16(1,a.byteLength,!1);const c=new Uint8Array(o.buffer);return c.set(a,3),c;case"timestamp":const l=new Uint8Array(9);return l[0]=8,l.set(Bb.fromNumber(e.value.valueOf()).bytes,1),l;case"uuid":if(!zb.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);const u=new Uint8Array(17);return u[0]=9,u.set(_y(e.value.replace(/\-/g,"")),1),u}}}var Fb;!function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"}(Fb||(Fb={}));const zb=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;let Bb=class e{constructor(e){if(this.bytes=e,8!==e.byteLength)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(t){if(t>0x8000000000000000||t<-0x8000000000000000)throw new Error(`${t} is too large (or, if negative, too small) to represent as an Int64`);const n=new Uint8Array(8);for(let e=7,r=Math.abs(Math.round(t));e>-1&&r>0;e--,r/=256)n[e]=r;return t<0&&qb(n),new e(n)}valueOf(){const e=this.bytes.slice(0),t=128&e[0];return t&&qb(e),parseInt(xy(e),16)*(t?-1:1)}toString(){return String(this.valueOf())}};function qb(e){for(let t=0;t<8;t++)e[t]^=255;for(let t=7;t>-1&&(e[t]++,0===e[t]);t--);}const Wb=e=>{e=xg.clone(e);for(const t of Object.keys(e.headers))Eb.indexOf(t.toLowerCase())>-1&&delete e.headers[t];return e},Hb=e=>"number"==typeof e?new Date(1e3*e):"string"==typeof e?Number(e)?new Date(1e3*Number(e)):new Date(e):e;class Kb{constructor({applyChecksum:e,credentials:t,region:n,service:r,sha256:i,uriEscapePath:s=!0}){this.service=r,this.sha256=i,this.uriEscapePath=s,this.applyChecksum="boolean"!=typeof e||e,this.regionProvider=Rg(n),this.credentialProvider=Rg(t)}createCanonicalRequest(e,t,n){const r=Object.keys(t).sort();return`${e.method}\n${this.getCanonicalPath(e)}\n${(({query:e={}})=>{const t=[],n={};for(const r of Object.keys(e)){if(r.toLowerCase()===Sb)continue;const i=ny(r);t.push(i);const s=e[r];"string"==typeof s?n[i]=`${i}=${ny(s)}`:Array.isArray(s)&&(n[i]=s.slice(0).reduce((e,t)=>e.concat([`${i}=${ny(t)}`]),[]).sort().join("&"))}return t.sort().map(e=>n[e]).filter(e=>e).join("&")})(e)}\n${r.map(e=>`${e}:${t[e]}`).join("\n")}\n\n${r.join(";")}\n${n}`}async createStringToSign(e,t,n,r){const i=new this.sha256;i.update(Yg(n));return`${r}\n${e}\n${t}\n${xy(await i.digest())}`}getCanonicalPath({path:e}){if(this.uriEscapePath){const t=[];for(const n of e.split("/"))0!==n?.length&&"."!==n&&(".."===n?t.pop():t.push(n));const n=`${e?.startsWith("/")?"/":""}${t.join("/")}${t.length>0&&e?.endsWith("/")?"/":""}`;return ny(n).replace(/%2F/g,"/")}return e}validateResolvedCredentials(e){if("object"!=typeof e||"string"!=typeof e.accessKeyId||"string"!=typeof e.secretAccessKey)throw new Error("Resolved credential object is not valid")}formatDate(e){const t=(n=e,Hb(n).toISOString().replace(/\.\d{3}Z$/,"Z")).replace(/[\-:]/g,"");var n;return{longDate:t,shortDate:t.slice(0,8)}}getCanonicalHeaderList(e){return Object.keys(e).sort().join(";")}}class Gb extends Kb{constructor({applyChecksum:e,credentials:t,region:n,service:r,sha256:i,uriEscapePath:s=!0}){super({applyChecksum:e,credentials:t,region:n,service:r,sha256:i,uriEscapePath:s}),this.headerFormatter=new Mb}async presign(e,t={}){const{signingDate:n=new Date,expiresIn:r=3600,unsignableHeaders:i,unhoistableHeaders:s,signableHeaders:a,hoistableHeaders:o,signingRegion:c,signingService:l}=t,u=await this.credentialProvider();this.validateResolvedCredentials(u);const d=c??await this.regionProvider(),{longDate:p,shortDate:h}=this.formatDate(n);if(r>604800)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");const m=$b(h,d,l??this.service),f=((e,t={})=>{const{headers:n,query:r={}}=xg.clone(e);for(const e of Object.keys(n)){const i=e.toLowerCase();("x-amz-"===i.slice(0,6)&&!t.unhoistableHeaders?.has(i)||t.hoistableHeaders?.has(i))&&(r[e]=n[e],delete n[e])}return{...e,headers:n,query:r}})(Wb(e),{unhoistableHeaders:s,hoistableHeaders:o});u.sessionToken&&(f.query[wb]=u.sessionToken),f.query["X-Amz-Algorithm"]=Tb,f.query["X-Amz-Credential"]=`${u.accessKeyId}/${m}`,f.query[vb]=p,f.query["X-Amz-Expires"]=r.toString(10);const g=Db(f,i,a);return f.query["X-Amz-SignedHeaders"]=this.getCanonicalHeaderList(g),f.query[bb]=await this.getSignature(p,m,this.getSigningKey(u,d,h,l),this.createCanonicalRequest(f,g,await Ub(e,this.sha256))),f}async sign(e,t){return"string"==typeof e?this.signString(e,t):e.headers&&e.payload?this.signEvent(e,t):e.message?this.signMessage(e,t):this.signRequest(e,t)}async signEvent({headers:e,payload:t},{signingDate:n=new Date,priorSignature:r,signingRegion:i,signingService:s}){const a=i??await this.regionProvider(),{shortDate:o,longDate:c}=this.formatDate(n),l=$b(o,a,s??this.service),u=await Ub({headers:{},body:t},this.sha256),d=new this.sha256;d.update(e);const p=xy(await d.digest()),h=[Pb,c,l,r,p,u].join("\n");return this.signString(h,{signingDate:n,signingRegion:a,signingService:s})}async signMessage(e,{signingDate:t=new Date,signingRegion:n,signingService:r}){return this.signEvent({headers:this.headerFormatter.format(e.message.headers),payload:e.message.body},{signingDate:t,signingRegion:n,signingService:r,priorSignature:e.priorSignature}).then(t=>({message:e.message,signature:t}))}async signString(e,{signingDate:t=new Date,signingRegion:n,signingService:r}={}){const i=await this.credentialProvider();this.validateResolvedCredentials(i);const s=n??await this.regionProvider(),{shortDate:a}=this.formatDate(t),o=new this.sha256(await this.getSigningKey(i,s,a,r));return o.update(Yg(e)),xy(await o.digest())}async signRequest(e,{signingDate:t=new Date,signableHeaders:n,unsignableHeaders:r,signingRegion:i,signingService:s}={}){const a=await this.credentialProvider();this.validateResolvedCredentials(a);const o=i??await this.regionProvider(),c=Wb(e),{longDate:l,shortDate:u}=this.formatDate(t),d=$b(u,o,s??this.service);c.headers[xb]=l,a.sessionToken&&(c.headers[Ab]=a.sessionToken);const p=await Ub(c,this.sha256);!((e,t)=>{e=e.toLowerCase();for(const n of Object.keys(t))if(e===n.toLowerCase())return!0;return!1})(kb,c.headers)&&this.applyChecksum&&(c.headers[kb]=p);const h=Db(c,r,n),m=await this.getSignature(l,d,this.getSigningKey(a,o,u,s),this.createCanonicalRequest(c,h,p));return c.headers[_b]=`${Tb} Credential=${a.accessKeyId}/${d}, SignedHeaders=${this.getCanonicalHeaderList(h)}, Signature=${m}`,c}async getSignature(e,t,n,r){const i=await this.createStringToSign(e,t,r,Tb),s=new this.sha256(await n);return s.update(Yg(i)),xy(await s.digest())}getSigningKey(e,t,n,r){return(async(e,t,n,r,i)=>{const s=`${n}:${r}:${i}:${xy(await Lb(e,t.secretAccessKey,t.accessKeyId))}:${t.sessionToken}`;if(s in jb)return jb[s];for(Nb.push(s);Nb.length>50;)delete jb[Nb.shift()];let a=`AWS4${t.secretAccessKey}`;for(const t of[n,r,i,Rb])a=await Lb(e,a,t);return jb[s]=a})(this.sha256,e,n,t,r||this.service)}}const Vb=e=>{let t,n=e.credentials,r=!!e.credentials;Object.defineProperty(e,"credentials",{set(i){i&&i!==n&&i!==t&&(r=!0),n=i;const s=function(e,{credentials:t,credentialDefaultProvider:n}){let r;r=t?t?.memoized?t:xv(t,bv,_v):n?Wg(n(Object.assign({},e,{parentClientConfig:e}))):async()=>{throw new Error("@aws-sdk/core::resolveAwsSdkSigV4Config - `credentials` not provided and no credentialDefaultProvider was configured.")};return r.memoized=!0,r}(e,{credentials:n,credentialDefaultProvider:e.credentialDefaultProvider}),a=function(e,t){if(t.configBound)return t;const n=async n=>t({...n,callerClientConfig:e});return n.memoized=t.memoized,n.configBound=!0,n}(e,s);r&&!a.attributed?(t=async e=>a(e).then(e=>nb(e,"CREDENTIALS_CODE","e")),t.memoized=a.memoized,t.configBound=a.configBound,t.attributed=!0):t=a},get:()=>t,enumerable:!0,configurable:!0}),e.credentials=n;const{signingEscapePath:i=!0,systemClockOffset:s=e.systemClockOffset||0,sha256:a}=e;let o;o=e.signer?Wg(e.signer):e.regionInfoProvider?()=>Wg(e.region)().then(async t=>[await e.regionInfoProvider(t,{useFipsEndpoint:await e.useFipsEndpoint(),useDualstackEndpoint:await e.useDualstackEndpoint()})||{},t]).then(([t,n])=>{const{signingRegion:r,signingService:s}=t;e.signingRegion=e.signingRegion||r||n,e.signingName=e.signingName||s||e.serviceId;const o={...e,credentials:e.credentials,region:e.signingRegion,service:e.signingName,sha256:a,uriEscapePath:i};return new(e.signerConstructor||Gb)(o)}):async t=>{const n=(t=Object.assign({},{name:"sigv4",signingName:e.signingName||e.defaultSigningName,signingRegion:await Wg(e.region)(),properties:{}},t)).signingRegion,r=t.signingName;e.signingRegion=e.signingRegion||n,e.signingName=e.signingName||r||e.serviceId;const s={...e,credentials:e.credentials,region:e.signingRegion,service:e.signingName,sha256:a,uriEscapePath:i};return new(e.signerConstructor||Gb)(s)};return Object.assign(e,{systemClockOffset:s,signingEscapePath:i,signer:o})};const Zb=(e,t)=>{const n=[];if(e&&n.push(e),t)for(const e of t)n.push(e);return n},Jb=(e,t)=>`${e||"anonymous"}${t&&t.length>0?` (a.k.a. ${t.join(",")})`:""}`,Yb=()=>{let e=[],t=[],n=!1;const r=new Set,i=n=>(e.forEach(e=>{n.add(e.middleware,{...e})}),t.forEach(e=>{n.addRelativeTo(e.middleware,{...e})}),n.identifyOnResolve?.(o.identifyOnResolve()),n),s=e=>{const t=[];return e.before.forEach(e=>{0===e.before.length&&0===e.after.length?t.push(e):t.push(...s(e))}),t.push(e),e.after.reverse().forEach(e=>{0===e.before.length&&0===e.after.length?t.push(e):t.push(...s(e))}),t},a=(n=!1)=>{const r=[],i=[],a={};e.forEach(e=>{const t={...e,before:[],after:[]};for(const e of Zb(t.name,t.aliases))a[e]=t;r.push(t)}),t.forEach(e=>{const t={...e,before:[],after:[]};for(const e of Zb(t.name,t.aliases))a[e]=t;i.push(t)}),i.forEach(e=>{if(e.toMiddleware){const t=a[e.toMiddleware];if(void 0===t){if(n)return;throw new Error(`${e.toMiddleware} is not found when adding ${Jb(e.name,e.aliases)} middleware ${e.relation} ${e.toMiddleware}`)}"after"===e.relation&&t.after.push(e),"before"===e.relation&&t.before.push(e)}});const o=(c=r,c.sort((e,t)=>Xb[t.step]-Xb[e.step]||Qb[t.priority||"normal"]-Qb[e.priority||"normal"])).map(s).reduce((e,t)=>(e.push(...t),e),[]);var c;return o},o={add:(t,n={})=>{const{name:i,override:s,aliases:a}=n,o={step:"initialize",priority:"normal",middleware:t,...n},c=Zb(i,a);if(c.length>0){if(c.some(e=>r.has(e))){if(!s)throw new Error(`Duplicate middleware name '${Jb(i,a)}'`);for(const t of c){const n=e.findIndex(e=>e.name===t||e.aliases?.some(e=>e===t));if(-1===n)continue;const r=e[n];if(r.step!==o.step||o.priority!==r.priority)throw new Error(`"${Jb(r.name,r.aliases)}" middleware with ${r.priority} priority in ${r.step} step cannot be overridden by "${Jb(i,a)}" middleware with ${o.priority} priority in ${o.step} step.`);e.splice(n,1)}}for(const e of c)r.add(e)}e.push(o)},addRelativeTo:(e,n)=>{const{name:i,override:s,aliases:a}=n,o={middleware:e,...n},c=Zb(i,a);if(c.length>0){if(c.some(e=>r.has(e))){if(!s)throw new Error(`Duplicate middleware name '${Jb(i,a)}'`);for(const e of c){const n=t.findIndex(t=>t.name===e||t.aliases?.some(t=>t===e));if(-1===n)continue;const r=t[n];if(r.toMiddleware!==o.toMiddleware||r.relation!==o.relation)throw new Error(`"${Jb(r.name,r.aliases)}" middleware ${r.relation} "${r.toMiddleware}" middleware cannot be overridden by "${Jb(i,a)}" middleware ${o.relation} "${o.toMiddleware}" middleware.`);t.splice(n,1)}}for(const e of c)r.add(e)}t.push(o)},clone:()=>i(Yb()),use:e=>{e.applyToStack(o)},remove:n=>"string"==typeof n?(n=>{let i=!1;const s=e=>{const t=Zb(e.name,e.aliases);if(t.includes(n)){i=!0;for(const e of t)r.delete(e);return!1}return!0};return e=e.filter(s),t=t.filter(s),i})(n):(n=>{let i=!1;const s=e=>{if(e.middleware===n){i=!0;for(const t of Zb(e.name,e.aliases))r.delete(t);return!1}return!0};return e=e.filter(s),t=t.filter(s),i})(n),removeByTag:n=>{let i=!1;const s=e=>{const{tags:t,name:s,aliases:a}=e;if(t&&t.includes(n)){const e=Zb(s,a);for(const t of e)r.delete(t);return i=!0,!1}return!0};return e=e.filter(s),t=t.filter(s),i},concat:e=>{const t=i(Yb());return t.use(e),t.identifyOnResolve(n||t.identifyOnResolve()||(e.identifyOnResolve?.()??!1)),t},applyToStack:i,identify:()=>a(!0).map(e=>{const t=e.step??e.relation+" "+e.toMiddleware;return Jb(e.name,e.aliases)+" - "+t}),identifyOnResolve:e=>("boolean"==typeof e&&(n=e),n),resolve:(e,t)=>{for(const n of a().map(e=>e.middleware).reverse())e=n(e,t);return n&&console.log(o.identify()),e}};return o},Xb={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},Qb={high:3,normal:2,low:1};class ew{constructor(e){this.config=e,this.middlewareStack=Yb()}send(e,t,n){const r="function"!=typeof t?t:void 0,i="function"==typeof t?t:n;let s;if(void 0===r&&!0===this.config.cacheMiddleware){this.handlers||(this.handlers=new WeakMap);const t=this.handlers;t.has(e.constructor)?s=t.get(e.constructor):(s=e.resolveMiddleware(this.middlewareStack,this.config,r),t.set(e.constructor,s))}else delete this.handlers,s=e.resolveMiddleware(this.middlewareStack,this.config,r);if(!i)return s(e).then(e=>e.output);s(e).then(e=>i(null,e.output),e=>i(e)).catch(()=>{})}destroy(){this.config?.requestHandler?.destroy?.(),delete this.handlers}}class tw{constructor(){this.middlewareStack=Yb()}static classBuilder(){return new nw}resolveMiddlewareWithContext(e,t,n,{middlewareFn:r,clientName:i,commandName:s,inputFilterSensitiveLog:a,outputFilterSensitiveLog:o,smithyContext:c,additionalContext:l,CommandCtor:u}){for(const i of r.bind(this)(u,e,t,n))this.middlewareStack.use(i);const d=e.concat(this.middlewareStack),{logger:p}=t,h={logger:p,clientName:i,commandName:s,inputFilterSensitiveLog:a,outputFilterSensitiveLog:o,[bg]:{commandInstance:this,...c},...l},{requestHandler:m}=t;return d.resolve(e=>m.handle(e.request,n||{}),h)}}class nw{constructor(){this._init=()=>{},this._ep={},this._middlewareFn=()=>[],this._commandName="",this._clientName="",this._additionalContext={},this._smithyContext={},this._inputFilterSensitiveLog=e=>e,this._outputFilterSensitiveLog=e=>e,this._serializer=null,this._deserializer=null}init(e){this._init=e}ep(e){return this._ep=e,this}m(e){return this._middlewareFn=e,this}s(e,t,n={}){return this._smithyContext={service:e,operation:t,...n},this}c(e={}){return this._additionalContext=e,this}n(e,t){return this._clientName=e,this._commandName=t,this}f(e=e=>e,t=e=>e){return this._inputFilterSensitiveLog=e,this._outputFilterSensitiveLog=t,this}ser(e){return this._serializer=e,this}de(e){return this._deserializer=e,this}sc(e){return this._operationSchema=e,this._smithyContext.operationSchema=e,this}build(){const e=this;let t;return t=class extends tw{static getEndpointParameterInstructions(){return e._ep}constructor(...[t]){super(),this.serialize=e._serializer,this.deserialize=e._deserializer,this.input=t??{},e._init(this),this.schema=e._operationSchema}resolveMiddleware(n,r,i){return this.resolveMiddlewareWithContext(n,r,i,{CommandCtor:t,middlewareFn:e._middlewareFn,clientName:e._clientName,commandName:e._commandName,inputFilterSensitiveLog:e._inputFilterSensitiveLog,outputFilterSensitiveLog:e._outputFilterSensitiveLog,smithyContext:e._smithyContext,additionalContext:e._additionalContext})}}}}const rw="***SensitiveInformation***",iw=(e,t)=>{for(const n of Object.keys(e)){const r=e[n],i=async function(e,t,n){const i=new r(e);if("function"==typeof t)this.send(i,t);else{if("function"!=typeof n)return this.send(i,t);if("object"!=typeof t)throw new Error("Expected http options but got "+typeof t);this.send(i,t||{},n)}},s=(n[0].toLowerCase()+n.slice(1)).replace(/Command$/,"");t.prototype[s]=i}};class sw extends Error{constructor(e){super(e.message),Object.setPrototypeOf(this,Object.getPrototypeOf(this).constructor.prototype),this.name=e.name,this.$fault=e.$fault,this.$metadata=e.$metadata}static isInstance(e){if(!e)return!1;const t=e;return sw.prototype.isPrototypeOf(t)||Boolean(t.$fault)&&Boolean(t.$metadata)&&("client"===t.$fault||"server"===t.$fault)}static[Symbol.hasInstance](e){if(!e)return!1;const t=e;return this===sw?sw.isInstance(e):!!sw.isInstance(e)&&(t.name&&this.name?this.prototype.isPrototypeOf(e)||t.name===this.name:this.prototype.isPrototypeOf(e))}}const aw=(e,t={})=>{Object.entries(t).filter(([,e])=>void 0!==e).forEach(([t,n])=>{null!=e[t]&&""!==e[t]||(e[t]=n)});const n=e.message||e.Message||"UnknownError";return e.message=n,delete e.Message,e},ow=e=>({output:t,parsedBody:n,errorCode:r})=>{(({output:e,parsedBody:t,exceptionCtor:n,errorCode:r})=>{const i=cw(e),s=i.httpStatusCode?i.httpStatusCode+"":void 0,a=new n({name:t?.code||t?.Code||r||s||"UnknownError",$fault:"client",$metadata:i});throw aw(a,t)})({output:t,parsedBody:n,exceptionCtor:e,errorCode:r})},cw=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),lw=e=>{switch(e){case"standard":case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}};let uw=!1;const dw=e=>{e&&!uw&&parseInt(e.substring(1,e.indexOf(".")))<16&&(uw=!0)},pw=e=>Object.assign((e=>{const t=[];for(const n in yg){const r=yg[n];void 0!==e[r]&&t.push({algorithmId:()=>r,checksumConstructor:()=>e[r]})}return{addChecksumAlgorithm(e){t.push(e)},checksumAlgorithms:()=>t}})(e),(e=>({setRetryStrategy(t){e.retryStrategy=t},retryStrategy:()=>e.retryStrategy}))(e)),hw=e=>Object.assign((e=>{const t={};return e.checksumAlgorithms().forEach(e=>{t[e.algorithmId()]=e.checksumConstructor()}),t})(e),(e=>{const t={};return t.retryStrategy=e.retryStrategy(),t})(e)),mw=e=>{const t="#text";for(const n in e)e.hasOwnProperty(n)&&void 0!==e[n][t]?e[n]=e[n][t]:"object"==typeof e[n]&&null!==e[n]&&(e[n]=mw(e[n]));return e},fw=e=>null!=e;class gw{trace(){}debug(){}info(){}warn(){}error(){}}function yw(e,t,n){let r,i,s;if(void 0===t&&void 0===n)r={},s=e;else{if(r=e,"function"==typeof t)return i=t,s=n,bw(r,i,s);s=t}for(const e of Object.keys(s))Array.isArray(s[e])?ww(r,null,s,e):r[e]=s[e];return r}const vw=(e,t)=>{const n={};for(const r in t)ww(n,e,t,r);return n},bw=(e,t,n)=>yw(e,Object.entries(n).reduce((e,[n,r])=>(Array.isArray(r)?e[n]=r:e[n]="function"==typeof r?[t,r()]:[t,r],e),{})),ww=(e,t,n,r)=>{if(null!==t){let i=n[r];"function"==typeof i&&(i=[,i]);const[s=_w,a=xw,o=r]=i;return void(("function"==typeof s&&s(t[o])||"function"!=typeof s&&s)&&(e[r]=a(t[o])))}let[i,s]=n[r];if("function"==typeof s){let t;const n=void 0===i&&null!=(t=s()),a="function"==typeof i&&!!i(void 0)||"function"!=typeof i&&!!i;n?e[r]=t:a&&(e[r]=s())}else{const t=void 0===i&&null!=s,n="function"==typeof i&&!!i(s)||"function"!=typeof i&&!!i;(t||n)&&(e[r]=s)}},_w=e=>null!=e,xw=e=>e,Ew=e=>{if(e!=e)return"NaN";switch(e){case 1/0:return"Infinity";case-1/0:return"-Infinity";default:return e}},Sw=e=>{if(null==e)return{};if(Array.isArray(e))return e.filter(e=>null!=e).map(Sw);if("object"==typeof e){const t={};for(const n of Object.keys(e))null!=e[n]&&(t[n]=Sw(e[n]));return t}return e},kw=e=>{if(null!=e)return"object"==typeof e&&"__type"in e&&delete e.__type,(e=>{if(null==e)return;const t=Fy(e),n=Object.entries(t).filter(([,e])=>null!=e).map(([e])=>e);if(0===n.length)throw new TypeError("Unions must have exactly one non-null member. None were found.");if(n.length>1)throw new TypeError(`Unions must have exactly one non-null member. Keys ${n} were not null.`);return t})(e)},Aw=(e,t)=>Cy(e,t).then(e=>t.utf8Encoder(e)),Ow=(e,t)=>Aw(e,t).then(e=>{if(e.length)try{return JSON.parse(e)}catch(t){throw"SyntaxError"===t?.name&&Object.defineProperty(t,"$responseBodyText",{value:e}),t}return{}}),Cw=async(e,t)=>{const n=await Ow(e,t);return n.message=n.message??n.Message,n},Iw=(e,t)=>{const n=(e,t)=>Object.keys(e).find(e=>e.toLowerCase()===t.toLowerCase()),r=e=>{let t=e;return"number"==typeof t&&(t=t.toString()),t.indexOf(",")>=0&&(t=t.split(",")[0]),t.indexOf(":")>=0&&(t=t.split(":")[0]),t.indexOf("#")>=0&&(t=t.split("#")[1]),t},i=n(e.headers,"x-amzn-errortype");if(void 0!==i)return r(e.headers[i]);if(t&&"object"==typeof t){const e=n(t,"code");if(e&&void 0!==t[e])return r(t[e]);if(void 0!==t.__type)return r(t.__type)}};var Tw={},Pw={};!function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n="["+t+"]["+(t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040")+"]*",r=new RegExp("^"+n+"$");e.isExist=function(e){return void 0!==e},e.isEmptyObject=function(e){return 0===Object.keys(e).length},e.merge=function(e,t,n){if(t){const r=Object.keys(t),i=r.length;for(let s=0;s<i;s++)e[r[s]]="strict"===n?[t[r[s]]]:t[r[s]]}},e.getValue=function(t){return e.isExist(t)?t:""},e.isName=function(e){const t=r.exec(e);return!(null==t)},e.getAllMatches=function(e,t){const n=[];let r=t.exec(e);for(;r;){const i=[];i.startIndex=t.lastIndex-r[0].length;const s=r.length;for(let e=0;e<s;e++)i.push(r[e]);n.push(i),r=t.exec(e)}return n},e.nameRegexp=n}(Pw);const Rw=Pw,jw={allowBooleanAttributes:!1,unpairedTags:[]};function Nw(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function $w(e,t){const n=t;for(;t<e.length;t++)if("?"==e[t]||" "==e[t]){const r=e.substr(n,t-n);if(t>5&&"xml"===r)return qw("InvalidXml","XML declaration allowed only at the start of the document.",Kw(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}continue}return t}function Lw(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let n=1;for(t+=8;t<e.length;t++)if("<"===e[t])n++;else if(">"===e[t]&&(n--,0===n))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}Tw.validate=function(e,t){t=Object.assign({},jw,t);const n=[];let r=!1,i=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let s=0;s<e.length;s++)if("<"===e[s]&&"?"===e[s+1]){if(s+=2,s=$w(e,s),s.err)return s}else{if("<"!==e[s]){if(Nw(e[s]))continue;return qw("InvalidChar","char '"+e[s]+"' is not expected.",Kw(e,s))}{let a=s;if(s++,"!"===e[s]){s=Lw(e,s);continue}{let o=!1;"/"===e[s]&&(o=!0,s++);let c="";for(;s<e.length&&">"!==e[s]&&" "!==e[s]&&"\t"!==e[s]&&"\n"!==e[s]&&"\r"!==e[s];s++)c+=e[s];if(c=c.trim(),"/"===c[c.length-1]&&(c=c.substring(0,c.length-1),s--),!Hw(c)){let t;return t=0===c.trim().length?"Invalid space after '<'.":"Tag '"+c+"' is an invalid name.",qw("InvalidTag",t,Kw(e,s))}const l=Mw(e,s);if(!1===l)return qw("InvalidAttr","Attributes for '"+c+"' have open quote.",Kw(e,s));let u=l.value;if(s=l.index,"/"===u[u.length-1]){const n=s-u.length;u=u.substring(0,u.length-1);const i=zw(u,t);if(!0!==i)return qw(i.err.code,i.err.msg,Kw(e,n+i.err.line));r=!0}else if(o){if(!l.tagClosed)return qw("InvalidTag","Closing tag '"+c+"' doesn't have proper closing.",Kw(e,s));if(u.trim().length>0)return qw("InvalidTag","Closing tag '"+c+"' can't have attributes or invalid starting.",Kw(e,a));if(0===n.length)return qw("InvalidTag","Closing tag '"+c+"' has not been opened.",Kw(e,a));{const t=n.pop();if(c!==t.tagName){let n=Kw(e,t.tagStartPos);return qw("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+n.line+", col "+n.col+") instead of closing tag '"+c+"'.",Kw(e,a))}0==n.length&&(i=!0)}}else{const o=zw(u,t);if(!0!==o)return qw(o.err.code,o.err.msg,Kw(e,s-u.length+o.err.line));if(!0===i)return qw("InvalidXml","Multiple possible root nodes found.",Kw(e,s));-1!==t.unpairedTags.indexOf(c)||n.push({tagName:c,tagStartPos:a}),r=!0}for(s++;s<e.length;s++)if("<"===e[s]){if("!"===e[s+1]){s++,s=Lw(e,s);continue}if("?"!==e[s+1])break;if(s=$w(e,++s),s.err)return s}else if("&"===e[s]){const t=Bw(e,s);if(-1==t)return qw("InvalidChar","char '&' is not expected.",Kw(e,s));s=t}else if(!0===i&&!Nw(e[s]))return qw("InvalidXml","Extra text at the end",Kw(e,s));"<"===e[s]&&s--}}}return r?1==n.length?qw("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",Kw(e,n[0].tagStartPos)):!(n.length>0)||qw("InvalidXml","Invalid '"+JSON.stringify(n.map(e=>e.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):qw("InvalidXml","Start tag expected.",1)};const Dw='"',Uw="'";function Mw(e,t){let n="",r="",i=!1;for(;t<e.length;t++){if(e[t]===Dw||e[t]===Uw)""===r?r=e[t]:r!==e[t]||(r="");else if(">"===e[t]&&""===r){i=!0;break}n+=e[t]}return""===r&&{value:n,index:t,tagClosed:i}}const Fw=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function zw(e,t){const n=Rw.getAllMatches(e,Fw),r={};for(let e=0;e<n.length;e++){if(0===n[e][1].length)return qw("InvalidAttr","Attribute '"+n[e][2]+"' has no space in starting.",Gw(n[e]));if(void 0!==n[e][3]&&void 0===n[e][4])return qw("InvalidAttr","Attribute '"+n[e][2]+"' is without value.",Gw(n[e]));if(void 0===n[e][3]&&!t.allowBooleanAttributes)return qw("InvalidAttr","boolean attribute '"+n[e][2]+"' is not allowed.",Gw(n[e]));const i=n[e][2];if(!Ww(i))return qw("InvalidAttr","Attribute '"+i+"' is an invalid name.",Gw(n[e]));if(r.hasOwnProperty(i))return qw("InvalidAttr","Attribute '"+i+"' is repeated.",Gw(n[e]));r[i]=1}return!0}function Bw(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let n=/\d/;for("x"===e[t]&&(t++,n=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(n))break}return-1}(e,++t);let n=0;for(;t<e.length;t++,n++)if(!(e[t].match(/\w/)&&n<20)){if(";"===e[t])break;return-1}return t}function qw(e,t,n){return{err:{code:e,msg:t,line:n.line||n,col:n.col}}}function Ww(e){return Rw.isName(e)}function Hw(e){return Rw.isName(e)}function Kw(e,t){const n=e.substring(0,t).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function Gw(e){return e.startIndex+e[1].length}var Vw={};const Zw={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,n){return e}};Vw.buildOptions=function(e){return Object.assign({},Zw,e)},Vw.defaultOptions=Zw;var Jw=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}};const Yw=Pw;function Xw(e,t){let n="";for(;t<e.length&&"'"!==e[t]&&'"'!==e[t];t++)n+=e[t];if(n=n.trim(),-1!==n.indexOf(" "))throw new Error("External entites are not supported");const r=e[t++];let i="";for(;t<e.length&&e[t]!==r;t++)i+=e[t];return[n,i,t]}function Qw(e,t){return"!"===e[t+1]&&"-"===e[t+2]&&"-"===e[t+3]}function e_(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7]}function t_(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8]}function n_(e,t){return"!"===e[t+1]&&"A"===e[t+2]&&"T"===e[t+3]&&"T"===e[t+4]&&"L"===e[t+5]&&"I"===e[t+6]&&"S"===e[t+7]&&"T"===e[t+8]}function r_(e,t){return"!"===e[t+1]&&"N"===e[t+2]&&"O"===e[t+3]&&"T"===e[t+4]&&"A"===e[t+5]&&"T"===e[t+6]&&"I"===e[t+7]&&"O"===e[t+8]&&"N"===e[t+9]}function i_(e){if(Yw.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}var s_=function(e,t){const n={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let r=1,i=!1,s=!1,a="";for(;t<e.length;t++)if("<"!==e[t]||s)if(">"===e[t]){if(s?"-"===e[t-1]&&"-"===e[t-2]&&(s=!1,r--):r--,0===r)break}else"["===e[t]?i=!0:a+=e[t];else{if(i&&e_(e,t))t+=7,[entityName,val,t]=Xw(e,t+1),-1===val.indexOf("&")&&(n[i_(entityName)]={regx:RegExp(`&${entityName};`,"g"),val:val});else if(i&&t_(e,t))t+=8;else if(i&&n_(e,t))t+=8;else if(i&&r_(e,t))t+=9;else{if(!Qw)throw new Error("Invalid DOCTYPE");s=!0}r++,a=""}if(0!==r)throw new Error("Unclosed DOCTYPE")}return{entities:n,i:t}};const a_=/^[-+]?0x[a-fA-F0-9]+$/,o_=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,c_={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};var l_=function(e,t={}){if(t=Object.assign({},c_,t),!e||"string"!=typeof e)return e;let n=e.trim();if(void 0!==t.skipLike&&t.skipLike.test(n))return e;if("0"===e)return 0;if(t.hex&&a_.test(n))return function(e,t){if(parseInt)return parseInt(e,t);if(Number.parseInt)return Number.parseInt(e,t);if(window&&window.parseInt)return window.parseInt(e,t);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}(n,16);if(-1!==n.search(/[eE]/)){const r=n.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(r){if(t.leadingZeros)n=(r[1]||"")+r[3];else if("0"!==r[2]||"."!==r[3][0])return e;return t.eNotation?Number(n):e}return e}{const r=o_.exec(n);if(r){const i=r[1],s=r[2];let a=function(e){if(e&&-1!==e.indexOf("."))return"."===(e=e.replace(/0+$/,""))?e="0":"."===e[0]?e="0"+e:"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),e;return e}(r[3]);if(!t.leadingZeros&&s.length>0&&i&&"."!==n[2])return e;if(!t.leadingZeros&&s.length>0&&!i&&"."!==n[1])return e;if(t.leadingZeros&&s===e)return 0;{const r=Number(n),o=""+r;return-1!==o.search(/[eE]/)?t.eNotation?r:e:-1!==n.indexOf(".")?"0"===o&&""===a||o===a||i&&o==="-"+a?r:e:s?a===o||i+a===o?r:e:n===o||n===i+o?r:e}}return e}};const u_=Pw,d_=Jw,p_=s_,h_=l_;function m_(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const r=t[n];this.lastEntities[r]={regex:new RegExp("&"+r+";","g"),val:e[r]}}}function f_(e,t,n,r,i,s,a){if(void 0!==e&&(this.options.trimValues&&!r&&(e=e.trim()),e.length>0)){a||(e=this.replaceEntitiesValue(e));const r=this.options.tagValueProcessor(t,e,n,i,s);if(null==r)return e;if(typeof r!=typeof e||r!==e)return r;if(this.options.trimValues)return O_(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?O_(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function g_(e){if(this.options.removeNSPrefix){const t=e.split(":"),n="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=n+t[1])}return e}const y_=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function v_(e,t,n){if(!this.options.ignoreAttributes&&"string"==typeof e){const n=u_.getAllMatches(e,y_),r=n.length,i={};for(let e=0;e<r;e++){const r=this.resolveNameSpace(n[e][1]);let s=n[e][4],a=this.options.attributeNamePrefix+r;if(r.length)if(this.options.transformAttributeName&&(a=this.options.transformAttributeName(a)),"__proto__"===a&&(a="#__proto__"),void 0!==s){this.options.trimValues&&(s=s.trim()),s=this.replaceEntitiesValue(s);const e=this.options.attributeValueProcessor(r,s,t);i[a]=null==e?s:typeof e!=typeof s||e!==s?e:O_(s,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[a]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=i,e}return i}}const b_=function(e){e=e.replace(/\r\n?/g,"\n");const t=new d_("!xml");let n=t,r="",i="";for(let s=0;s<e.length;s++){if("<"===e[s])if("/"===e[s+1]){const t=S_(e,">",s,"Closing Tag is not closed.");let a=e.substring(s+2,t).trim();if(this.options.removeNSPrefix){const e=a.indexOf(":");-1!==e&&(a=a.substr(e+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),n&&(r=this.saveTextToParentTag(r,n,i));const o=i.substring(i.lastIndexOf(".")+1);if(a&&-1!==this.options.unpairedTags.indexOf(a))throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let c=0;o&&-1!==this.options.unpairedTags.indexOf(o)?(c=i.lastIndexOf(".",i.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=i.lastIndexOf("."),i=i.substring(0,c),n=this.tagsNodeStack.pop(),r="",s=t}else if("?"===e[s+1]){let t=k_(e,s,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(r=this.saveTextToParentTag(r,n,i),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new d_(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,i,t.tagName)),this.addChild(n,e,i)}s=t.closeIndex+1}else if("!--"===e.substr(s+1,3)){const t=S_(e,"--\x3e",s+4,"Comment is not closed.");if(this.options.commentPropName){const a=e.substring(s+4,t-2);r=this.saveTextToParentTag(r,n,i),n.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}s=t}else if("!D"===e.substr(s+1,2)){const t=p_(e,s);this.docTypeEntities=t.entities,s=t.i}else if("!["===e.substr(s+1,2)){const t=S_(e,"]]>",s,"CDATA is not closed.")-2,a=e.substring(s+9,t);r=this.saveTextToParentTag(r,n,i);let o=this.parseTextData(a,n.tagname,i,!0,!1,!0,!0);null==o&&(o=""),this.options.cdataPropName?n.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]):n.add(this.options.textNodeName,o),s=t+2}else{let a=k_(e,s,this.options.removeNSPrefix),o=a.tagName;const c=a.rawTagName;let l=a.tagExp,u=a.attrExpPresent,d=a.closeIndex;this.options.transformTagName&&(o=this.options.transformTagName(o)),n&&r&&"!xml"!==n.tagname&&(r=this.saveTextToParentTag(r,n,i,!1));const p=n;if(p&&-1!==this.options.unpairedTags.indexOf(p.tagname)&&(n=this.tagsNodeStack.pop(),i=i.substring(0,i.lastIndexOf("."))),o!==t.tagname&&(i+=i?"."+o:o),this.isItStopNode(this.options.stopNodes,i,o)){let t="";if(l.length>0&&l.lastIndexOf("/")===l.length-1)"/"===o[o.length-1]?(o=o.substr(0,o.length-1),i=i.substr(0,i.length-1),l=o):l=l.substr(0,l.length-1),s=a.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(o))s=a.closeIndex;else{const n=this.readStopNodeData(e,c,d+1);if(!n)throw new Error(`Unexpected end of ${c}`);s=n.i,t=n.tagContent}const r=new d_(o);o!==l&&u&&(r[":@"]=this.buildAttributesMap(l,i,o)),t&&(t=this.parseTextData(t,o,i,!0,u,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),r.add(this.options.textNodeName,t),this.addChild(n,r,i)}else{if(l.length>0&&l.lastIndexOf("/")===l.length-1){"/"===o[o.length-1]?(o=o.substr(0,o.length-1),i=i.substr(0,i.length-1),l=o):l=l.substr(0,l.length-1),this.options.transformTagName&&(o=this.options.transformTagName(o));const e=new d_(o);o!==l&&u&&(e[":@"]=this.buildAttributesMap(l,i,o)),this.addChild(n,e,i),i=i.substr(0,i.lastIndexOf("."))}else{const e=new d_(o);this.tagsNodeStack.push(n),o!==l&&u&&(e[":@"]=this.buildAttributesMap(l,i,o)),this.addChild(n,e,i),n=e}r="",s=d}}else r+=e[s]}return t.child};function w_(e,t,n){const r=this.options.updateTag(t.tagname,n,t[":@"]);!1===r||("string"==typeof r?(t.tagname=r,e.addChild(t)):e.addChild(t))}const __=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const n=this.docTypeEntities[t];e=e.replace(n.regx,n.val)}for(let t in this.lastEntities){const n=this.lastEntities[t];e=e.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const n=this.htmlEntities[t];e=e.replace(n.regex,n.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function x_(e,t,n,r){return e&&(void 0===r&&(r=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,n,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,r))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function E_(e,t,n){const r="*."+n;for(const n in e){const i=e[n];if(r===i||t===i)return!0}return!1}function S_(e,t,n,r){const i=e.indexOf(t,n);if(-1===i)throw new Error(r);return i+t.length-1}function k_(e,t,n,r=">"){const i=function(e,t,n=">"){let r,i="";for(let s=t;s<e.length;s++){let t=e[s];if(r)t===r&&(r="");else if('"'===t||"'"===t)r=t;else if(t===n[0]){if(!n[1])return{data:i,index:s};if(e[s+1]===n[1])return{data:i,index:s}}else"\t"===t&&(t=" ");i+=t}}(e,t+1,r);if(!i)return;let s=i.data;const a=i.index,o=s.search(/\s/);let c=s,l=!0;-1!==o&&(c=s.substring(0,o),s=s.substring(o+1).trimStart());const u=c;if(n){const e=c.indexOf(":");-1!==e&&(c=c.substr(e+1),l=c!==i.data.substr(e+1))}return{tagName:c,tagExp:s,closeIndex:a,attrExpPresent:l,rawTagName:u}}function A_(e,t,n){const r=n;let i=1;for(;n<e.length;n++)if("<"===e[n])if("/"===e[n+1]){const s=S_(e,">",n,`${t} is not closed`);if(e.substring(n+2,s).trim()===t&&(i--,0===i))return{tagContent:e.substring(r,n),i:s};n=s}else if("?"===e[n+1]){n=S_(e,"?>",n+1,"StopNode is not closed.")}else if("!--"===e.substr(n+1,3)){n=S_(e,"--\x3e",n+3,"StopNode is not closed.")}else if("!["===e.substr(n+1,2)){n=S_(e,"]]>",n,"StopNode is not closed.")-2}else{const r=k_(e,n,">");if(r){(r&&r.tagName)===t&&"/"!==r.tagExp[r.tagExp.length-1]&&i++,n=r.closeIndex}}}function O_(e,t,n){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&h_(e,n)}return u_.isExist(e)?e:""}var C_=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,16))}},this.addExternalEntities=m_,this.parseXml=b_,this.parseTextData=f_,this.resolveNameSpace=g_,this.buildAttributesMap=v_,this.isItStopNode=E_,this.replaceEntitiesValue=__,this.readStopNodeData=A_,this.saveTextToParentTag=x_,this.addChild=w_}},I_={};function T_(e,t,n){let r;const i={};for(let s=0;s<e.length;s++){const a=e[s],o=P_(a);let c="";if(c=void 0===n?o:n+"."+o,o===t.textNodeName)void 0===r?r=a[o]:r+=""+a[o];else{if(void 0===o)continue;if(a[o]){let e=T_(a[o],t,c);const n=j_(e,t);a[":@"]?R_(e,a[":@"],c,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==i[o]&&i.hasOwnProperty(o)?(Array.isArray(i[o])||(i[o]=[i[o]]),i[o].push(e)):t.isArray(o,c,n)?i[o]=[e]:i[o]=e}}}return"string"==typeof r?r.length>0&&(i[t.textNodeName]=r):void 0!==r&&(i[t.textNodeName]=r),i}function P_(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function R_(e,t,n,r){if(t){const i=Object.keys(t),s=i.length;for(let a=0;a<s;a++){const s=i[a];r.isArray(s,n+"."+s,!0,!0)?e[s]=[t[s]]:e[s]=t[s]}}}function j_(e,t){const{textNodeName:n}=t,r=Object.keys(e).length;return 0===r||!(1!==r||!e[n]&&"boolean"!=typeof e[n]&&0!==e[n])}I_.prettify=function(e,t){return T_(e,t)};const{buildOptions:N_}=Vw,$_=C_,{prettify:L_}=I_,D_=Tw;var U_=class{constructor(e){this.externalEntities={},this.options=N_(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const n=D_.validate(e,t);if(!0!==n)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const n=new $_(this.options);n.addExternalEntities(this.externalEntities);const r=n.parseXml(e);return this.options.preserveOrder||void 0===r?r:L_(r,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}};function M_(e,t,n,r){let i="",s=!1;for(let a=0;a<e.length;a++){const o=e[a],c=F_(o);if(void 0===c)continue;let l="";if(l=0===n.length?c:`${n}.${c}`,c===t.textNodeName){let e=o[c];B_(l,t)||(e=t.tagValueProcessor(c,e),e=q_(e,t)),s&&(i+=r),i+=e,s=!1;continue}if(c===t.cdataPropName){s&&(i+=r),i+=`<![CDATA[${o[c][0][t.textNodeName]}]]>`,s=!1;continue}if(c===t.commentPropName){i+=r+`\x3c!--${o[c][0][t.textNodeName]}--\x3e`,s=!0;continue}if("?"===c[0]){const e=z_(o[":@"],t),n="?xml"===c?"":r;let a=o[c][0][t.textNodeName];a=0!==a.length?" "+a:"",i+=n+`<${c}${a}${e}?>`,s=!0;continue}let u=r;""!==u&&(u+=t.indentBy);const d=r+`<${c}${z_(o[":@"],t)}`,p=M_(o[c],t,l,u);-1!==t.unpairedTags.indexOf(c)?t.suppressUnpairedNode?i+=d+">":i+=d+"/>":p&&0!==p.length||!t.suppressEmptyNode?p&&p.endsWith(">")?i+=d+`>${p}${r}</${c}>`:(i+=d+">",p&&""!==r&&(p.includes("/>")||p.includes("</"))?i+=r+t.indentBy+p+r:i+=p,i+=`</${c}>`):i+=d+"/>",s=!0}return i}function F_(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const r=t[n];if(e.hasOwnProperty(r)&&":@"!==r)return r}}function z_(e,t){let n="";if(e&&!t.ignoreAttributes)for(let r in e){if(!e.hasOwnProperty(r))continue;let i=t.attributeValueProcessor(r,e[r]);i=q_(i,t),!0===i&&t.suppressBooleanAttributes?n+=` ${r.substr(t.attributeNamePrefix.length)}`:n+=` ${r.substr(t.attributeNamePrefix.length)}="${i}"`}return n}function B_(e,t){let n=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let r in t.stopNodes)if(t.stopNodes[r]===e||t.stopNodes[r]==="*."+n)return!0;return!1}function q_(e,t){if(e&&e.length>0&&t.processEntities)for(let n=0;n<t.entities.length;n++){const r=t.entities[n];e=e.replace(r.regex,r.val)}return e}const W_=function(e,t){let n="";return t.format&&t.indentBy.length>0&&(n="\n"),M_(e,t,"",n)},H_={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function K_(e){this.options=Object.assign({},H_,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=Z_),this.processTextOrObjNode=G_,this.options.format?(this.indentate=V_,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function G_(e,t,n){const r=this.j2x(e,n+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextValNode(e[this.options.textNodeName],t,r.attrStr,n):this.buildObjectNode(r.val,t,r.attrStr,n)}function V_(e){return this.options.indentBy.repeat(e)}function Z_(e){return!(!e.startsWith(this.options.attributeNamePrefix)||e===this.options.textNodeName)&&e.substr(this.attrPrefixLen)}K_.prototype.build=function(e){return this.options.preserveOrder?W_(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},K_.prototype.j2x=function(e,t){let n="",r="";for(let i in e)if(Object.prototype.hasOwnProperty.call(e,i))if(void 0===e[i])this.isAttribute(i)&&(r+="");else if(null===e[i])this.isAttribute(i)?r+="":"?"===i[0]?r+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+i+"/"+this.tagEndChar;else if(e[i]instanceof Date)r+=this.buildTextValNode(e[i],i,"",t);else if("object"!=typeof e[i]){const s=this.isAttribute(i);if(s)n+=this.buildAttrPairStr(s,""+e[i]);else if(i===this.options.textNodeName){let t=this.options.tagValueProcessor(i,""+e[i]);r+=this.replaceEntitiesValue(t)}else r+=this.buildTextValNode(e[i],i,"",t)}else if(Array.isArray(e[i])){const n=e[i].length;let s="",a="";for(let o=0;o<n;o++){const n=e[i][o];if(void 0===n);else if(null===n)"?"===i[0]?r+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+i+"/"+this.tagEndChar;else if("object"==typeof n)if(this.options.oneListGroup){const e=this.j2x(n,t+1);s+=e.val,this.options.attributesGroupName&&n.hasOwnProperty(this.options.attributesGroupName)&&(a+=e.attrStr)}else s+=this.processTextOrObjNode(n,i,t);else if(this.options.oneListGroup){let e=this.options.tagValueProcessor(i,n);e=this.replaceEntitiesValue(e),s+=e}else s+=this.buildTextValNode(n,i,"",t)}this.options.oneListGroup&&(s=this.buildObjectNode(s,i,a,t)),r+=s}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const t=Object.keys(e[i]),r=t.length;for(let s=0;s<r;s++)n+=this.buildAttrPairStr(t[s],""+e[i][t[s]])}else r+=this.processTextOrObjNode(e[i],i,t);return{attrStr:n,val:r}},K_.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'},K_.prototype.buildObjectNode=function(e,t,n,r){if(""===e)return"?"===t[0]?this.indentate(r)+"<"+t+n+"?"+this.tagEndChar:this.indentate(r)+"<"+t+n+this.closeTag(t)+this.tagEndChar;{let i="</"+t+this.tagEndChar,s="";return"?"===t[0]&&(s="?",i=""),!n&&""!==n||-1!==e.indexOf("<")?!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===s.length?this.indentate(r)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(r)+"<"+t+n+s+this.tagEndChar+e+this.indentate(r)+i:this.indentate(r)+"<"+t+n+s+">"+e+i}},K_.prototype.closeTag=function(e){let t="";return-1!==this.options.unpairedTags.indexOf(e)?this.options.suppressUnpairedNode||(t="/"):t=this.options.suppressEmptyNode?"/":`></${e}`,t},K_.prototype.buildTextValNode=function(e,t,n,r){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(r)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(r)+`\x3c!--${e}--\x3e`+this.newLine;if("?"===t[0])return this.indentate(r)+"<"+t+n+"?"+this.tagEndChar;{let i=this.options.tagValueProcessor(t,e);return i=this.replaceEntitiesValue(i),""===i?this.indentate(r)+"<"+t+n+this.closeTag(t)+this.tagEndChar:this.indentate(r)+"<"+t+n+">"+i+"</"+t+this.tagEndChar}},K_.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const n=this.options.entities[t];e=e.replace(n.regex,n.val)}return e};var J_={XMLParser:U_,XMLValidator:Tw,XMLBuilder:K_};const Y_=(e,t)=>Aw(e,t).then(e=>{if(e.length){const t=new J_.XMLParser({attributeNamePrefix:"",htmlEntities:!0,ignoreAttributes:!1,ignoreDeclaration:!0,parseTagValue:!1,trimValues:!1,tagValueProcessor:(e,t)=>""===t.trim()&&t.includes("\n")?"":void 0});let n;t.addEntity("#xD","\r"),t.addEntity("#10","\n");try{n=t.parse(e,!0)}catch(t){throw t&&"object"==typeof t&&Object.defineProperty(t,"$responseBodyText",{value:e}),t}const r="#text",i=Object.keys(n)[0],s=n[i];return s[r]&&(s[i]=s[r],delete s[r]),mw(s)}return{}}),X_=async(e,t)=>{const n=await Y_(e,t);return n.Error&&(n.Error.message=n.Error.message??n.Error.Message),n},Q_=/\d{12}\.ddb/;const ex="user-agent",tx="x-amz-user-agent",nx=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,rx=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g;const ix=e=>(t,n)=>async r=>{const{request:i}=r;if(!xg.isInstance(i))return t(r);const{headers:s}=i,a=n?.userAgent?.map(sx)||[],o=(await e.defaultUserAgentProvider()).map(sx);await async function(e,t,n){const r=n.request;if("rpc-v2-cbor"===r?.headers?.["smithy-protocol"]&&rb(e,"PROTOCOL_RPC_V2_CBOR","M"),"function"==typeof t.retryStrategy){const n=await t.retryStrategy();"function"==typeof n.acquireInitialRetryToken?n.constructor?.name?.includes("Adaptive")?rb(e,"RETRY_MODE_ADAPTIVE","F"):rb(e,"RETRY_MODE_STANDARD","E"):rb(e,"RETRY_MODE_LEGACY","D")}if("function"==typeof t.accountIdEndpointMode){const n=e.endpointV2;switch(String(n?.url?.hostname).match(Q_)&&rb(e,"ACCOUNT_ID_ENDPOINT","O"),await(t.accountIdEndpointMode?.())){case"disabled":rb(e,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":rb(e,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":rb(e,"ACCOUNT_ID_MODE_REQUIRED","R")}}const i=e.__smithy_context?.selectedHttpAuthScheme?.identity;if(i?.$source){const t=i;t.accountId&&rb(e,"RESOLVED_ACCOUNT_ID","T");for(const[n,r]of Object.entries(t.$source??{}))rb(e,n,r)}}(n,e,r);const c=n;o.push(`m/${function(e){let t="";for(const n in e){const r=e[n];if(!(t.length+r.length+1<=1024))break;t.length?t+=","+r:t+=r}return t}(Object.assign({},n.__smithy_context?.features,c.__aws_sdk_context?.features))}`);const l=e?.customUserAgent?.map(sx)||[],u=await e.userAgentAppId();u&&o.push(sx([`app/${u}`]));const d=[].concat([...o,...a,...l]).join(" "),p=[...o.filter(e=>e.startsWith("aws-sdk-")),...l].join(" ");return"browser"!==e.runtime?(p&&(s[tx]=s[tx]?`${s[ex]} ${p}`:p),s[ex]=d):s[tx]=d,t({...r,request:i})},sx=e=>{const t=e[0].split("/").map(e=>e.replace(nx,"-")).join("/"),n=e[1]?.replace(rx,"-"),r=t.indexOf("/"),i=t.substring(0,r);let s=t.substring(r+1);return"api"===i&&(s=s.toLowerCase()),[i,s,n].filter(e=>e&&e.length>0).reduce((e,t,n)=>{switch(n){case 0:return t;case 1:return`${e}/${t}`;default:return`${e}#${t}`}},"")},ax={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},ox=e=>({applyToStack:t=>{t.add(ix(e),ax)}}),cx=(e,t,n)=>{if(t in e){if("true"===e[t])return!0;if("false"===e[t])return!1;throw new Error(`Cannot load ${n} "${t}". Expected "true" or "false", got ${e[t]}.`)}};var lx;!function(e){e.ENV="env",e.CONFIG="shared config entry"}(lx||(lx={}));const ux={environmentVariableSelector:e=>cx(e,"AWS_USE_DUALSTACK_ENDPOINT",lx.ENV),configFileSelector:e=>cx(e,"use_dualstack_endpoint",lx.CONFIG),default:!1},dx={environmentVariableSelector:e=>cx(e,"AWS_USE_FIPS_ENDPOINT",lx.ENV),configFileSelector:e=>cx(e,"use_fips_endpoint",lx.CONFIG),default:!1},px={environmentVariableSelector:e=>e.AWS_REGION,configFileSelector:e=>e.region,default:()=>{throw new Error("Region is missing")}},hx={preferredFile:"credentials"},mx=e=>"string"==typeof e&&(e.startsWith("fips-")||e.endsWith("-fips")),fx=e=>mx(e)?["fips-aws-global","aws-fips"].includes(e)?"us-east-1":e.replace(/fips-(dkr-|prod-)?|-fips/,""):e,gx=e=>{const{region:t,useFipsEndpoint:n}=e;if(!t)throw new Error("Region is missing");return Object.assign(e,{region:async()=>{if("string"==typeof t)return fx(t);const e=await t();return fx(e)},useFipsEndpoint:async()=>{const e="string"==typeof t?t:await t();return!!mx(e)||("function"!=typeof n?Promise.resolve(!!n):n())}})},yx="content-length";const vx={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},bx=e=>({applyToStack:t=>{var n;t.add((n=e.bodyLengthChecker,e=>async t=>{const r=t.request;if(xg.isInstance(r)){const{body:e,headers:t}=r;if(e&&-1===Object.keys(t).map(e=>e.toLowerCase()).indexOf(yx))try{const t=n(e);r.headers={...r.headers,[yx]:String(t)}}catch(e){}}return e({...t,request:r})}),vx)}}),wx=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,_x=/(\d+\.){3}\d+/,xx=/\.\./,Ex=e=>wx.test(e)&&!_x.test(e)&&!xx.test(e),Sx=e=>{const[t,n,r,,,i]=e.split(":"),s="arn"===t&&e.split(":").length>=6,a=Boolean(s&&n&&r&&i);if(s&&!a)throw new Error(`Invalid ARN: ${e} was an invalid ARN.`);return a},kx=(e,t,n)=>{const r=async()=>{const r=n[e]??n[t];return"function"==typeof r?r():r};return"credentialScope"===e||"CredentialScope"===t?async()=>{const e="function"==typeof n.credentials?await n.credentials():n.credentials;return e?.credentialScope??e?.CredentialScope}:"accountId"===e||"AccountId"===t?async()=>{const e="function"==typeof n.credentials?await n.credentials():n.credentials;return e?.accountId??e?.AccountId}:"endpoint"===e||"endpoint"===t?async()=>{if(!1===n.isCustomEndpoint)return;const e=await r();if(e&&"object"==typeof e){if("url"in e)return e.url.href;if("hostname"in e){const{protocol:t,hostname:n,port:r,path:i}=e;return`${t}//${n}${r?":"+r:""}${i}`}}return e}:r};function Ax(e){try{const t=new Set(Array.from(e.match(/([A-Z_]){3,}/g)??[]));return t.delete("CONFIG"),t.delete("CONFIG_PREFIX_SEPARATOR"),t.delete("ENV"),[...t].join(", ")}catch(t){return e}}const Ox={},Cx=()=>{const{HOME:e,USERPROFILE:t,HOMEPATH:n,HOMEDRIVE:r=`C:${l}`}=process.env;if(e)return e;if(t)return t;if(n)return`${r}${n}`;const i=process&&process.geteuid?`${process.geteuid()}`:"DEFAULT";return Ox[i]||(Ox[i]=T()),Ox[i]},Ix="AWS_PROFILE",Tx=e=>e.profile||process.env[Ix]||"default",Px=e=>{const t=k("sha1").update(e).digest("hex");return u(Cx(),".aws","sso","cache",`${t}.json`)},{readFile:Rx}=w,jx=async e=>{const t=Px(e),n=await Rx(t,"utf8");return JSON.parse(n)},Nx=e=>Object.entries(e).filter(([e])=>{const t=e.indexOf(Wx);return-1!==t&&Object.values(wg).includes(e.substring(0,t))}).reduce((e,[t,n])=>{const r=t.indexOf(Wx);return e[t.substring(0,r)===wg.PROFILE?t.substring(r+1):t]=n,e},{...e.default&&{default:e.default}}),$x=()=>process.env.AWS_CONFIG_FILE||u(Cx(),".aws","config"),Lx=()=>process.env.AWS_SHARED_CREDENTIALS_FILE||u(Cx(),".aws","credentials"),Dx=/^([\w-]+)\s(["'])?([\w-@\+\.%:/]+)\2$/,Ux=["__proto__","profile __proto__"],Mx=e=>{const t={};let n,r;for(const i of e.split(/\r?\n/)){const e=i.split(/(^|\s)[;#]/)[0].trim();if("["===e[0]&&"]"===e[e.length-1]){n=void 0,r=void 0;const t=e.substring(1,e.length-1),i=Dx.exec(t);if(i){const[,e,,t]=i;Object.values(wg).includes(e)&&(n=[e,t].join(Wx))}else n=t;if(Ux.includes(t))throw new Error(`Found invalid profile name "${t}"`)}else if(n){const s=e.indexOf("=");if(![0,-1].includes(s)){const[a,o]=[e.substring(0,s).trim(),e.substring(s+1).trim()];if(""===o)r=a;else{r&&i.trimStart()===i&&(r=void 0),t[n]=t[n]||{};const e=r?[r,a].join(Wx):a;t[n][e]=o}}}}return t},{readFile:Fx}=w,zx={},Bx=(e,t)=>(zx[e]&&!t?.ignoreCache||(zx[e]=Fx(e,"utf8")),zx[e]),qx=()=>({}),Wx=".",Hx=async(e={})=>{const{filepath:t=Lx(),configFilepath:n=$x()}=e,r=Cx();let i=t;t.startsWith("~/")&&(i=u(r,t.slice(2)));let s=n;n.startsWith("~/")&&(s=u(r,n.slice(2)));const a=await Promise.all([Bx(s,{ignoreCache:e.ignoreCache}).then(Mx).then(Nx).catch(qx),Bx(i,{ignoreCache:e.ignoreCache}).then(Mx).catch(qx)]);return{configFile:a[0],credentialsFile:a[1]}},Kx=e=>Object.entries(e).filter(([e])=>e.startsWith(wg.SSO_SESSION+Wx)).reduce((e,[t,n])=>({...e,[t.substring(t.indexOf(Wx)+1)]:n}),{}),Gx=()=>({}),Vx=async(e={})=>Bx(e.configFilepath??$x()).then(Mx).then(Kx).catch(Gx),Zx=async e=>{const t=await Hx(e);return((...e)=>{const t={};for(const n of e)for(const[e,r]of Object.entries(n))void 0!==t[e]?Object.assign(t[e],r):t[e]=r;return t})(t.configFile,t.credentialsFile)},Jx=e=>{return"function"==typeof e?async()=>await e():(t=e,()=>Promise.resolve(t));var t},Yx=({environmentVariableSelector:e,configFileSelector:t,default:n},r={})=>{const{signingName:i,logger:s}=r;return yb(gb((a=e,o={signingName:i,logger:s},async()=>{try{const e=a(process.env,o);if(void 0===e)throw new Error;return e}catch(e){throw new mb(e.message||`Not found in ENV: ${Ax(a.toString())}`,{logger:o?.logger})}}),((e,{preferredFile:t="config",...n}={})=>async()=>{const r=Tx(n),{configFile:i,credentialsFile:s}=await Hx(n),a=s[r]||{},o=i[r]||{},c="config"===t?{...a,...o}:{...o,...a};try{const n=e(c,"config"===t?i:s);if(void 0===n)throw new Error;return n}catch(t){throw new mb(t.message||`Not found in config files w/ profile [${r}]: ${Ax(e.toString())}`,{logger:n.logger})}})(t,r),Jx(n)));var a,o},Xx="AWS_ENDPOINT_URL",Qx="endpoint_url",eE=async e=>Yx((e=>({environmentVariableSelector:t=>{const n=e.split(" ").map(e=>e.toUpperCase()),r=t[[Xx,...n].join("_")];if(r)return r;return t[Xx]||void 0},configFileSelector:(t,n)=>{if(n&&t.services){const r=n[["services",t.services].join(Wx)];if(r){const t=e.split(" ").map(e=>e.toLowerCase()),n=r[[t.join("_"),Qx].join(Wx)];if(n)return n}}const r=t[Qx];if(r)return r},default:void 0}))(e??""))();const tE=e=>{if("string"==typeof e)return tE(new URL(e));const{hostname:t,pathname:n,port:r,protocol:i,search:s}=e;let a;return s&&(a=function(e){const t={};if(e=e.replace(/^\?/,""))for(const n of e.split("&")){let[e,r=null]=n.split("=");e=decodeURIComponent(e),r&&(r=decodeURIComponent(r)),e in t?Array.isArray(t[e])?t[e].push(r):t[e]=[t[e],r]:t[e]=r}return t}(s)),{hostname:t,port:r?parseInt(r):void 0,protocol:i,path:n,query:a}},nE=e=>"object"==typeof e?"url"in e?tE(e.url):e:tE(e),rE=async(e,t,n)=>{const r={},i=t?.getEndpointParameterInstructions?.()||{};for(const[t,s]of Object.entries(i))switch(s.type){case"staticContextParams":r[t]=s.value;break;case"contextParams":r[t]=e[s.name];break;case"clientContextParams":case"builtInParams":r[t]=await kx(s.name,t,n)();break;case"operationContextParams":r[t]=s.get(e);break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(s))}return 0===Object.keys(i).length&&Object.assign(r,n),"s3"===String(n.serviceId).toLowerCase()&&await(async e=>{const t=e?.Bucket||"";if("string"==typeof e.Bucket&&(e.Bucket=t.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),Sx(t)){if(!0===e.ForcePathStyle)throw new Error("Path-style addressing cannot be used with ARN buckets")}else(!Ex(t)||-1!==t.indexOf(".")&&!String(e.Endpoint).startsWith("http:")||t.toLowerCase()!==t||t.length<3)&&(e.ForcePathStyle=!0);return e.DisableMultiRegionAccessPoints&&(e.disableMultiRegionAccessPoints=!0,e.DisableMRAP=!0),e})(r),r},iE=({config:e,instructions:t})=>(n,r)=>async i=>{e.isCustomEndpoint&&function(e,t,n){e.__smithy_context?e.__smithy_context.features||(e.__smithy_context.features={}):e.__smithy_context={features:{}},e.__smithy_context.features[t]=n}(r,"ENDPOINT_OVERRIDE","N");const s=await(async(e,t,n,r)=>{if(!n.isCustomEndpoint){let e;e=n.serviceConfiguredEndpoint?await n.serviceConfiguredEndpoint():await eE(n.serviceId),e&&(n.endpoint=()=>Promise.resolve(nE(e)),n.isCustomEndpoint=!0)}const i=await rE(e,t,n);if("function"!=typeof n.endpointProvider)throw new Error("config.endpointProvider is not set.");return n.endpointProvider(i,r)})(i.input,{getEndpointParameterInstructions:()=>t},{...e},r);r.endpointV2=s,r.authSchemes=s.properties?.authSchemes;const a=r.authSchemes?.[0];if(a){r.signing_region=a.signingRegion,r.signing_service=a.signingName;const e=Pg(r),t=e?.selectedHttpAuthScheme?.httpAuthOption;t&&(t.signingProperties=Object.assign(t.signingProperties||{},{signing_region:a.signingRegion,signingRegion:a.signingRegion,signing_service:a.signingName,signingName:a.signingName,signingRegionSet:a.signingRegionSet},a.properties))}return n({...i})},sE={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:Ug.name},aE=(e,t)=>({applyToStack:n=>{n.addRelativeTo(iE({config:e,instructions:t}),sE)}}),oE=e=>{const t=e.tls??!0,{endpoint:n,useDualstackEndpoint:r,useFipsEndpoint:i}=e,s=null!=n?async()=>nE(await Rg(n)()):void 0,a=!!n,o=Object.assign(e,{endpoint:s,tls:t,isCustomEndpoint:a,useDualstackEndpoint:Rg(r??!1),useFipsEndpoint:Rg(i??!1)});let c;return o.serviceConfiguredEndpoint=async()=>(e.serviceId&&!c&&(c=eE(e.serviceId)),c),o};var cE;!function(e){e.STANDARD="standard",e.ADAPTIVE="adaptive"}(cE||(cE={}));const lE=cE.STANDARD,uE=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],dE=["TimeoutError","RequestTimeout","RequestTimeoutException"],pE=[500,502,503,504],hE=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],mE=["EHOSTUNREACH","ENETUNREACH","ENOTFOUND"],fE=e=>429===e.$metadata?.httpStatusCode||uE.includes(e.name)||1==e.$retryable?.throttling,gE=(e,t=0)=>(e=>e.$metadata?.clockSkewCorrected)(e)||dE.includes(e.name)||hE.includes(e?.code||"")||mE.includes(e?.code||"")||pE.includes(e.$metadata?.httpStatusCode||0)||(e=>{const t=new Set(["Failed to fetch","NetworkError when attempting to fetch resource","The Internet connection appears to be offline","Load failed","Network request failed"]);return!!(e&&e instanceof TypeError)&&t.has(e.message)})(e)||void 0!==e.cause&&t<=10&&gE(e.cause,t+1);class yE{constructor(e){this.currentCapacity=0,this.enabled=!1,this.lastMaxRate=0,this.measuredTxRate=0,this.requestCount=0,this.lastTimestamp=0,this.timeWindow=0,this.beta=e?.beta??.7,this.minCapacity=e?.minCapacity??1,this.minFillRate=e?.minFillRate??.5,this.scaleConstant=e?.scaleConstant??.4,this.smooth=e?.smooth??.8;const t=this.getCurrentTimeInSeconds();this.lastThrottleTime=t,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(e){if(this.enabled){if(this.refillTokenBucket(),e>this.currentCapacity){const t=(e-this.currentCapacity)/this.fillRate*1e3;await new Promise(e=>yE.setTimeoutFn(e,t))}this.currentCapacity=this.currentCapacity-e}}refillTokenBucket(){const e=this.getCurrentTimeInSeconds();if(!this.lastTimestamp)return void(this.lastTimestamp=e);const t=(e-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+t),this.lastTimestamp=e}updateClientSendingRate(e){let t;if(this.updateMeasuredRate(),fE(e)){const e=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=e,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),t=this.cubicThrottle(e),this.enableTokenBucket()}else this.calculateTimeWindow(),t=this.cubicSuccess(this.getCurrentTimeInSeconds());const n=Math.min(t,2*this.measuredTxRate);this.updateTokenBucketRate(n)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(e){return this.getPrecise(e*this.beta)}cubicSuccess(e){return this.getPrecise(this.scaleConstant*Math.pow(e-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(e){this.refillTokenBucket(),this.fillRate=Math.max(e,this.minFillRate),this.maxCapacity=Math.max(e,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){const e=this.getCurrentTimeInSeconds(),t=Math.floor(2*e)/2;if(this.requestCount++,t>this.lastTxRateBucket){const e=this.requestCount/(t-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(e*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=t}}getPrecise(e){return parseFloat(e.toFixed(8))}}yE.setTimeoutFn=setTimeout;const vE=({retryDelay:e,retryCount:t,retryCost:n})=>({getRetryCount:()=>t,getRetryDelay:()=>Math.min(2e4,e),getRetryCost:()=>n});class bE{constructor(e){this.maxAttempts=e,this.mode=cE.STANDARD,this.capacity=500,this.retryBackoffStrategy=(()=>{let e=100;return{computeNextBackoffDelay:t=>Math.floor(Math.min(2e4,Math.random()*2**t*e)),setDelayBase:t=>{e=t}}})(),this.maxAttemptsProvider="function"==typeof e?e:async()=>e}async acquireInitialRetryToken(e){return vE({retryDelay:100,retryCount:0})}async refreshRetryTokenForRetry(e,t){const n=await this.getMaxAttempts();if(this.shouldRetry(e,t,n)){const n=t.errorType;this.retryBackoffStrategy.setDelayBase("THROTTLING"===n?500:100);const r=this.retryBackoffStrategy.computeNextBackoffDelay(e.getRetryCount()),i=t.retryAfterHint?Math.max(t.retryAfterHint.getTime()-Date.now()||0,r):r,s=this.getCapacityCost(n);return this.capacity-=s,vE({retryDelay:i,retryCount:e.getRetryCount()+1,retryCost:s})}throw new Error("No retry token available")}recordSuccess(e){this.capacity=Math.max(500,this.capacity+(e.getRetryCost()??1))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch(e){return console.warn("Max attempts provider could not resolve. Using default of 3"),3}}shouldRetry(e,t,n){return e.getRetryCount()+1<n&&this.capacity>=this.getCapacityCost(t.errorType)&&this.isRetryableError(t.errorType)}getCapacityCost(e){return"TRANSIENT"===e?10:5}isRetryableError(e){return"THROTTLING"===e||"TRANSIENT"===e}}class wE{constructor(e,t){this.maxAttemptsProvider=e,this.mode=cE.ADAPTIVE;const{rateLimiter:n}=t??{};this.rateLimiter=n??new yE,this.standardRetryStrategy=new bE(e)}async acquireInitialRetryToken(e){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(e)}async refreshRetryTokenForRetry(e,t){return this.rateLimiter.updateClientSendingRate(t),this.standardRetryStrategy.refreshRetryTokenForRetry(e,t)}recordSuccess(e){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(e)}}const _E=e=>e instanceof Error?e:e instanceof Object?Object.assign(new Error,e):"string"==typeof e?new Error(e):new Error(`AWS SDK error wrapper for ${e}`),xE="AWS_MAX_ATTEMPTS",EE="max_attempts",SE={environmentVariableSelector:e=>{const t=e[xE];if(!t)return;const n=parseInt(t);if(Number.isNaN(n))throw new Error(`Environment variable ${xE} mast be a number, got "${t}"`);return n},configFileSelector:e=>{const t=e[EE];if(!t)return;const n=parseInt(t);if(Number.isNaN(n))throw new Error(`Shared config file entry ${EE} mast be a number, got "${t}"`);return n},default:3},kE=e=>{const{retryStrategy:t,retryMode:n,maxAttempts:r}=e,i=Rg(r??3);return Object.assign(e,{maxAttempts:i,retryStrategy:async()=>{if(t)return t;return await Rg(n)()===cE.ADAPTIVE?new wE(i):new bE(i)}})},AE={environmentVariableSelector:e=>e.AWS_RETRY_MODE,configFileSelector:e=>e.retry_mode,default:lE},OE=e=>e?.body instanceof r||"undefined"!=typeof ReadableStream&&e?.body instanceof ReadableStream,CE=e=>void 0!==e.acquireInitialRetryToken&&void 0!==e.refreshRetryTokenForRetry&&void 0!==e.recordSuccess,IE=e=>{const t={error:e,errorType:TE(e)},n=jE(e.$response);return n&&(t.retryAfterHint=n),t},TE=e=>fE(e)?"THROTTLING":gE(e)?"TRANSIENT":(e=>{if(void 0!==e.$metadata?.httpStatusCode){const t=e.$metadata.httpStatusCode;return 500<=t&&t<=599&&!gE(e)}return!1})(e)?"SERVER_ERROR":"CLIENT_ERROR",PE={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},RE=e=>({applyToStack:t=>{t.add((e=>(t,n)=>async r=>{let i=await e.retryStrategy();const s=await e.maxAttempts();if(!CE(i))return i?.mode&&(n.userAgent=[...n.userAgent||[],["cfg/retry-mode",i.mode]]),i.retry(t,r);{let e=await i.acquireInitialRetryToken(n.partition_id),a=new Error,o=0,c=0;const{request:l}=r,u=xg.isInstance(l);for(u&&(l.headers["amz-sdk-invocation-id"]=mv());;)try{u&&(l.headers["amz-sdk-request"]=`attempt=${o+1}; max=${s}`);const{response:n,output:a}=await t(r);return i.recordSuccess(e),a.$metadata.attempts=o+1,a.$metadata.totalRetryDelay=c,{response:n,output:a}}catch(t){const r=IE(t);if(a=_E(t),u&&OE(l))throw(n.logger instanceof gw?console:n.logger)?.warn("An error was encountered in a non-retryable streaming request."),a;try{e=await i.refreshRetryTokenForRetry(e,r)}catch(e){throw a.$metadata||(a.$metadata={}),a.$metadata.attempts=o+1,a.$metadata.totalRetryDelay=c,a}o=e.getRetryCount();const s=e.getRetryDelay();c+=s,await new Promise(e=>setTimeout(e,s))}}})(e),PE)}}),jE=e=>{if(!Eg.isInstance(e))return;const t=Object.keys(e.headers).find(e=>"retry-after"===e.toLowerCase());if(!t)return;const n=e.headers[t],r=Number(n);if(!Number.isNaN(r))return new Date(1e3*r);return new Date(n)},NE=async(e,t,n)=>({operation:Pg(t).operation,region:await Rg(e.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});const $E=e=>{const t=[];return e.operation,t.push(function(e){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"bedrock",region:e.region},propertiesExtractor:(e,t)=>({signingProperties:{config:e,context:t}})}}(e)),t},LE={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}};var DE="3.816.0";const UE="AWS_ACCESS_KEY_ID",ME="AWS_SECRET_ACCESS_KEY",FE="AWS_SESSION_TOKEN",zE="AWS_CREDENTIAL_EXPIRATION",BE="AWS_CREDENTIAL_SCOPE",qE="AWS_ACCOUNT_ID",WE=e=>async()=>{e?.logger?.debug("@aws-sdk/credential-provider-env - fromEnv");const t=process.env[UE],n=process.env[ME],r=process.env[FE],i=process.env[zE],s=process.env[BE],a=process.env[qE];if(t&&n){const e={accessKeyId:t,secretAccessKey:n,...r&&{sessionToken:r},...i&&{expiration:new Date(i)},...s&&{credentialScope:s},...a&&{accountId:a}};return nb(e,"CREDENTIALS_ENV_VARS","g"),e}throw new mb("Unable to find environment variable credentials.",{logger:e?.logger})};var HE=Object.freeze({__proto__:null,ENV_ACCOUNT_ID:qE,ENV_CREDENTIAL_SCOPE:BE,ENV_EXPIRATION:zE,ENV_KEY:UE,ENV_SECRET:ME,ENV_SESSION:FE,fromEnv:WE});const KE="AWS_EC2_METADATA_DISABLED";let GE=!1;const VE=(e={})=>yb(gb(async()=>{if(e.profile??process.env[Ix]){if(process.env[UE]&&process.env[ME]&&!GE){(e.logger?.warn&&"NoOpLogger"!==e.logger?.constructor?.name?e.logger.warn:console.warn)("@aws-sdk/credential-provider-node - defaultProvider::fromEnv WARNING:\n    Multiple credential sources detected: \n    Both AWS_PROFILE and the pair AWS_ACCESS_KEY_ID/AWS_SECRET_ACCESS_KEY static credentials are set.\n    This SDK will proceed with the AWS_PROFILE value.\n    \n    However, a future version may change this behavior to prefer the ENV static credentials.\n    Please ensure that your environment only sets either the AWS_PROFILE or the\n    AWS_ACCESS_KEY_ID/AWS_SECRET_ACCESS_KEY pair.\n"),GE=!0}throw new mb("AWS_PROFILE is set, skipping fromEnv provider.",{logger:e.logger,tryNextLink:!0})}return e.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromEnv"),WE(e)()},async()=>{e.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromSSO");const{ssoStartUrl:t,ssoAccountId:n,ssoRegion:r,ssoRoleName:i,ssoSession:s}=e;if(!(t||n||r||i||s))throw new mb("Skipping SSO provider in default chain (inputs do not include SSO fields).",{logger:e.logger});const{fromSSO:a}=await Promise.resolve().then(function(){return Fz});return a(e)()},async()=>{e.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromIni");const{fromIni:t}=await Promise.resolve().then(function(){return Zz});return t(e)()},async()=>{e.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromProcess");const{fromProcess:t}=await Promise.resolve().then(function(){return Yz});return t(e)()},async()=>{e.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromTokenFile");const{fromTokenFile:t}=await Promise.resolve().then(function(){return eB});return t(e)()},async()=>(e.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::remoteProvider"),(await(async e=>{const{ENV_CMDS_FULL_URI:t,ENV_CMDS_RELATIVE_URI:n,fromContainerMetadata:r,fromInstanceMetadata:i}=await Promise.resolve().then(function(){return Oz});if(process.env[n]||process.env[t]){e.logger?.debug("@aws-sdk/credential-provider-node - remoteProvider::fromHttp/fromContainerMetadata");const{fromHttp:t}=await Promise.resolve().then(function(){return Cz});return gb(t(e),r(e))}return process.env[KE]&&"false"!==process.env[KE]?async()=>{throw new mb("EC2 Instance Metadata Service access disabled",{logger:e.logger})}:(e.logger?.debug("@aws-sdk/credential-provider-node - remoteProvider::fromInstanceMetadata"),i(e))})(e))()),async()=>{throw new mb("Could not load credentials from any providers",{tryNextLink:!1,logger:e.logger})}),JE,ZE),ZE=e=>void 0!==e?.expiration,JE=e=>void 0!==e?.expiration&&e.expiration.getTime()-Date.now()<3e5;function YE(e,t,n,r){return new(n||(n=Promise))(function(i,s){function a(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){e.done?i(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,o)}c((r=r.apply(e,t||[])).next())})}function XE(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}"function"==typeof SuppressedError&&SuppressedError;var QE="undefined"!=typeof Buffer&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:e=>{const t=((e,t)=>{if("string"!=typeof e)throw new TypeError(`The "input" argument must be of type string. Received type ${typeof e} (${e})`);return $.from(e,t)})(e,"utf8");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT)};function eS(e){return e instanceof Uint8Array?e:"string"==typeof e?QE(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)}var tS,nS=function(){function e(){this.checksum=4294967295}return e.prototype.update=function(e){var t,n;try{for(var r=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),i=r.next();!i.done;i=r.next()){var s=i.value;this.checksum=this.checksum>>>8^rS[255&(this.checksum^s)]}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return this},e.prototype.digest=function(){return(4294967295^this.checksum)>>>0},e}(),rS=function(e){if(!Uint32Array.from){for(var t=new Uint32Array(e.length),n=0;n<e.length;)t[n]=e[n],n+=1;return t}return Uint32Array.from(e)}([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);class iS{constructor(e){if(this.bytes=e,8!==e.byteLength)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>0x8000000000000000||e<-0x8000000000000000)throw new Error(`${e} is too large (or, if negative, too small) to represent as an Int64`);const t=new Uint8Array(8);for(let n=7,r=Math.abs(Math.round(e));n>-1&&r>0;n--,r/=256)t[n]=r;return e<0&&sS(t),new iS(t)}valueOf(){const e=this.bytes.slice(0),t=128&e[0];return t&&sS(e),parseInt(xy(e),16)*(t?-1:1)}toString(){return String(this.valueOf())}}function sS(e){for(let t=0;t<8;t++)e[t]^=255;for(let t=7;t>-1&&(e[t]++,0===e[t]);t--);}class aS{constructor(e,t){this.toUtf8=e,this.fromUtf8=t}format(e){const t=[];for(const n of Object.keys(e)){const r=this.fromUtf8(n);t.push(Uint8Array.from([r.byteLength]),r,this.formatHeaderValue(e[n]))}const n=new Uint8Array(t.reduce((e,t)=>e+t.byteLength,0));let r=0;for(const e of t)n.set(e,r),r+=e.byteLength;return n}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const t=new DataView(new ArrayBuffer(3));return t.setUint8(0,3),t.setInt16(1,e.value,!1),new Uint8Array(t.buffer);case"integer":const n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,e.value,!1),new Uint8Array(n.buffer);case"long":const r=new Uint8Array(9);return r[0]=5,r.set(e.value.bytes,1),r;case"binary":const i=new DataView(new ArrayBuffer(3+e.value.byteLength));i.setUint8(0,6),i.setUint16(1,e.value.byteLength,!1);const s=new Uint8Array(i.buffer);return s.set(e.value,3),s;case"string":const a=this.fromUtf8(e.value),o=new DataView(new ArrayBuffer(3+a.byteLength));o.setUint8(0,7),o.setUint16(1,a.byteLength,!1);const c=new Uint8Array(o.buffer);return c.set(a,3),c;case"timestamp":const l=new Uint8Array(9);return l[0]=8,l.set(iS.fromNumber(e.value.valueOf()).bytes,1),l;case"uuid":if(!gS.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);const u=new Uint8Array(17);return u[0]=9,u.set(_y(e.value.replace(/\-/g,"")),1),u}}parse(e){const t={};let n=0;for(;n<e.byteLength;){const r=e.getUint8(n++),i=this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+n,r));switch(n+=r,e.getUint8(n++)){case 0:t[i]={type:oS,value:!0};break;case 1:t[i]={type:oS,value:!1};break;case 2:t[i]={type:cS,value:e.getInt8(n++)};break;case 3:t[i]={type:lS,value:e.getInt16(n,!1)},n+=2;break;case 4:t[i]={type:uS,value:e.getInt32(n,!1)},n+=4;break;case 5:t[i]={type:dS,value:new iS(new Uint8Array(e.buffer,e.byteOffset+n,8))},n+=8;break;case 6:const r=e.getUint16(n,!1);n+=2,t[i]={type:pS,value:new Uint8Array(e.buffer,e.byteOffset+n,r)},n+=r;break;case 7:const s=e.getUint16(n,!1);n+=2,t[i]={type:hS,value:this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+n,s))},n+=s;break;case 8:t[i]={type:mS,value:new Date(new iS(new Uint8Array(e.buffer,e.byteOffset+n,8)).valueOf())},n+=8;break;case 9:const a=new Uint8Array(e.buffer,e.byteOffset+n,16);n+=16,t[i]={type:fS,value:`${xy(a.subarray(0,4))}-${xy(a.subarray(4,6))}-${xy(a.subarray(6,8))}-${xy(a.subarray(8,10))}-${xy(a.subarray(10))}`};break;default:throw new Error("Unrecognized header type tag")}}return t}}!function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"}(tS||(tS={}));const oS="boolean",cS="byte",lS="short",uS="integer",dS="long",pS="binary",hS="string",mS="timestamp",fS="uuid",gS=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;class yS{constructor(e,t){this.headerMarshaller=new aS(e,t),this.messageBuffer=[],this.isEndOfStream=!1}feed(e){this.messageBuffer.push(this.decode(e))}endOfStream(){this.isEndOfStream=!0}getMessage(){const e=this.messageBuffer.pop(),t=this.isEndOfStream;return{getMessage:()=>e,isEndOfStream:()=>t}}getAvailableMessages(){const e=this.messageBuffer;this.messageBuffer=[];const t=this.isEndOfStream;return{getMessages:()=>e,isEndOfStream:()=>t}}encode({headers:e,body:t}){const n=this.headerMarshaller.format(e),r=n.byteLength+t.byteLength+16,i=new Uint8Array(r),s=new DataView(i.buffer,i.byteOffset,i.byteLength),a=new nS;return s.setUint32(0,r,!1),s.setUint32(4,n.byteLength,!1),s.setUint32(8,a.update(i.subarray(0,8)).digest(),!1),i.set(n,12),i.set(t,n.byteLength+12),s.setUint32(r-4,a.update(i.subarray(8,r-4)).digest(),!1),i}decode(e){const{headers:t,body:n}=function({byteLength:e,byteOffset:t,buffer:n}){if(e<16)throw new Error("Provided message too short to accommodate event stream message overhead");const r=new DataView(n,t,e),i=r.getUint32(0,!1);if(e!==i)throw new Error("Reported message length does not match received message length");const s=r.getUint32(4,!1),a=r.getUint32(8,!1),o=r.getUint32(e-4,!1),c=(new nS).update(new Uint8Array(n,t,8));if(a!==c.digest())throw new Error(`The prelude checksum specified in the message (${a}) does not match the calculated CRC32 checksum (${c.digest()})`);if(c.update(new Uint8Array(n,t+8,e-12)),o!==c.digest())throw new Error(`The message checksum (${c.digest()}) did not match the expected value of ${o}`);return{headers:new DataView(n,t+8+4,s),body:new Uint8Array(n,t+8+4+s,i-s-16)}}(e);return{headers:this.headerMarshaller.parse(t),body:n}}formatHeaders(e){return this.headerMarshaller.format(e)}}class vS{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.inputStream){const t=this.options.decoder.decode(e);yield t}}}class bS{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.messageStream){const t=this.options.encoder.encode(e);yield t}this.options.includeEndFrame&&(yield new Uint8Array(0))}}class wS{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.messageStream){const t=await this.options.deserializer(e);void 0!==t&&(yield t)}}}class _S{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.inputStream){const t=this.options.serializer(e);yield t}}}class xS extends s{priorSignature;messageSigner;eventStreamCodec;systemClockOffsetProvider;constructor(e){super({autoDestroy:!0,readableObjectMode:!0,writableObjectMode:!0,...e}),this.priorSignature=e.priorSignature,this.eventStreamCodec=e.eventStreamCodec,this.messageSigner=e.messageSigner,this.systemClockOffsetProvider=e.systemClockOffsetProvider}async _transform(e,t,n){try{const t=new Date(Date.now()+await this.systemClockOffsetProvider()),r={":date":{type:"timestamp",value:t}},i=await this.messageSigner.sign({message:{body:e,headers:r},priorSignature:this.priorSignature},{signingDate:t});this.priorSignature=i.signature;const s=this.eventStreamCodec.encode({headers:{...r,":chunk-signature":{type:"binary",value:ES(i.signature)}},body:e});return this.push(s),n()}catch(e){n(e)}}}function ES(e){const t=Buffer.from(e,"hex");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT)}class SS{messageSigner;eventStreamCodec;systemClockOffsetProvider;constructor(e){this.messageSigner=e.messageSigner,this.eventStreamCodec=new yS(e.utf8Encoder,e.utf8Decoder),this.systemClockOffsetProvider=async()=>e.systemClockOffset??0}async handle(e,t,n={}){const i=t.request,{body:s,query:c}=i;if(!(s instanceof r))throw new Error("Eventstream payload must be a Readable stream.");const l=s;i.body=new a({objectMode:!0});const u=i.headers?.authorization?.match(/Signature=([\w]+)$/),d=new xS({priorSignature:u?.[1]??c?.["X-Amz-Signature"]??"",eventStreamCodec:this.eventStreamCodec,messageSigner:await this.messageSigner(),systemClockOffsetProvider:this.systemClockOffsetProvider});let p;o(l,d,i.body,e=>{if(e)throw e});try{p=await e(t)}catch(e){throw i.body.end(),e}return p}}const kS=e=>new SS(e),AS=({serviceId:e,clientVersion:t})=>async n=>{const r=[["aws-sdk-js",t],["ua","2.1"],[`os/${P()}`,R()],["lang/js"],["md/nodejs",`${z.node}`]];e&&r.push([`api/${e}`,t]),B.AWS_EXECUTION_ENV&&r.push([`exec-env/${B.AWS_EXECUTION_ENV}`]);const i=await(n?.userAgentAppId?.());return i?[...r,[`app/${i}`]]:[...r]},OS={environmentVariableSelector:e=>e.AWS_SDK_UA_APP_ID,configFileSelector:e=>e.sdk_ua_app_id??e["sdk-ua-app-id"],default:Ev};function CS(e,t){return async function(n){const{value:r}=n.headers[":message-type"];if("error"===r){const e=new Error(n.headers[":error-message"].value||"UnknownError");throw e.name=n.headers[":error-code"].value,e}if("exception"===r){const r=n.headers[":exception-type"].value,i={[r]:n},s=await e(i);if(s.$unknown){const e=new Error(t(n.body));throw e.name=r,e}throw s[r]}if("event"===r){const t={[n.headers[":event-type"].value]:n},r=await e(t);if(r.$unknown)return;return r}throw Error(`Unrecognizable event type: ${n.headers[":event-type"].value}`)}}let IS=class{constructor({utf8Encoder:e,utf8Decoder:t}){this.eventStreamCodec=new yS(e,t),this.utfEncoder=e}deserialize(e,t){const n=function(e){let t=0,n=0,r=null,i=null;const s=e=>{if("number"!=typeof e)throw new Error("Attempted to allocate an event message where size was not a number: "+e);t=e,n=4,r=new Uint8Array(e),new DataView(r.buffer).setUint32(0,e,!1)};return{[Symbol.asyncIterator]:async function*(){const a=e[Symbol.asyncIterator]();for(;;){const{value:e,done:o}=await a.next();if(o){if(!t)return;if(t!==n)throw new Error("Truncated event message received.");return void(yield r)}const c=e.length;let l=0;for(;l<c;){if(!r){const t=c-l;i||(i=new Uint8Array(4));const r=Math.min(4-n,t);if(i.set(e.slice(l,l+r),n),n+=r,l+=r,n<4)break;s(new DataView(i.buffer).getUint32(0,!1)),i=null}const a=Math.min(t-n,c-l);r.set(e.slice(l,l+a),n),n+=a,l+=a,t&&t===n&&(yield r,r=null,t=0,n=0)}}}}}(e);return new wS({messageStream:new vS({inputStream:n,decoder:this.eventStreamCodec}),deserializer:CS(t,this.utfEncoder)})}serialize(e,t){return new bS({messageStream:new _S({inputStream:e,serializer:t}),encoder:this.eventStreamCodec,includeEndFrame:!0})}};class TS{constructor({utf8Encoder:e,utf8Decoder:t}){this.universalMarshaller=new IS({utf8Decoder:t,utf8Encoder:e})}deserialize(e,t){const n="function"==typeof e[Symbol.asyncIterator]?e:async function*(e){let t=!1,n=!1;const r=new Array;for(e.on("error",e=>{if(t||(t=!0),e)throw e}),e.on("data",e=>{r.push(e)}),e.on("end",()=>{t=!0});!n;){const e=await new Promise(e=>setTimeout(()=>e(r.shift()),0));e&&(yield e),n=t&&0===r.length}}(e);return this.universalMarshaller.deserialize(n,t)}serialize(e,t){return r.from(this.universalMarshaller.serialize(e,t))}}const PS=e=>new TS(e);class RS{constructor(e,t){this.algorithmIdentifier=e,this.secret=t,this.reset()}update(e,t){this.hash.update(Yg(jS(e,t)))}digest(){return Promise.resolve(this.hash.digest())}reset(){this.hash=this.secret?A(this.algorithmIdentifier,jS(this.secret)):k(this.algorithmIdentifier)}}function jS(e,t){return $.isBuffer(e)?e:"string"==typeof e?Gg(e,t):ArrayBuffer.isView(e)?Kg(e.buffer,e.byteOffset,e.byteLength):Kg(e)}const NS=e=>{if(!e)return 0;if("string"==typeof e)return Buffer.byteLength(e);if("number"==typeof e.byteLength)return e.byteLength;if("number"==typeof e.size)return e.size;if("number"==typeof e.start&&"number"==typeof e.end)return e.end+1-e.start;if("string"==typeof e.path||Buffer.isBuffer(e.path))return _(e.path).size;if("number"==typeof e.fd)return x(e.fd).size;throw new Error(`Body Length computation failed for ${e}`)},$S="required",LS="fn",DS="argv",US="ref",MS=!0,FS="isSet",zS="booleanEquals",BS="error",qS="endpoint",WS="tree",HS="PartitionResult",KS={[$S]:!1,type:"String"},GS={[$S]:!0,default:!1,type:"Boolean"},VS={[US]:"Endpoint"},ZS={[LS]:zS,[DS]:[{[US]:"UseFIPS"},!0]},JS={[LS]:zS,[DS]:[{[US]:"UseDualStack"},!0]},YS={},XS={[LS]:"getAttr",[DS]:[{[US]:HS},"supportsFIPS"]},QS={[LS]:zS,[DS]:[!0,{[LS]:"getAttr",[DS]:[{[US]:HS},"supportsDualStack"]}]},ek=[ZS],tk=[JS],nk=[{[US]:"Region"}],rk={parameters:{Region:KS,UseDualStack:GS,UseFIPS:GS,Endpoint:KS},rules:[{conditions:[{[LS]:FS,[DS]:[VS]}],rules:[{conditions:ek,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:BS},{rules:[{conditions:tk,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:BS},{endpoint:{url:VS,properties:YS,headers:YS},type:qS}],type:WS}],type:WS},{rules:[{conditions:[{[LS]:FS,[DS]:nk}],rules:[{conditions:[{[LS]:"aws.partition",[DS]:nk,assign:HS}],rules:[{conditions:[ZS,JS],rules:[{conditions:[{[LS]:zS,[DS]:[MS,XS]},QS],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:YS,headers:YS},type:qS}],type:WS}],type:WS},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:BS}],type:WS},{conditions:ek,rules:[{conditions:[{[LS]:zS,[DS]:[XS,MS]}],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime-fips.{Region}.{PartitionResult#dnsSuffix}",properties:YS,headers:YS},type:qS}],type:WS}],type:WS},{error:"FIPS is enabled but this partition does not support FIPS",type:BS}],type:WS},{conditions:tk,rules:[{conditions:[QS],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:YS,headers:YS},type:qS}],type:WS}],type:WS},{error:"DualStack is enabled but this partition does not support DualStack",type:BS}],type:WS},{rules:[{endpoint:{url:"https://bedrock-runtime.{Region}.{PartitionResult#dnsSuffix}",properties:YS,headers:YS},type:qS}],type:WS}],type:WS}],type:WS},{error:"Invalid Configuration: Missing Region",type:BS}],type:WS}]},ik=new kv({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),sk=(e,t={})=>ik.get(e,()=>Jv(rk,{endpointParams:e,logger:t.logger}));Tv.aws=Qv;const ak="AWS_REGION",ok="AWS_DEFAULT_REGION",ck=["in-region","cross-region","mobile","standard","legacy"],lk={environmentVariableSelector:e=>e.AWS_DEFAULTS_MODE,configFileSelector:e=>e.defaults_mode,default:"legacy"},uk=({region:e=Yx(px),defaultsMode:t=Yx(lk)}={})=>yb(async()=>{const n="function"==typeof t?await t():t;switch(n?.toLowerCase()){case"auto":return dk(e);case"in-region":case"cross-region":case"mobile":case"standard":case"legacy":return Promise.resolve(n?.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error(`Invalid parameter for "defaultsMode", expect ${ck.join(", ")}, got ${n}`)}}),dk=async e=>{if(e){const t="function"==typeof e?await e():e,n=await pk();return n?t===n?"in-region":"cross-region":"standard"}return"standard"},pk=async()=>{if(process.env.AWS_EXECUTION_ENV&&(process.env[ak]||process.env[ok]))return process.env[ak]??process.env[ok];if(!process.env.AWS_EC2_METADATA_DISABLED)try{const{getInstanceMetadataEndpoint:e,httpRequest:t}=await Promise.resolve().then(function(){return Oz}),n=await e();return(await t({...n,path:"/latest/meta-data/placement/region"})).toString()}catch(e){}},hk=e=>{dw(process.version);const t=uk(e),n=()=>t().then(lw),r=(e=>({apiVersion:"2023-09-30",base64Decoder:e?.base64Decoder??Zg,base64Encoder:e?.base64Encoder??Qg,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??sk,extensions:e?.extensions??[],httpAuthSchemeProvider:e?.httpAuthSchemeProvider??$E,httpAuthSchemes:e?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4"),signer:new cb}],logger:e?.logger??new gw,serviceId:e?.serviceId??"Bedrock Runtime",urlParser:e?.urlParser??tE,utf8Decoder:e?.utf8Decoder??Jg,utf8Encoder:e?.utf8Encoder??Xg}))(e);tb(process.version);const i={profile:e?.profile,logger:r.logger};return{...r,...e,runtime:"node",defaultsMode:t,authSchemePreference:e?.authSchemePreference??Yx(pb,i),bodyLengthChecker:e?.bodyLengthChecker??NS,credentialDefaultProvider:e?.credentialDefaultProvider??VE,defaultUserAgentProvider:e?.defaultUserAgentProvider??AS({serviceId:r.serviceId,clientVersion:DE}),eventStreamPayloadHandlerProvider:e?.eventStreamPayloadHandlerProvider??kS,eventStreamSerdeProvider:e?.eventStreamSerdeProvider??PS,maxAttempts:e?.maxAttempts??Yx(SE,e),region:e?.region??Yx(px,{...hx,...i}),requestHandler:my.create(e?.requestHandler??(async()=>({...await n(),disableConcurrentStreams:!0}))),retryMode:e?.retryMode??Yx({...AE,default:async()=>(await n()).retryMode||lE},e),sha256:e?.sha256??RS.bind(null,"sha256"),streamCollector:e?.streamCollector??gy,useDualstackEndpoint:e?.useDualstackEndpoint??Yx(ux,i),useFipsEndpoint:e?.useFipsEndpoint??Yx(dx,i),userAgentAppId:e?.userAgentAppId??Yx(OS,i)}},mk=e=>({setRegion(t){e.region=t},region:()=>e.region}),fk=e=>({region:e.region()});class gk extends ew{config;constructor(...[e]){const t=hk(e||{});super(t),this.initConfig=t;var n;const r=Sv((n=t,Object.assign(n,{useDualstackEndpoint:n.useDualstackEndpoint??!1,useFipsEndpoint:n.useFipsEndpoint??!1,defaultSigningName:"bedrock"}))),i=kE(r),s=gx(i),a=oE(s);var o;const c=((e,t)=>{const n=Object.assign(mk(e),pw(e),pg(e),(e=>{const t=e.httpAuthSchemes;let n=e.httpAuthSchemeProvider,r=e.credentials;return{setHttpAuthScheme(e){const n=t.findIndex(t=>t.schemeId===e.schemeId);-1===n?t.push(e):t.splice(n,1,e)},httpAuthSchemes:()=>t,setHttpAuthSchemeProvider(e){n=e},httpAuthSchemeProvider:()=>n,setCredentials(e){r=e},credentials:()=>r}})(e));return t.forEach(e=>e.configure(n)),Object.assign(e,fk(n),hw(n),hg(n),{httpAuthSchemes:(r=n).httpAuthSchemes(),httpAuthSchemeProvider:r.httpAuthSchemeProvider(),credentials:r.credentials()});var r})(function(e){const t=e.signer,n=e.signer,r=Object.assign(e,{eventSigner:t,messageSigner:n}),i=r.eventStreamPayloadHandlerProvider(r);return Object.assign(r,{eventStreamPayloadHandler:i})}((e=>{const t=Vb(e);return Object.assign(t,{authSchemePreference:Rg(e.authSchemePreference??[])})})((o=a,Object.assign(o,{eventStreamMarshaller:o.eventStreamSerdeProvider(o)})))),e?.extensions||[]);this.config=c,this.middlewareStack.use(ox(this.config)),this.middlewareStack.use(RE(this.config)),this.middlewareStack.use(bx(this.config)),this.middlewareStack.use(kg(this.config)),this.middlewareStack.use(Og(this.config)),this.middlewareStack.use(Tg(this.config)),this.middlewareStack.use($g(this.config,{httpAuthSchemeParametersProvider:NE,identityProviderConfigProvider:async e=>new yv({"aws.auth#sigv4":e.credentials})})),this.middlewareStack.use(qg(this.config))}destroy(){super.destroy()}}class yk extends sw{constructor(e){super(e),Object.setPrototypeOf(this,yk.prototype)}}let vk=class e extends yk{name="AccessDeniedException";$fault="client";constructor(t){super({name:"AccessDeniedException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype)}};var bk;!function(e){e.visit=(e,t)=>void 0!==e.s3OutputDataConfig?t.s3OutputDataConfig(e.s3OutputDataConfig):t._(e.$unknown[0],e.$unknown[1])}(bk||(bk={}));let wk=class e extends yk{name="InternalServerException";$fault="server";constructor(t){super({name:"InternalServerException",$fault:"server",...t}),Object.setPrototypeOf(this,e.prototype)}};class _k extends yk{name="ThrottlingException";$fault="client";constructor(e){super({name:"ThrottlingException",$fault:"client",...e}),Object.setPrototypeOf(this,_k.prototype)}}class xk extends yk{name="ValidationException";$fault="client";constructor(e){super({name:"ValidationException",$fault:"client",...e}),Object.setPrototypeOf(this,xk.prototype)}}class Ek extends yk{name="ConflictException";$fault="client";constructor(e){super({name:"ConflictException",$fault:"client",...e}),Object.setPrototypeOf(this,Ek.prototype)}}let Sk=class e extends yk{name="ResourceNotFoundException";$fault="client";constructor(t){super({name:"ResourceNotFoundException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype)}};class kk extends yk{name="ServiceQuotaExceededException";$fault="client";constructor(e){super({name:"ServiceQuotaExceededException",$fault:"client",...e}),Object.setPrototypeOf(this,kk.prototype)}}class Ak extends yk{name="ServiceUnavailableException";$fault="server";constructor(e){super({name:"ServiceUnavailableException",$fault:"server",...e}),Object.setPrototypeOf(this,Ak.prototype)}}var Ok,Ck,Ik,Tk,Pk,Rk,jk,Nk,$k,Lk,Dk,Uk,Mk,Fk,zk,Bk,qk,Wk,Hk,Kk,Gk,Vk,Zk;!function(e){e.visit=(e,t)=>void 0!==e.bytes?t.bytes(e.bytes):t._(e.$unknown[0],e.$unknown[1])}(Ok||(Ok={})),function(e){e.visit=(e,t)=>void 0!==e.text?t.text(e.text):void 0!==e.image?t.image(e.image):t._(e.$unknown[0],e.$unknown[1])}(Ck||(Ck={})),function(e){e.visit=(e,t)=>void 0!==e.bytes?t.bytes(e.bytes):void 0!==e.s3Location?t.s3Location(e.s3Location):t._(e.$unknown[0],e.$unknown[1])}(Ik||(Ik={})),function(e){e.visit=(e,t)=>void 0!==e.bytes?t.bytes(e.bytes):t._(e.$unknown[0],e.$unknown[1])}(Tk||(Tk={})),function(e){e.visit=(e,t)=>void 0!==e.text?t.text(e.text):void 0!==e.image?t.image(e.image):t._(e.$unknown[0],e.$unknown[1])}(Pk||(Pk={})),function(e){e.visit=(e,t)=>void 0!==e.bytes?t.bytes(e.bytes):void 0!==e.s3Location?t.s3Location(e.s3Location):t._(e.$unknown[0],e.$unknown[1])}(Rk||(Rk={})),function(e){e.visit=(e,t)=>void 0!==e.reasoningText?t.reasoningText(e.reasoningText):void 0!==e.redactedContent?t.redactedContent(e.redactedContent):t._(e.$unknown[0],e.$unknown[1])}(jk||(jk={})),function(e){e.visit=(e,t)=>void 0!==e.bytes?t.bytes(e.bytes):void 0!==e.s3Location?t.s3Location(e.s3Location):t._(e.$unknown[0],e.$unknown[1])}(Nk||(Nk={})),function(e){e.visit=(e,t)=>void 0!==e.json?t.json(e.json):void 0!==e.text?t.text(e.text):void 0!==e.image?t.image(e.image):void 0!==e.document?t.document(e.document):void 0!==e.video?t.video(e.video):t._(e.$unknown[0],e.$unknown[1])}($k||($k={})),function(e){e.visit=(e,t)=>void 0!==e.text?t.text(e.text):void 0!==e.image?t.image(e.image):void 0!==e.document?t.document(e.document):void 0!==e.video?t.video(e.video):void 0!==e.toolUse?t.toolUse(e.toolUse):void 0!==e.toolResult?t.toolResult(e.toolResult):void 0!==e.guardContent?t.guardContent(e.guardContent):void 0!==e.cachePoint?t.cachePoint(e.cachePoint):void 0!==e.reasoningContent?t.reasoningContent(e.reasoningContent):t._(e.$unknown[0],e.$unknown[1])}(Lk||(Lk={})),function(e){e.visit=(e,t)=>void 0!==e.text?t.text(e.text):t._(e.$unknown[0],e.$unknown[1])}(Dk||(Dk={})),function(e){e.visit=(e,t)=>void 0!==e.text?t.text(e.text):void 0!==e.guardContent?t.guardContent(e.guardContent):void 0!==e.cachePoint?t.cachePoint(e.cachePoint):t._(e.$unknown[0],e.$unknown[1])}(Uk||(Uk={})),function(e){e.visit=(e,t)=>void 0!==e.auto?t.auto(e.auto):void 0!==e.any?t.any(e.any):void 0!==e.tool?t.tool(e.tool):t._(e.$unknown[0],e.$unknown[1])}(Mk||(Mk={})),function(e){e.visit=(e,t)=>void 0!==e.json?t.json(e.json):t._(e.$unknown[0],e.$unknown[1])}(Fk||(Fk={})),function(e){e.visit=(e,t)=>void 0!==e.toolSpec?t.toolSpec(e.toolSpec):void 0!==e.cachePoint?t.cachePoint(e.cachePoint):t._(e.$unknown[0],e.$unknown[1])}(zk||(zk={})),function(e){e.visit=(e,t)=>void 0!==e.message?t.message(e.message):t._(e.$unknown[0],e.$unknown[1])}(Bk||(Bk={}));class Jk extends yk{name="ModelErrorException";$fault="client";originalStatusCode;resourceName;constructor(e){super({name:"ModelErrorException",$fault:"client",...e}),Object.setPrototypeOf(this,Jk.prototype),this.originalStatusCode=e.originalStatusCode,this.resourceName=e.resourceName}}class Yk extends yk{name="ModelNotReadyException";$fault="client";$retryable={};constructor(e){super({name:"ModelNotReadyException",$fault:"client",...e}),Object.setPrototypeOf(this,Yk.prototype)}}class Xk extends yk{name="ModelTimeoutException";$fault="client";constructor(e){super({name:"ModelTimeoutException",$fault:"client",...e}),Object.setPrototypeOf(this,Xk.prototype)}}!function(e){e.visit=(e,t)=>void 0!==e.text?t.text(e.text):void 0!==e.redactedContent?t.redactedContent(e.redactedContent):void 0!==e.signature?t.signature(e.signature):t._(e.$unknown[0],e.$unknown[1])}(qk||(qk={})),function(e){e.visit=(e,t)=>void 0!==e.text?t.text(e.text):void 0!==e.toolUse?t.toolUse(e.toolUse):void 0!==e.reasoningContent?t.reasoningContent(e.reasoningContent):t._(e.$unknown[0],e.$unknown[1])}(Wk||(Wk={})),function(e){e.visit=(e,t)=>void 0!==e.toolUse?t.toolUse(e.toolUse):t._(e.$unknown[0],e.$unknown[1])}(Hk||(Hk={}));class Qk extends yk{name="ModelStreamErrorException";$fault="client";originalStatusCode;originalMessage;constructor(e){super({name:"ModelStreamErrorException",$fault:"client",...e}),Object.setPrototypeOf(this,Qk.prototype),this.originalStatusCode=e.originalStatusCode,this.originalMessage=e.originalMessage}}!function(e){e.visit=(e,t)=>void 0!==e.messageStart?t.messageStart(e.messageStart):void 0!==e.contentBlockStart?t.contentBlockStart(e.contentBlockStart):void 0!==e.contentBlockDelta?t.contentBlockDelta(e.contentBlockDelta):void 0!==e.contentBlockStop?t.contentBlockStop(e.contentBlockStop):void 0!==e.messageStop?t.messageStop(e.messageStop):void 0!==e.metadata?t.metadata(e.metadata):void 0!==e.internalServerException?t.internalServerException(e.internalServerException):void 0!==e.modelStreamErrorException?t.modelStreamErrorException(e.modelStreamErrorException):void 0!==e.validationException?t.validationException(e.validationException):void 0!==e.throttlingException?t.throttlingException(e.throttlingException):void 0!==e.serviceUnavailableException?t.serviceUnavailableException(e.serviceUnavailableException):t._(e.$unknown[0],e.$unknown[1])}(Kk||(Kk={})),function(e){e.visit=(e,t)=>void 0!==e.chunk?t.chunk(e.chunk):t._(e.$unknown[0],e.$unknown[1])}(Gk||(Gk={})),function(e){e.visit=(e,t)=>void 0!==e.chunk?t.chunk(e.chunk):void 0!==e.internalServerException?t.internalServerException(e.internalServerException):void 0!==e.modelStreamErrorException?t.modelStreamErrorException(e.modelStreamErrorException):void 0!==e.validationException?t.validationException(e.validationException):void 0!==e.throttlingException?t.throttlingException(e.throttlingException):void 0!==e.modelTimeoutException?t.modelTimeoutException(e.modelTimeoutException):void 0!==e.serviceUnavailableException?t.serviceUnavailableException(e.serviceUnavailableException):t._(e.$unknown[0],e.$unknown[1])}(Vk||(Vk={})),(Zk||(Zk={})).visit=(e,t)=>void 0!==e.chunk?t.chunk(e.chunk):void 0!==e.internalServerException?t.internalServerException(e.internalServerException):void 0!==e.modelStreamErrorException?t.modelStreamErrorException(e.modelStreamErrorException):void 0!==e.validationException?t.validationException(e.validationException):void 0!==e.throttlingException?t.throttlingException(e.throttlingException):void 0!==e.modelTimeoutException?t.modelTimeoutException(e.modelTimeoutException):void 0!==e.serviceUnavailableException?t.serviceUnavailableException(e.serviceUnavailableException):t._(e.$unknown[0],e.$unknown[1]);const eA=e=>void 0!==e.text?{text:e.text}:void 0!==e.image?{image:rw}:void 0!==e.$unknown?{[e.$unknown[0]]:"UNKNOWN"}:void 0,tA=e=>({...e,...e.content&&{content:e.content.map(e=>(e=>void 0!==e.text?{text:e.text}:void 0!==e.image?{image:e.image}:void 0!==e.document?{document:e.document}:void 0!==e.video?{video:e.video}:void 0!==e.toolUse?{toolUse:e.toolUse}:void 0!==e.toolResult?{toolResult:e.toolResult}:void 0!==e.guardContent?{guardContent:eA(e.guardContent)}:void 0!==e.cachePoint?{cachePoint:e.cachePoint}:void 0!==e.reasoningContent?{reasoningContent:rw}:void 0!==e.$unknown?{[e.$unknown[0]]:"UNKNOWN"}:void 0)(e))}}),nA=e=>void 0!==e.text?{text:e.text}:void 0!==e.guardContent?{guardContent:eA(e.guardContent)}:void 0!==e.cachePoint?{cachePoint:e.cachePoint}:void 0!==e.$unknown?{[e.$unknown[0]]:"UNKNOWN"}:void 0,rA=e=>({...e,...e.messages&&{messages:e.messages.map(e=>tA(e))},...e.system&&{system:e.system.map(e=>nA(e))},...e.toolConfig&&{toolConfig:e.toolConfig},...e.promptVariables&&{promptVariables:rw},...e.requestMetadata&&{requestMetadata:rw}}),iA=e=>void 0!==e.message?{message:tA(e.message)}:void 0!==e.$unknown?{[e.$unknown[0]]:"UNKNOWN"}:void 0,sA=e=>({...e,...e.output&&{output:iA(e.output)}}),aA=e=>({...e,...e.messages&&{messages:e.messages.map(e=>tA(e))},...e.system&&{system:e.system.map(e=>nA(e))},...e.toolConfig&&{toolConfig:e.toolConfig},...e.promptVariables&&{promptVariables:rw},...e.requestMetadata&&{requestMetadata:rw}}),oA=e=>({...e,...e.stream&&{stream:"STREAMING_CONTENT"}}),cA=e=>({...e,...e.body&&{body:rw}}),lA=e=>({...e,...e.body&&{body:rw}}),uA=async(e,t)=>{const n=fv(e,t);let r;return n.bp("/model/{modelId}/converse"),n.p("modelId",()=>e.modelId,"{modelId}",!1),r=JSON.stringify(vw(e,{additionalModelRequestFields:e=>cO(e),additionalModelResponseFieldPaths:e=>Sw(e),guardrailConfig:e=>Sw(e),inferenceConfig:e=>JA(e),messages:e=>YA(e,t),performanceConfig:e=>Sw(e),promptVariables:e=>Sw(e),requestMetadata:e=>Sw(e),system:e=>QA(e,t),toolConfig:e=>eO(e)})),n.m("POST").h({"content-type":"application/json"}).b(r),n.build()},dA=async(e,t)=>{const n=fv(e,t);let r;return n.bp("/model/{modelId}/converse-stream"),n.p("modelId",()=>e.modelId,"{modelId}",!1),r=JSON.stringify(vw(e,{additionalModelRequestFields:e=>cO(e),additionalModelResponseFieldPaths:e=>Sw(e),guardrailConfig:e=>Sw(e),inferenceConfig:e=>JA(e),messages:e=>YA(e,t),performanceConfig:e=>Sw(e),promptVariables:e=>Sw(e),requestMetadata:e=>Sw(e),system:e=>QA(e,t),toolConfig:e=>eO(e)})),n.m("POST").h({"content-type":"application/json"}).b(r),n.build()},pA=async(e,t)=>{const n=fv(e,t),r=yw({},fw,{[FO]:e[MO]||"application/octet-stream",[UO]:e[UO],[VO]:e[WO],[HO]:e[zO],[KO]:e[BO],[GO]:e[qO]});let i;return n.bp("/model/{modelId}/invoke"),n.p("modelId",()=>e.modelId,"{modelId}",!1),void 0!==e.body&&(i=e.body),n.m("POST").h(r).b(i),n.build()},hA=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return gA(e,t);const n=yw({$metadata:DO(e)}),r=My(Fy(await Ow(e.body,t)),"body"),i=vw(r,{additionalModelResponseFields:e=>LO(e),metrics:Sw,output:e=>dO(kw(e),t),performanceConfig:Sw,stopReason:zy,trace:e=>mO(e),usage:Sw});return Object.assign(n,i),n},mA=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return gA(e,t);const n=yw({$metadata:DO(e)}),r=e.body;return n.stream=TA(r,t),n},fA=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return gA(e,t);const n=yw({$metadata:DO(e),[MO]:[,e.headers[FO]],[qO]:[,e.headers[GO]]}),r=await Cy(e.body,t);return n.body=r,n},gA=async(e,t)=>{const n={...e,body:await Cw(e.body,t)},r=Iw(e,n.body);switch(r){case"AccessDeniedException":case"com.amazonaws.bedrockruntime#AccessDeniedException":throw await vA(n);case"InternalServerException":case"com.amazonaws.bedrockruntime#InternalServerException":throw await wA(n);case"ResourceNotFoundException":case"com.amazonaws.bedrockruntime#ResourceNotFoundException":throw await kA(n);case"ServiceQuotaExceededException":case"com.amazonaws.bedrockruntime#ServiceQuotaExceededException":throw await AA(n);case"ThrottlingException":case"com.amazonaws.bedrockruntime#ThrottlingException":throw await CA(n);case"ValidationException":case"com.amazonaws.bedrockruntime#ValidationException":throw await IA(n);case"ModelErrorException":case"com.amazonaws.bedrockruntime#ModelErrorException":throw await _A(n);case"ModelNotReadyException":case"com.amazonaws.bedrockruntime#ModelNotReadyException":throw await xA(n);case"ModelTimeoutException":case"com.amazonaws.bedrockruntime#ModelTimeoutException":throw await SA(n);case"ServiceUnavailableException":case"com.amazonaws.bedrockruntime#ServiceUnavailableException":throw await OA(n);case"ModelStreamErrorException":case"com.amazonaws.bedrockruntime#ModelStreamErrorException":throw await EA(n);case"ConflictException":case"com.amazonaws.bedrockruntime#ConflictException":throw await bA(n);default:const t=n.body;return yA({output:e,parsedBody:t,errorCode:r})}},yA=ow(yk),vA=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new vk({$metadata:DO(e),...n});return aw(s,e.body)},bA=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new Ek({$metadata:DO(e),...n});return aw(s,e.body)},wA=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new wk({$metadata:DO(e),...n});return aw(s,e.body)},_A=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy,originalStatusCode:Ny,resourceName:zy});Object.assign(n,i);const s=new Jk({$metadata:DO(e),...n});return aw(s,e.body)},xA=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new Yk({$metadata:DO(e),...n});return aw(s,e.body)},EA=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy,originalMessage:zy,originalStatusCode:Ny});Object.assign(n,i);const s=new Qk({$metadata:DO(e),...n});return aw(s,e.body)},SA=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new Xk({$metadata:DO(e),...n});return aw(s,e.body)},kA=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new Sk({$metadata:DO(e),...n});return aw(s,e.body)},AA=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new kk({$metadata:DO(e),...n});return aw(s,e.body)},OA=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new Ak({$metadata:DO(e),...n});return aw(s,e.body)},CA=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new _k({$metadata:DO(e),...n});return aw(s,e.body)},IA=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new xk({$metadata:DO(e),...n});return aw(s,e.body)},TA=(e,t)=>t.eventStreamMarshaller.deserialize(e,async n=>null!=n.messageStart?{messageStart:await LA(n.messageStart,t)}:null!=n.contentBlockStart?{contentBlockStart:await RA(n.contentBlockStart,t)}:null!=n.contentBlockDelta?{contentBlockDelta:await PA(n.contentBlockDelta,t)}:null!=n.contentBlockStop?{contentBlockStop:await jA(n.contentBlockStop,t)}:null!=n.messageStop?{messageStop:await DA(n.messageStop,t)}:null!=n.metadata?{metadata:await NA(n.metadata,t)}:null!=n.internalServerException?{internalServerException:await $A(n.internalServerException,t)}:null!=n.modelStreamErrorException?{modelStreamErrorException:await UA(n.modelStreamErrorException,t)}:null!=n.validationException?{validationException:await zA(n.validationException,t)}:null!=n.throttlingException?{throttlingException:await FA(n.throttlingException,t)}:null!=n.serviceUnavailableException?{serviceUnavailableException:await MA(n.serviceUnavailableException,t)}:{$unknown:e}),PA=async(e,t)=>{const n={},r=await Ow(e.body,t);return Object.assign(n,lO(r,t)),n},RA=async(e,t)=>{const n={},r=await Ow(e.body,t);return Object.assign(n,Sw(r)),n},jA=async(e,t)=>{const n={},r=await Ow(e.body,t);return Object.assign(n,Sw(r)),n},NA=async(e,t)=>{const n={},r=await Ow(e.body,t);return Object.assign(n,pO(r)),n},$A=async(e,t)=>{const n={...e,body:await Ow(e.body,t)};return wA(n)},LA=async(e,t)=>{const n={},r=await Ow(e.body,t);return Object.assign(n,Sw(r)),n},DA=async(e,t)=>{const n={},r=await Ow(e.body,t);return Object.assign(n,CO(r)),n},UA=async(e,t)=>{const n={...e,body:await Ow(e.body,t)};return EA(n)},MA=async(e,t)=>{const n={...e,body:await Ow(e.body,t)};return OA(n)},FA=async(e,t)=>{const n={...e,body:await Ow(e.body,t)};return CA(n)},zA=async(e,t)=>{const n={...e,body:await Ow(e.body,t)};return IA(n)},BA=(e,t)=>e.filter(e=>null!=e).map(e=>((e,t)=>Lk.visit(e,{cachePoint:e=>({cachePoint:Sw(e)}),document:e=>({document:qA(e,t)}),guardContent:e=>({guardContent:HA(e,t)}),image:e=>({image:VA(e,t)}),reasoningContent:e=>({reasoningContent:XA(e,t)}),text:e=>({text:e}),toolResult:e=>({toolResult:tO(e,t)}),toolUse:e=>({toolUse:sO(e)}),video:e=>({video:aO(e,t)}),_:(e,t)=>({[e]:t})}))(e,t)),qA=(e,t)=>vw(e,{format:[],name:[],source:e=>WA(e,t)}),WA=(e,t)=>Ik.visit(e,{bytes:e=>({bytes:t.base64Encoder(e)}),s3Location:e=>({s3Location:Sw(e)}),_:(e,t)=>({[e]:t})}),HA=(e,t)=>Pk.visit(e,{image:e=>({image:KA(e,t)}),text:e=>({text:Sw(e)}),_:(e,t)=>({[e]:t})}),KA=(e,t)=>vw(e,{format:[],source:e=>GA(e,t)}),GA=(e,t)=>Tk.visit(e,{bytes:e=>({bytes:t.base64Encoder(e)}),_:(e,t)=>({[e]:t})}),VA=(e,t)=>vw(e,{format:[],source:e=>ZA(e,t)}),ZA=(e,t)=>Rk.visit(e,{bytes:e=>({bytes:t.base64Encoder(e)}),s3Location:e=>({s3Location:Sw(e)}),_:(e,t)=>({[e]:t})}),JA=(e,t)=>vw(e,{maxTokens:[],stopSequences:Sw,temperature:Ew,topP:Ew}),YA=(e,t)=>e.filter(e=>null!=e).map(e=>((e,t)=>vw(e,{content:e=>BA(e,t),role:[]}))(e,t)),XA=(e,t)=>jk.visit(e,{reasoningText:e=>({reasoningText:Sw(e)}),redactedContent:e=>({redactedContent:t.base64Encoder(e)}),_:(e,t)=>({[e]:t})}),QA=(e,t)=>e.filter(e=>null!=e).map(e=>((e,t)=>Uk.visit(e,{cachePoint:e=>({cachePoint:Sw(e)}),guardContent:e=>({guardContent:HA(e,t)}),text:e=>({text:e}),_:(e,t)=>({[e]:t})}))(e,t)),eO=(e,t)=>vw(e,{toolChoice:Sw,tools:e=>rO(e)}),tO=(e,t)=>vw(e,{content:e=>nO(e,t),status:[],toolUseId:[]}),nO=(e,t)=>e.filter(e=>null!=e).map(e=>((e,t)=>$k.visit(e,{document:e=>({document:qA(e,t)}),image:e=>({image:VA(e,t)}),json:e=>({json:cO(e)}),text:e=>({text:e}),video:e=>({video:aO(e,t)}),_:(e,t)=>({[e]:t})}))(e,t)),rO=(e,t)=>e.filter(e=>null!=e).map(e=>(e=>zk.visit(e,{cachePoint:e=>({cachePoint:Sw(e)}),toolSpec:e=>({toolSpec:iO(e)}),_:(e,t)=>({[e]:t})}))(e)),iO=(e,t)=>vw(e,{description:[],inputSchema:e=>(e=>Fk.visit(e,{json:e=>({json:cO(e)}),_:(e,t)=>({[e]:t})}))(e),name:[]}),sO=(e,t)=>vw(e,{input:e=>cO(e),name:[],toolUseId:[]}),aO=(e,t)=>vw(e,{format:[],source:e=>oO(e,t)}),oO=(e,t)=>Nk.visit(e,{bytes:e=>({bytes:t.base64Encoder(e)}),s3Location:e=>({s3Location:Sw(e)}),_:(e,t)=>({[e]:t})}),cO=(e,t)=>e,lO=(e,t)=>vw(e,{contentBlockIndex:Ny,delta:e=>((e,t)=>null!=e.reasoningContent?{reasoningContent:TO(kw(e.reasoningContent),t)}:void 0!==zy(e.text)?{text:zy(e.text)}:null!=e.toolUse?{toolUse:Sw(e.toolUse)}:{$unknown:Object.entries(e)[0]})(kw(e),t)}),uO=(e,t)=>{const n=(e||[]).filter(e=>null!=e).map(e=>((e,t)=>null!=e.cachePoint?{cachePoint:Sw(e.cachePoint)}:null!=e.document?{document:fO(e.document,t)}:null!=e.guardContent?{guardContent:_O(kw(e.guardContent),t)}:null!=e.image?{image:kO(e.image,t)}:null!=e.reasoningContent?{reasoningContent:IO(kw(e.reasoningContent),t)}:void 0!==zy(e.text)?{text:zy(e.text)}:null!=e.toolResult?{toolResult:PO(e.toolResult,t)}:null!=e.toolUse?{toolUse:jO(e.toolUse)}:null!=e.video?{video:NO(e.video,t)}:{$unknown:Object.entries(e)[0]})(kw(e),t));return n},dO=(e,t)=>null!=e.message?{message:OO(e.message,t)}:{$unknown:Object.entries(e)[0]},pO=(e,t)=>vw(e,{metrics:Sw,performanceConfig:Sw,trace:e=>hO(e),usage:Sw}),hO=(e,t)=>vw(e,{guardrail:e=>SO(e),promptRouter:Sw}),mO=(e,t)=>vw(e,{guardrail:e=>SO(e),promptRouter:Sw}),fO=(e,t)=>vw(e,{format:zy,name:zy,source:e=>gO(kw(e),t)}),gO=(e,t)=>null!=e.bytes?{bytes:t.base64Decoder(e.bytes)}:null!=e.s3Location?{s3Location:Sw(e.s3Location)}:{$unknown:Object.entries(e)[0]},yO=(e,t)=>vw(e,{contentPolicy:Sw,contextualGroundingPolicy:e=>wO(e),invocationMetrics:Sw,sensitiveInformationPolicy:Sw,topicPolicy:Sw,wordPolicy:Sw}),vO=(e,t)=>Object.entries(e).reduce((e,[t,n])=>(null===n||(e[t]=(e=>{const t=(e||[]).filter(e=>null!=e).map(e=>yO(e));return t})(n)),e),{}),bO=(e,t)=>{const n=(e||[]).filter(e=>null!=e).map(e=>(e=>vw(e,{action:zy,detected:Ty,score:Wy,threshold:Wy,type:zy}))(e));return n},wO=(e,t)=>vw(e,{filters:e=>bO(e)}),_O=(e,t)=>null!=e.image?{image:xO(e.image,t)}:null!=e.text?{text:Sw(e.text)}:{$unknown:Object.entries(e)[0]},xO=(e,t)=>vw(e,{format:zy,source:e=>EO(kw(e),t)}),EO=(e,t)=>null!=e.bytes?{bytes:t.base64Decoder(e.bytes)}:{$unknown:Object.entries(e)[0]},SO=(e,t)=>vw(e,{actionReason:zy,inputAssessment:e=>(e=>Object.entries(e).reduce((e,[t,n])=>(null===n||(e[t]=yO(n)),e),{}))(e),modelOutput:Sw,outputAssessments:e=>vO(e)}),kO=(e,t)=>vw(e,{format:zy,source:e=>AO(kw(e),t)}),AO=(e,t)=>null!=e.bytes?{bytes:t.base64Decoder(e.bytes)}:null!=e.s3Location?{s3Location:Sw(e.s3Location)}:{$unknown:Object.entries(e)[0]},OO=(e,t)=>vw(e,{content:e=>uO(e,t),role:zy}),CO=(e,t)=>vw(e,{additionalModelResponseFields:e=>LO(e),stopReason:zy}),IO=(e,t)=>null!=e.reasoningText?{reasoningText:Sw(e.reasoningText)}:null!=e.redactedContent?{redactedContent:t.base64Decoder(e.redactedContent)}:{$unknown:Object.entries(e)[0]},TO=(e,t)=>null!=e.redactedContent?{redactedContent:t.base64Decoder(e.redactedContent)}:void 0!==zy(e.signature)?{signature:zy(e.signature)}:void 0!==zy(e.text)?{text:zy(e.text)}:{$unknown:Object.entries(e)[0]},PO=(e,t)=>vw(e,{content:e=>RO(e,t),status:zy,toolUseId:zy}),RO=(e,t)=>{const n=(e||[]).filter(e=>null!=e).map(e=>((e,t)=>null!=e.document?{document:fO(e.document,t)}:null!=e.image?{image:kO(e.image,t)}:null!=e.json?{json:LO(e.json)}:void 0!==zy(e.text)?{text:zy(e.text)}:null!=e.video?{video:NO(e.video,t)}:{$unknown:Object.entries(e)[0]})(kw(e),t));return n},jO=(e,t)=>vw(e,{input:e=>LO(e),name:zy,toolUseId:zy}),NO=(e,t)=>vw(e,{format:zy,source:e=>$O(kw(e),t)}),$O=(e,t)=>null!=e.bytes?{bytes:t.base64Decoder(e.bytes)}:null!=e.s3Location?{s3Location:Sw(e.s3Location)}:{$unknown:Object.entries(e)[0]},LO=(e,t)=>e,DO=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),UO="accept",MO="contentType",FO="content-type",zO="guardrailIdentifier",BO="guardrailVersion",qO="performanceConfigLatency",WO="trace",HO="x-amzn-bedrock-guardrailidentifier",KO="x-amzn-bedrock-guardrailversion",GO="x-amzn-bedrock-performanceconfig-latency",VO="x-amzn-bedrock-trace";class ZO extends(tw.classBuilder().ep(LE).m(function(e,t,n,r){return[Mg(n,this.serialize,this.deserialize),aE(n,e.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","Converse",{}).n("BedrockRuntimeClient","ConverseCommand").f(rA,sA).ser(uA).de(hA).build()){}class JO extends(tw.classBuilder().ep(LE).m(function(e,t,n,r){return[Mg(n,this.serialize,this.deserialize),aE(n,e.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","ConverseStream",{eventStream:{output:!0}}).n("BedrockRuntimeClient","ConverseStreamCommand").f(aA,oA).ser(dA).de(mA).build()){}class YO extends(tw.classBuilder().ep(LE).m(function(e,t,n,r){return[Mg(n,this.serialize,this.deserialize),aE(n,e.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","InvokeModel",{}).n("BedrockRuntimeClient","InvokeModelCommand").f(cA,lA).ser(pA).de(fA).build()){}const XO={warningEmitted:!1},QO=e=>{e&&!XO.warningEmitted&&parseInt(e.substring(1,e.indexOf(".")))<18&&(XO.warningEmitted=!0,process.emitWarning("NodeDeprecationWarning: The AWS SDK for JavaScript (v3) will\nno longer support Node.js 16.x on January 6, 2025.\n\nTo continue receiving updates to AWS services, bug fixes, and security\nupdates please upgrade to a supported Node.js LTS version.\n\nMore information can be found at: https://a.co/74kJMmI"))};function eC(e,t,n){return e.$source||(e.$source={}),e.$source[t]=n,e}function tC(e,t,n){e.__aws_sdk_context?e.__aws_sdk_context.features||(e.__aws_sdk_context.features={}):e.__aws_sdk_context={features:{}},e.__aws_sdk_context.features[t]=n}const nC="AWS_ACCESS_KEY_ID",rC="AWS_SECRET_ACCESS_KEY",iC="AWS_SESSION_TOKEN",sC="AWS_CREDENTIAL_EXPIRATION",aC="AWS_CREDENTIAL_SCOPE",oC="AWS_ACCOUNT_ID",cC=e=>async()=>{e?.logger?.debug("@aws-sdk/credential-provider-env - fromEnv");const t=process.env[nC],n=process.env[rC],r=process.env[iC],i=process.env[sC],s=process.env[aC],a=process.env[oC];if(t&&n){const e={accessKeyId:t,secretAccessKey:n,...r&&{sessionToken:r},...i&&{expiration:new Date(i)},...s&&{credentialScope:s},...a&&{accountId:a}};return eC(e,"CREDENTIALS_ENV_VARS","g"),e}throw new mb("Unable to find environment variable credentials.",{logger:e?.logger})};var lC=Object.freeze({__proto__:null,ENV_ACCOUNT_ID:oC,ENV_CREDENTIAL_SCOPE:aC,ENV_EXPIRATION:sC,ENV_KEY:nC,ENV_SECRET:rC,ENV_SESSION:iC,fromEnv:cC});const uC="AWS_EC2_METADATA_DISABLED";let dC=!1;const pC=(e={})=>yb(gb(async()=>{if(e.profile??process.env[Ix]){if(process.env[nC]&&process.env[rC]&&!dC){(e.logger?.warn&&"NoOpLogger"!==e.logger?.constructor?.name?e.logger.warn:console.warn)("@aws-sdk/credential-provider-node - defaultProvider::fromEnv WARNING:\n    Multiple credential sources detected: \n    Both AWS_PROFILE and the pair AWS_ACCESS_KEY_ID/AWS_SECRET_ACCESS_KEY static credentials are set.\n    This SDK will proceed with the AWS_PROFILE value.\n    \n    However, a future version may change this behavior to prefer the ENV static credentials.\n    Please ensure that your environment only sets either the AWS_PROFILE or the\n    AWS_ACCESS_KEY_ID/AWS_SECRET_ACCESS_KEY pair.\n"),dC=!0}throw new mb("AWS_PROFILE is set, skipping fromEnv provider.",{logger:e.logger,tryNextLink:!0})}return e.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromEnv"),cC(e)()},async()=>{e.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromSSO");const{ssoStartUrl:t,ssoAccountId:n,ssoRegion:r,ssoRoleName:i,ssoSession:s}=e;if(!(t||n||r||i||s))throw new mb("Skipping SSO provider in default chain (inputs do not include SSO fields).",{logger:e.logger});const{fromSSO:a}=await Promise.resolve().then(function(){return hB});return a(e)()},async()=>{e.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromIni");const{fromIni:t}=await Promise.resolve().then(function(){return xB});return t(e)()},async()=>{e.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromProcess");const{fromProcess:t}=await Promise.resolve().then(function(){return SB});return t(e)()},async()=>{e.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromTokenFile");const{fromTokenFile:t}=await Promise.resolve().then(function(){return OB});return t(e)()},async()=>(e.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::remoteProvider"),(await(async e=>{const{ENV_CMDS_FULL_URI:t,ENV_CMDS_RELATIVE_URI:n,fromContainerMetadata:r,fromInstanceMetadata:i}=await Promise.resolve().then(function(){return Oz});if(process.env[n]||process.env[t]){e.logger?.debug("@aws-sdk/credential-provider-node - remoteProvider::fromHttp/fromContainerMetadata");const{fromHttp:t}=await Promise.resolve().then(function(){return tB});return gb(t(e),r(e))}return process.env[uC]&&"false"!==process.env[uC]?async()=>{throw new mb("EC2 Instance Metadata Service access disabled",{logger:e.logger})}:(e.logger?.debug("@aws-sdk/credential-provider-node - remoteProvider::fromInstanceMetadata"),i(e))})(e))()),async()=>{throw new mb("Could not load credentials from any providers",{tryNextLink:!1,logger:e.logger})}),mC,hC),hC=e=>void 0!==e?.expiration,mC=e=>void 0!==e?.expiration&&e.expiration.getTime()-Date.now()<3e5;function fC(e){return void 0!==e&&Array.isArray(e.lc_namespace)}function gC(e){return function(e){return!!e&&"object"==typeof e&&"name"in e&&"schema"in e&&(lg(e.schema)||null!=e.schema&&"object"==typeof e.schema&&"type"in e.schema&&"string"==typeof e.schema.type&&["null","boolean","object","array","number","string"].includes(e.schema.type))}(e)||function(e){return void 0!==e&&gf.isRunnable(e)&&"lc_name"in e.constructor&&"function"==typeof e.constructor.lc_name&&"RunnableToolLike"===e.constructor.lc_name()}(e)||fC(e)}function yC(e,t){const n=typeof e;if(n!==typeof t)return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(!yC(e[r],t[r]))return!1;return!0}if("object"===n){if(!e||!t)return e===t;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const r of n)if(!yC(e[r],t[r]))return!1;return!0}return e===t}function vC(e,t){return{name:e.name,description:e.description,parameters:(n=e.schema,lg(n)?tf(n):n)};var n}const bC={providerName:"ChatBedrockConverse",fromStandardTextBlock:e=>({text:e.text}),fromStandardImageBlock(e){let t;if("url"===e.source_type){const n=Ao({dataUrl:e.url,asTypedArray:!0});if(n){return t=ko(n.mime_type).type,{image:{format:t,source:{bytes:n.data}}}}throw new Error("Only base64 data URLs are supported for image blocks with source type 'url' with ChatBedrockConverse.")}if("base64"===e.source_type){if(e.mime_type){t=ko(e.mime_type).subtype}if(t&&!["gif","jpeg","png","webp"].includes(t))throw new Error(`Unsupported image mime type: "${e.mime_type}" ChatBedrockConverse only supports "image/gif", "image/jpeg", "image/png", and "image/webp" formats.`);return{image:{format:t,source:{bytes:Uint8Array.from(atob(e.data),e=>e.charCodeAt(0))}}}}throw"id"===e.source_type?new Error("Image source type 'id' not supported with ChatBedrockConverse."):new Error(`Unsupported image source type: "${e.source_type}" with ChatBedrockConverse.`)},fromStandardFileBlock(e){const t={"text/csv":"csv","application/msword":"doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","text/html":"html","text/markdown":"md","application/pdf":"pdf","text/plain":"txt","application/vnd.ms-excel":"xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx"},n=e.metadata?.name??e.metadata?.filename??e.metadata?.title;if("text"===e.source_type)return{document:{name:n,format:"txt",source:{bytes:(new TextEncoder).encode(e.text)}}};if("url"===e.source_type){const r=Ao({dataUrl:e.url,asTypedArray:!0});if(r){const i=ko(r.mime_type??e.mime_type);return{document:{name:n,format:t[`${i.type}/${i.subtype}`],source:{bytes:r.data}}}}throw new Error("Only base64 data URLs are supported for file blocks with source type 'url' with ChatBedrockConverse.")}if("base64"===e.source_type){let r;if(e.mime_type){const n=ko(e.mime_type);if(r=t[`${n.type}/${n.subtype}`],void 0===r)throw new Error(`Unsupported file mime type: "${e.mime_type}" ChatBedrockConverse only supports ${Object.keys(t).join(", ")} formats.`)}return{document:{name:n,format:r,source:{bytes:Uint8Array.from(atob(e.data),e=>e.charCodeAt(0))}}}}if("id"===e.source_type)throw new Error("File source type 'id' not supported with ChatBedrockConverse.");throw new Error(`Unsupported file source type: "${e.source_type}" with ChatBedrockConverse.`)}};function wC({block:e,onUnknown:t="throw"}){if("string"==typeof e)return{text:e};if(_o(e))return Oo(e,bC);if("text"===e.type)return{text:e.text};if("image_url"===e.type)return function(e){const t=e.match(/^data:image\/(\w+);base64,/);let n;if(t){const e=t[1].toLowerCase();["gif","jpeg","png","webp"].includes(e)&&(n=e)}const r=e.replace(/^data:image\/\w+;base64,/,""),i=atob(r),s=new Uint8Array(i.length);for(let e=0;e<i.length;e+=1)s[e]=i.charCodeAt(e);return{image:{format:n,source:{bytes:s}}}}("string"==typeof e.image_url?e.image_url:e.image_url.url);if("document"===e.type&&void 0!==e.document)return{document:e.document};if("image"===e.type&&void 0!==e.image)return{image:e.image};if("throw"===t)throw new Error(`Unsupported content block type: ${e.type}`);return e}function _C(e){const t={role:"assistant",content:[]};if("string"==typeof e.content&&""!==e.content)t.content?.push({text:e.content});else if(Array.isArray(e.content)){const n=function(e){const t=[];let n={};for(const r of e)if("reasoning_content"===r.type){if("reasoningText"in r&&"object"==typeof r.reasoningText){"redactedContent"in n&&(t.push(n),n={});const{text:e,signature:i}=r.reasoningText,{text:s,signature:a}="reasoningText"in n?n.reasoningText:{};n={type:"reasoning_content",reasoningText:{...n.reasoningText??{},...void 0!==s||void 0!==e?{text:(s??"")+(e??"")}:{},...void 0!==a||void 0!==i?{signature:(a??"")+(i??"")}:{}}},"signature"in r.reasoningText&&(t.push(n),n={})}if("redactedContent"in r){"reasoningText"in n&&(t.push(n),n={});const{redactedContent:e}=r;n={type:"reasoning_content",redactedContent:("redactedContent"in n?n.redactedContent:"")+e}}}else Object.keys(n).length>0&&(t.push(n),n={}),t.push(r);Object.keys(n).length>0&&t.push(n);return t}(e.content).map(e=>{if("text"===e.type&&""!==e.text)return{text:e.text};if("reasoning_content"===e.type)return{reasoningContent:PC(e)};{const t=Object.fromEntries(Object.entries(e).filter(([e])=>"type"!==e));throw new Error(`Unsupported content block type: ${e.type} with content of ${JSON.stringify(t,null,2)}`)}});t.content=[...t.content?t.content:[],...n]}return e.tool_calls&&e.tool_calls.length&&(t.content=[...t.content?t.content:[],...e.tool_calls.map(e=>({toolUse:{toolUseId:e.id,name:e.name,input:e.args}}))]),t}function xC(e){const t=e.filter(e=>"system"===e._getType()).map(e=>function(e){if("string"==typeof e.content)return{text:e.content};if(1===e.content.length&&"text"===e.content[0].type)return{text:e.content[0].text};throw new Error("System message content must be either a string, or a content array containing a single text object.")}(e)),n=e.filter(e=>"system"!==e._getType()).map(e=>{if("ai"===e._getType())return _C(e);if("human"===e._getType()||"generic"===e._getType())return function(e){if(""===e.content)throw new Error(`Invalid message content: empty string. '${e._getType()}' must contain non-empty content.`);const t=Array.isArray(e.content)?e.content.map(e=>wC({block:e,onUnknown:"throw"})):[wC({block:e.content,onUnknown:"throw"})];return{role:"user",content:t}}(e);if("tool"===e._getType())return function(e){const t=e;return"string"==typeof t.content?{role:"user",content:[{toolResult:{toolUseId:t.tool_call_id,content:[{text:t.content}]}}]}:{role:"user",content:[{toolResult:{toolUseId:t.tool_call_id,content:e.content.map(e=>{const t=wC({block:e,onUnknown:"returnUnmodified"});return t!==e?t:{json:e}})}}]}}(e);throw new Error(`Unsupported message type: ${e._getType()}`)}),r=n.reduce((e,t)=>{const n=e[e.length-1];return n&&"user"===n.role&&n.content?.some(e=>"toolResult"in e)&&"user"===t.role&&t.content?.some(e=>"toolResult"in e)?n.content=n.content.concat(t.content):e.push(t),e},[]);return{converseMessages:r,converseSystem:t}}function EC(e){return!("object"!=typeof e||!e||!("toolSpec"in e))}function SC(e){if(e.every(sg))return e.map(e=>({toolSpec:{name:e.function.name,description:e.function.description,inputSchema:{json:e.function.parameters}}}));if(e.every(gC))return e.map(e=>({toolSpec:{name:e.name,description:e.description,inputSchema:{json:lg(e.schema)?tf(e.schema):e.schema}}}));if(e.every(EC))return e;throw new Error("Invalid tools passed. Must be an array of StructuredToolInterface, ToolDefinition, or BedrockTool.")}function kC(e,t,n){const r=n.supportsToolChoiceValues??[];let i;if("string"==typeof e)switch(e){case"any":i={any:{}};break;case"auto":i={auto:{}};break;default:if(!t.find(t=>t.toolSpec?.name===e))throw new Error(`Tool with name ${e} not found in tools list.`);i={tool:{name:e}}}else i=e;const s=Object.keys(i)[0];if(!r.includes(s)){let e="";throw e=r.length?`Model ${n.model} does not currently support 'tool_choice' of type ${s}. The following 'tool_choice' types are supported: ${r.join(", ")}.`:`Model ${n.model} does not currently support 'tool_choice'.`,new Error(`${e} Please seehttps://docs.aws.amazon.com/bedrock/latest/APIReference/API_runtime_ToolChoice.htmlfor the latest documentation on models that support tool choice.`)}return i}function AC(e,t){if(!e.content)throw new Error("No message content found in response.");if("assistant"!==e.role)throw new Error(`Unsupported message role received in ChatBedrockConverse response: ${e.role}`);let n,r;if("$metadata"in t&&t.$metadata&&"object"==typeof t.$metadata&&"requestId"in t.$metadata&&(n=t.$metadata.requestId),t.usage){const e=t.usage.inputTokens??0,n=t.usage.outputTokens??0;r={input_tokens:e,output_tokens:n,total_tokens:t.usage.totalTokens??e+n}}if(1===e.content?.length&&"text"in e.content[0]&&"string"==typeof e.content[0].text)return new Uo({content:e.content[0].text,response_metadata:t,usage_metadata:r,id:n});{const i=[],s=[];return e.content.forEach(e=>{"toolUse"in e&&e.toolUse&&e.toolUse.name&&e.toolUse.input&&"object"==typeof e.toolUse.input?i.push({id:e.toolUse.toolUseId,name:e.toolUse.name,args:e.toolUse.input,type:"tool_call"}):"text"in e&&"string"==typeof e.text?s.push({type:"text",text:e.text}):"reasoningContent"in e?s.push(function(e){const{reasoningText:t,redactedContent:n}=e;if(t)return{type:"reasoning_content",reasoningText:t};if(n)return{type:"reasoning_content",redactedContent:Buffer.from(n).toString("base64")};throw new Error("Invalid reasoning content")}(e.reasoningContent)):s.push(e)}),new Uo({content:s.length?s:"",tool_calls:i.length?i:void 0,response_metadata:t,usage_metadata:r,id:n})}}function OC(e){if(!e.delta)throw new Error("No delta found in content block.");if("string"==typeof e.delta.text)return new cm({text:e.delta.text,message:new zo({content:e.delta.text})});if(e.delta.toolUse){const t=e.contentBlockIndex;return new cm({text:"",message:new zo({content:"",tool_call_chunks:[{args:e.delta.toolUse.input,index:t,type:"tool_call_chunk"}]})})}if(e.delta.reasoningContent)return new cm({text:"",message:new zo({content:[TC(e.delta.reasoningContent)]})});throw new Error(`Unsupported content block type(s): ${JSON.stringify(e.delta,null,2)}`)}function CC(e){const t=e.contentBlockIndex;if(e.start?.toolUse)return new cm({text:"",message:new zo({content:"",tool_call_chunks:[{name:e.start.toolUse.name,id:e.start.toolUse.toolUseId,index:t,type:"tool_call_chunk"}]})});throw new Error("Unsupported content block start event.")}function IC(e,t){const n=e.usage?.inputTokens??0,r=e.usage?.outputTokens??0,i={input_tokens:n,output_tokens:r,total_tokens:e.usage?.totalTokens??n+r};return new cm({text:"",message:new zo({content:"",usage_metadata:t.streamUsage?i:void 0,response_metadata:{metadata:e}})})}function TC(e){const{text:t,redactedContent:n,signature:r}=e;if("string"==typeof t)return{type:"reasoning_content",reasoningText:{text:t}};if(r)return{type:"reasoning_content",reasoningText:{signature:r}};if(n)return{type:"reasoning_content",redactedContent:Buffer.from(n).toString("base64")};throw new Error("Invalid reasoning content")}function PC(e){if("reasoning_content"!==e.type)throw new Error("Invalid reasoning content");if("reasoningText"in e)return{reasoningText:e.reasoningText};if("redactedContent"in e)return{redactedContent:Buffer.from(e.redactedContent,"base64")};throw new Error("Invalid reasoning content")}class RC extends dg{static lc_name(){return"ChatBedrockConverse"}get lc_secrets(){return{apiKey:"API_KEY_NAME"}}get lc_aliases(){return{apiKey:"API_KEY_NAME"}}constructor(e){super(e??{}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"anthropic.claude-3-haiku-20240307-v1:0"}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"region",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"endpointHost",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additionalModelRequestFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"guardrailConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsToolChoiceValues",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{profile:t,filepath:n,configFilepath:r,ignoreCache:i,mfaCodeProvider:s,roleAssumer:a,roleArn:o,webIdentityTokenFile:c,roleAssumerWithWebIdentity:l,...u}=e??{},d=u?.credentials??pC({profile:t,filepath:n,configFilepath:r,ignoreCache:i,mfaCodeProvider:s,roleAssumer:a,roleArn:o,webIdentityTokenFile:c,roleAssumerWithWebIdentity:l}),p=u?.region??Pu("AWS_DEFAULT_REGION");if(!p)throw new Error("Please set the AWS_DEFAULT_REGION environment variable or pass it to the constructor as the region field.");this.client=e?.client??new gk({region:p,credentials:d,endpoint:u.endpointHost?`https://${u.endpointHost}`:void 0}),this.region=p,this.model=u?.model??this.model,this.streaming=u?.streaming??this.streaming,this.temperature=u?.temperature,this.maxTokens=u?.maxTokens,this.endpointHost=u?.endpointHost,this.topP=u?.topP,this.additionalModelRequestFields=u?.additionalModelRequestFields,this.streamUsage=u?.streamUsage??this.streamUsage,this.guardrailConfig=u?.guardrailConfig,void 0===u?.supportsToolChoiceValues?this.model.includes("claude-3")?this.supportsToolChoiceValues=["auto","any","tool"]:this.model.includes("mistral-large")?this.supportsToolChoiceValues=["auto","any"]:this.supportsToolChoiceValues=void 0:this.supportsToolChoiceValues=u.supportsToolChoiceValues}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"amazon_bedrock",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.inferenceConfig?.temperature??this.temperature,ls_max_tokens:t.inferenceConfig?.maxTokens??void 0,ls_stop:e.stop}}bindTools(e,t){return this.bind({tools:SC(e),...t})}_llmType(){return"chat_bedrock_converse"}invocationParams(e){let t;if(e?.tools&&e.tools.length){const n=SC(e.tools);t={tools:n,toolChoice:e.tool_choice?kC(e.tool_choice,n,{model:this.model,supportsToolChoiceValues:this.supportsToolChoiceValues}):void 0}}return{inferenceConfig:{maxTokens:this.maxTokens,temperature:this.temperature,topP:this.topP,stopSequences:e?.stop},toolConfig:t,additionalModelRequestFields:this.additionalModelRequestFields??e?.additionalModelRequestFields,guardrailConfig:this.guardrailConfig}}async _generate(e,t,n){if(this.streaming){const r=this._streamResponseChunks(e,t,n);let i;for await(const e of r)i=void 0===i?e:i.concat(e);if(void 0===i)throw new Error("Could not parse final output from Bedrock streaming call.");return{generations:[i],llmOutput:i.generationInfo}}return this._generateNonStreaming(e,t,n)}async _generateNonStreaming(e,t,n){const{converseMessages:r,converseSystem:i}=xC(e),s=this.invocationParams(t),a=new ZO({modelId:this.model,messages:r,system:i,...s}),o=await this.client.send(a,{abortSignal:t.signal}),{output:c,...l}=o;if(!c?.message)throw new Error("No message found in Bedrock response.");const u=AC(c.message,l);return{generations:[{text:"string"==typeof u.content?u.content:"",message:u}]}}async*_streamResponseChunks(e,t,n){const{converseMessages:r,converseSystem:i}=xC(e),s=this.invocationParams(t);let{streamUsage:a}=this;void 0!==t.streamUsage&&(a=t.streamUsage);const o=new JO({modelId:this.model,messages:r,system:i,...s}),c=await this.client.send(o,{abortSignal:t.signal});if(c.stream)for await(const e of c.stream)if(e.contentBlockStart)yield CC(e.contentBlockStart);else if(e.contentBlockDelta){const t=OC(e.contentBlockDelta);yield t,await(n?.handleLLMNewToken(t.text,void 0,void 0,void 0,void 0,{chunk:t}))}else e.metadata?yield IC(e.metadata,{streamUsage:a}):yield new cm({text:"",message:new zo({content:"",response_metadata:e})})}withStructuredOutput(e,t){const n=e,r=t?.name,i=n.description??"A function available to call.",s=t?.method,a=t?.includeRaw;if("jsonMode"===s)throw new Error("ChatBedrockConverse does not support 'jsonMode'.");let o,c=r??"extract";lg(n)?o=[{type:"function",function:{name:c,description:i,parameters:tf(n)}}]:("name"in n&&(c=n.name),o=[{type:"function",function:{name:c,description:i,parameters:n}}]);const l=this.supportsToolChoiceValues??[];let u;l.includes("tool")?u={tool_choice:o[0].function.name}:l.includes("any")&&(u={tool_choice:"any"});const d=this.bindTools(o,u),p=Ef.from(e=>{if(!e.tool_calls||0===e.tool_calls.length)throw new Error("No tool calls found in the response.");const t=e.tool_calls.find(e=>e.name===c);if(!t)throw new Error(`No tool call found with name ${c}.`);return t.args});if(!a)return d.pipe(p).withConfig({runName:"StructuredOutput"});const h=cg.assign({parsed:(e,t)=>p.invoke(e.raw,t)}),m=cg.assign({parsed:()=>null}),f=h.withFallbacks({fallbacks:[m]});return wf.from([{raw:d},f]).withConfig({runName:"StructuredOutputRunnable"})}}const jC={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},NC=e=>({applyToStack:t=>{t.add((e=>t=>async n=>{if(!xg.isInstance(n.request))return t(n);const{request:r}=n,{handlerProtocol:i=""}=e.requestHandler.metadata||{};if(i.indexOf("h2")>=0&&!r.headers[":authority"])delete r.headers.host,r.headers[":authority"]=r.hostname+(r.port?":"+r.port:"");else if(!r.headers.host){let e=r.hostname;null!=r.port&&(e+=`:${r.port}`),r.headers.host=e}return t(n)})(e),jC)}}),$C={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},LC=e=>({applyToStack:e=>{e.add((e,t)=>async n=>{try{const r=await e(n),{clientName:i,commandName:s,logger:a,dynamoDbDocumentClientOptions:o={}}=t,{overrideInputFilterSensitiveLog:c,overrideOutputFilterSensitiveLog:l}=o,u=c??t.inputFilterSensitiveLog,d=l??t.outputFilterSensitiveLog,{$metadata:p,...h}=r.output;return a?.info?.({clientName:i,commandName:s,input:u(n.input),output:d(h),metadata:p}),r}catch(e){const{clientName:r,commandName:i,logger:s,dynamoDbDocumentClientOptions:a={}}=t,{overrideInputFilterSensitiveLog:o}=a,c=o??t.inputFilterSensitiveLog;throw s?.error?.({clientName:r,commandName:i,input:c(n.input),error:e,metadata:e.$metadata}),e}},$C)}}),DC="X-Amzn-Trace-Id",UC={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},MC=e=>({applyToStack:t=>{t.add((e=>t=>async n=>{const{request:r}=n;if(!xg.isInstance(r)||"node"!==e.runtime)return t(n);const i=Object.keys(r.headers??{}).find(e=>e.toLowerCase()===DC.toLowerCase())??DC;if(r.headers.hasOwnProperty(i))return t(n);const s=process.env.AWS_LAMBDA_FUNCTION_NAME,a=process.env._X_AMZN_TRACE_ID,o=e=>"string"==typeof e&&e.length>0;return o(s)&&o(a)&&(r.headers[DC]=a),t({...n,request:r})})(e),UC)}}),FC=void 0;function zC(e){const t=Wg(e.userAgentAppId??FC),{customUserAgent:n}=e;return Object.assign(e,{customUserAgent:"string"==typeof n?[[n]]:n,userAgentAppId:async()=>{const n=await t();if(!function(e){return void 0===e||"string"==typeof e&&e.length<=50}(n)){const t="NoOpLogger"!==e.logger?.constructor?.name&&e.logger?e.logger:console;"string"!=typeof n?t?.warn("userAgentAppId must be a string or undefined."):n.length>50&&t?.warn("The provided userAgentAppId exceeds the maximum length of 50 characters.")}return n}})}const BC=(e,t=!1)=>{if(t){for(const t of e.split("."))if(!BC(t))return!1;return!0}return!!Iv(e)&&(!(e.length<3||e.length>63)&&(e===e.toLowerCase()&&!Ov(e)))};let qC={partitions:[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il|mx)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-east-2":{description:"Asia Pacific (Taipei)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"ap-southeast-5":{description:"Asia Pacific (Malaysia)"},"ap-southeast-7":{description:"Asia Pacific (Thailand)"},"aws-global":{description:"AWS Standard global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"mx-central-1":{description:"Mexico (Central)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"AWS China global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"AWS GovCloud (US) global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"c2s.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"AWS ISO (US) global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"sc2s.sgov.gov",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"AWS ISOB (US) global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"cloud.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{"aws-iso-e-global":{description:"AWS ISOE (Europe) global region"},"eu-isoe-west-1":{description:"EU ISOE West"}}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"csp.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{"aws-iso-f-global":{description:"AWS ISOF global region"},"us-isof-east-1":{description:"US ISOF EAST"},"us-isof-south-1":{description:"US ISOF SOUTH"}}},{id:"aws-eusc",outputs:{dnsSuffix:"amazonaws.eu",dualStackDnsSuffix:"amazonaws.eu",implicitGlobalRegion:"eusc-de-east-1",name:"aws-eusc",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eusc\\-(de)\\-\\w+\\-\\d+$",regions:{"eusc-de-east-1":{description:"EU (Germany)"}}}]};const WC={isVirtualHostableS3Bucket:BC,parseArn:e=>{const t=e.split(":");if(t.length<6)return null;const[n,r,i,s,a,...o]=t;if("arn"!==n||""===r||""===i||""===o.join(":"))return null;return{partition:r,service:i,region:s,accountId:a,resourceId:o.map(e=>e.split("/")).flat()}},partition:e=>{const{partitions:t}=qC;for(const n of t){const{regions:t,outputs:r}=n;for(const[n,i]of Object.entries(t))if(n===e)return{...r,...i}}for(const n of t){const{regionRegex:t,outputs:r}=n;if(new RegExp(t).test(e))return{...r}}const n=t.find(e=>"aws"===e.id);if(!n)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...n.outputs}}};Tv.aws=WC;const HC=e=>Eg.isInstance(e)?e.headers?.date??e.headers?.Date:void 0,KC=e=>new Date(Date.now()+e),GC=(e,t)=>{const n=Date.parse(e);return((e,t)=>Math.abs(KC(t).getTime()-e)>=3e5)(n,t)?n-Date.now():t},VC=(e,t)=>{if(!t)throw new Error(`Property \`${e}\` is not resolved for AWS SDK SigV4Auth`);return t};class ZC{async sign(e,t,n){if(!xg.isInstance(e))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const r=await(async e=>{const t=VC("context",e.context),n=VC("config",e.config),r=t.endpointV2?.properties?.authSchemes?.[0],i=VC("signer",n.signer),s=await i(r),a=e?.signingRegion,o=e?.signingRegionSet,c=e?.signingName;return{config:n,signer:s,signingRegion:a,signingRegionSet:o,signingName:c}})(n),{config:i,signer:s}=r;let{signingRegion:a,signingName:o}=r;const c=n.context;if(c?.authSchemes?.length){const[e,t]=c.authSchemes;"sigv4a"===e?.name&&"sigv4"===t?.name&&(a=t?.signingRegion??a,o=t?.signingName??o)}return await s.sign(e,{signingDate:KC(i.systemClockOffset),signingRegion:a,signingService:o})}errorHandler(e){return t=>{const n=t.ServerTime??HC(t.$response);if(n){const r=VC("config",e.config),i=r.systemClockOffset;r.systemClockOffset=GC(n,r.systemClockOffset);r.systemClockOffset!==i&&t.$metadata&&(t.$metadata.clockSkewCorrected=!0)}throw t}}successHandler(e,t){const n=HC(e);if(n){const e=VC("config",t.config);e.systemClockOffset=GC(n,e.systemClockOffset)}}}const JC=e=>"string"==typeof e&&e.length>0?e.split(",").map(e=>e.trim()):[],YC="AWS_AUTH_SCHEME_PREFERENCE",XC="auth_scheme_preference",QC={environmentVariableSelector:(e,t)=>{if(t?.signingName){if(`AWS_BEARER_TOKEN_${t.signingName.replace(/[\s-]/g,"_").toUpperCase()}`in e)return["httpBearerAuth"]}if(YC in e)return JC(e[YC])},configFileSelector:e=>{if(XC in e)return JC(e[XC])},default:[]},eI=e=>{let t,n=e.credentials,r=!!e.credentials;Object.defineProperty(e,"credentials",{set(i){i&&i!==n&&i!==t&&(r=!0),n=i;const s=function(e,{credentials:t,credentialDefaultProvider:n}){let r;r=t?t?.memoized?t:xv(t,bv,_v):n?Wg(n(Object.assign({},e,{parentClientConfig:e}))):async()=>{throw new Error("@aws-sdk/core::resolveAwsSdkSigV4Config - `credentials` not provided and no credentialDefaultProvider was configured.")};return r.memoized=!0,r}(e,{credentials:n,credentialDefaultProvider:e.credentialDefaultProvider}),a=function(e,t){if(t.configBound)return t;const n=async n=>t({...n,callerClientConfig:e});return n.memoized=t.memoized,n.configBound=!0,n}(e,s);r&&!a.attributed?(t=async e=>a(e).then(e=>eC(e,"CREDENTIALS_CODE","e")),t.memoized=a.memoized,t.configBound=a.configBound,t.attributed=!0):t=a},get:()=>t,enumerable:!0,configurable:!0}),e.credentials=n;const{signingEscapePath:i=!0,systemClockOffset:s=e.systemClockOffset||0,sha256:a}=e;let o;o=e.signer?Wg(e.signer):e.regionInfoProvider?()=>Wg(e.region)().then(async t=>[await e.regionInfoProvider(t,{useFipsEndpoint:await e.useFipsEndpoint(),useDualstackEndpoint:await e.useDualstackEndpoint()})||{},t]).then(([t,n])=>{const{signingRegion:r,signingService:s}=t;e.signingRegion=e.signingRegion||r||n,e.signingName=e.signingName||s||e.serviceId;const o={...e,credentials:e.credentials,region:e.signingRegion,service:e.signingName,sha256:a,uriEscapePath:i};return new(e.signerConstructor||Gb)(o)}):async t=>{const n=(t=Object.assign({},{name:"sigv4",signingName:e.signingName||e.defaultSigningName,signingRegion:await Wg(e.region)(),properties:{}},t)).signingRegion,r=t.signingName;e.signingRegion=e.signingRegion||n,e.signingName=e.signingName||r||e.serviceId;const s={...e,credentials:e.credentials,region:e.signingRegion,service:e.signingName,sha256:a,uriEscapePath:i};return new(e.signerConstructor||Gb)(s)};return Object.assign(e,{systemClockOffset:s,signingEscapePath:i,signer:o})};const tI=(e,t)=>Cy(e,t).then(e=>t.utf8Encoder(e)),nI=(e,t)=>tI(e,t).then(e=>{if(e.length)try{return JSON.parse(e)}catch(t){throw"SyntaxError"===t?.name&&Object.defineProperty(t,"$responseBodyText",{value:e}),t}return{}}),rI=async(e,t)=>{const n=await nI(e,t);return n.message=n.message??n.Message,n},iI=(e,t)=>{const n=(e,t)=>Object.keys(e).find(e=>e.toLowerCase()===t.toLowerCase()),r=e=>{let t=e;return"number"==typeof t&&(t=t.toString()),t.indexOf(",")>=0&&(t=t.split(",")[0]),t.indexOf(":")>=0&&(t=t.split(":")[0]),t.indexOf("#")>=0&&(t=t.split("#")[1]),t},i=n(e.headers,"x-amzn-errortype");if(void 0!==i)return r(e.headers[i]);if(t&&"object"==typeof t){const e=n(t,"code");if(e&&void 0!==t[e])return r(t[e]);if(void 0!==t.__type)return r(t.__type)}},sI=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",aI=new RegExp("^"+("["+sI+"]["+(sI+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040")+"]*")+"$");function oI(e,t){const n=[];let r=t.exec(e);for(;r;){const i=[];i.startIndex=t.lastIndex-r[0].length;const s=r.length;for(let e=0;e<s;e++)i.push(r[e]);n.push(i),r=t.exec(e)}return n}const cI=function(e){const t=aI.exec(e);return!(null==t)};const lI={allowBooleanAttributes:!1,unpairedTags:[]};function uI(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function dI(e,t){const n=t;for(;t<e.length;t++)if("?"==e[t]||" "==e[t]){const r=e.substr(n,t-n);if(t>5&&"xml"===r)return bI("InvalidXml","XML declaration allowed only at the start of the document.",xI(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}continue}return t}function pI(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let n=1;for(t+=8;t<e.length;t++)if("<"===e[t])n++;else if(">"===e[t]&&(n--,0===n))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}const hI='"',mI="'";function fI(e,t){let n="",r="",i=!1;for(;t<e.length;t++){if(e[t]===hI||e[t]===mI)""===r?r=e[t]:r!==e[t]||(r="");else if(">"===e[t]&&""===r){i=!0;break}n+=e[t]}return""===r&&{value:n,index:t,tagClosed:i}}const gI=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function yI(e,t){const n=oI(e,gI),r={};for(let e=0;e<n.length;e++){if(0===n[e][1].length)return bI("InvalidAttr","Attribute '"+n[e][2]+"' has no space in starting.",EI(n[e]));if(void 0!==n[e][3]&&void 0===n[e][4])return bI("InvalidAttr","Attribute '"+n[e][2]+"' is without value.",EI(n[e]));if(void 0===n[e][3]&&!t.allowBooleanAttributes)return bI("InvalidAttr","boolean attribute '"+n[e][2]+"' is not allowed.",EI(n[e]));const i=n[e][2];if(!wI(i))return bI("InvalidAttr","Attribute '"+i+"' is an invalid name.",EI(n[e]));if(r.hasOwnProperty(i))return bI("InvalidAttr","Attribute '"+i+"' is repeated.",EI(n[e]));r[i]=1}return!0}function vI(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let n=/\d/;for("x"===e[t]&&(t++,n=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(n))break}return-1}(e,++t);let n=0;for(;t<e.length;t++,n++)if(!(e[t].match(/\w/)&&n<20)){if(";"===e[t])break;return-1}return t}function bI(e,t,n){return{err:{code:e,msg:t,line:n.line||n,col:n.col}}}function wI(e){return cI(e)}function _I(e){return cI(e)}function xI(e,t){const n=e.substring(0,t).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function EI(e){return e.startIndex+e[1].length}const SI={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,n){return e},captureMetaData:!1};let kI;kI="function"!=typeof Symbol?"@@xmlMetadata":Symbol("XML Node Metadata");class AI{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e,t){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child}),void 0!==t&&(this.child[this.child.length-1][kI]={startIndex:t})}static getMetaDataSymbol(){return kI}}function OI(e,t){const n={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let r=1,i=!1,s=!1,a="";for(;t<e.length;t++)if("<"!==e[t]||s)if(">"===e[t]){if(s?"-"===e[t-1]&&"-"===e[t-2]&&(s=!1,r--):r--,0===r)break}else"["===e[t]?i=!0:a+=e[t];else{if(i&&jI(e,"!ENTITY",t)){let r,i;t+=7,[r,i,t]=II(e,t+1),-1===i.indexOf("&")&&(n[r]={regx:RegExp(`&${r};`,"g"),val:i})}else if(i&&jI(e,"!ELEMENT",t)){t+=8;const{index:n}=RI(e,t+1);t=n}else if(i&&jI(e,"!ATTLIST",t))t+=8;else if(i&&jI(e,"!NOTATION",t)){t+=9;const{index:n}=TI(e,t+1);t=n}else{if(!jI(e,"!--",t))throw new Error("Invalid DOCTYPE");s=!0}r++,a=""}if(0!==r)throw new Error("Unclosed DOCTYPE")}return{entities:n,i:t}}const CI=(e,t)=>{for(;t<e.length&&/\s/.test(e[t]);)t++;return t};function II(e,t){t=CI(e,t);let n="";for(;t<e.length&&!/\s/.test(e[t])&&'"'!==e[t]&&"'"!==e[t];)n+=e[t],t++;if(NI(n),t=CI(e,t),"SYSTEM"===e.substring(t,t+6).toUpperCase())throw new Error("External entities are not supported");if("%"===e[t])throw new Error("Parameter entities are not supported");let r="";return[t,r]=PI(e,t,"entity"),[n,r,--t]}function TI(e,t){t=CI(e,t);let n="";for(;t<e.length&&!/\s/.test(e[t]);)n+=e[t],t++;NI(n),t=CI(e,t);const r=e.substring(t,t+6).toUpperCase();if("SYSTEM"!==r&&"PUBLIC"!==r)throw new Error(`Expected SYSTEM or PUBLIC, found "${r}"`);t+=r.length,t=CI(e,t);let i=null,s=null;if("PUBLIC"===r)[t,i]=PI(e,t,"publicIdentifier"),'"'!==e[t=CI(e,t)]&&"'"!==e[t]||([t,s]=PI(e,t,"systemIdentifier"));else if("SYSTEM"===r&&([t,s]=PI(e,t,"systemIdentifier"),!s))throw new Error("Missing mandatory system identifier for SYSTEM notation");return{notationName:n,publicIdentifier:i,systemIdentifier:s,index:--t}}function PI(e,t,n){let r="";const i=e[t];if('"'!==i&&"'"!==i)throw new Error(`Expected quoted string, found "${i}"`);for(t++;t<e.length&&e[t]!==i;)r+=e[t],t++;if(e[t]!==i)throw new Error(`Unterminated ${n} value`);return[++t,r]}function RI(e,t){t=CI(e,t);let n="";for(;t<e.length&&!/\s/.test(e[t]);)n+=e[t],t++;if(!NI(n))throw new Error(`Invalid element name: "${n}"`);let r="";if("E"===e[t=CI(e,t)]&&jI(e,"MPTY",t))t+=4;else if("A"===e[t]&&jI(e,"NY",t))t+=2;else{if("("!==e[t])throw new Error(`Invalid Element Expression, found "${e[t]}"`);for(t++;t<e.length&&")"!==e[t];)r+=e[t],t++;if(")"!==e[t])throw new Error("Unterminated content model")}return{elementName:n,contentModel:r.trim(),index:t}}function jI(e,t,n){for(let r=0;r<t.length;r++)if(t[r]!==e[n+r+1])return!1;return!0}function NI(e){if(cI(e))return e;throw new Error(`Invalid entity name ${e}`)}const $I=/^[-+]?0x[a-fA-F0-9]+$/,LI=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,DI={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function UI(e,t={}){if(t=Object.assign({},DI,t),!e||"string"!=typeof e)return e;let n=e.trim();if(void 0!==t.skipLike&&t.skipLike.test(n))return e;if("0"===e)return 0;if(t.hex&&$I.test(n))return function(e,t){if(parseInt)return parseInt(e,t);if(Number.parseInt)return Number.parseInt(e,t);if(window&&window.parseInt)return window.parseInt(e,t);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}(n,16);if(-1!==n.search(/.+[eE].+/))return function(e,t,n){if(!n.eNotation)return e;const r=t.match(MI);if(r){let i=r[1]||"";const s=-1===r[3].indexOf("e")?"E":"e",a=r[2],o=i?e[a.length+1]===s:e[a.length]===s;return a.length>1&&o?e:1!==a.length||!r[3].startsWith(`.${s}`)&&r[3][0]!==s?n.leadingZeros&&!o?(t=(r[1]||"")+r[3],Number(t)):e:Number(t)}return e}(e,n,t);{const r=LI.exec(n);if(r){const i=r[1]||"",s=r[2];let a=function(e){if(e&&-1!==e.indexOf("."))return"."===(e=e.replace(/0+$/,""))?e="0":"."===e[0]?e="0"+e:"."===e[e.length-1]&&(e=e.substring(0,e.length-1)),e;return e}(r[3]);const o=i?"."===e[s.length+1]:"."===e[s.length];if(!t.leadingZeros&&(s.length>1||1===s.length&&!o))return e;{const r=Number(n),o=String(r);if(0===r)return r;if(-1!==o.search(/[eE]/))return t.eNotation?r:e;if(-1!==n.indexOf("."))return"0"===o||o===a||o===`${i}${a}`?r:e;let c=s?a:n;return s?c===o||i+c===o?r:e:c===o||c===i+o?r:e}}return e}}const MI=/^([-+])?(0*)(\d*(\.\d*)?[eE][-\+]?\d+)$/;class FI{constructor(e){var t;this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,t)=>String.fromCodePoint(Number.parseInt(t,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,t)=>String.fromCodePoint(Number.parseInt(t,16))}},this.addExternalEntities=zI,this.parseXml=KI,this.parseTextData=BI,this.resolveNameSpace=qI,this.buildAttributesMap=HI,this.isItStopNode=JI,this.replaceEntitiesValue=VI,this.readStopNodeData=QI,this.saveTextToParentTag=ZI,this.addChild=GI,this.ignoreAttributesFn="function"==typeof(t=this.options.ignoreAttributes)?t:Array.isArray(t)?e=>{for(const n of t){if("string"==typeof n&&e===n)return!0;if(n instanceof RegExp&&n.test(e))return!0}}:()=>!1}}function zI(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const r=t[n];this.lastEntities[r]={regex:new RegExp("&"+r+";","g"),val:e[r]}}}function BI(e,t,n,r,i,s,a){if(void 0!==e&&(this.options.trimValues&&!r&&(e=e.trim()),e.length>0)){a||(e=this.replaceEntitiesValue(e));const r=this.options.tagValueProcessor(t,e,n,i,s);if(null==r)return e;if(typeof r!=typeof e||r!==e)return r;if(this.options.trimValues)return eT(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?eT(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function qI(e){if(this.options.removeNSPrefix){const t=e.split(":"),n="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=n+t[1])}return e}const WI=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function HI(e,t,n){if(!0!==this.options.ignoreAttributes&&"string"==typeof e){const n=oI(e,WI),r=n.length,i={};for(let e=0;e<r;e++){const r=this.resolveNameSpace(n[e][1]);if(this.ignoreAttributesFn(r,t))continue;let s=n[e][4],a=this.options.attributeNamePrefix+r;if(r.length)if(this.options.transformAttributeName&&(a=this.options.transformAttributeName(a)),"__proto__"===a&&(a="#__proto__"),void 0!==s){this.options.trimValues&&(s=s.trim()),s=this.replaceEntitiesValue(s);const e=this.options.attributeValueProcessor(r,s,t);i[a]=null==e?s:typeof e!=typeof s||e!==s?e:eT(s,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[a]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=i,e}return i}}const KI=function(e){e=e.replace(/\r\n?/g,"\n");const t=new AI("!xml");let n=t,r="",i="";for(let s=0;s<e.length;s++){if("<"===e[s])if("/"===e[s+1]){const t=YI(e,">",s,"Closing Tag is not closed.");let a=e.substring(s+2,t).trim();if(this.options.removeNSPrefix){const e=a.indexOf(":");-1!==e&&(a=a.substr(e+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),n&&(r=this.saveTextToParentTag(r,n,i));const o=i.substring(i.lastIndexOf(".")+1);if(a&&-1!==this.options.unpairedTags.indexOf(a))throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let c=0;o&&-1!==this.options.unpairedTags.indexOf(o)?(c=i.lastIndexOf(".",i.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=i.lastIndexOf("."),i=i.substring(0,c),n=this.tagsNodeStack.pop(),r="",s=t}else if("?"===e[s+1]){let t=XI(e,s,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(r=this.saveTextToParentTag(r,n,i),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new AI(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,i,t.tagName)),this.addChild(n,e,i,s)}s=t.closeIndex+1}else if("!--"===e.substr(s+1,3)){const t=YI(e,"--\x3e",s+4,"Comment is not closed.");if(this.options.commentPropName){const a=e.substring(s+4,t-2);r=this.saveTextToParentTag(r,n,i),n.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}s=t}else if("!D"===e.substr(s+1,2)){const t=OI(e,s);this.docTypeEntities=t.entities,s=t.i}else if("!["===e.substr(s+1,2)){const t=YI(e,"]]>",s,"CDATA is not closed.")-2,a=e.substring(s+9,t);r=this.saveTextToParentTag(r,n,i);let o=this.parseTextData(a,n.tagname,i,!0,!1,!0,!0);null==o&&(o=""),this.options.cdataPropName?n.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]):n.add(this.options.textNodeName,o),s=t+2}else{let a=XI(e,s,this.options.removeNSPrefix),o=a.tagName;const c=a.rawTagName;let l=a.tagExp,u=a.attrExpPresent,d=a.closeIndex;this.options.transformTagName&&(o=this.options.transformTagName(o)),n&&r&&"!xml"!==n.tagname&&(r=this.saveTextToParentTag(r,n,i,!1));const p=n;p&&-1!==this.options.unpairedTags.indexOf(p.tagname)&&(n=this.tagsNodeStack.pop(),i=i.substring(0,i.lastIndexOf("."))),o!==t.tagname&&(i+=i?"."+o:o);const h=s;if(this.isItStopNode(this.options.stopNodes,i,o)){let t="";if(l.length>0&&l.lastIndexOf("/")===l.length-1)"/"===o[o.length-1]?(o=o.substr(0,o.length-1),i=i.substr(0,i.length-1),l=o):l=l.substr(0,l.length-1),s=a.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(o))s=a.closeIndex;else{const n=this.readStopNodeData(e,c,d+1);if(!n)throw new Error(`Unexpected end of ${c}`);s=n.i,t=n.tagContent}const r=new AI(o);o!==l&&u&&(r[":@"]=this.buildAttributesMap(l,i,o)),t&&(t=this.parseTextData(t,o,i,!0,u,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),r.add(this.options.textNodeName,t),this.addChild(n,r,i,h)}else{if(l.length>0&&l.lastIndexOf("/")===l.length-1){"/"===o[o.length-1]?(o=o.substr(0,o.length-1),i=i.substr(0,i.length-1),l=o):l=l.substr(0,l.length-1),this.options.transformTagName&&(o=this.options.transformTagName(o));const e=new AI(o);o!==l&&u&&(e[":@"]=this.buildAttributesMap(l,i,o)),this.addChild(n,e,i,h),i=i.substr(0,i.lastIndexOf("."))}else{const e=new AI(o);this.tagsNodeStack.push(n),o!==l&&u&&(e[":@"]=this.buildAttributesMap(l,i,o)),this.addChild(n,e,i,h),n=e}r="",s=d}}else r+=e[s]}return t.child};function GI(e,t,n,r){this.options.captureMetaData||(r=void 0);const i=this.options.updateTag(t.tagname,n,t[":@"]);!1===i||("string"==typeof i?(t.tagname=i,e.addChild(t,r)):e.addChild(t,r))}const VI=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const n=this.docTypeEntities[t];e=e.replace(n.regx,n.val)}for(let t in this.lastEntities){const n=this.lastEntities[t];e=e.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const n=this.htmlEntities[t];e=e.replace(n.regex,n.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function ZI(e,t,n,r){return e&&(void 0===r&&(r=0===t.child.length),void 0!==(e=this.parseTextData(e,t.tagname,n,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,r))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function JI(e,t,n){const r="*."+n;for(const n in e){const i=e[n];if(r===i||t===i)return!0}return!1}function YI(e,t,n,r){const i=e.indexOf(t,n);if(-1===i)throw new Error(r);return i+t.length-1}function XI(e,t,n,r=">"){const i=function(e,t,n=">"){let r,i="";for(let s=t;s<e.length;s++){let t=e[s];if(r)t===r&&(r="");else if('"'===t||"'"===t)r=t;else if(t===n[0]){if(!n[1])return{data:i,index:s};if(e[s+1]===n[1])return{data:i,index:s}}else"\t"===t&&(t=" ");i+=t}}(e,t+1,r);if(!i)return;let s=i.data;const a=i.index,o=s.search(/\s/);let c=s,l=!0;-1!==o&&(c=s.substring(0,o),s=s.substring(o+1).trimStart());const u=c;if(n){const e=c.indexOf(":");-1!==e&&(c=c.substr(e+1),l=c!==i.data.substr(e+1))}return{tagName:c,tagExp:s,closeIndex:a,attrExpPresent:l,rawTagName:u}}function QI(e,t,n){const r=n;let i=1;for(;n<e.length;n++)if("<"===e[n])if("/"===e[n+1]){const s=YI(e,">",n,`${t} is not closed`);if(e.substring(n+2,s).trim()===t&&(i--,0===i))return{tagContent:e.substring(r,n),i:s};n=s}else if("?"===e[n+1]){n=YI(e,"?>",n+1,"StopNode is not closed.")}else if("!--"===e.substr(n+1,3)){n=YI(e,"--\x3e",n+3,"StopNode is not closed.")}else if("!["===e.substr(n+1,2)){n=YI(e,"]]>",n,"StopNode is not closed.")-2}else{const r=XI(e,n,">");if(r){(r&&r.tagName)===t&&"/"!==r.tagExp[r.tagExp.length-1]&&i++,n=r.closeIndex}}}function eT(e,t,n){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&UI(e,n)}return function(e){return void 0!==e}(e)?e:""}const tT=AI.getMetaDataSymbol();function nT(e,t){return rT(e,t)}function rT(e,t,n){let r;const i={};for(let s=0;s<e.length;s++){const a=e[s],o=iT(a);let c="";if(c=void 0===n?o:n+"."+o,o===t.textNodeName)void 0===r?r=a[o]:r+=""+a[o];else{if(void 0===o)continue;if(a[o]){let e=rT(a[o],t,c);const n=aT(e,t);void 0!==a[tT]&&(e[tT]=a[tT]),a[":@"]?sT(e,a[":@"],c,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==i[o]&&i.hasOwnProperty(o)?(Array.isArray(i[o])||(i[o]=[i[o]]),i[o].push(e)):t.isArray(o,c,n)?i[o]=[e]:i[o]=e}}}return"string"==typeof r?r.length>0&&(i[t.textNodeName]=r):void 0!==r&&(i[t.textNodeName]=r),i}function iT(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function sT(e,t,n,r){if(t){const i=Object.keys(t),s=i.length;for(let a=0;a<s;a++){const s=i[a];r.isArray(s,n+"."+s,!0,!0)?e[s]=[t[s]]:e[s]=t[s]}}}function aT(e,t){const{textNodeName:n}=t,r=Object.keys(e).length;return 0===r||!(1!==r||!e[n]&&"boolean"!=typeof e[n]&&0!==e[n])}class oT{constructor(e){this.externalEntities={},this.options=function(e){return Object.assign({},SI,e)}(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const n=function(e,t){t=Object.assign({},lI,t);const n=[];let r=!1,i=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let s=0;s<e.length;s++)if("<"===e[s]&&"?"===e[s+1]){if(s+=2,s=dI(e,s),s.err)return s}else{if("<"!==e[s]){if(uI(e[s]))continue;return bI("InvalidChar","char '"+e[s]+"' is not expected.",xI(e,s))}{let a=s;if(s++,"!"===e[s]){s=pI(e,s);continue}{let o=!1;"/"===e[s]&&(o=!0,s++);let c="";for(;s<e.length&&">"!==e[s]&&" "!==e[s]&&"\t"!==e[s]&&"\n"!==e[s]&&"\r"!==e[s];s++)c+=e[s];if(c=c.trim(),"/"===c[c.length-1]&&(c=c.substring(0,c.length-1),s--),!_I(c)){let t;return t=0===c.trim().length?"Invalid space after '<'.":"Tag '"+c+"' is an invalid name.",bI("InvalidTag",t,xI(e,s))}const l=fI(e,s);if(!1===l)return bI("InvalidAttr","Attributes for '"+c+"' have open quote.",xI(e,s));let u=l.value;if(s=l.index,"/"===u[u.length-1]){const n=s-u.length;u=u.substring(0,u.length-1);const i=yI(u,t);if(!0!==i)return bI(i.err.code,i.err.msg,xI(e,n+i.err.line));r=!0}else if(o){if(!l.tagClosed)return bI("InvalidTag","Closing tag '"+c+"' doesn't have proper closing.",xI(e,s));if(u.trim().length>0)return bI("InvalidTag","Closing tag '"+c+"' can't have attributes or invalid starting.",xI(e,a));if(0===n.length)return bI("InvalidTag","Closing tag '"+c+"' has not been opened.",xI(e,a));{const t=n.pop();if(c!==t.tagName){let n=xI(e,t.tagStartPos);return bI("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+n.line+", col "+n.col+") instead of closing tag '"+c+"'.",xI(e,a))}0==n.length&&(i=!0)}}else{const o=yI(u,t);if(!0!==o)return bI(o.err.code,o.err.msg,xI(e,s-u.length+o.err.line));if(!0===i)return bI("InvalidXml","Multiple possible root nodes found.",xI(e,s));-1!==t.unpairedTags.indexOf(c)||n.push({tagName:c,tagStartPos:a}),r=!0}for(s++;s<e.length;s++)if("<"===e[s]){if("!"===e[s+1]){s++,s=pI(e,s);continue}if("?"!==e[s+1])break;if(s=dI(e,++s),s.err)return s}else if("&"===e[s]){const t=vI(e,s);if(-1==t)return bI("InvalidChar","char '&' is not expected.",xI(e,s));s=t}else if(!0===i&&!uI(e[s]))return bI("InvalidXml","Extra text at the end",xI(e,s));"<"===e[s]&&s--}}}return r?1==n.length?bI("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",xI(e,n[0].tagStartPos)):!(n.length>0)||bI("InvalidXml","Invalid '"+JSON.stringify(n.map(e=>e.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):bI("InvalidXml","Start tag expected.",1)}(e,t);if(!0!==n)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const n=new FI(this.options);n.addExternalEntities(this.externalEntities);const r=n.parseXml(e);return this.options.preserveOrder||void 0===r?r:nT(r,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}static getMetaDataSymbol(){return AI.getMetaDataSymbol()}}const cT=(e,t)=>tI(e,t).then(e=>{if(e.length){const t=new oT({attributeNamePrefix:"",htmlEntities:!0,ignoreAttributes:!1,ignoreDeclaration:!0,parseTagValue:!1,trimValues:!1,tagValueProcessor:(e,t)=>""===t.trim()&&t.includes("\n")?"":void 0});let n;t.addEntity("#xD","\r"),t.addEntity("#10","\n");try{n=t.parse(e,!0)}catch(t){throw t&&"object"==typeof t&&Object.defineProperty(t,"$responseBodyText",{value:e}),t}const r="#text",i=Object.keys(n)[0],s=n[i];return s[r]&&(s[i]=s[r],delete s[r]),mw(s)}return{}}),lT=async(e,t)=>{const n=await cT(e,t);return n.Error&&(n.Error.message=n.Error.message??n.Error.Message),n},uT=/\d{12}\.ddb/;const dT="user-agent",pT="x-amz-user-agent",hT=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,mT=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g;const fT=e=>(t,n)=>async r=>{const{request:i}=r;if(!xg.isInstance(i))return t(r);const{headers:s}=i,a=n?.userAgent?.map(gT)||[],o=(await e.defaultUserAgentProvider()).map(gT);await async function(e,t,n){const r=n.request;if("rpc-v2-cbor"===r?.headers?.["smithy-protocol"]&&tC(e,"PROTOCOL_RPC_V2_CBOR","M"),"function"==typeof t.retryStrategy){const n=await t.retryStrategy();"function"==typeof n.acquireInitialRetryToken?n.constructor?.name?.includes("Adaptive")?tC(e,"RETRY_MODE_ADAPTIVE","F"):tC(e,"RETRY_MODE_STANDARD","E"):tC(e,"RETRY_MODE_LEGACY","D")}if("function"==typeof t.accountIdEndpointMode){const n=e.endpointV2;switch(String(n?.url?.hostname).match(uT)&&tC(e,"ACCOUNT_ID_ENDPOINT","O"),await(t.accountIdEndpointMode?.())){case"disabled":tC(e,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":tC(e,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":tC(e,"ACCOUNT_ID_MODE_REQUIRED","R")}}const i=e.__smithy_context?.selectedHttpAuthScheme?.identity;if(i?.$source){const t=i;t.accountId&&tC(e,"RESOLVED_ACCOUNT_ID","T");for(const[n,r]of Object.entries(t.$source??{}))tC(e,n,r)}}(n,e,r);const c=n;o.push(`m/${function(e){let t="";for(const n in e){const r=e[n];if(!(t.length+r.length+1<=1024))break;t.length?t+=","+r:t+=r}return t}(Object.assign({},n.__smithy_context?.features,c.__aws_sdk_context?.features))}`);const l=e?.customUserAgent?.map(gT)||[],u=await e.userAgentAppId();u&&o.push(gT([`app/${u}`]));const d=[].concat([...o,...a,...l]).join(" "),p=[...o.filter(e=>e.startsWith("aws-sdk-")),...l].join(" ");return"browser"!==e.runtime?(p&&(s[pT]=s[pT]?`${s[dT]} ${p}`:p),s[dT]=d):s[pT]=d,t({...r,request:i})},gT=e=>{const t=e[0].split("/").map(e=>e.replace(hT,"-")).join("/"),n=e[1]?.replace(mT,"-"),r=t.indexOf("/"),i=t.substring(0,r);let s=t.substring(r+1);return"api"===i&&(s=s.toLowerCase()),[i,s,n].filter(e=>e&&e.length>0).reduce((e,t,n)=>{switch(n){case 0:return t;case 1:return`${e}/${t}`;default:return`${e}#${t}`}},"")},yT={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},vT=e=>({applyToStack:t=>{t.add(fT(e),yT)}}),bT=({serviceId:e,clientVersion:t})=>async n=>{const r=[["aws-sdk-js",t],["ua","2.1"],[`os/${P()}`,R()],["lang/js"],["md/nodejs",`${z.node}`]];e&&r.push([`api/${e}`,t]),B.AWS_EXECUTION_ENV&&r.push([`exec-env/${B.AWS_EXECUTION_ENV}`]);const i=await(n?.userAgentAppId?.());return i?[...r,[`app/${i}`]]:[...r]},wT={environmentVariableSelector:e=>e.AWS_SDK_UA_APP_ID,configFileSelector:e=>e.sdk_ua_app_id??e["sdk-ua-app-id"],default:FC},_T=e=>({setRegion(t){e.region=t},region:()=>e.region}),xT=e=>({region:e.region()});let ET=class{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new mm(e??{})}};class ST extends ET{constructor(e){super(e??{}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),this.model=e?.model??"amazon.titan-embed-text-v1",this.client=e?.client??new gk({region:e?.region,credentials:e?.credentials})}async _embedText(e){return this.caller.call(async()=>{try{const t=e.replace(/\n/g," "),n=await this.client.send(new YO({modelId:this.model,body:JSON.stringify({inputText:t}),contentType:"application/json",accept:"application/json"})),r=(new TextDecoder).decode(n.body);return JSON.parse(r).embedding}catch(e){if(console.error({error:e}),e instanceof Error)throw new Error(`An error occurred while embedding documents with Bedrock: ${e.message}`);throw new Error("An error occurred while embedding documents with Bedrock")}})}embedQuery(e){return this.caller.callWithOptions({},this._embedText.bind(this),e)}async embedDocuments(e){return Promise.all(e.map(e=>this._embedText(e)))}}const kT=async(e,t,n)=>({operation:Pg(t).operation,region:await Rg(e.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});const AT=e=>{const t=[];return e.operation,t.push(function(e){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"polly",region:e.region},propertiesExtractor:(e,t)=>({signingProperties:{config:e,context:t}})}}(e)),t},OT={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}};var CT="3.816.0";const IT="required",TT="fn",PT="argv",RT="ref",jT=!0,NT="isSet",$T="booleanEquals",LT="error",DT="endpoint",UT="tree",MT="PartitionResult",FT={[IT]:!1,type:"String"},zT={[IT]:!0,default:!1,type:"Boolean"},BT={[RT]:"Endpoint"},qT={[TT]:$T,[PT]:[{[RT]:"UseFIPS"},!0]},WT={[TT]:$T,[PT]:[{[RT]:"UseDualStack"},!0]},HT={},KT={[TT]:"getAttr",[PT]:[{[RT]:MT},"supportsFIPS"]},GT={[TT]:$T,[PT]:[!0,{[TT]:"getAttr",[PT]:[{[RT]:MT},"supportsDualStack"]}]},VT=[qT],ZT=[WT],JT=[{[RT]:"Region"}],YT={parameters:{Region:FT,UseDualStack:zT,UseFIPS:zT,Endpoint:FT},rules:[{conditions:[{[TT]:NT,[PT]:[BT]}],rules:[{conditions:VT,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:LT},{conditions:ZT,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:LT},{endpoint:{url:BT,properties:HT,headers:HT},type:DT}],type:UT},{conditions:[{[TT]:NT,[PT]:JT}],rules:[{conditions:[{[TT]:"aws.partition",[PT]:JT,assign:MT}],rules:[{conditions:[qT,WT],rules:[{conditions:[{[TT]:$T,[PT]:[jT,KT]},GT],rules:[{endpoint:{url:"https://polly-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:HT,headers:HT},type:DT}],type:UT},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:LT}],type:UT},{conditions:VT,rules:[{conditions:[{[TT]:$T,[PT]:[KT,jT]}],rules:[{endpoint:{url:"https://polly-fips.{Region}.{PartitionResult#dnsSuffix}",properties:HT,headers:HT},type:DT}],type:UT},{error:"FIPS is enabled but this partition does not support FIPS",type:LT}],type:UT},{conditions:ZT,rules:[{conditions:[GT],rules:[{endpoint:{url:"https://polly.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:HT,headers:HT},type:DT}],type:UT},{error:"DualStack is enabled but this partition does not support DualStack",type:LT}],type:UT},{endpoint:{url:"https://polly.{Region}.{PartitionResult#dnsSuffix}",properties:HT,headers:HT},type:DT}],type:UT}],type:UT},{error:"Invalid Configuration: Missing Region",type:LT}]},XT=new kv({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),QT=(e,t={})=>XT.get(e,()=>Jv(YT,{endpointParams:e,logger:t.logger}));Tv.aws=Qv;const eP=e=>{dw(process.version);const t=uk(e),n=()=>t().then(lw),r=(e=>({apiVersion:"2016-06-10",base64Decoder:e?.base64Decoder??Zg,base64Encoder:e?.base64Encoder??Qg,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??QT,extensions:e?.extensions??[],httpAuthSchemeProvider:e?.httpAuthSchemeProvider??AT,httpAuthSchemes:e?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4"),signer:new cb}],logger:e?.logger??new gw,sdkStreamMixin:e?.sdkStreamMixin??Oy,serviceId:e?.serviceId??"Polly",urlParser:e?.urlParser??tE,utf8Decoder:e?.utf8Decoder??Jg,utf8Encoder:e?.utf8Encoder??Xg}))(e);tb(process.version);const i={profile:e?.profile,logger:r.logger};return{...r,...e,runtime:"node",defaultsMode:t,authSchemePreference:e?.authSchemePreference??Yx(pb,i),bodyLengthChecker:e?.bodyLengthChecker??NS,credentialDefaultProvider:e?.credentialDefaultProvider??VE,defaultUserAgentProvider:e?.defaultUserAgentProvider??AS({serviceId:r.serviceId,clientVersion:CT}),maxAttempts:e?.maxAttempts??Yx(SE,e),region:e?.region??Yx(px,{...hx,...i}),requestHandler:dy.create(e?.requestHandler??n),retryMode:e?.retryMode??Yx({...AE,default:async()=>(await n()).retryMode||lE},e),sha256:e?.sha256??RS.bind(null,"sha256"),streamCollector:e?.streamCollector??gy,useDualstackEndpoint:e?.useDualstackEndpoint??Yx(ux,i),useFipsEndpoint:e?.useFipsEndpoint??Yx(dx,i),userAgentAppId:e?.userAgentAppId??Yx(OS,i)}};class tP extends ew{config;constructor(...[e]){const t=eP(e||{});super(t),this.initConfig=t;var n;const r=Sv((n=t,Object.assign(n,{useDualstackEndpoint:n.useDualstackEndpoint??!1,useFipsEndpoint:n.useFipsEndpoint??!1,defaultSigningName:"polly"}))),i=kE(r),s=gx(i),a=((e,t)=>{const n=Object.assign(mk(e),pw(e),pg(e),(e=>{const t=e.httpAuthSchemes;let n=e.httpAuthSchemeProvider,r=e.credentials;return{setHttpAuthScheme(e){const n=t.findIndex(t=>t.schemeId===e.schemeId);-1===n?t.push(e):t.splice(n,1,e)},httpAuthSchemes:()=>t,setHttpAuthSchemeProvider(e){n=e},httpAuthSchemeProvider:()=>n,setCredentials(e){r=e},credentials:()=>r}})(e));return t.forEach(e=>e.configure(n)),Object.assign(e,fk(n),hw(n),hg(n),{httpAuthSchemes:(r=n).httpAuthSchemes(),httpAuthSchemeProvider:r.httpAuthSchemeProvider(),credentials:r.credentials()});var r})((e=>{const t=Vb(e);return Object.assign(t,{authSchemePreference:Rg(e.authSchemePreference??[])})})(oE(s)),e?.extensions||[]);this.config=a,this.middlewareStack.use(ox(this.config)),this.middlewareStack.use(RE(this.config)),this.middlewareStack.use(bx(this.config)),this.middlewareStack.use(kg(this.config)),this.middlewareStack.use(Og(this.config)),this.middlewareStack.use(Tg(this.config)),this.middlewareStack.use($g(this.config,{httpAuthSchemeParametersProvider:kT,identityProviderConfigProvider:async e=>new yv({"aws.auth#sigv4":e.credentials})})),this.middlewareStack.use(qg(this.config))}destroy(){super.destroy()}}class nP extends sw{constructor(e){super(e),Object.setPrototypeOf(this,nP.prototype)}}class rP extends nP{name="LexiconNotFoundException";$fault="client";constructor(e){super({name:"LexiconNotFoundException",$fault:"client",...e}),Object.setPrototypeOf(this,rP.prototype)}}class iP extends nP{name="ServiceFailureException";$fault="server";constructor(e){super({name:"ServiceFailureException",$fault:"server",...e}),Object.setPrototypeOf(this,iP.prototype)}}class sP extends nP{name="InvalidNextTokenException";$fault="client";constructor(e){super({name:"InvalidNextTokenException",$fault:"client",...e}),Object.setPrototypeOf(this,sP.prototype)}}class aP extends nP{name="EngineNotSupportedException";$fault="client";constructor(e){super({name:"EngineNotSupportedException",$fault:"client",...e}),Object.setPrototypeOf(this,aP.prototype)}}class oP extends nP{name="InvalidTaskIdException";$fault="client";constructor(e){super({name:"InvalidTaskIdException",$fault:"client",...e}),Object.setPrototypeOf(this,oP.prototype)}}class cP extends nP{name="SynthesisTaskNotFoundException";$fault="client";constructor(e){super({name:"SynthesisTaskNotFoundException",$fault:"client",...e}),Object.setPrototypeOf(this,cP.prototype)}}class lP extends nP{name="InvalidLexiconException";$fault="client";constructor(e){super({name:"InvalidLexiconException",$fault:"client",...e}),Object.setPrototypeOf(this,lP.prototype)}}class uP extends nP{name="InvalidS3BucketException";$fault="client";constructor(e){super({name:"InvalidS3BucketException",$fault:"client",...e}),Object.setPrototypeOf(this,uP.prototype)}}class dP extends nP{name="InvalidS3KeyException";$fault="client";constructor(e){super({name:"InvalidS3KeyException",$fault:"client",...e}),Object.setPrototypeOf(this,dP.prototype)}}class pP extends nP{name="InvalidSampleRateException";$fault="client";constructor(e){super({name:"InvalidSampleRateException",$fault:"client",...e}),Object.setPrototypeOf(this,pP.prototype)}}class hP extends nP{name="InvalidSnsTopicArnException";$fault="client";constructor(e){super({name:"InvalidSnsTopicArnException",$fault:"client",...e}),Object.setPrototypeOf(this,hP.prototype)}}class mP extends nP{name="InvalidSsmlException";$fault="client";constructor(e){super({name:"InvalidSsmlException",$fault:"client",...e}),Object.setPrototypeOf(this,mP.prototype)}}class fP extends nP{name="LanguageNotSupportedException";$fault="client";constructor(e){super({name:"LanguageNotSupportedException",$fault:"client",...e}),Object.setPrototypeOf(this,fP.prototype)}}class gP extends nP{name="LexiconSizeExceededException";$fault="client";constructor(e){super({name:"LexiconSizeExceededException",$fault:"client",...e}),Object.setPrototypeOf(this,gP.prototype)}}class yP extends nP{name="MarksNotSupportedForFormatException";$fault="client";constructor(e){super({name:"MarksNotSupportedForFormatException",$fault:"client",...e}),Object.setPrototypeOf(this,yP.prototype)}}class vP extends nP{name="MaxLexemeLengthExceededException";$fault="client";constructor(e){super({name:"MaxLexemeLengthExceededException",$fault:"client",...e}),Object.setPrototypeOf(this,vP.prototype)}}class bP extends nP{name="MaxLexiconsNumberExceededException";$fault="client";constructor(e){super({name:"MaxLexiconsNumberExceededException",$fault:"client",...e}),Object.setPrototypeOf(this,bP.prototype)}}class wP extends nP{name="UnsupportedPlsAlphabetException";$fault="client";constructor(e){super({name:"UnsupportedPlsAlphabetException",$fault:"client",...e}),Object.setPrototypeOf(this,wP.prototype)}}class _P extends nP{name="UnsupportedPlsLanguageException";$fault="client";constructor(e){super({name:"UnsupportedPlsLanguageException",$fault:"client",...e}),Object.setPrototypeOf(this,_P.prototype)}}class xP extends nP{name="SsmlMarksNotSupportedForTextTypeException";$fault="client";constructor(e){super({name:"SsmlMarksNotSupportedForTextTypeException",$fault:"client",...e}),Object.setPrototypeOf(this,xP.prototype)}}class EP extends nP{name="TextLengthExceededException";$fault="client";constructor(e){super({name:"TextLengthExceededException",$fault:"client",...e}),Object.setPrototypeOf(this,EP.prototype)}}const SP=e=>({...e}),kP=async(e,t)=>{const n=fv(e,t);let r;return n.bp("/v1/speech"),r=JSON.stringify(vw(e,{Engine:[],LanguageCode:[],LexiconNames:e=>Sw(e),OutputFormat:[],SampleRate:[],SpeechMarkTypes:e=>Sw(e),Text:[],TextType:[],VoiceId:[]})),n.m("POST").h({"content-type":"application/json"}).b(r),n.build()},AP=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return OP(e,t);const n=yw({$metadata:JP(e),[YP]:[,e.headers[QP]],[XP]:[()=>void 0!==e.headers[eR],()=>Ky(e.headers[eR])]}),r=e.body;return t.sdkStreamMixin(r),n.AudioStream=r,n},OP=async(e,t)=>{const n={...e,body:await Cw(e.body,t)},r=Iw(e,n.body);switch(r){case"LexiconNotFoundException":case"com.amazonaws.polly#LexiconNotFoundException":throw await MP(n);case"ServiceFailureException":case"com.amazonaws.polly#ServiceFailureException":throw await WP(n);case"InvalidNextTokenException":case"com.amazonaws.polly#InvalidNextTokenException":throw await PP(n);case"InvalidTaskIdException":case"com.amazonaws.polly#InvalidTaskIdException":throw await DP(n);case"SynthesisTaskNotFoundException":case"com.amazonaws.polly#SynthesisTaskNotFoundException":throw await KP(n);case"InvalidLexiconException":case"com.amazonaws.polly#InvalidLexiconException":throw await TP(n);case"LexiconSizeExceededException":case"com.amazonaws.polly#LexiconSizeExceededException":throw await FP(n);case"MaxLexemeLengthExceededException":case"com.amazonaws.polly#MaxLexemeLengthExceededException":throw await BP(n);case"MaxLexiconsNumberExceededException":case"com.amazonaws.polly#MaxLexiconsNumberExceededException":throw await qP(n);case"UnsupportedPlsAlphabetException":case"com.amazonaws.polly#UnsupportedPlsAlphabetException":throw await VP(n);case"UnsupportedPlsLanguageException":case"com.amazonaws.polly#UnsupportedPlsLanguageException":throw await ZP(n);case"EngineNotSupportedException":case"com.amazonaws.polly#EngineNotSupportedException":throw await IP(n);case"InvalidS3BucketException":case"com.amazonaws.polly#InvalidS3BucketException":throw await RP(n);case"InvalidS3KeyException":case"com.amazonaws.polly#InvalidS3KeyException":throw await jP(n);case"InvalidSampleRateException":case"com.amazonaws.polly#InvalidSampleRateException":throw await NP(n);case"InvalidSnsTopicArnException":case"com.amazonaws.polly#InvalidSnsTopicArnException":throw await $P(n);case"InvalidSsmlException":case"com.amazonaws.polly#InvalidSsmlException":throw await LP(n);case"LanguageNotSupportedException":case"com.amazonaws.polly#LanguageNotSupportedException":throw await UP(n);case"MarksNotSupportedForFormatException":case"com.amazonaws.polly#MarksNotSupportedForFormatException":throw await zP(n);case"SsmlMarksNotSupportedForTextTypeException":case"com.amazonaws.polly#SsmlMarksNotSupportedForTextTypeException":throw await HP(n);case"TextLengthExceededException":case"com.amazonaws.polly#TextLengthExceededException":throw await GP(n);default:const t=n.body;return CP({output:e,parsedBody:t,errorCode:r})}},CP=ow(nP),IP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new aP({$metadata:JP(e),...n});return aw(s,e.body)},TP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new lP({$metadata:JP(e),...n});return aw(s,e.body)},PP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new sP({$metadata:JP(e),...n});return aw(s,e.body)},RP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new uP({$metadata:JP(e),...n});return aw(s,e.body)},jP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new dP({$metadata:JP(e),...n});return aw(s,e.body)},NP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new pP({$metadata:JP(e),...n});return aw(s,e.body)},$P=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new hP({$metadata:JP(e),...n});return aw(s,e.body)},LP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new mP({$metadata:JP(e),...n});return aw(s,e.body)},DP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new oP({$metadata:JP(e),...n});return aw(s,e.body)},UP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new fP({$metadata:JP(e),...n});return aw(s,e.body)},MP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new rP({$metadata:JP(e),...n});return aw(s,e.body)},FP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new gP({$metadata:JP(e),...n});return aw(s,e.body)},zP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new yP({$metadata:JP(e),...n});return aw(s,e.body)},BP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new vP({$metadata:JP(e),...n});return aw(s,e.body)},qP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new bP({$metadata:JP(e),...n});return aw(s,e.body)},WP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new iP({$metadata:JP(e),...n});return aw(s,e.body)},HP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new xP({$metadata:JP(e),...n});return aw(s,e.body)},KP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new cP({$metadata:JP(e),...n});return aw(s,e.body)},GP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new EP({$metadata:JP(e),...n});return aw(s,e.body)},VP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new wP({$metadata:JP(e),...n});return aw(s,e.body)},ZP=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new _P({$metadata:JP(e),...n});return aw(s,e.body)},JP=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),YP="ContentType",XP="RequestCharacters",QP="content-type",eR="x-amzn-requestcharacters";class tR extends(tw.classBuilder().ep(OT).m(function(e,t,n,r){return[Mg(n,this.serialize,this.deserialize),aE(n,e.getEndpointParameterInstructions())]}).s("Parrot_v1","SynthesizeSpeech",{}).n("PollyClient","SynthesizeSpeechCommand").f(void 0,SP).ser(kP).de(AP).build()){}var nR=64,rR=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),iR=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],sR=Math.pow(2,53)-1,aR=function(){function e(){this.state=Int32Array.from(iR),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return e.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var t=0,n=e.byteLength;if(this.bytesHashed+=n,8*this.bytesHashed>sR)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=e[t++],n--,this.bufferLength===nR&&(this.hashBuffer(),this.bufferLength=0)},e.prototype.digest=function(){if(!this.finished){var e=8*this.bytesHashed,t=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(t.setUint8(this.bufferLength++,128),n%nR>=56){for(var r=this.bufferLength;r<nR;r++)t.setUint8(r,0);this.hashBuffer(),this.bufferLength=0}for(r=this.bufferLength;r<56;r++)t.setUint8(r,0);t.setUint32(56,Math.floor(e/4294967296),!0),t.setUint32(60,e),this.hashBuffer(),this.finished=!0}var i=new Uint8Array(32);for(r=0;r<8;r++)i[4*r]=this.state[r]>>>24&255,i[4*r+1]=this.state[r]>>>16&255,i[4*r+2]=this.state[r]>>>8&255,i[4*r+3]=this.state[r]>>>0&255;return i},e.prototype.hashBuffer=function(){for(var e=this.buffer,t=this.state,n=t[0],r=t[1],i=t[2],s=t[3],a=t[4],o=t[5],c=t[6],l=t[7],u=0;u<nR;u++){if(u<16)this.temp[u]=(255&e[4*u])<<24|(255&e[4*u+1])<<16|(255&e[4*u+2])<<8|255&e[4*u+3];else{var d=this.temp[u-2],p=(d>>>17|d<<15)^(d>>>19|d<<13)^d>>>10,h=((d=this.temp[u-15])>>>7|d<<25)^(d>>>18|d<<14)^d>>>3;this.temp[u]=(p+this.temp[u-7]|0)+(h+this.temp[u-16]|0)}var m=(((a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7))+(a&o^~a&c)|0)+(l+(rR[u]+this.temp[u]|0)|0)|0,f=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&r^n&i^r&i)|0;l=c,c=o,o=a,a=s+m|0,s=i,i=r,r=n,n=m+f|0}t[0]+=n,t[1]+=r,t[2]+=i,t[3]+=s,t[4]+=a,t[5]+=o,t[6]+=c,t[7]+=l},e}(),oR=function(){function e(e){this.secret=e,this.hash=new aR,this.reset()}return e.prototype.update=function(e){var t;if(("string"==typeof(t=e)?0!==t.length:0!==t.byteLength)&&!this.error)try{this.hash.update(eS(e))}catch(e){this.error=e}},e.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},e.prototype.digest=function(){return YE(this,void 0,void 0,function(){return XE(this,function(e){return[2,this.digestSync()]})})},e.prototype.reset=function(){if(this.hash=new aR,this.secret){this.outer=new aR;var e=function(e){var t=eS(e);if(t.byteLength>nR){var n=new aR;n.update(t),t=n.digest()}var r=new Uint8Array(nR);return r.set(t),r}(this.secret),t=new Uint8Array(nR);t.set(e);for(var n=0;n<nR;n++)e[n]^=54,t[n]^=92;this.hash.update(e),this.outer.update(t);for(n=0;n<e.byteLength;n++)e[n]=0}},e}();function cR(e){const t=e.match(/^data:(image\/.+);base64,(.+)$/);if(null===t)throw new Error(["Anthropic only supports base64-encoded images currently.","Example: data:image/png;base64,/9j/4AAQSk..."].join("\n\n"));return{type:"base64",media_type:t[1]??"",data:t[2]??""}}function lR(e){if(void 0===e.id)throw new Error('Anthropic requires all tool calls to have an "id".');return{type:"tool_use",id:e.id,name:e.name,input:e.args}}function uR(e){if("string"==typeof e)return e;return e.flatMap(e=>{if("image_url"===e.type){let t;return t="string"==typeof e.image_url?cR(e.image_url):cR(e.image_url.url),{type:"image",source:t}}if("text"===e.type||"text_delta"===e.type)return""===e.text?[]:{type:"text",text:e.text};if("tool_use"===e.type||"tool_result"===e.type)return{...e};if("input_json_delta"===e.type)return[];throw new Error("Unsupported message content format")})}function dR(e){const t=function(e){const t=[];for(const n of e)if("tool"===n._getType())if("string"==typeof n.content){const e=t[t.length-1];"human"===e?._getType()&&Array.isArray(e.content)&&"type"in e.content[0]&&"tool_result"===e.content[0].type?e.content.push({type:"tool_result",content:n.content,tool_use_id:n.tool_call_id}):t.push(new Ho({content:[{type:"tool_result",content:n.content,tool_use_id:n.tool_call_id}]}))}else t.push(new Ho({content:[{type:"tool_result",content:uR(n.content),tool_use_id:n.tool_call_id}]}));else t.push(n);return t}(e);let n;if(t.length>0&&"system"===t[0]._getType()){if("string"!=typeof e[0].content)throw new Error("System message content must be a string.");n=e[0].content}return{messages:(void 0!==n?t.slice(1):t).map(e=>{let t;if("human"===e._getType())t="user";else if("ai"===e._getType())t="assistant";else{if("tool"!==e._getType())throw"system"===e._getType()?new Error("System messages are only permitted as the first passed message."):new Error(`Message type "${e._getType()}" is not supported.`);t="user"}if(Mo(e)&&e.tool_calls?.length){if("string"==typeof e.content)return""===e.content?{role:t,content:e.tool_calls.map(lR)}:{role:t,content:[{type:"text",text:e.content},...e.tool_calls.map(lR)]};{const n=uR(e.content);if(Array.isArray(n)){const r=e.tool_calls.map(lR);return{role:t,content:[...n,...r]}}return{role:t,content:n}}}return{role:t,content:uR(e.content)}}),system:n}}function pR(e){return!("object"!=typeof e||!e)&&"input_schema"in e}class hR{static prepareInput(e,t,n=50,r=0,i=void 0,s={},a="invoke",o=void 0){const c={};return"anthropic"===e?(c.prompt=t,c.max_tokens_to_sample=n,c.temperature=r,c.stop_sequences=i):"ai21"===e?(c.prompt=t,c.maxTokens=n,c.temperature=r,c.stopSequences=i):"meta"===e?(c.prompt=t,c.max_gen_len=n,c.temperature=r):"amazon"===e?(c.inputText=t,c.textGenerationConfig={maxTokenCount:n,temperature:r}):"cohere"===e?(c.prompt=t,c.max_tokens=n,c.temperature=r,c.stop_sequences=i,"invoke-with-response-stream"===a&&(c.stream=!0)):"mistral"===e&&(c.prompt=t,c.max_tokens=n,c.temperature=r,c.stop=i),o&&o.tagSuffix&&o.streamProcessingMode&&(c["amazon-bedrock-guardrailConfig"]=o),{...c,...s}}static prepareMessagesInput(e,t,n=1024,r=0,i=void 0,s={},a=void 0,o=[]){const c={};if("anthropic"===e){const{system:e,messages:s}=dR(t);void 0!==e&&(c.system=e),c.anthropic_version="bedrock-2023-05-31",c.messages=s,c.max_tokens=n,c.temperature=r,c.stop_sequences=i,o.length>0&&(c.tools=o)}else{if("cohere"!==e)throw new Error("The messages API is currently only supported by Anthropic or Cohere");{const{system:e,message:s,chatHistory:a}=function(e){const t=e.filter(e=>"system"===e._getType()),n=t.filter(e=>"string"==typeof e.content).map(e=>e.content).join("\n\n"),r=e.filter(e=>"system"!==e._getType()),i=r.slice(-1);if(!i.length||"human"!==i[0]._getType())throw new Error("question message content must be a human message.");if("string"!=typeof i[0].content)throw new Error("question message content must be a string.");const s=i[0].content;return{chatHistory:r.slice(0,-1).map(e=>{let t;switch(e._getType()){case"human":t="USER";break;case"ai":t="CHATBOT";break;case"system":throw new Error("chat_history can not include system prompts.");default:throw new Error(`Message type "${e._getType()}" is not supported.`)}if("string"!=typeof e.content)throw new Error("message content must be a string.");return{role:t,message:e.content}}),message:s,system:n}}(t);void 0!==e&&e.length>0&&(c.preamble=e),c.message=s,c.chat_history=a,c.max_tokens=n,c.temperature=r,c.stop_sequences=i}}return a&&a.tagSuffix&&a.streamProcessingMode&&(c["amazon-bedrock-guardrailConfig"]=a),{...c,...s}}static prepareOutput(e,t){return"anthropic"===e?t.completion:"ai21"===e?t?.completions?.[0]?.data?.text??"":"cohere"===e?t?.generations?.[0]?.text??t?.text??"":"meta"===e?t.generation:"mistral"===e?t?.outputs?.[0]?.text:t.results?.[0]?.outputText}static prepareMessagesOutput(e,t,n){const r=t??{};if("anthropic"===e){if("message"===r.type)return mR(r);if("message_start"===r.type)return mR(r.message,!0);const e=function(e,t){if("message_start"===e.type){const{content:n,usage:r,...i}=e.message,s={};for(const[e,t]of Object.entries(i))null!=t&&(s[e]=t);return new zo({content:t.coerceContentToString?"":[],additional_kwargs:s})}if("message_delta"===e.type){let n;return new zo({content:t.coerceContentToString?"":[],additional_kwargs:{...e.delta},usage_metadata:n})}if("content_block_start"===e.type&&"tool_use"===e.content_block.type)return new zo({content:t.coerceContentToString?"":[{index:e.index,...e.content_block,input:""}],additional_kwargs:{}});if("content_block_delta"===e.type&&"text_delta"===e.delta.type){const n=e.delta?.text;if(void 0!==n)return new zo({content:t.coerceContentToString?n:[{index:e.index,...e.delta}],additional_kwargs:{}})}else{if("content_block_delta"===e.type&&"input_json_delta"===e.delta.type)return new zo({content:t.coerceContentToString?"":[{index:e.index,input:e.delta.partial_json,type:e.delta.type}],additional_kwargs:{}});if("message_stop"===e.type&&void 0!==e["amazon-bedrock-invocationMetrics"])return new zo({content:"",response_metadata:{"amazon-bedrock-invocationMetrics":e["amazon-bedrock-invocationMetrics"]},usage_metadata:{input_tokens:e["amazon-bedrock-invocationMetrics"].inputTokenCount,output_tokens:e["amazon-bedrock-invocationMetrics"].outputTokenCount,total_tokens:e["amazon-bedrock-invocationMetrics"].inputTokenCount+e["amazon-bedrock-invocationMetrics"].outputTokenCount}})}return null}(t,{coerceContentToString:n?.coerceContentToString});if(!e)return;const i=function(e){let t;const n=Array.isArray(e.content)?e.content.find(e=>"tool_use"===e.type):void 0;n&&"index"in n&&"name"in n&&"id"in n&&(t={args:"",id:n.id,name:n.name,index:n.index,type:"tool_call_chunk"});const r=Array.isArray(e.content)?e.content.find(e=>"input_json_delta"===e.type):void 0;return r&&"index"in r&&"input"in r&&(t="string"==typeof r.input?{args:r.input,index:r.index,type:"tool_call_chunk"}:{args:JSON.stringify(r.input,null,2),index:r.index,type:"tool_call_chunk"}),t}(e);let s;const a=function(e,t){let n,r=t;if(r=r?Xh(r,e):e,Array.isArray(r.content)&&r.content.find(e=>"tool_use"===e.type))try{const e=r.content.find(e=>"tool_use"===e.type);if(!e||!("input"in e||"name"in e||"id"in e))return;const t=JSON.parse(e.input);t&&(n={type:"tool_use",id:e.id,name:e.name,input:t})}catch(e){}return{toolUseContent:n,concatenatedChunks:r}}(e,void 0);a&&(s=a.toolUseContent);const o=Array.isArray(e.content)?e.content.filter(e=>"tool_use"!==e.type):e.content;Array.isArray(o)&&s&&o.push(s);const c=function(e){return"string"==typeof e.content&&""!==e.content?e.content:void 0}(e);return new cm({message:new zo({content:o,additional_kwargs:e.additional_kwargs,tool_call_chunks:i?[i]:void 0,usage_metadata:e.usage_metadata,response_metadata:e.response_metadata}),generationInfo:{...e.response_metadata},text:c??""})}if("cohere"===e)return"stream-start"===r.event_type?fR(r.message,!0):"text-generation"===r.event_type&&"string"==typeof r?.text?new cm({message:new zo({content:r.text}),text:r.text}):"search-queries-generation"===r.event_type?fR(r):"stream-end"===r.event_type&&void 0!==r.response&&void 0!==r["amazon-bedrock-invocationMetrics"]?new cm({message:new zo({content:""}),text:"",generationInfo:{response:r.response,"amazon-bedrock-invocationMetrics":r["amazon-bedrock-invocationMetrics"]}}):"COMPLETE"===r.finish_reason||"MAX_TOKENS"===r.finish_reason?fR(r):void 0;throw new Error("The messages API is currently only supported by Anthropic or Cohere.")}}function mR(e,t){const{content:n,id:r,...i}=e;let s;if(s=Array.isArray(n)&&1===n.length&&"text"===n[0].type?n[0].text:Array.isArray(n)&&0===n.length?"":n,t)return new cm({message:new zo({content:s,additional_kwargs:{id:r}}),text:"string"==typeof s?s:"",generationInfo:i});{const t=function(e){const t=[];for(const n of e)"tool_use"===n.type&&t.push({name:n.name,args:n.input,id:n.id,type:"tool_call"});return t}(e.content);return t.length>0?{message:new Uo({content:e.content,additional_kwargs:{id:r},tool_calls:t}),text:"string"==typeof s?s:"",generationInfo:i}:{message:new Uo({content:s,additional_kwargs:{id:r},tool_calls:t}),text:"string"==typeof s?s:"",generationInfo:i}}}function fR(e,t){const{text:n,...r}=e;let i=n;return"string"!=typeof n&&(i=""),t?new cm({message:new zo({content:i}),text:i,generationInfo:r}):{message:new Uo({content:i}),text:i,generationInfo:r}}const gR=["us","sa","me","il","eu","cn","ca","ap","af","us-gov"],yR=["ai21","anthropic","amazon","cohere","meta","mistral","deepseek"];function vR(e,t="\n\nHuman:",n="\n\nAssistant:"){const r=[...e];return 0!==r.length&&"ai"===r[r.length-1]._getType()||r.push(new Uo({content:""})),r.map(e=>function(e,t,n){if("human"===e._getType())return`${t} ${e.content}`;if("ai"===e._getType())return`${n} ${e.content}`;if("system"===e._getType())return`${t} <admin>${e.content}</admin>`;if("function"===e._getType())return`${t} ${e.content}`;if(Bo.isInstance(e))return`\n\n${e.role[0].toUpperCase()+e.role.slice(1)}: {message.content}`;throw new Error(`Unknown role: ${e._getType()}`)}(e,t,n)).join("")}function bR(e){if(!e||!e.length)return[];if(e.every(gC))return e.map(e=>({name:e.name,description:e.description,input_schema:lg(e.schema)?tf(e.schema):e.schema}));if(e.every(sg))return e.map(e=>({name:e.function.name,description:e.function.description,input_schema:e.function.parameters}));if(e.every(pR))return e;if(e.some(fC)||e.some(sg)||e.some(pR))throw new Error("All tools passed to BedrockChat must be of the same type.");throw new Error("Invalid tool format received.")}let wR=class extends dg{get lc_aliases(){return{model:"model_id",region:"region_name"}}get lc_secrets(){return{"credentials.accessKeyId":"AWS_ACCESS_KEY_ID","credentials.secretAccessKey":"AWS_SECRET_ACCESS_KEY","credentials.sessionToken":"AWS_SECRET_ACCESS_KEY",awsAccessKeyId:"AWS_ACCESS_KEY_ID",awsSecretAccessKey:"AWS_SECRET_ACCESS_KEY",awsSessionToken:"AWS_SESSION_TOKEN"}}get lc_attributes(){return{region:this.region}}_identifyingParams(){return{model:this.model}}_llmType(){return"bedrock"}static lc_name(){return"BedrockChat"}constructor(e){const t=e?.awsAccessKeyId??Pu("AWS_ACCESS_KEY_ID"),n=e?.awsSecretAccessKey??Pu("AWS_SECRET_ACCESS_KEY"),r=e?.awsSessionToken??Pu("AWS_SESSION_TOKEN");let i=e?.credentials;if(void 0===i){if(void 0===t||void 0===n)throw new Error("Please set your AWS credentials in the 'credentials' field or set env vars AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY, and optionally AWS_SESSION_TOKEN.");i={accessKeyId:t,secretAccessKey:n,sessionToken:r}}if(super(e={...e,awsAccessKeyId:t,awsSecretAccessKey:n,awsSessionToken:r}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"amazon.titan-tg1-large"}),Object.defineProperty(this,"modelProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"region",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"credentials",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchFn",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"endpointHost",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"codec",{enumerable:!0,configurable:!0,writable:!0,value:new yS(Xg,Jg)}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"usesMessagesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"trace",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"guardrailIdentifier",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"guardrailVersion",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"guardrailConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.model=e?.model??this.model,this.modelProvider=xR(this.model),!yR.includes(this.modelProvider))throw new Error(`Unknown model provider: '${this.modelProvider}', only these are supported: ${yR}`);const s=e?.region??Pu("AWS_DEFAULT_REGION");if(!s)throw new Error("Please set the AWS_DEFAULT_REGION environment variable or pass it to the constructor as the region field.");this.region=s,this.credentials=i,this.temperature=e?.temperature??this.temperature,this.maxTokens=e?.maxTokens??this.maxTokens,this.fetchFn=e?.fetchFn??fetch.bind(globalThis),this.endpointHost=e?.endpointHost??e?.endpointUrl,this.stopSequences=e?.stopSequences,this.modelKwargs=e?.modelKwargs,this.streaming=e?.streaming??this.streaming,this.usesMessagesApi=function(e){const t=xR(e);if("anthropic"===t&&!e.includes("claude-v2")&&!e.includes("claude-instant-v1"))return!0;if("cohere"===t){if(e.includes("command-r-v1"))return!0;if(e.includes("command-r-plus-v1"))return!0}return!1}(this.model),this.trace=e?.trace??this.trace,this.guardrailVersion=e?.guardrailVersion??this.guardrailVersion,this.guardrailIdentifier=e?.guardrailIdentifier??this.guardrailIdentifier,this.guardrailConfig=e?.guardrailConfig,e?.applicationInferenceProfile&&(this.model=e?.applicationInferenceProfile)}invocationParams(e){if(e?.tool_choice)throw new Error("'tool_choice' call option is not supported by BedrockChat.");return{tools:e?.tools?bR(e.tools):void 0,temperature:this.temperature,max_tokens:this.maxTokens,stop:e?.stop??this.stopSequences,modelKwargs:this.modelKwargs,guardrailConfig:this.guardrailConfig}}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"bedrock",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}async _generate(e,t,n){if(this.streaming){const r=this._streamResponseChunks(e,t,n);let i;for await(const e of r)i=void 0===i?e:i.concat(e);if(void 0===i)throw new Error("Could not parse final output from Bedrock streaming call.");return{generations:[i],llmOutput:i.generationInfo}}return this._generateNonStreaming(e,t,n)}async _generateNonStreaming(e,t,n){const r=this.endpointHost??`bedrock-runtime.${this.region}.amazonaws.com`,i=this.modelProvider,s=await this._signedFetch(e,t,{bedrockMethod:"invoke",endpointHost:r,provider:i}),a=await s.json();if(!s.ok)throw new Error(`Error ${s.status}: ${a.message??JSON.stringify(a)}`);if(this.usesMessagesApi){const e=hR.prepareMessagesOutput(i,a);if(void 0===e)throw new Error("Failed to parse output generation.");return{generations:[e],llmOutput:e.generationInfo}}{const e=hR.prepareOutput(i,a);return{generations:[{text:e,message:new Uo(e)}]}}}async _signedFetch(e,t,n){const{bedrockMethod:r,endpointHost:i,provider:s}=n,{max_tokens:a,temperature:o,stop:c,modelKwargs:l,guardrailConfig:u,tools:d}=this.invocationParams(t),p=this.usesMessagesApi?hR.prepareMessagesInput(s,e,a,o,c,l,u,d):hR.prepareInput(s,vR(e),a,o,c,l,n.bedrockMethod,u),h=new URL(`https://${i}/model/${this.model}/${r}`),m=new xg({hostname:h.hostname,path:h.pathname,protocol:h.protocol,method:"POST",body:JSON.stringify(p),query:Object.fromEntries(h.searchParams.entries()),headers:{host:h.host,accept:"application/json","content-type":"application/json",...this.trace&&this.guardrailIdentifier&&this.guardrailVersion&&{"X-Amzn-Bedrock-Trace":this.trace,"X-Amzn-Bedrock-GuardrailIdentifier":this.guardrailIdentifier,"X-Amzn-Bedrock-GuardrailVersion":this.guardrailVersion}}}),f=new Gb({credentials:this.credentials,service:"bedrock",region:this.region,sha256:oR}),g=await f.sign(m);return await this.caller.callWithOptions({signal:t.signal},async()=>this.fetchFn(h,{headers:g.headers,body:g.body,method:g.method}))}async*_streamResponseChunks(e,t,n){const r=this.modelProvider,i=this.endpointHost??`bedrock-runtime.${this.region}.amazonaws.com`,s="anthropic"===r||"cohere"===r||"meta"===r||"mistral"===r?"invoke-with-response-stream":"invoke",a=await this._signedFetch(e,t,{bedrockMethod:s,endpointHost:i,provider:r});if(a.status<200||a.status>=300)throw Error(`Failed to access underlying url '${i}': got ${a.status} ${a.statusText}: ${await a.text()}`);if("anthropic"===r||"cohere"===r||"meta"===r||"mistral"===r){const e=!!((o=t).tools&&o.tools.length>0),i=a.body?.getReader(),s=new TextDecoder;for await(const t of this._readChunks(i)){const i=this.codec.decode(t);if(void 0!==i.headers[":event-type"]&&"chunk"!==i.headers[":event-type"].value||"application/json"!==i.headers[":content-type"].value)throw Error(`Failed to get event chunk: got ${t}`);const a=JSON.parse(s.decode(i.body));if(a.message)throw new Error(a.message);if(void 0!==a.bytes){const t=JSON.parse(s.decode(Uint8Array.from(atob(a.bytes),e=>e.codePointAt(0)??0)));if(this.usesMessagesApi){const i=hR.prepareMessagesOutput(r,t,{coerceContentToString:!e});if(void 0===i)continue;"anthropic"===r&&void 0!==i.generationInfo?.usage&&delete i.generationInfo.usage;const s=i.generationInfo?.["amazon-bedrock-invocationMetrics"];null!=s&&"object"==typeof s&&Mo(i.message)&&(i.message.usage_metadata={input_tokens:s.inputTokenCount,output_tokens:s.outputTokenCount,total_tokens:s.inputTokenCount+s.outputTokenCount}),_R(i)?(yield i,n?.handleLLMNewToken(i.text,void 0,void 0,void 0,void 0,{chunk:i})):n?.handleLLMNewToken(i.text)}else{const e=hR.prepareOutput(r,t),i=new cm({text:e,message:new zo({content:e})});yield i,n?.handleLLMNewToken(e,void 0,void 0,void 0,void 0,{chunk:i})}}}}else{const e=await a.json(),t=hR.prepareOutput(r,e);yield new cm({text:t,message:new zo({content:t})}),n?.handleLLMNewToken(t)}var o}_readChunks(e){function t(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function n(e){if(e.byteLength<4)return 0;return new DataView(e.buffer,e.byteOffset,e.byteLength).getUint32(0,!1)}return{async*[Symbol.asyncIterator](){let r=await e.read(),i=new Uint8Array(0);for(;!r.done;){i=t(i,r.value);let s=n(i);for(;i.byteLength>=4&&i.byteLength>=s;)yield i.slice(0,s),i=i.slice(s),s=n(i);r=await e.read()}}}}_combineLLMOutput(){return{}}bindTools(e,t){if("anthropic"!==this.modelProvider)throw new Error("Currently, tool calling through Bedrock is only supported for Anthropic models.");return this.withConfig({tools:bR(e)})}};function _R(e){return void 0!==e&&"function"==typeof e.concat}function xR(e){const t=e.split(".");return function(e){const t=e.split(".");return gR.some(e=>t[0]===e)}(e)?t[1]:t[0]}class ER extends wR{static lc_name(){return"BedrockChat"}constructor(e){const{profile:t,filepath:n,configFilepath:r,ignoreCache:i,mfaCodeProvider:s,roleAssumer:a,roleArn:o,webIdentityTokenFile:c,roleAssumerWithWebIdentity:l,...u}=e??{};super({...u,credentials:u?.credentials??VE({profile:t,filepath:n,configFilepath:r,ignoreCache:i,mfaCodeProvider:s,roleAssumer:a,roleArn:o,webIdentityTokenFile:c,roleAssumerWithWebIdentity:l})})}}class SR extends og{constructor({concurrency:e,...t}){super(e?{maxConcurrency:e,...t}:t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","llms",this._llmType()]})}async invoke(e,t){const n=SR._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t?.callbacks)).generations[0][0].text}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}_separateRunnableConfigFromCallOptionsCompat(e){const[t,n]=super._separateRunnableConfigFromCallOptions(e);return n.signal=t.signal,[t,n]}async*_streamIterator(e,t){if(this._streamResponseChunks===SR.prototype._streamResponseChunks)yield this.invoke(e,t);else{const n=SR._convertInputToPromptValue(e),[r,i]=this._separateRunnableConfigFromCallOptionsCompat(t),s=await Uh.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),a={options:i,invocation_params:this?.invocationParams(i),batch_size:1},o=await(s?.handleLLMStart(this.toJSON(),[n.toString()],r.runId,void 0,a,void 0,void 0,r.runName));let c=new om({text:""});try{for await(const e of this._streamResponseChunks(n.toString(),i,o?.[0]))c=c?c.concat(e):e,"string"==typeof e.text&&(yield e.text)}catch(e){throw await Promise.all((o??[]).map(t=>t?.handleLLMError(e))),e}await Promise.all((o??[]).map(e=>e?.handleLLMEnd({generations:[[c]]})))}}async generatePrompt(e,t,n){const r=e.map(e=>e.toString());return this.generate(r,t,n)}invocationParams(e){return{}}_flattenLLMResult(e){const t=[];for(let n=0;n<e.generations.length;n+=1){const r=e.generations[n];if(0===n)t.push({generations:[r],llmOutput:e.llmOutput});else{const n=e.llmOutput?{...e.llmOutput,tokenUsage:{}}:void 0;t.push({generations:[r],llmOutput:n})}}return t}async _generateUncached(e,t,n,r){let i;if(void 0!==r&&r.length===e.length)i=r;else{const r=await Uh.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),s={options:t,invocation_params:this?.invocationParams(t),batch_size:e.length};i=await(r?.handleLLMStart(this.toJSON(),e,n.runId,void 0,s,void 0,void 0,n?.runName))}let s;if(!!i?.[0].handlers.find(ju)&&1===e.length&&this._streamResponseChunks!==SR.prototype._streamResponseChunks)try{const n=await this._streamResponseChunks(e[0],t,i?.[0]);let r;for await(const e of n)r=void 0===r?e:Xh(r,e);if(void 0===r)throw new Error("Received empty response from chat model call.");s={generations:[[r]],llmOutput:{}},await(i?.[0].handleLLMEnd(s))}catch(e){throw await(i?.[0].handleLLMError(e)),e}else{try{s=await this._generate(e,t,i?.[0])}catch(e){throw await Promise.all((i??[]).map(t=>t?.handleLLMError(e))),e}const n=this._flattenLLMResult(s);await Promise.all((i??[]).map((e,t)=>e?.handleLLMEnd(n[t])))}const a=i?.map(e=>e.runId)||void 0;return Object.defineProperty(s,am,{value:a?{runIds:a}:void 0,configurable:!0}),s}async _generateCached({prompts:e,cache:t,llmStringKey:n,parsedOptions:r,handledOptions:i,runId:s}){const a=await Uh.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),o={options:r,invocation_params:this?.invocationParams(r),batch_size:e.length},c=await(a?.handleLLMStart(this.toJSON(),e,s,void 0,o,void 0,void 0,i?.runName)),l=[],u=await Promise.allSettled(e.map(async(e,r)=>{const i=await t.lookup(e,n);return null==i&&l.push(r),i})),d=u.map((e,t)=>({result:e,runManager:c?.[t]})).filter(({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status),p=[];await Promise.all(d.map(async({result:e,runManager:t},n)=>{if("fulfilled"===e.status){const r=e.value;return p[n]=r.map(e=>(e.generationInfo={...e.generationInfo,tokenUsage:{}},e)),r.length&&await(t?.handleLLMNewToken(r[0].text)),t?.handleLLMEnd({generations:[r]},void 0,void 0,void 0,{cached:!0})}return await(t?.handleLLMError(e.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(e.reason)}));const h={generations:p,missingPromptIndices:l,startedRunManagers:c};return Object.defineProperty(h,am,{value:c?{runIds:c?.map(e=>e.runId)}:void 0,configurable:!0}),h}async generate(e,t,n){if(!Array.isArray(e))throw new Error("Argument 'prompts' is expected to be a string[]");let r;r=Array.isArray(t)?{stop:t}:t;const[i,s]=this._separateRunnableConfigFromCallOptionsCompat(r);if(i.callbacks=i.callbacks??n,!this.cache)return this._generateUncached(e,s,i);const{cache:a}=this,o=this._getSerializedCacheKeyParametersForCall(s),{generations:c,missingPromptIndices:l,startedRunManagers:u}=await this._generateCached({prompts:e,cache:a,llmStringKey:o,parsedOptions:s,handledOptions:i,runId:i.runId});let d={};if(l.length>0){const t=await this._generateUncached(l.map(t=>e[t]),s,i,void 0!==u?l.map(e=>u?.[e]):void 0);await Promise.all(t.generations.map(async(t,n)=>{const r=l[n];return c[r]=t,a.update(e[r],o,t)})),d=t.llmOutput??{}}return{generations:c,llmOutput:d}}async call(e,t,n){const{generations:r}=await this.generate([e],t,n);return r[0][0].text}async predict(e,t,n){return this.call(e,t,n)}async predictMessages(e,t,n){const r=tc(e),i=await this.call(r,t,n);return new Uo(i)}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}_modelType(){return"base_llm"}}class kR extends SR{async _generate(e,t,n){return{generations:await Promise.all(e.map((e,r)=>this._call(e,{...t,promptIndex:r},n).then(e=>[{text:e}])))}}}const AR=["us","sa","me","il","eu","cn","ca","ap","af","us-gov"],OR=["ai21","anthropic","amazon","cohere","meta","mistral","deepseek"];let CR=class extends kR{get lc_aliases(){return{model:"model_id",region:"region_name"}}get lc_secrets(){return{"credentials.accessKeyId":"BEDROCK_AWS_ACCESS_KEY_ID","credentials.secretAccessKey":"BEDROCK_AWS_SECRET_ACCESS_KEY"}}get lc_attributes(){return{region:this.region}}_llmType(){return"bedrock"}static lc_name(){return"Bedrock"}constructor(e){if(super(e??{}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"amazon.titan-tg1-large"}),Object.defineProperty(this,"modelProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"region",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"credentials",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchFn",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"endpointHost",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"codec",{enumerable:!0,configurable:!0,writable:!0,value:new yS(Xg,Jg)}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.model=e?.model??this.model,this.modelProvider=function(e){const t=e.split(".");return function(e){const t=e.split(".");return AR.some(e=>t[0]===e)}(e)?t[1]:t[0]}(this.model),!OR.includes(this.modelProvider))throw new Error(`Unknown model provider: '${this.modelProvider}', only these are supported: ${OR}`);const t=e?.region??Pu("AWS_DEFAULT_REGION");if(!t)throw new Error("Please set the AWS_DEFAULT_REGION environment variable or pass it to the constructor as the region field.");this.region=t;const n=e?.credentials;if(!n)throw new Error("Please set the AWS credentials in the 'credentials' field.");this.credentials=n,this.temperature=e?.temperature??this.temperature,this.maxTokens=e?.maxTokens??this.maxTokens,this.fetchFn=e?.fetchFn??fetch.bind(globalThis),this.endpointHost=e?.endpointHost??e?.endpointUrl,this.stopSequences=e?.stopSequences,this.modelKwargs=e?.modelKwargs,this.streaming=e?.streaming??this.streaming}async _call(e,t,n){const r=this.endpointHost??`bedrock-runtime.${this.region}.amazonaws.com`,i=this.modelProvider;if(this.streaming){const r=this._streamResponseChunks(e,t,n);let i;for await(const e of r)i=void 0===i?e:i.concat(e);return i?.text??""}const s=await this._signedFetch(e,t,{bedrockMethod:"invoke",endpointHost:r,provider:i}),a=await s.json();if(!s.ok)throw new Error(`Error ${s.status}: ${a.message??JSON.stringify(a)}`);return hR.prepareOutput(i,a)}async _signedFetch(e,t,n){const{bedrockMethod:r,endpointHost:i,provider:s}=n,a=hR.prepareInput(s,e,this.maxTokens,this.temperature,t.stop??this.stopSequences,this.modelKwargs,n.bedrockMethod),o=new URL(`https://${i}/model/${this.model}/${r}`),c=new xg({hostname:o.hostname,path:o.pathname,protocol:o.protocol,method:"POST",body:JSON.stringify(a),query:Object.fromEntries(o.searchParams.entries()),headers:{host:o.host,accept:"application/json","content-type":"application/json"}}),l=new Gb({credentials:this.credentials,service:"bedrock",region:this.region,sha256:oR}),u=await l.sign(c);return await this.caller.callWithOptions({signal:t.signal},async()=>this.fetchFn(o,{headers:u.headers,body:u.body,method:u.method}))}invocationParams(e){return{model:this.model,region:this.region,temperature:this.temperature,maxTokens:this.maxTokens,stop:e?.stop??this.stopSequences,modelKwargs:this.modelKwargs}}async*_streamResponseChunks(e,t,n){const r=this.modelProvider,i="anthropic"===r||"cohere"===r||"meta"===r||"mistral"===r?"invoke-with-response-stream":"invoke",s=this.endpointHost??`bedrock-runtime.${this.region}.amazonaws.com`,a=await this._signedFetch(e,t,{bedrockMethod:i,endpointHost:s,provider:r});if(a.status<200||a.status>=300)throw Error(`Failed to access underlying url '${s}': got ${a.status} ${a.statusText}: ${await a.text()}`);if("anthropic"===r||"cohere"===r||"meta"===r||"mistral"===r){const e=a.body?.getReader(),t=new TextDecoder;for await(const i of this._readChunks(e)){const e=this.codec.decode(i);if(void 0!==e.headers[":event-type"]&&"chunk"!==e.headers[":event-type"].value||"application/json"!==e.headers[":content-type"].value)throw Error(`Failed to get event chunk: got ${i}`);const s=JSON.parse(t.decode(e.body));if(s.message)throw new Error(s.message);if(void 0!==s.bytes){const e=JSON.parse(t.decode(Uint8Array.from(atob(s.bytes),e=>e.codePointAt(0)??0))),i=hR.prepareOutput(r,e);yield new om({text:i,generationInfo:{}}),n?.handleLLMNewToken(i)}}}else{const e=await a.json(),t=hR.prepareOutput(r,e);yield new om({text:t,generationInfo:{}}),n?.handleLLMNewToken(t)}}_readChunks(e){function t(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function n(e){if(e.byteLength<4)return 0;return new DataView(e.buffer,e.byteOffset,e.byteLength).getUint32(0,!1)}return{async*[Symbol.asyncIterator](){let r=await e.read(),i=new Uint8Array(0);for(;!r.done;){i=t(i,r.value);let s=n(i);for(;i.byteLength>=4&&i.byteLength>=s;)yield i.slice(0,s),i=i.slice(s),s=n(i);r=await e.read()}}}}};class IR extends CR{static lc_name(){return"Bedrock"}constructor(e){super({...e,credentials:e?.credentials??VE()})}}var TR,PR,RR={exports:{}};
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */TR=RR,PR=RR.exports,function(){var e,t="Expected a function",n="__lodash_hash_undefined__",r="__lodash_placeholder__",i=32,s=128,a=256,o=1/0,c=9007199254740991,l=NaN,u=4294967295,d=[["ary",s],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",i],["partialRight",64],["rearg",a]],p="[object Arguments]",h="[object Array]",m="[object Boolean]",f="[object Date]",g="[object Error]",y="[object Function]",v="[object GeneratorFunction]",b="[object Map]",w="[object Number]",_="[object Object]",x="[object Promise]",E="[object RegExp]",S="[object Set]",k="[object String]",A="[object Symbol]",O="[object WeakMap]",C="[object ArrayBuffer]",I="[object DataView]",T="[object Float32Array]",P="[object Float64Array]",R="[object Int8Array]",j="[object Int16Array]",N="[object Int32Array]",$="[object Uint8Array]",L="[object Uint8ClampedArray]",D="[object Uint16Array]",U="[object Uint32Array]",M=/\b__p \+= '';/g,F=/\b(__p \+=) '' \+/g,z=/(__e\(.*?\)|\b__t\)) \+\n'';/g,B=/&(?:amp|lt|gt|quot|#39);/g,q=/[&<>"']/g,W=RegExp(B.source),H=RegExp(q.source),K=/<%-([\s\S]+?)%>/g,G=/<%([\s\S]+?)%>/g,V=/<%=([\s\S]+?)%>/g,Z=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,J=/^\w*$/,Y=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,X=/[\\^$.*+?()[\]{}|]/g,Q=RegExp(X.source),ee=/^\s+/,te=/\s/,ne=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,re=/\{\n\/\* \[wrapped with (.+)\] \*/,ie=/,? & /,se=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ae=/[()=,{}\[\]\/\s]/,oe=/\\(\\)?/g,ce=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,le=/\w*$/,ue=/^[-+]0x[0-9a-f]+$/i,de=/^0b[01]+$/i,pe=/^\[object .+?Constructor\]$/,he=/^0o[0-7]+$/i,me=/^(?:0|[1-9]\d*)$/,fe=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ge=/($^)/,ye=/['\n\r\u2028\u2029\\]/g,ve="\\ud800-\\udfff",be="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",we="\\u2700-\\u27bf",_e="a-z\\xdf-\\xf6\\xf8-\\xff",xe="A-Z\\xc0-\\xd6\\xd8-\\xde",Ee="\\ufe0e\\ufe0f",Se="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ke="[']",Ae="["+ve+"]",Oe="["+Se+"]",Ce="["+be+"]",Ie="\\d+",Te="["+we+"]",Pe="["+_e+"]",Re="[^"+ve+Se+Ie+we+_e+xe+"]",je="\\ud83c[\\udffb-\\udfff]",Ne="[^"+ve+"]",Le="(?:\\ud83c[\\udde6-\\uddff]){2}",De="[\\ud800-\\udbff][\\udc00-\\udfff]",Ue="["+xe+"]",Me="\\u200d",Fe="(?:"+Pe+"|"+Re+")",ze="(?:"+Ue+"|"+Re+")",Be="(?:['](?:d|ll|m|re|s|t|ve))?",qe="(?:['](?:D|LL|M|RE|S|T|VE))?",We="(?:"+Ce+"|"+je+")?",He="["+Ee+"]?",Ke=He+We+"(?:"+Me+"(?:"+[Ne,Le,De].join("|")+")"+He+We+")*",Ge="(?:"+[Te,Le,De].join("|")+")"+Ke,Ve="(?:"+[Ne+Ce+"?",Ce,Le,De,Ae].join("|")+")",Ze=RegExp(ke,"g"),Je=RegExp(Ce,"g"),Ye=RegExp(je+"(?="+je+")|"+Ve+Ke,"g"),Xe=RegExp([Ue+"?"+Pe+"+"+Be+"(?="+[Oe,Ue,"$"].join("|")+")",ze+"+"+qe+"(?="+[Oe,Ue+Fe,"$"].join("|")+")",Ue+"?"+Fe+"+"+Be,Ue+"+"+qe,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ie,Ge].join("|"),"g"),Qe=RegExp("["+Me+ve+be+Ee+"]"),et=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,tt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],nt=-1,rt={};rt[T]=rt[P]=rt[R]=rt[j]=rt[N]=rt[$]=rt[L]=rt[D]=rt[U]=!0,rt[p]=rt[h]=rt[C]=rt[m]=rt[I]=rt[f]=rt[g]=rt[y]=rt[b]=rt[w]=rt[_]=rt[E]=rt[S]=rt[k]=rt[O]=!1;var it={};it[p]=it[h]=it[C]=it[I]=it[m]=it[f]=it[T]=it[P]=it[R]=it[j]=it[N]=it[b]=it[w]=it[_]=it[E]=it[S]=it[k]=it[A]=it[$]=it[L]=it[D]=it[U]=!0,it[g]=it[y]=it[O]=!1;var st={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},at=parseFloat,ot=parseInt,ct="object"==typeof $e&&$e&&$e.Object===Object&&$e,lt="object"==typeof self&&self&&self.Object===Object&&self,ut=ct||lt||Function("return this")(),dt=PR&&!PR.nodeType&&PR,pt=dt&&TR&&!TR.nodeType&&TR,ht=pt&&pt.exports===dt,mt=ht&&ct.process,ft=function(){try{var e=pt&&pt.require&&pt.require("util").types;return e||mt&&mt.binding&&mt.binding("util")}catch(e){}}(),gt=ft&&ft.isArrayBuffer,yt=ft&&ft.isDate,vt=ft&&ft.isMap,bt=ft&&ft.isRegExp,wt=ft&&ft.isSet,_t=ft&&ft.isTypedArray;function xt(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Et(e,t,n,r){for(var i=-1,s=null==e?0:e.length;++i<s;){var a=e[i];t(r,a,n(a),e)}return r}function St(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function kt(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function At(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function Ot(e,t){for(var n=-1,r=null==e?0:e.length,i=0,s=[];++n<r;){var a=e[n];t(a,n,e)&&(s[i++]=a)}return s}function Ct(e,t){return!(null==e||!e.length)&&Ut(e,t,0)>-1}function It(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}function Tt(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function Pt(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function Rt(e,t,n,r){var i=-1,s=null==e?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function jt(e,t,n,r){var i=null==e?0:e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}function Nt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var $t=Bt("length");function Lt(e,t,n){var r;return n(e,function(e,n,i){if(t(e,n,i))return r=n,!1}),r}function Dt(e,t,n,r){for(var i=e.length,s=n+(r?1:-1);r?s--:++s<i;)if(t(e[s],s,e))return s;return-1}function Ut(e,t,n){return t==t?function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}(e,t,n):Dt(e,Ft,n)}function Mt(e,t,n,r){for(var i=n-1,s=e.length;++i<s;)if(r(e[i],t))return i;return-1}function Ft(e){return e!=e}function zt(e,t){var n=null==e?0:e.length;return n?Ht(e,t)/n:l}function Bt(t){return function(n){return null==n?e:n[t]}}function qt(t){return function(n){return null==t?e:t[n]}}function Wt(e,t,n,r,i){return i(e,function(e,i,s){n=r?(r=!1,e):t(n,e,i,s)}),n}function Ht(t,n){for(var r,i=-1,s=t.length;++i<s;){var a=n(t[i]);a!==e&&(r=r===e?a:r+a)}return r}function Kt(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function Gt(e){return e?e.slice(0,dn(e)+1).replace(ee,""):e}function Vt(e){return function(t){return e(t)}}function Zt(e,t){return Tt(t,function(t){return e[t]})}function Jt(e,t){return e.has(t)}function Yt(e,t){for(var n=-1,r=e.length;++n<r&&Ut(t,e[n],0)>-1;);return n}function Xt(e,t){for(var n=e.length;n--&&Ut(t,e[n],0)>-1;);return n}var Qt=qt({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),en=qt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function tn(e){return"\\"+st[e]}function nn(e){return Qe.test(e)}function rn(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function sn(e,t){return function(n){return e(t(n))}}function an(e,t){for(var n=-1,i=e.length,s=0,a=[];++n<i;){var o=e[n];o!==t&&o!==r||(e[n]=r,a[s++]=n)}return a}function on(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}function cn(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=[e,e]}),n}function ln(e){return nn(e)?function(e){for(var t=Ye.lastIndex=0;Ye.test(e);)++t;return t}(e):$t(e)}function un(e){return nn(e)?function(e){return e.match(Ye)||[]}(e):function(e){return e.split("")}(e)}function dn(e){for(var t=e.length;t--&&te.test(e.charAt(t)););return t}var pn=qt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),hn=function te(ve){var be,we=(ve=null==ve?ut:hn.defaults(ut.Object(),ve,hn.pick(ut,tt))).Array,_e=ve.Date,xe=ve.Error,Ee=ve.Function,Se=ve.Math,ke=ve.Object,Ae=ve.RegExp,Oe=ve.String,Ce=ve.TypeError,Ie=we.prototype,Te=Ee.prototype,Pe=ke.prototype,Re=ve["__core-js_shared__"],je=Te.toString,Ne=Pe.hasOwnProperty,$e=0,Le=(be=/[^.]+$/.exec(Re&&Re.keys&&Re.keys.IE_PROTO||""))?"Symbol(src)_1."+be:"",De=Pe.toString,Ue=je.call(ke),Me=ut._,Fe=Ae("^"+je.call(Ne).replace(X,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ze=ht?ve.Buffer:e,Be=ve.Symbol,qe=ve.Uint8Array,We=ze?ze.allocUnsafe:e,He=sn(ke.getPrototypeOf,ke),Ke=ke.create,Ge=Pe.propertyIsEnumerable,Ve=Ie.splice,Ye=Be?Be.isConcatSpreadable:e,Qe=Be?Be.iterator:e,st=Be?Be.toStringTag:e,ct=function(){try{var e=us(ke,"defineProperty");return e({},"",{}),e}catch(e){}}(),lt=ve.clearTimeout!==ut.clearTimeout&&ve.clearTimeout,dt=_e&&_e.now!==ut.Date.now&&_e.now,pt=ve.setTimeout!==ut.setTimeout&&ve.setTimeout,mt=Se.ceil,ft=Se.floor,$t=ke.getOwnPropertySymbols,qt=ze?ze.isBuffer:e,mn=ve.isFinite,fn=Ie.join,gn=sn(ke.keys,ke),yn=Se.max,vn=Se.min,bn=_e.now,wn=ve.parseInt,_n=Se.random,xn=Ie.reverse,En=us(ve,"DataView"),Sn=us(ve,"Map"),kn=us(ve,"Promise"),An=us(ve,"Set"),On=us(ve,"WeakMap"),Cn=us(ke,"create"),In=On&&new On,Tn={},Pn=Ls(En),Rn=Ls(Sn),jn=Ls(kn),Nn=Ls(An),$n=Ls(On),Ln=Be?Be.prototype:e,Dn=Ln?Ln.valueOf:e,Un=Ln?Ln.toString:e;function Mn(e){if(Qa(e)&&!Ba(e)&&!(e instanceof qn)){if(e instanceof Bn)return e;if(Ne.call(e,"__wrapped__"))return Ds(e)}return new Bn(e)}var Fn=function(){function t(){}return function(n){if(!Xa(n))return{};if(Ke)return Ke(n);t.prototype=n;var r=new t;return t.prototype=e,r}}();function zn(){}function Bn(t,n){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=e}function qn(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=u,this.__views__=[]}function Wn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Hn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Kn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Gn(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Kn;++t<n;)this.add(e[t])}function Vn(e){var t=this.__data__=new Hn(e);this.size=t.size}function Zn(e,t){var n=Ba(e),r=!n&&za(e),i=!n&&!r&&Ka(e),s=!n&&!r&&!i&&oo(e),a=n||r||i||s,o=a?Kt(e.length,Oe):[],c=o.length;for(var l in e)!t&&!Ne.call(e,l)||a&&("length"==l||i&&("offset"==l||"parent"==l)||s&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||ys(l,c))||o.push(l);return o}function Jn(t){var n=t.length;return n?t[Gr(0,n-1)]:e}function Yn(e,t){return js(Ci(e),ar(t,0,e.length))}function Xn(e){return js(Ci(e))}function Qn(t,n,r){(r!==e&&!Ua(t[n],r)||r===e&&!(n in t))&&ir(t,n,r)}function er(t,n,r){var i=t[n];Ne.call(t,n)&&Ua(i,r)&&(r!==e||n in t)||ir(t,n,r)}function tr(e,t){for(var n=e.length;n--;)if(Ua(e[n][0],t))return n;return-1}function nr(e,t,n,r){return dr(e,function(e,i,s){t(r,e,n(e),s)}),r}function rr(e,t){return e&&Ii(t,To(t),e)}function ir(e,t,n){"__proto__"==t&&ct?ct(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function sr(t,n){for(var r=-1,i=n.length,s=we(i),a=null==t;++r<i;)s[r]=a?e:ko(t,n[r]);return s}function ar(t,n,r){return t==t&&(r!==e&&(t=t<=r?t:r),n!==e&&(t=t>=n?t:n)),t}function or(t,n,r,i,s,a){var o,c=1&n,l=2&n,u=4&n;if(r&&(o=s?r(t,i,s,a):r(t)),o!==e)return o;if(!Xa(t))return t;var d=Ba(t);if(d){if(o=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Ne.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(t),!c)return Ci(t,o)}else{var h=hs(t),g=h==y||h==v;if(Ka(t))return xi(t,c);if(h==_||h==p||g&&!s){if(o=l||g?{}:fs(t),!c)return l?function(e,t){return Ii(e,ps(e),t)}(t,function(e,t){return e&&Ii(t,Po(t),e)}(o,t)):function(e,t){return Ii(e,ds(e),t)}(t,rr(o,t))}else{if(!it[h])return s?t:{};o=function(e,t,n){var r,i=e.constructor;switch(t){case C:return Ei(e);case m:case f:return new i(+e);case I:return function(e,t){var n=t?Ei(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case T:case P:case R:case j:case N:case $:case L:case D:case U:return Si(e,n);case b:return new i;case w:case k:return new i(e);case E:return function(e){var t=new e.constructor(e.source,le.exec(e));return t.lastIndex=e.lastIndex,t}(e);case S:return new i;case A:return r=e,Dn?ke(Dn.call(r)):{}}}(t,h,c)}}a||(a=new Vn);var x=a.get(t);if(x)return x;a.set(t,o),io(t)?t.forEach(function(e){o.add(or(e,n,r,e,t,a))}):eo(t)&&t.forEach(function(e,i){o.set(i,or(e,n,r,i,t,a))});var O=d?e:(u?l?rs:ns:l?Po:To)(t);return St(O||t,function(e,i){O&&(e=t[i=e]),er(o,i,or(e,n,r,i,t,a))}),o}function cr(t,n,r){var i=r.length;if(null==t)return!i;for(t=ke(t);i--;){var s=r[i],a=n[s],o=t[s];if(o===e&&!(s in t)||!a(o))return!1}return!0}function lr(n,r,i){if("function"!=typeof n)throw new Ce(t);return Is(function(){n.apply(e,i)},r)}function ur(e,t,n,r){var i=-1,s=Ct,a=!0,o=e.length,c=[],l=t.length;if(!o)return c;n&&(t=Tt(t,Vt(n))),r?(s=It,a=!1):t.length>=200&&(s=Jt,a=!1,t=new Gn(t));e:for(;++i<o;){var u=e[i],d=null==n?u:n(u);if(u=r||0!==u?u:0,a&&d==d){for(var p=l;p--;)if(t[p]===d)continue e;c.push(u)}else s(t,d,r)||c.push(u)}return c}Mn.templateSettings={escape:K,evaluate:G,interpolate:V,variable:"",imports:{_:Mn}},Mn.prototype=zn.prototype,Mn.prototype.constructor=Mn,Bn.prototype=Fn(zn.prototype),Bn.prototype.constructor=Bn,qn.prototype=Fn(zn.prototype),qn.prototype.constructor=qn,Wn.prototype.clear=function(){this.__data__=Cn?Cn(null):{},this.size=0},Wn.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Wn.prototype.get=function(t){var r=this.__data__;if(Cn){var i=r[t];return i===n?e:i}return Ne.call(r,t)?r[t]:e},Wn.prototype.has=function(t){var n=this.__data__;return Cn?n[t]!==e:Ne.call(n,t)},Wn.prototype.set=function(t,r){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=Cn&&r===e?n:r,this},Hn.prototype.clear=function(){this.__data__=[],this.size=0},Hn.prototype.delete=function(e){var t=this.__data__,n=tr(t,e);return!(n<0||(n==t.length-1?t.pop():Ve.call(t,n,1),--this.size,0))},Hn.prototype.get=function(t){var n=this.__data__,r=tr(n,t);return r<0?e:n[r][1]},Hn.prototype.has=function(e){return tr(this.__data__,e)>-1},Hn.prototype.set=function(e,t){var n=this.__data__,r=tr(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Kn.prototype.clear=function(){this.size=0,this.__data__={hash:new Wn,map:new(Sn||Hn),string:new Wn}},Kn.prototype.delete=function(e){var t=cs(this,e).delete(e);return this.size-=t?1:0,t},Kn.prototype.get=function(e){return cs(this,e).get(e)},Kn.prototype.has=function(e){return cs(this,e).has(e)},Kn.prototype.set=function(e,t){var n=cs(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Gn.prototype.add=Gn.prototype.push=function(e){return this.__data__.set(e,n),this},Gn.prototype.has=function(e){return this.__data__.has(e)},Vn.prototype.clear=function(){this.__data__=new Hn,this.size=0},Vn.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Vn.prototype.get=function(e){return this.__data__.get(e)},Vn.prototype.has=function(e){return this.__data__.has(e)},Vn.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Hn){var r=n.__data__;if(!Sn||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Kn(r)}return n.set(e,t),this.size=n.size,this};var dr=Ri(br),pr=Ri(wr,!0);function hr(e,t){var n=!0;return dr(e,function(e,r,i){return n=!!t(e,r,i)}),n}function mr(t,n,r){for(var i=-1,s=t.length;++i<s;){var a=t[i],o=n(a);if(null!=o&&(c===e?o==o&&!ao(o):r(o,c)))var c=o,l=a}return l}function fr(e,t){var n=[];return dr(e,function(e,r,i){t(e,r,i)&&n.push(e)}),n}function gr(e,t,n,r,i){var s=-1,a=e.length;for(n||(n=gs),i||(i=[]);++s<a;){var o=e[s];t>0&&n(o)?t>1?gr(o,t-1,n,r,i):Pt(i,o):r||(i[i.length]=o)}return i}var yr=ji(),vr=ji(!0);function br(e,t){return e&&yr(e,t,To)}function wr(e,t){return e&&vr(e,t,To)}function _r(e,t){return Ot(t,function(t){return Za(e[t])})}function xr(t,n){for(var r=0,i=(n=vi(n,t)).length;null!=t&&r<i;)t=t[$s(n[r++])];return r&&r==i?t:e}function Er(e,t,n){var r=t(e);return Ba(e)?r:Pt(r,n(e))}function Sr(t){return null==t?t===e?"[object Undefined]":"[object Null]":st&&st in ke(t)?function(t){var n=Ne.call(t,st),r=t[st];try{t[st]=e;var i=!0}catch(e){}var s=De.call(t);return i&&(n?t[st]=r:delete t[st]),s}(t):function(e){return De.call(e)}(t)}function kr(e,t){return e>t}function Ar(e,t){return null!=e&&Ne.call(e,t)}function Or(e,t){return null!=e&&t in ke(e)}function Cr(t,n,r){for(var i=r?It:Ct,s=t[0].length,a=t.length,o=a,c=we(a),l=1/0,u=[];o--;){var d=t[o];o&&n&&(d=Tt(d,Vt(n))),l=vn(d.length,l),c[o]=!r&&(n||s>=120&&d.length>=120)?new Gn(o&&d):e}d=t[0];var p=-1,h=c[0];e:for(;++p<s&&u.length<l;){var m=d[p],f=n?n(m):m;if(m=r||0!==m?m:0,!(h?Jt(h,f):i(u,f,r))){for(o=a;--o;){var g=c[o];if(!(g?Jt(g,f):i(t[o],f,r)))continue e}h&&h.push(f),u.push(m)}}return u}function Ir(t,n,r){var i=null==(t=As(t,n=vi(n,t)))?t:t[$s(Vs(n))];return null==i?e:xt(i,t,r)}function Tr(e){return Qa(e)&&Sr(e)==p}function Pr(t,n,r,i,s){return t===n||(null==t||null==n||!Qa(t)&&!Qa(n)?t!=t&&n!=n:function(t,n,r,i,s,a){var o=Ba(t),c=Ba(n),l=o?h:hs(t),u=c?h:hs(n),d=(l=l==p?_:l)==_,y=(u=u==p?_:u)==_,v=l==u;if(v&&Ka(t)){if(!Ka(n))return!1;o=!0,d=!1}if(v&&!d)return a||(a=new Vn),o||oo(t)?es(t,n,r,i,s,a):function(e,t,n,r,i,s,a){switch(n){case I:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case C:return!(e.byteLength!=t.byteLength||!s(new qe(e),new qe(t)));case m:case f:case w:return Ua(+e,+t);case g:return e.name==t.name&&e.message==t.message;case E:case k:return e==t+"";case b:var o=rn;case S:var c=1&r;if(o||(o=on),e.size!=t.size&&!c)return!1;var l=a.get(e);if(l)return l==t;r|=2,a.set(e,t);var u=es(o(e),o(t),r,i,s,a);return a.delete(e),u;case A:if(Dn)return Dn.call(e)==Dn.call(t)}return!1}(t,n,l,r,i,s,a);if(!(1&r)){var x=d&&Ne.call(t,"__wrapped__"),O=y&&Ne.call(n,"__wrapped__");if(x||O){var T=x?t.value():t,P=O?n.value():n;return a||(a=new Vn),s(T,P,r,i,a)}}return!!v&&(a||(a=new Vn),function(t,n,r,i,s,a){var o=1&r,c=ns(t),l=c.length,u=ns(n),d=u.length;if(l!=d&&!o)return!1;for(var p=l;p--;){var h=c[p];if(!(o?h in n:Ne.call(n,h)))return!1}var m=a.get(t),f=a.get(n);if(m&&f)return m==n&&f==t;var g=!0;a.set(t,n),a.set(n,t);for(var y=o;++p<l;){var v=t[h=c[p]],b=n[h];if(i)var w=o?i(b,v,h,n,t,a):i(v,b,h,t,n,a);if(!(w===e?v===b||s(v,b,r,i,a):w)){g=!1;break}y||(y="constructor"==h)}if(g&&!y){var _=t.constructor,x=n.constructor;_==x||!("constructor"in t)||!("constructor"in n)||"function"==typeof _&&_ instanceof _&&"function"==typeof x&&x instanceof x||(g=!1)}return a.delete(t),a.delete(n),g}(t,n,r,i,s,a))}(t,n,r,i,Pr,s))}function Rr(t,n,r,i){var s=r.length,a=s,o=!i;if(null==t)return!a;for(t=ke(t);s--;){var c=r[s];if(o&&c[2]?c[1]!==t[c[0]]:!(c[0]in t))return!1}for(;++s<a;){var l=(c=r[s])[0],u=t[l],d=c[1];if(o&&c[2]){if(u===e&&!(l in t))return!1}else{var p=new Vn;if(i)var h=i(u,d,l,t,n,p);if(!(h===e?Pr(d,u,3,i,p):h))return!1}}return!0}function jr(e){return!(!Xa(e)||(t=e,Le&&Le in t))&&(Za(e)?Fe:pe).test(Ls(e));var t}function Nr(e){return"function"==typeof e?e:null==e?nc:"object"==typeof e?Ba(e)?Fr(e[0],e[1]):Mr(e):dc(e)}function $r(e){if(!xs(e))return gn(e);var t=[];for(var n in ke(e))Ne.call(e,n)&&"constructor"!=n&&t.push(n);return t}function Lr(e){if(!Xa(e))return function(e){var t=[];if(null!=e)for(var n in ke(e))t.push(n);return t}(e);var t=xs(e),n=[];for(var r in e)("constructor"!=r||!t&&Ne.call(e,r))&&n.push(r);return n}function Dr(e,t){return e<t}function Ur(e,t){var n=-1,r=Wa(e)?we(e.length):[];return dr(e,function(e,i,s){r[++n]=t(e,i,s)}),r}function Mr(e){var t=ls(e);return 1==t.length&&t[0][2]?Ss(t[0][0],t[0][1]):function(n){return n===e||Rr(n,e,t)}}function Fr(t,n){return bs(t)&&Es(n)?Ss($s(t),n):function(r){var i=ko(r,t);return i===e&&i===n?Ao(r,t):Pr(n,i,3)}}function zr(t,n,r,i,s){t!==n&&yr(n,function(a,o){if(s||(s=new Vn),Xa(a))!function(t,n,r,i,s,a,o){var c=Os(t,r),l=Os(n,r),u=o.get(l);if(u)Qn(t,r,u);else{var d=a?a(c,l,r+"",t,n,o):e,p=d===e;if(p){var h=Ba(l),m=!h&&Ka(l),f=!h&&!m&&oo(l);d=l,h||m||f?Ba(c)?d=c:Ha(c)?d=Ci(c):m?(p=!1,d=xi(l,!0)):f?(p=!1,d=Si(l,!0)):d=[]:no(l)||za(l)?(d=c,za(c)?d=go(c):Xa(c)&&!Za(c)||(d=fs(l))):p=!1}p&&(o.set(l,d),s(d,l,i,a,o),o.delete(l)),Qn(t,r,d)}}(t,n,o,r,zr,i,s);else{var c=i?i(Os(t,o),a,o+"",t,n,s):e;c===e&&(c=a),Qn(t,o,c)}},Po)}function Br(t,n){var r=t.length;if(r)return ys(n+=n<0?r:0,r)?t[n]:e}function qr(e,t,n){t=t.length?Tt(t,function(e){return Ba(e)?function(t){return xr(t,1===e.length?e[0]:e)}:e}):[nc];var r=-1;t=Tt(t,Vt(os()));var i=Ur(e,function(e,n,i){var s=Tt(t,function(t){return t(e)});return{criteria:s,index:++r,value:e}});return function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(i,function(e,t){return function(e,t,n){for(var r=-1,i=e.criteria,s=t.criteria,a=i.length,o=n.length;++r<a;){var c=ki(i[r],s[r]);if(c)return r>=o?c:c*("desc"==n[r]?-1:1)}return e.index-t.index}(e,t,n)})}function Wr(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var a=t[r],o=xr(e,a);n(o,a)&&Xr(s,vi(a,e),o)}return s}function Hr(e,t,n,r){var i=r?Mt:Ut,s=-1,a=t.length,o=e;for(e===t&&(t=Ci(t)),n&&(o=Tt(e,Vt(n)));++s<a;)for(var c=0,l=t[s],u=n?n(l):l;(c=i(o,u,c,r))>-1;)o!==e&&Ve.call(o,c,1),Ve.call(e,c,1);return e}function Kr(e,t){for(var n=e?t.length:0,r=n-1;n--;){var i=t[n];if(n==r||i!==s){var s=i;ys(i)?Ve.call(e,i,1):ui(e,i)}}return e}function Gr(e,t){return e+ft(_n()*(t-e+1))}function Vr(e,t){var n="";if(!e||t<1||t>c)return n;do{t%2&&(n+=e),(t=ft(t/2))&&(e+=e)}while(t);return n}function Zr(e,t){return Ts(ks(e,t,nc),e+"")}function Jr(e){return Jn(Mo(e))}function Yr(e,t){var n=Mo(e);return js(n,ar(t,0,n.length))}function Xr(t,n,r,i){if(!Xa(t))return t;for(var s=-1,a=(n=vi(n,t)).length,o=a-1,c=t;null!=c&&++s<a;){var l=$s(n[s]),u=r;if("__proto__"===l||"constructor"===l||"prototype"===l)return t;if(s!=o){var d=c[l];(u=i?i(d,l,c):e)===e&&(u=Xa(d)?d:ys(n[s+1])?[]:{})}er(c,l,u),c=c[l]}return t}var Qr=In?function(e,t){return In.set(e,t),e}:nc,ei=ct?function(e,t){return ct(e,"toString",{configurable:!0,enumerable:!1,value:Qo(t),writable:!0})}:nc;function ti(e){return js(Mo(e))}function ni(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=we(i);++r<i;)s[r]=e[r+t];return s}function ri(e,t){var n;return dr(e,function(e,r,i){return!(n=t(e,r,i))}),!!n}function ii(e,t,n){var r=0,i=null==e?r:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;r<i;){var s=r+i>>>1,a=e[s];null!==a&&!ao(a)&&(n?a<=t:a<t)?r=s+1:i=s}return i}return si(e,t,nc,n)}function si(t,n,r,i){var s=0,a=null==t?0:t.length;if(0===a)return 0;for(var o=(n=r(n))!=n,c=null===n,l=ao(n),u=n===e;s<a;){var d=ft((s+a)/2),p=r(t[d]),h=p!==e,m=null===p,f=p==p,g=ao(p);if(o)var y=i||f;else y=u?f&&(i||h):c?f&&h&&(i||!m):l?f&&h&&!m&&(i||!g):!m&&!g&&(i?p<=n:p<n);y?s=d+1:a=d}return vn(a,4294967294)}function ai(e,t){for(var n=-1,r=e.length,i=0,s=[];++n<r;){var a=e[n],o=t?t(a):a;if(!n||!Ua(o,c)){var c=o;s[i++]=0===a?0:a}}return s}function oi(e){return"number"==typeof e?e:ao(e)?l:+e}function ci(e){if("string"==typeof e)return e;if(Ba(e))return Tt(e,ci)+"";if(ao(e))return Un?Un.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function li(e,t,n){var r=-1,i=Ct,s=e.length,a=!0,o=[],c=o;if(n)a=!1,i=It;else if(s>=200){var l=t?null:Vi(e);if(l)return on(l);a=!1,i=Jt,c=new Gn}else c=t?[]:o;e:for(;++r<s;){var u=e[r],d=t?t(u):u;if(u=n||0!==u?u:0,a&&d==d){for(var p=c.length;p--;)if(c[p]===d)continue e;t&&c.push(d),o.push(u)}else i(c,d,n)||(c!==o&&c.push(d),o.push(u))}return o}function ui(e,t){return null==(e=As(e,t=vi(t,e)))||delete e[$s(Vs(t))]}function di(e,t,n,r){return Xr(e,t,n(xr(e,t)),r)}function pi(e,t,n,r){for(var i=e.length,s=r?i:-1;(r?s--:++s<i)&&t(e[s],s,e););return n?ni(e,r?0:s,r?s+1:i):ni(e,r?s+1:0,r?i:s)}function hi(e,t){var n=e;return n instanceof qn&&(n=n.value()),Rt(t,function(e,t){return t.func.apply(t.thisArg,Pt([e],t.args))},n)}function mi(e,t,n){var r=e.length;if(r<2)return r?li(e[0]):[];for(var i=-1,s=we(r);++i<r;)for(var a=e[i],o=-1;++o<r;)o!=i&&(s[i]=ur(s[i]||a,e[o],t,n));return li(gr(s,1),t,n)}function fi(t,n,r){for(var i=-1,s=t.length,a=n.length,o={};++i<s;){var c=i<a?n[i]:e;r(o,t[i],c)}return o}function gi(e){return Ha(e)?e:[]}function yi(e){return"function"==typeof e?e:nc}function vi(e,t){return Ba(e)?e:bs(e,t)?[e]:Ns(yo(e))}var bi=Zr;function wi(t,n,r){var i=t.length;return r=r===e?i:r,!n&&r>=i?t:ni(t,n,r)}var _i=lt||function(e){return ut.clearTimeout(e)};function xi(e,t){if(t)return e.slice();var n=e.length,r=We?We(n):new e.constructor(n);return e.copy(r),r}function Ei(e){var t=new e.constructor(e.byteLength);return new qe(t).set(new qe(e)),t}function Si(e,t){var n=t?Ei(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function ki(t,n){if(t!==n){var r=t!==e,i=null===t,s=t==t,a=ao(t),o=n!==e,c=null===n,l=n==n,u=ao(n);if(!c&&!u&&!a&&t>n||a&&o&&l&&!c&&!u||i&&o&&l||!r&&l||!s)return 1;if(!i&&!a&&!u&&t<n||u&&r&&s&&!i&&!a||c&&r&&s||!o&&s||!l)return-1}return 0}function Ai(e,t,n,r){for(var i=-1,s=e.length,a=n.length,o=-1,c=t.length,l=yn(s-a,0),u=we(c+l),d=!r;++o<c;)u[o]=t[o];for(;++i<a;)(d||i<s)&&(u[n[i]]=e[i]);for(;l--;)u[o++]=e[i++];return u}function Oi(e,t,n,r){for(var i=-1,s=e.length,a=-1,o=n.length,c=-1,l=t.length,u=yn(s-o,0),d=we(u+l),p=!r;++i<u;)d[i]=e[i];for(var h=i;++c<l;)d[h+c]=t[c];for(;++a<o;)(p||i<s)&&(d[h+n[a]]=e[i++]);return d}function Ci(e,t){var n=-1,r=e.length;for(t||(t=we(r));++n<r;)t[n]=e[n];return t}function Ii(t,n,r,i){var s=!r;r||(r={});for(var a=-1,o=n.length;++a<o;){var c=n[a],l=i?i(r[c],t[c],c,r,t):e;l===e&&(l=t[c]),s?ir(r,c,l):er(r,c,l)}return r}function Ti(e,t){return function(n,r){var i=Ba(n)?Et:nr,s=t?t():{};return i(n,e,os(r,2),s)}}function Pi(t){return Zr(function(n,r){var i=-1,s=r.length,a=s>1?r[s-1]:e,o=s>2?r[2]:e;for(a=t.length>3&&"function"==typeof a?(s--,a):e,o&&vs(r[0],r[1],o)&&(a=s<3?e:a,s=1),n=ke(n);++i<s;){var c=r[i];c&&t(n,c,i,a)}return n})}function Ri(e,t){return function(n,r){if(null==n)return n;if(!Wa(n))return e(n,r);for(var i=n.length,s=t?i:-1,a=ke(n);(t?s--:++s<i)&&!1!==r(a[s],s,a););return n}}function ji(e){return function(t,n,r){for(var i=-1,s=ke(t),a=r(t),o=a.length;o--;){var c=a[e?o:++i];if(!1===n(s[c],c,s))break}return t}}function Ni(t){return function(n){var r=nn(n=yo(n))?un(n):e,i=r?r[0]:n.charAt(0),s=r?wi(r,1).join(""):n.slice(1);return i[t]()+s}}function $i(e){return function(t){return Rt(Jo(Bo(t).replace(Ze,"")),e,"")}}function Li(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Fn(e.prototype),r=e.apply(n,t);return Xa(r)?r:n}}function Di(t){return function(n,r,i){var s=ke(n);if(!Wa(n)){var a=os(r,3);n=To(n),r=function(e){return a(s[e],e,s)}}var o=t(n,r,i);return o>-1?s[a?n[o]:o]:e}}function Ui(n){return ts(function(r){var i=r.length,s=i,a=Bn.prototype.thru;for(n&&r.reverse();s--;){var o=r[s];if("function"!=typeof o)throw new Ce(t);if(a&&!c&&"wrapper"==ss(o))var c=new Bn([],!0)}for(s=c?s:i;++s<i;){var l=ss(o=r[s]),u="wrapper"==l?is(o):e;c=u&&ws(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?c[ss(u[0])].apply(c,u[3]):1==o.length&&ws(o)?c[l]():c.thru(o)}return function(){var e=arguments,t=e[0];if(c&&1==e.length&&Ba(t))return c.plant(t).value();for(var n=0,s=i?r[n].apply(this,e):t;++n<i;)s=r[n].call(this,s);return s}})}function Mi(t,n,r,i,a,o,c,l,u,d){var p=n&s,h=1&n,m=2&n,f=24&n,g=512&n,y=m?e:Li(t);return function s(){for(var v=arguments.length,b=we(v),w=v;w--;)b[w]=arguments[w];if(f)var _=as(s),x=function(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}(b,_);if(i&&(b=Ai(b,i,a,f)),o&&(b=Oi(b,o,c,f)),v-=x,f&&v<d){var E=an(b,_);return Ki(t,n,Mi,s.placeholder,r,b,E,l,u,d-v)}var S=h?r:this,k=m?S[t]:t;return v=b.length,l?b=function(t,n){for(var r=t.length,i=vn(n.length,r),s=Ci(t);i--;){var a=n[i];t[i]=ys(a,r)?s[a]:e}return t}(b,l):g&&v>1&&b.reverse(),p&&u<v&&(b.length=u),this&&this!==ut&&this instanceof s&&(k=y||Li(k)),k.apply(S,b)}}function Fi(e,t){return function(n,r){return function(e,t,n,r){return br(e,function(e,i,s){t(r,n(e),i,s)}),r}(n,e,t(r),{})}}function zi(t,n){return function(r,i){var s;if(r===e&&i===e)return n;if(r!==e&&(s=r),i!==e){if(s===e)return i;"string"==typeof r||"string"==typeof i?(r=ci(r),i=ci(i)):(r=oi(r),i=oi(i)),s=t(r,i)}return s}}function Bi(e){return ts(function(t){return t=Tt(t,Vt(os())),Zr(function(n){var r=this;return e(t,function(e){return xt(e,r,n)})})})}function qi(t,n){var r=(n=n===e?" ":ci(n)).length;if(r<2)return r?Vr(n,t):n;var i=Vr(n,mt(t/ln(n)));return nn(n)?wi(un(i),0,t).join(""):i.slice(0,t)}function Wi(t){return function(n,r,i){return i&&"number"!=typeof i&&vs(n,r,i)&&(r=i=e),n=po(n),r===e?(r=n,n=0):r=po(r),function(e,t,n,r){for(var i=-1,s=yn(mt((t-e)/(n||1)),0),a=we(s);s--;)a[r?s:++i]=e,e+=n;return a}(n,r,i=i===e?n<r?1:-1:po(i),t)}}function Hi(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=fo(t),n=fo(n)),e(t,n)}}function Ki(t,n,r,s,a,o,c,l,u,d){var p=8&n;n|=p?i:64,4&(n&=~(p?64:i))||(n&=-4);var h=[t,n,a,p?o:e,p?c:e,p?e:o,p?e:c,l,u,d],m=r.apply(e,h);return ws(t)&&Cs(m,h),m.placeholder=s,Ps(m,t,n)}function Gi(e){var t=Se[e];return function(e,n){if(e=fo(e),(n=null==n?0:vn(ho(n),292))&&mn(e)){var r=(yo(e)+"e").split("e");return+((r=(yo(t(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}var Vi=An&&1/on(new An([,-0]))[1]==o?function(e){return new An(e)}:oc;function Zi(e){return function(t){var n=hs(t);return n==b?rn(t):n==S?cn(t):function(e,t){return Tt(t,function(t){return[t,e[t]]})}(t,e(t))}}function Ji(n,o,c,l,u,d,p,h){var m=2&o;if(!m&&"function"!=typeof n)throw new Ce(t);var f=l?l.length:0;if(f||(o&=-97,l=u=e),p=p===e?p:yn(ho(p),0),h=h===e?h:ho(h),f-=u?u.length:0,64&o){var g=l,y=u;l=u=e}var v=m?e:is(n),b=[n,o,c,l,u,g,y,d,p,h];if(v&&function(e,t){var n=e[1],i=t[1],o=n|i,c=o<131,l=i==s&&8==n||i==s&&n==a&&e[7].length<=t[8]||384==i&&t[7].length<=t[8]&&8==n;if(!c&&!l)return e;1&i&&(e[2]=t[2],o|=1&n?0:4);var u=t[3];if(u){var d=e[3];e[3]=d?Ai(d,u,t[4]):u,e[4]=d?an(e[3],r):t[4]}(u=t[5])&&(d=e[5],e[5]=d?Oi(d,u,t[6]):u,e[6]=d?an(e[5],r):t[6]),(u=t[7])&&(e[7]=u),i&s&&(e[8]=null==e[8]?t[8]:vn(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=o}(b,v),n=b[0],o=b[1],c=b[2],l=b[3],u=b[4],!(h=b[9]=b[9]===e?m?0:n.length:yn(b[9]-f,0))&&24&o&&(o&=-25),o&&1!=o)w=8==o||16==o?function(t,n,r){var i=Li(t);return function s(){for(var a=arguments.length,o=we(a),c=a,l=as(s);c--;)o[c]=arguments[c];var u=a<3&&o[0]!==l&&o[a-1]!==l?[]:an(o,l);return(a-=u.length)<r?Ki(t,n,Mi,s.placeholder,e,o,u,e,e,r-a):xt(this&&this!==ut&&this instanceof s?i:t,this,o)}}(n,o,h):o!=i&&33!=o||u.length?Mi.apply(e,b):function(e,t,n,r){var i=1&t,s=Li(e);return function t(){for(var a=-1,o=arguments.length,c=-1,l=r.length,u=we(l+o),d=this&&this!==ut&&this instanceof t?s:e;++c<l;)u[c]=r[c];for(;o--;)u[c++]=arguments[++a];return xt(d,i?n:this,u)}}(n,o,c,l);else var w=function(e,t,n){var r=1&t,i=Li(e);return function t(){return(this&&this!==ut&&this instanceof t?i:e).apply(r?n:this,arguments)}}(n,o,c);return Ps((v?Qr:Cs)(w,b),n,o)}function Yi(t,n,r,i){return t===e||Ua(t,Pe[r])&&!Ne.call(i,r)?n:t}function Xi(t,n,r,i,s,a){return Xa(t)&&Xa(n)&&(a.set(n,t),zr(t,n,e,Xi,a),a.delete(n)),t}function Qi(t){return no(t)?e:t}function es(t,n,r,i,s,a){var o=1&r,c=t.length,l=n.length;if(c!=l&&!(o&&l>c))return!1;var u=a.get(t),d=a.get(n);if(u&&d)return u==n&&d==t;var p=-1,h=!0,m=2&r?new Gn:e;for(a.set(t,n),a.set(n,t);++p<c;){var f=t[p],g=n[p];if(i)var y=o?i(g,f,p,n,t,a):i(f,g,p,t,n,a);if(y!==e){if(y)continue;h=!1;break}if(m){if(!Nt(n,function(e,t){if(!Jt(m,t)&&(f===e||s(f,e,r,i,a)))return m.push(t)})){h=!1;break}}else if(f!==g&&!s(f,g,r,i,a)){h=!1;break}}return a.delete(t),a.delete(n),h}function ts(t){return Ts(ks(t,e,qs),t+"")}function ns(e){return Er(e,To,ds)}function rs(e){return Er(e,Po,ps)}var is=In?function(e){return In.get(e)}:oc;function ss(e){for(var t=e.name+"",n=Tn[t],r=Ne.call(Tn,t)?n.length:0;r--;){var i=n[r],s=i.func;if(null==s||s==e)return i.name}return t}function as(e){return(Ne.call(Mn,"placeholder")?Mn:e).placeholder}function os(){var e=Mn.iteratee||rc;return e=e===rc?Nr:e,arguments.length?e(arguments[0],arguments[1]):e}function cs(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function ls(e){for(var t=To(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Es(i)]}return t}function us(t,n){var r=function(t,n){return null==t?e:t[n]}(t,n);return jr(r)?r:e}var ds=$t?function(e){return null==e?[]:(e=ke(e),Ot($t(e),function(t){return Ge.call(e,t)}))}:mc,ps=$t?function(e){for(var t=[];e;)Pt(t,ds(e)),e=He(e);return t}:mc,hs=Sr;function ms(e,t,n){for(var r=-1,i=(t=vi(t,e)).length,s=!1;++r<i;){var a=$s(t[r]);if(!(s=null!=e&&n(e,a)))break;e=e[a]}return s||++r!=i?s:!!(i=null==e?0:e.length)&&Ya(i)&&ys(a,i)&&(Ba(e)||za(e))}function fs(e){return"function"!=typeof e.constructor||xs(e)?{}:Fn(He(e))}function gs(e){return Ba(e)||za(e)||!!(Ye&&e&&e[Ye])}function ys(e,t){var n=typeof e;return!!(t=null==t?c:t)&&("number"==n||"symbol"!=n&&me.test(e))&&e>-1&&e%1==0&&e<t}function vs(e,t,n){if(!Xa(n))return!1;var r=typeof t;return!!("number"==r?Wa(n)&&ys(t,n.length):"string"==r&&t in n)&&Ua(n[t],e)}function bs(e,t){if(Ba(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!ao(e))||J.test(e)||!Z.test(e)||null!=t&&e in ke(t)}function ws(e){var t=ss(e),n=Mn[t];if("function"!=typeof n||!(t in qn.prototype))return!1;if(e===n)return!0;var r=is(n);return!!r&&e===r[0]}(En&&hs(new En(new ArrayBuffer(1)))!=I||Sn&&hs(new Sn)!=b||kn&&hs(kn.resolve())!=x||An&&hs(new An)!=S||On&&hs(new On)!=O)&&(hs=function(t){var n=Sr(t),r=n==_?t.constructor:e,i=r?Ls(r):"";if(i)switch(i){case Pn:return I;case Rn:return b;case jn:return x;case Nn:return S;case $n:return O}return n});var _s=Re?Za:fc;function xs(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Pe)}function Es(e){return e==e&&!Xa(e)}function Ss(t,n){return function(r){return null!=r&&r[t]===n&&(n!==e||t in ke(r))}}function ks(t,n,r){return n=yn(n===e?t.length-1:n,0),function(){for(var e=arguments,i=-1,s=yn(e.length-n,0),a=we(s);++i<s;)a[i]=e[n+i];i=-1;for(var o=we(n+1);++i<n;)o[i]=e[i];return o[n]=r(a),xt(t,this,o)}}function As(e,t){return t.length<2?e:xr(e,ni(t,0,-1))}function Os(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var Cs=Rs(Qr),Is=pt||function(e,t){return ut.setTimeout(e,t)},Ts=Rs(ei);function Ps(e,t,n){var r=t+"";return Ts(e,function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace(ne,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return St(d,function(n){var r="_."+n[0];t&n[1]&&!Ct(e,r)&&e.push(r)}),e.sort()}(function(e){var t=e.match(re);return t?t[1].split(ie):[]}(r),n)))}function Rs(t){var n=0,r=0;return function(){var i=bn(),s=16-(i-r);if(r=i,s>0){if(++n>=800)return arguments[0]}else n=0;return t.apply(e,arguments)}}function js(t,n){var r=-1,i=t.length,s=i-1;for(n=n===e?i:n;++r<n;){var a=Gr(r,s),o=t[a];t[a]=t[r],t[r]=o}return t.length=n,t}var Ns=function(e){var t=Ra(e,function(e){return 500===n.size&&n.clear(),e}),n=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Y,function(e,n,r,i){t.push(r?i.replace(oe,"$1"):n||e)}),t});function $s(e){if("string"==typeof e||ao(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Ls(e){if(null!=e){try{return je.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ds(e){if(e instanceof qn)return e.clone();var t=new Bn(e.__wrapped__,e.__chain__);return t.__actions__=Ci(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Us=Zr(function(e,t){return Ha(e)?ur(e,gr(t,1,Ha,!0)):[]}),Ms=Zr(function(t,n){var r=Vs(n);return Ha(r)&&(r=e),Ha(t)?ur(t,gr(n,1,Ha,!0),os(r,2)):[]}),Fs=Zr(function(t,n){var r=Vs(n);return Ha(r)&&(r=e),Ha(t)?ur(t,gr(n,1,Ha,!0),e,r):[]});function zs(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:ho(n);return i<0&&(i=yn(r+i,0)),Dt(e,os(t,3),i)}function Bs(t,n,r){var i=null==t?0:t.length;if(!i)return-1;var s=i-1;return r!==e&&(s=ho(r),s=r<0?yn(i+s,0):vn(s,i-1)),Dt(t,os(n,3),s,!0)}function qs(e){return null!=e&&e.length?gr(e,1):[]}function Ws(t){return t&&t.length?t[0]:e}var Hs=Zr(function(e){var t=Tt(e,gi);return t.length&&t[0]===e[0]?Cr(t):[]}),Ks=Zr(function(t){var n=Vs(t),r=Tt(t,gi);return n===Vs(r)?n=e:r.pop(),r.length&&r[0]===t[0]?Cr(r,os(n,2)):[]}),Gs=Zr(function(t){var n=Vs(t),r=Tt(t,gi);return(n="function"==typeof n?n:e)&&r.pop(),r.length&&r[0]===t[0]?Cr(r,e,n):[]});function Vs(t){var n=null==t?0:t.length;return n?t[n-1]:e}var Zs=Zr(Js);function Js(e,t){return e&&e.length&&t&&t.length?Hr(e,t):e}var Ys=ts(function(e,t){var n=null==e?0:e.length,r=sr(e,t);return Kr(e,Tt(t,function(e){return ys(e,n)?+e:e}).sort(ki)),r});function Xs(e){return null==e?e:xn.call(e)}var Qs=Zr(function(e){return li(gr(e,1,Ha,!0))}),ea=Zr(function(t){var n=Vs(t);return Ha(n)&&(n=e),li(gr(t,1,Ha,!0),os(n,2))}),ta=Zr(function(t){var n=Vs(t);return n="function"==typeof n?n:e,li(gr(t,1,Ha,!0),e,n)});function na(e){if(!e||!e.length)return[];var t=0;return e=Ot(e,function(e){if(Ha(e))return t=yn(e.length,t),!0}),Kt(t,function(t){return Tt(e,Bt(t))})}function ra(t,n){if(!t||!t.length)return[];var r=na(t);return null==n?r:Tt(r,function(t){return xt(n,e,t)})}var ia=Zr(function(e,t){return Ha(e)?ur(e,t):[]}),sa=Zr(function(e){return mi(Ot(e,Ha))}),aa=Zr(function(t){var n=Vs(t);return Ha(n)&&(n=e),mi(Ot(t,Ha),os(n,2))}),oa=Zr(function(t){var n=Vs(t);return n="function"==typeof n?n:e,mi(Ot(t,Ha),e,n)}),ca=Zr(na),la=Zr(function(t){var n=t.length,r=n>1?t[n-1]:e;return r="function"==typeof r?(t.pop(),r):e,ra(t,r)});function ua(e){var t=Mn(e);return t.__chain__=!0,t}function da(e,t){return t(e)}var pa=ts(function(t){var n=t.length,r=n?t[0]:0,i=this.__wrapped__,s=function(e){return sr(e,t)};return!(n>1||this.__actions__.length)&&i instanceof qn&&ys(r)?((i=i.slice(r,+r+(n?1:0))).__actions__.push({func:da,args:[s],thisArg:e}),new Bn(i,this.__chain__).thru(function(t){return n&&!t.length&&t.push(e),t})):this.thru(s)}),ha=Ti(function(e,t,n){Ne.call(e,n)?++e[n]:ir(e,n,1)}),ma=Di(zs),fa=Di(Bs);function ga(e,t){return(Ba(e)?St:dr)(e,os(t,3))}function ya(e,t){return(Ba(e)?kt:pr)(e,os(t,3))}var va=Ti(function(e,t,n){Ne.call(e,n)?e[n].push(t):ir(e,n,[t])}),ba=Zr(function(e,t,n){var r=-1,i="function"==typeof t,s=Wa(e)?we(e.length):[];return dr(e,function(e){s[++r]=i?xt(t,e,n):Ir(e,t,n)}),s}),wa=Ti(function(e,t,n){ir(e,n,t)});function _a(e,t){return(Ba(e)?Tt:Ur)(e,os(t,3))}var xa=Ti(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]}),Ea=Zr(function(e,t){if(null==e)return[];var n=t.length;return n>1&&vs(e,t[0],t[1])?t=[]:n>2&&vs(t[0],t[1],t[2])&&(t=[t[0]]),qr(e,gr(t,1),[])}),Sa=dt||function(){return ut.Date.now()};function ka(t,n,r){return n=r?e:n,n=t&&null==n?t.length:n,Ji(t,s,e,e,e,e,n)}function Aa(n,r){var i;if("function"!=typeof r)throw new Ce(t);return n=ho(n),function(){return--n>0&&(i=r.apply(this,arguments)),n<=1&&(r=e),i}}var Oa=Zr(function(e,t,n){var r=1;if(n.length){var s=an(n,as(Oa));r|=i}return Ji(e,r,t,n,s)}),Ca=Zr(function(e,t,n){var r=3;if(n.length){var s=an(n,as(Ca));r|=i}return Ji(t,r,e,n,s)});function Ia(n,r,i){var s,a,o,c,l,u,d=0,p=!1,h=!1,m=!0;if("function"!=typeof n)throw new Ce(t);function f(t){var r=s,i=a;return s=a=e,d=t,c=n.apply(i,r)}function g(t){var n=t-u;return u===e||n>=r||n<0||h&&t-d>=o}function y(){var e=Sa();if(g(e))return v(e);l=Is(y,function(e){var t=r-(e-u);return h?vn(t,o-(e-d)):t}(e))}function v(t){return l=e,m&&s?f(t):(s=a=e,c)}function b(){var t=Sa(),n=g(t);if(s=arguments,a=this,u=t,n){if(l===e)return function(e){return d=e,l=Is(y,r),p?f(e):c}(u);if(h)return _i(l),l=Is(y,r),f(u)}return l===e&&(l=Is(y,r)),c}return r=fo(r)||0,Xa(i)&&(p=!!i.leading,o=(h="maxWait"in i)?yn(fo(i.maxWait)||0,r):o,m="trailing"in i?!!i.trailing:m),b.cancel=function(){l!==e&&_i(l),d=0,s=u=a=l=e},b.flush=function(){return l===e?c:v(Sa())},b}var Ta=Zr(function(e,t){return lr(e,1,t)}),Pa=Zr(function(e,t,n){return lr(e,fo(t)||0,n)});function Ra(e,n){if("function"!=typeof e||null!=n&&"function"!=typeof n)throw new Ce(t);var r=function(){var t=arguments,i=n?n.apply(this,t):t[0],s=r.cache;if(s.has(i))return s.get(i);var a=e.apply(this,t);return r.cache=s.set(i,a)||s,a};return r.cache=new(Ra.Cache||Kn),r}function ja(e){if("function"!=typeof e)throw new Ce(t);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Ra.Cache=Kn;var Na=bi(function(e,t){var n=(t=1==t.length&&Ba(t[0])?Tt(t[0],Vt(os())):Tt(gr(t,1),Vt(os()))).length;return Zr(function(r){for(var i=-1,s=vn(r.length,n);++i<s;)r[i]=t[i].call(this,r[i]);return xt(e,this,r)})}),$a=Zr(function(t,n){var r=an(n,as($a));return Ji(t,i,e,n,r)}),La=Zr(function(t,n){var r=an(n,as(La));return Ji(t,64,e,n,r)}),Da=ts(function(t,n){return Ji(t,a,e,e,e,n)});function Ua(e,t){return e===t||e!=e&&t!=t}var Ma=Hi(kr),Fa=Hi(function(e,t){return e>=t}),za=Tr(function(){return arguments}())?Tr:function(e){return Qa(e)&&Ne.call(e,"callee")&&!Ge.call(e,"callee")},Ba=we.isArray,qa=gt?Vt(gt):function(e){return Qa(e)&&Sr(e)==C};function Wa(e){return null!=e&&Ya(e.length)&&!Za(e)}function Ha(e){return Qa(e)&&Wa(e)}var Ka=qt||fc,Ga=yt?Vt(yt):function(e){return Qa(e)&&Sr(e)==f};function Va(e){if(!Qa(e))return!1;var t=Sr(e);return t==g||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!no(e)}function Za(e){if(!Xa(e))return!1;var t=Sr(e);return t==y||t==v||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ja(e){return"number"==typeof e&&e==ho(e)}function Ya(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=c}function Xa(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Qa(e){return null!=e&&"object"==typeof e}var eo=vt?Vt(vt):function(e){return Qa(e)&&hs(e)==b};function to(e){return"number"==typeof e||Qa(e)&&Sr(e)==w}function no(e){if(!Qa(e)||Sr(e)!=_)return!1;var t=He(e);if(null===t)return!0;var n=Ne.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&je.call(n)==Ue}var ro=bt?Vt(bt):function(e){return Qa(e)&&Sr(e)==E},io=wt?Vt(wt):function(e){return Qa(e)&&hs(e)==S};function so(e){return"string"==typeof e||!Ba(e)&&Qa(e)&&Sr(e)==k}function ao(e){return"symbol"==typeof e||Qa(e)&&Sr(e)==A}var oo=_t?Vt(_t):function(e){return Qa(e)&&Ya(e.length)&&!!rt[Sr(e)]},co=Hi(Dr),lo=Hi(function(e,t){return e<=t});function uo(e){if(!e)return[];if(Wa(e))return so(e)?un(e):Ci(e);if(Qe&&e[Qe])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[Qe]());var t=hs(e);return(t==b?rn:t==S?on:Mo)(e)}function po(e){return e?(e=fo(e))===o||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function ho(e){var t=po(e),n=t%1;return t==t?n?t-n:t:0}function mo(e){return e?ar(ho(e),0,u):0}function fo(e){if("number"==typeof e)return e;if(ao(e))return l;if(Xa(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Xa(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Gt(e);var n=de.test(e);return n||he.test(e)?ot(e.slice(2),n?2:8):ue.test(e)?l:+e}function go(e){return Ii(e,Po(e))}function yo(e){return null==e?"":ci(e)}var vo=Pi(function(e,t){if(xs(t)||Wa(t))Ii(t,To(t),e);else for(var n in t)Ne.call(t,n)&&er(e,n,t[n])}),bo=Pi(function(e,t){Ii(t,Po(t),e)}),wo=Pi(function(e,t,n,r){Ii(t,Po(t),e,r)}),_o=Pi(function(e,t,n,r){Ii(t,To(t),e,r)}),xo=ts(sr),Eo=Zr(function(t,n){t=ke(t);var r=-1,i=n.length,s=i>2?n[2]:e;for(s&&vs(n[0],n[1],s)&&(i=1);++r<i;)for(var a=n[r],o=Po(a),c=-1,l=o.length;++c<l;){var u=o[c],d=t[u];(d===e||Ua(d,Pe[u])&&!Ne.call(t,u))&&(t[u]=a[u])}return t}),So=Zr(function(t){return t.push(e,Xi),xt(jo,e,t)});function ko(t,n,r){var i=null==t?e:xr(t,n);return i===e?r:i}function Ao(e,t){return null!=e&&ms(e,t,Or)}var Oo=Fi(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=De.call(t)),e[t]=n},Qo(nc)),Co=Fi(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=De.call(t)),Ne.call(e,t)?e[t].push(n):e[t]=[n]},os),Io=Zr(Ir);function To(e){return Wa(e)?Zn(e):$r(e)}function Po(e){return Wa(e)?Zn(e,!0):Lr(e)}var Ro=Pi(function(e,t,n){zr(e,t,n)}),jo=Pi(function(e,t,n,r){zr(e,t,n,r)}),No=ts(function(e,t){var n={};if(null==e)return n;var r=!1;t=Tt(t,function(t){return t=vi(t,e),r||(r=t.length>1),t}),Ii(e,rs(e),n),r&&(n=or(n,7,Qi));for(var i=t.length;i--;)ui(n,t[i]);return n}),$o=ts(function(e,t){return null==e?{}:function(e,t){return Wr(e,t,function(t,n){return Ao(e,n)})}(e,t)});function Lo(e,t){if(null==e)return{};var n=Tt(rs(e),function(e){return[e]});return t=os(t),Wr(e,n,function(e,n){return t(e,n[0])})}var Do=Zi(To),Uo=Zi(Po);function Mo(e){return null==e?[]:Zt(e,To(e))}var Fo=$i(function(e,t,n){return t=t.toLowerCase(),e+(n?zo(t):t)});function zo(e){return Zo(yo(e).toLowerCase())}function Bo(e){return(e=yo(e))&&e.replace(fe,Qt).replace(Je,"")}var qo=$i(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),Wo=$i(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),Ho=Ni("toLowerCase"),Ko=$i(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}),Go=$i(function(e,t,n){return e+(n?" ":"")+Zo(t)}),Vo=$i(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Zo=Ni("toUpperCase");function Jo(t,n,r){return t=yo(t),(n=r?e:n)===e?function(e){return et.test(e)}(t)?function(e){return e.match(Xe)||[]}(t):function(e){return e.match(se)||[]}(t):t.match(n)||[]}var Yo=Zr(function(t,n){try{return xt(t,e,n)}catch(e){return Va(e)?e:new xe(e)}}),Xo=ts(function(e,t){return St(t,function(t){t=$s(t),ir(e,t,Oa(e[t],e))}),e});function Qo(e){return function(){return e}}var ec=Ui(),tc=Ui(!0);function nc(e){return e}function rc(e){return Nr("function"==typeof e?e:or(e,1))}var ic=Zr(function(e,t){return function(n){return Ir(n,e,t)}}),sc=Zr(function(e,t){return function(n){return Ir(e,n,t)}});function ac(e,t,n){var r=To(t),i=_r(t,r);null!=n||Xa(t)&&(i.length||!r.length)||(n=t,t=e,e=this,i=_r(t,To(t)));var s=!(Xa(n)&&"chain"in n&&!n.chain),a=Za(e);return St(i,function(n){var r=t[n];e[n]=r,a&&(e.prototype[n]=function(){var t=this.__chain__;if(s||t){var n=e(this.__wrapped__);return(n.__actions__=Ci(this.__actions__)).push({func:r,args:arguments,thisArg:e}),n.__chain__=t,n}return r.apply(e,Pt([this.value()],arguments))})}),e}function oc(){}var cc=Bi(Tt),lc=Bi(At),uc=Bi(Nt);function dc(e){return bs(e)?Bt($s(e)):function(e){return function(t){return xr(t,e)}}(e)}var pc=Wi(),hc=Wi(!0);function mc(){return[]}function fc(){return!1}var gc,yc=zi(function(e,t){return e+t},0),vc=Gi("ceil"),bc=zi(function(e,t){return e/t},1),wc=Gi("floor"),_c=zi(function(e,t){return e*t},1),xc=Gi("round"),Ec=zi(function(e,t){return e-t},0);return Mn.after=function(e,n){if("function"!=typeof n)throw new Ce(t);return e=ho(e),function(){if(--e<1)return n.apply(this,arguments)}},Mn.ary=ka,Mn.assign=vo,Mn.assignIn=bo,Mn.assignInWith=wo,Mn.assignWith=_o,Mn.at=xo,Mn.before=Aa,Mn.bind=Oa,Mn.bindAll=Xo,Mn.bindKey=Ca,Mn.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Ba(e)?e:[e]},Mn.chain=ua,Mn.chunk=function(t,n,r){n=(r?vs(t,n,r):n===e)?1:yn(ho(n),0);var i=null==t?0:t.length;if(!i||n<1)return[];for(var s=0,a=0,o=we(mt(i/n));s<i;)o[a++]=ni(t,s,s+=n);return o},Mn.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i},Mn.concat=function(){var e=arguments.length;if(!e)return[];for(var t=we(e-1),n=arguments[0],r=e;r--;)t[r-1]=arguments[r];return Pt(Ba(n)?Ci(n):[n],gr(t,1))},Mn.cond=function(e){var n=null==e?0:e.length,r=os();return e=n?Tt(e,function(e){if("function"!=typeof e[1])throw new Ce(t);return[r(e[0]),e[1]]}):[],Zr(function(t){for(var r=-1;++r<n;){var i=e[r];if(xt(i[0],this,t))return xt(i[1],this,t)}})},Mn.conforms=function(e){return function(e){var t=To(e);return function(n){return cr(n,e,t)}}(or(e,1))},Mn.constant=Qo,Mn.countBy=ha,Mn.create=function(e,t){var n=Fn(e);return null==t?n:rr(n,t)},Mn.curry=function t(n,r,i){var s=Ji(n,8,e,e,e,e,e,r=i?e:r);return s.placeholder=t.placeholder,s},Mn.curryRight=function t(n,r,i){var s=Ji(n,16,e,e,e,e,e,r=i?e:r);return s.placeholder=t.placeholder,s},Mn.debounce=Ia,Mn.defaults=Eo,Mn.defaultsDeep=So,Mn.defer=Ta,Mn.delay=Pa,Mn.difference=Us,Mn.differenceBy=Ms,Mn.differenceWith=Fs,Mn.drop=function(t,n,r){var i=null==t?0:t.length;return i?ni(t,(n=r||n===e?1:ho(n))<0?0:n,i):[]},Mn.dropRight=function(t,n,r){var i=null==t?0:t.length;return i?ni(t,0,(n=i-(n=r||n===e?1:ho(n)))<0?0:n):[]},Mn.dropRightWhile=function(e,t){return e&&e.length?pi(e,os(t,3),!0,!0):[]},Mn.dropWhile=function(e,t){return e&&e.length?pi(e,os(t,3),!0):[]},Mn.fill=function(t,n,r,i){var s=null==t?0:t.length;return s?(r&&"number"!=typeof r&&vs(t,n,r)&&(r=0,i=s),function(t,n,r,i){var s=t.length;for((r=ho(r))<0&&(r=-r>s?0:s+r),(i=i===e||i>s?s:ho(i))<0&&(i+=s),i=r>i?0:mo(i);r<i;)t[r++]=n;return t}(t,n,r,i)):[]},Mn.filter=function(e,t){return(Ba(e)?Ot:fr)(e,os(t,3))},Mn.flatMap=function(e,t){return gr(_a(e,t),1)},Mn.flatMapDeep=function(e,t){return gr(_a(e,t),o)},Mn.flatMapDepth=function(t,n,r){return r=r===e?1:ho(r),gr(_a(t,n),r)},Mn.flatten=qs,Mn.flattenDeep=function(e){return null!=e&&e.length?gr(e,o):[]},Mn.flattenDepth=function(t,n){return null!=t&&t.length?gr(t,n=n===e?1:ho(n)):[]},Mn.flip=function(e){return Ji(e,512)},Mn.flow=ec,Mn.flowRight=tc,Mn.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},Mn.functions=function(e){return null==e?[]:_r(e,To(e))},Mn.functionsIn=function(e){return null==e?[]:_r(e,Po(e))},Mn.groupBy=va,Mn.initial=function(e){return null!=e&&e.length?ni(e,0,-1):[]},Mn.intersection=Hs,Mn.intersectionBy=Ks,Mn.intersectionWith=Gs,Mn.invert=Oo,Mn.invertBy=Co,Mn.invokeMap=ba,Mn.iteratee=rc,Mn.keyBy=wa,Mn.keys=To,Mn.keysIn=Po,Mn.map=_a,Mn.mapKeys=function(e,t){var n={};return t=os(t,3),br(e,function(e,r,i){ir(n,t(e,r,i),e)}),n},Mn.mapValues=function(e,t){var n={};return t=os(t,3),br(e,function(e,r,i){ir(n,r,t(e,r,i))}),n},Mn.matches=function(e){return Mr(or(e,1))},Mn.matchesProperty=function(e,t){return Fr(e,or(t,1))},Mn.memoize=Ra,Mn.merge=Ro,Mn.mergeWith=jo,Mn.method=ic,Mn.methodOf=sc,Mn.mixin=ac,Mn.negate=ja,Mn.nthArg=function(e){return e=ho(e),Zr(function(t){return Br(t,e)})},Mn.omit=No,Mn.omitBy=function(e,t){return Lo(e,ja(os(t)))},Mn.once=function(e){return Aa(2,e)},Mn.orderBy=function(t,n,r,i){return null==t?[]:(Ba(n)||(n=null==n?[]:[n]),Ba(r=i?e:r)||(r=null==r?[]:[r]),qr(t,n,r))},Mn.over=cc,Mn.overArgs=Na,Mn.overEvery=lc,Mn.overSome=uc,Mn.partial=$a,Mn.partialRight=La,Mn.partition=xa,Mn.pick=$o,Mn.pickBy=Lo,Mn.property=dc,Mn.propertyOf=function(t){return function(n){return null==t?e:xr(t,n)}},Mn.pull=Zs,Mn.pullAll=Js,Mn.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?Hr(e,t,os(n,2)):e},Mn.pullAllWith=function(t,n,r){return t&&t.length&&n&&n.length?Hr(t,n,e,r):t},Mn.pullAt=Ys,Mn.range=pc,Mn.rangeRight=hc,Mn.rearg=Da,Mn.reject=function(e,t){return(Ba(e)?Ot:fr)(e,ja(os(t,3)))},Mn.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],s=e.length;for(t=os(t,3);++r<s;){var a=e[r];t(a,r,e)&&(n.push(a),i.push(r))}return Kr(e,i),n},Mn.rest=function(n,r){if("function"!=typeof n)throw new Ce(t);return Zr(n,r=r===e?r:ho(r))},Mn.reverse=Xs,Mn.sampleSize=function(t,n,r){return n=(r?vs(t,n,r):n===e)?1:ho(n),(Ba(t)?Yn:Yr)(t,n)},Mn.set=function(e,t,n){return null==e?e:Xr(e,t,n)},Mn.setWith=function(t,n,r,i){return i="function"==typeof i?i:e,null==t?t:Xr(t,n,r,i)},Mn.shuffle=function(e){return(Ba(e)?Xn:ti)(e)},Mn.slice=function(t,n,r){var i=null==t?0:t.length;return i?(r&&"number"!=typeof r&&vs(t,n,r)?(n=0,r=i):(n=null==n?0:ho(n),r=r===e?i:ho(r)),ni(t,n,r)):[]},Mn.sortBy=Ea,Mn.sortedUniq=function(e){return e&&e.length?ai(e):[]},Mn.sortedUniqBy=function(e,t){return e&&e.length?ai(e,os(t,2)):[]},Mn.split=function(t,n,r){return r&&"number"!=typeof r&&vs(t,n,r)&&(n=r=e),(r=r===e?u:r>>>0)?(t=yo(t))&&("string"==typeof n||null!=n&&!ro(n))&&!(n=ci(n))&&nn(t)?wi(un(t),0,r):t.split(n,r):[]},Mn.spread=function(e,n){if("function"!=typeof e)throw new Ce(t);return n=null==n?0:yn(ho(n),0),Zr(function(t){var r=t[n],i=wi(t,0,n);return r&&Pt(i,r),xt(e,this,i)})},Mn.tail=function(e){var t=null==e?0:e.length;return t?ni(e,1,t):[]},Mn.take=function(t,n,r){return t&&t.length?ni(t,0,(n=r||n===e?1:ho(n))<0?0:n):[]},Mn.takeRight=function(t,n,r){var i=null==t?0:t.length;return i?ni(t,(n=i-(n=r||n===e?1:ho(n)))<0?0:n,i):[]},Mn.takeRightWhile=function(e,t){return e&&e.length?pi(e,os(t,3),!1,!0):[]},Mn.takeWhile=function(e,t){return e&&e.length?pi(e,os(t,3)):[]},Mn.tap=function(e,t){return t(e),e},Mn.throttle=function(e,n,r){var i=!0,s=!0;if("function"!=typeof e)throw new Ce(t);return Xa(r)&&(i="leading"in r?!!r.leading:i,s="trailing"in r?!!r.trailing:s),Ia(e,n,{leading:i,maxWait:n,trailing:s})},Mn.thru=da,Mn.toArray=uo,Mn.toPairs=Do,Mn.toPairsIn=Uo,Mn.toPath=function(e){return Ba(e)?Tt(e,$s):ao(e)?[e]:Ci(Ns(yo(e)))},Mn.toPlainObject=go,Mn.transform=function(e,t,n){var r=Ba(e),i=r||Ka(e)||oo(e);if(t=os(t,4),null==n){var s=e&&e.constructor;n=i?r?new s:[]:Xa(e)&&Za(s)?Fn(He(e)):{}}return(i?St:br)(e,function(e,r,i){return t(n,e,r,i)}),n},Mn.unary=function(e){return ka(e,1)},Mn.union=Qs,Mn.unionBy=ea,Mn.unionWith=ta,Mn.uniq=function(e){return e&&e.length?li(e):[]},Mn.uniqBy=function(e,t){return e&&e.length?li(e,os(t,2)):[]},Mn.uniqWith=function(t,n){return n="function"==typeof n?n:e,t&&t.length?li(t,e,n):[]},Mn.unset=function(e,t){return null==e||ui(e,t)},Mn.unzip=na,Mn.unzipWith=ra,Mn.update=function(e,t,n){return null==e?e:di(e,t,yi(n))},Mn.updateWith=function(t,n,r,i){return i="function"==typeof i?i:e,null==t?t:di(t,n,yi(r),i)},Mn.values=Mo,Mn.valuesIn=function(e){return null==e?[]:Zt(e,Po(e))},Mn.without=ia,Mn.words=Jo,Mn.wrap=function(e,t){return $a(yi(t),e)},Mn.xor=sa,Mn.xorBy=aa,Mn.xorWith=oa,Mn.zip=ca,Mn.zipObject=function(e,t){return fi(e||[],t||[],er)},Mn.zipObjectDeep=function(e,t){return fi(e||[],t||[],Xr)},Mn.zipWith=la,Mn.entries=Do,Mn.entriesIn=Uo,Mn.extend=bo,Mn.extendWith=wo,ac(Mn,Mn),Mn.add=yc,Mn.attempt=Yo,Mn.camelCase=Fo,Mn.capitalize=zo,Mn.ceil=vc,Mn.clamp=function(t,n,r){return r===e&&(r=n,n=e),r!==e&&(r=(r=fo(r))==r?r:0),n!==e&&(n=(n=fo(n))==n?n:0),ar(fo(t),n,r)},Mn.clone=function(e){return or(e,4)},Mn.cloneDeep=function(e){return or(e,5)},Mn.cloneDeepWith=function(t,n){return or(t,5,n="function"==typeof n?n:e)},Mn.cloneWith=function(t,n){return or(t,4,n="function"==typeof n?n:e)},Mn.conformsTo=function(e,t){return null==t||cr(e,t,To(t))},Mn.deburr=Bo,Mn.defaultTo=function(e,t){return null==e||e!=e?t:e},Mn.divide=bc,Mn.endsWith=function(t,n,r){t=yo(t),n=ci(n);var i=t.length,s=r=r===e?i:ar(ho(r),0,i);return(r-=n.length)>=0&&t.slice(r,s)==n},Mn.eq=Ua,Mn.escape=function(e){return(e=yo(e))&&H.test(e)?e.replace(q,en):e},Mn.escapeRegExp=function(e){return(e=yo(e))&&Q.test(e)?e.replace(X,"\\$&"):e},Mn.every=function(t,n,r){var i=Ba(t)?At:hr;return r&&vs(t,n,r)&&(n=e),i(t,os(n,3))},Mn.find=ma,Mn.findIndex=zs,Mn.findKey=function(e,t){return Lt(e,os(t,3),br)},Mn.findLast=fa,Mn.findLastIndex=Bs,Mn.findLastKey=function(e,t){return Lt(e,os(t,3),wr)},Mn.floor=wc,Mn.forEach=ga,Mn.forEachRight=ya,Mn.forIn=function(e,t){return null==e?e:yr(e,os(t,3),Po)},Mn.forInRight=function(e,t){return null==e?e:vr(e,os(t,3),Po)},Mn.forOwn=function(e,t){return e&&br(e,os(t,3))},Mn.forOwnRight=function(e,t){return e&&wr(e,os(t,3))},Mn.get=ko,Mn.gt=Ma,Mn.gte=Fa,Mn.has=function(e,t){return null!=e&&ms(e,t,Ar)},Mn.hasIn=Ao,Mn.head=Ws,Mn.identity=nc,Mn.includes=function(e,t,n,r){e=Wa(e)?e:Mo(e),n=n&&!r?ho(n):0;var i=e.length;return n<0&&(n=yn(i+n,0)),so(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Ut(e,t,n)>-1},Mn.indexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:ho(n);return i<0&&(i=yn(r+i,0)),Ut(e,t,i)},Mn.inRange=function(t,n,r){return n=po(n),r===e?(r=n,n=0):r=po(r),function(e,t,n){return e>=vn(t,n)&&e<yn(t,n)}(t=fo(t),n,r)},Mn.invoke=Io,Mn.isArguments=za,Mn.isArray=Ba,Mn.isArrayBuffer=qa,Mn.isArrayLike=Wa,Mn.isArrayLikeObject=Ha,Mn.isBoolean=function(e){return!0===e||!1===e||Qa(e)&&Sr(e)==m},Mn.isBuffer=Ka,Mn.isDate=Ga,Mn.isElement=function(e){return Qa(e)&&1===e.nodeType&&!no(e)},Mn.isEmpty=function(e){if(null==e)return!0;if(Wa(e)&&(Ba(e)||"string"==typeof e||"function"==typeof e.splice||Ka(e)||oo(e)||za(e)))return!e.length;var t=hs(e);if(t==b||t==S)return!e.size;if(xs(e))return!$r(e).length;for(var n in e)if(Ne.call(e,n))return!1;return!0},Mn.isEqual=function(e,t){return Pr(e,t)},Mn.isEqualWith=function(t,n,r){var i=(r="function"==typeof r?r:e)?r(t,n):e;return i===e?Pr(t,n,e,r):!!i},Mn.isError=Va,Mn.isFinite=function(e){return"number"==typeof e&&mn(e)},Mn.isFunction=Za,Mn.isInteger=Ja,Mn.isLength=Ya,Mn.isMap=eo,Mn.isMatch=function(e,t){return e===t||Rr(e,t,ls(t))},Mn.isMatchWith=function(t,n,r){return r="function"==typeof r?r:e,Rr(t,n,ls(n),r)},Mn.isNaN=function(e){return to(e)&&e!=+e},Mn.isNative=function(e){if(_s(e))throw new xe("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return jr(e)},Mn.isNil=function(e){return null==e},Mn.isNull=function(e){return null===e},Mn.isNumber=to,Mn.isObject=Xa,Mn.isObjectLike=Qa,Mn.isPlainObject=no,Mn.isRegExp=ro,Mn.isSafeInteger=function(e){return Ja(e)&&e>=-9007199254740991&&e<=c},Mn.isSet=io,Mn.isString=so,Mn.isSymbol=ao,Mn.isTypedArray=oo,Mn.isUndefined=function(t){return t===e},Mn.isWeakMap=function(e){return Qa(e)&&hs(e)==O},Mn.isWeakSet=function(e){return Qa(e)&&"[object WeakSet]"==Sr(e)},Mn.join=function(e,t){return null==e?"":fn.call(e,t)},Mn.kebabCase=qo,Mn.last=Vs,Mn.lastIndexOf=function(t,n,r){var i=null==t?0:t.length;if(!i)return-1;var s=i;return r!==e&&(s=(s=ho(r))<0?yn(i+s,0):vn(s,i-1)),n==n?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(t,n,s):Dt(t,Ft,s,!0)},Mn.lowerCase=Wo,Mn.lowerFirst=Ho,Mn.lt=co,Mn.lte=lo,Mn.max=function(t){return t&&t.length?mr(t,nc,kr):e},Mn.maxBy=function(t,n){return t&&t.length?mr(t,os(n,2),kr):e},Mn.mean=function(e){return zt(e,nc)},Mn.meanBy=function(e,t){return zt(e,os(t,2))},Mn.min=function(t){return t&&t.length?mr(t,nc,Dr):e},Mn.minBy=function(t,n){return t&&t.length?mr(t,os(n,2),Dr):e},Mn.stubArray=mc,Mn.stubFalse=fc,Mn.stubObject=function(){return{}},Mn.stubString=function(){return""},Mn.stubTrue=function(){return!0},Mn.multiply=_c,Mn.nth=function(t,n){return t&&t.length?Br(t,ho(n)):e},Mn.noConflict=function(){return ut._===this&&(ut._=Me),this},Mn.noop=oc,Mn.now=Sa,Mn.pad=function(e,t,n){e=yo(e);var r=(t=ho(t))?ln(e):0;if(!t||r>=t)return e;var i=(t-r)/2;return qi(ft(i),n)+e+qi(mt(i),n)},Mn.padEnd=function(e,t,n){e=yo(e);var r=(t=ho(t))?ln(e):0;return t&&r<t?e+qi(t-r,n):e},Mn.padStart=function(e,t,n){e=yo(e);var r=(t=ho(t))?ln(e):0;return t&&r<t?qi(t-r,n)+e:e},Mn.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),wn(yo(e).replace(ee,""),t||0)},Mn.random=function(t,n,r){if(r&&"boolean"!=typeof r&&vs(t,n,r)&&(n=r=e),r===e&&("boolean"==typeof n?(r=n,n=e):"boolean"==typeof t&&(r=t,t=e)),t===e&&n===e?(t=0,n=1):(t=po(t),n===e?(n=t,t=0):n=po(n)),t>n){var i=t;t=n,n=i}if(r||t%1||n%1){var s=_n();return vn(t+s*(n-t+at("1e-"+((s+"").length-1))),n)}return Gr(t,n)},Mn.reduce=function(e,t,n){var r=Ba(e)?Rt:Wt,i=arguments.length<3;return r(e,os(t,4),n,i,dr)},Mn.reduceRight=function(e,t,n){var r=Ba(e)?jt:Wt,i=arguments.length<3;return r(e,os(t,4),n,i,pr)},Mn.repeat=function(t,n,r){return n=(r?vs(t,n,r):n===e)?1:ho(n),Vr(yo(t),n)},Mn.replace=function(){var e=arguments,t=yo(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Mn.result=function(t,n,r){var i=-1,s=(n=vi(n,t)).length;for(s||(s=1,t=e);++i<s;){var a=null==t?e:t[$s(n[i])];a===e&&(i=s,a=r),t=Za(a)?a.call(t):a}return t},Mn.round=xc,Mn.runInContext=te,Mn.sample=function(e){return(Ba(e)?Jn:Jr)(e)},Mn.size=function(e){if(null==e)return 0;if(Wa(e))return so(e)?ln(e):e.length;var t=hs(e);return t==b||t==S?e.size:$r(e).length},Mn.snakeCase=Ko,Mn.some=function(t,n,r){var i=Ba(t)?Nt:ri;return r&&vs(t,n,r)&&(n=e),i(t,os(n,3))},Mn.sortedIndex=function(e,t){return ii(e,t)},Mn.sortedIndexBy=function(e,t,n){return si(e,t,os(n,2))},Mn.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=ii(e,t);if(r<n&&Ua(e[r],t))return r}return-1},Mn.sortedLastIndex=function(e,t){return ii(e,t,!0)},Mn.sortedLastIndexBy=function(e,t,n){return si(e,t,os(n,2),!0)},Mn.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var n=ii(e,t,!0)-1;if(Ua(e[n],t))return n}return-1},Mn.startCase=Go,Mn.startsWith=function(e,t,n){return e=yo(e),n=null==n?0:ar(ho(n),0,e.length),t=ci(t),e.slice(n,n+t.length)==t},Mn.subtract=Ec,Mn.sum=function(e){return e&&e.length?Ht(e,nc):0},Mn.sumBy=function(e,t){return e&&e.length?Ht(e,os(t,2)):0},Mn.template=function(t,n,r){var i=Mn.templateSettings;r&&vs(t,n,r)&&(n=e),t=yo(t),n=wo({},n,i,Yi);var s,a,o=wo({},n.imports,i.imports,Yi),c=To(o),l=Zt(o,c),u=0,d=n.interpolate||ge,p="__p += '",h=Ae((n.escape||ge).source+"|"+d.source+"|"+(d===V?ce:ge).source+"|"+(n.evaluate||ge).source+"|$","g"),m="//# sourceURL="+(Ne.call(n,"sourceURL")?(n.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++nt+"]")+"\n";t.replace(h,function(e,n,r,i,o,c){return r||(r=i),p+=t.slice(u,c).replace(ye,tn),n&&(s=!0,p+="' +\n__e("+n+") +\n'"),o&&(a=!0,p+="';\n"+o+";\n__p += '"),r&&(p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=c+e.length,e}),p+="';\n";var f=Ne.call(n,"variable")&&n.variable;if(f){if(ae.test(f))throw new xe("Invalid `variable` option passed into `_.template`")}else p="with (obj) {\n"+p+"\n}\n";p=(a?p.replace(M,""):p).replace(F,"$1").replace(z,"$1;"),p="function("+(f||"obj")+") {\n"+(f?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var g=Yo(function(){return Ee(c,m+"return "+p).apply(e,l)});if(g.source=p,Va(g))throw g;return g},Mn.times=function(e,t){if((e=ho(e))<1||e>c)return[];var n=u,r=vn(e,u);t=os(t),e-=u;for(var i=Kt(r,t);++n<e;)t(n);return i},Mn.toFinite=po,Mn.toInteger=ho,Mn.toLength=mo,Mn.toLower=function(e){return yo(e).toLowerCase()},Mn.toNumber=fo,Mn.toSafeInteger=function(e){return e?ar(ho(e),-9007199254740991,c):0===e?e:0},Mn.toString=yo,Mn.toUpper=function(e){return yo(e).toUpperCase()},Mn.trim=function(t,n,r){if((t=yo(t))&&(r||n===e))return Gt(t);if(!t||!(n=ci(n)))return t;var i=un(t),s=un(n);return wi(i,Yt(i,s),Xt(i,s)+1).join("")},Mn.trimEnd=function(t,n,r){if((t=yo(t))&&(r||n===e))return t.slice(0,dn(t)+1);if(!t||!(n=ci(n)))return t;var i=un(t);return wi(i,0,Xt(i,un(n))+1).join("")},Mn.trimStart=function(t,n,r){if((t=yo(t))&&(r||n===e))return t.replace(ee,"");if(!t||!(n=ci(n)))return t;var i=un(t);return wi(i,Yt(i,un(n))).join("")},Mn.truncate=function(t,n){var r=30,i="...";if(Xa(n)){var s="separator"in n?n.separator:s;r="length"in n?ho(n.length):r,i="omission"in n?ci(n.omission):i}var a=(t=yo(t)).length;if(nn(t)){var o=un(t);a=o.length}if(r>=a)return t;var c=r-ln(i);if(c<1)return i;var l=o?wi(o,0,c).join(""):t.slice(0,c);if(s===e)return l+i;if(o&&(c+=l.length-c),ro(s)){if(t.slice(c).search(s)){var u,d=l;for(s.global||(s=Ae(s.source,yo(le.exec(s))+"g")),s.lastIndex=0;u=s.exec(d);)var p=u.index;l=l.slice(0,p===e?c:p)}}else if(t.indexOf(ci(s),c)!=c){var h=l.lastIndexOf(s);h>-1&&(l=l.slice(0,h))}return l+i},Mn.unescape=function(e){return(e=yo(e))&&W.test(e)?e.replace(B,pn):e},Mn.uniqueId=function(e){var t=++$e;return yo(e)+t},Mn.upperCase=Vo,Mn.upperFirst=Zo,Mn.each=ga,Mn.eachRight=ya,Mn.first=Ws,ac(Mn,(gc={},br(Mn,function(e,t){Ne.call(Mn.prototype,t)||(gc[t]=e)}),gc),{chain:!1}),Mn.VERSION="4.17.21",St(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){Mn[e].placeholder=Mn}),St(["drop","take"],function(t,n){qn.prototype[t]=function(r){r=r===e?1:yn(ho(r),0);var i=this.__filtered__&&!n?new qn(this):this.clone();return i.__filtered__?i.__takeCount__=vn(r,i.__takeCount__):i.__views__.push({size:vn(r,u),type:t+(i.__dir__<0?"Right":"")}),i},qn.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),St(["filter","map","takeWhile"],function(e,t){var n=t+1,r=1==n||3==n;qn.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:os(e,3),type:n}),t.__filtered__=t.__filtered__||r,t}}),St(["head","last"],function(e,t){var n="take"+(t?"Right":"");qn.prototype[e]=function(){return this[n](1).value()[0]}}),St(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");qn.prototype[e]=function(){return this.__filtered__?new qn(this):this[n](1)}}),qn.prototype.compact=function(){return this.filter(nc)},qn.prototype.find=function(e){return this.filter(e).head()},qn.prototype.findLast=function(e){return this.reverse().find(e)},qn.prototype.invokeMap=Zr(function(e,t){return"function"==typeof e?new qn(this):this.map(function(n){return Ir(n,e,t)})}),qn.prototype.reject=function(e){return this.filter(ja(os(e)))},qn.prototype.slice=function(t,n){t=ho(t);var r=this;return r.__filtered__&&(t>0||n<0)?new qn(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),n!==e&&(r=(n=ho(n))<0?r.dropRight(-n):r.take(n-t)),r)},qn.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},qn.prototype.toArray=function(){return this.take(u)},br(qn.prototype,function(t,n){var r=/^(?:filter|find|map|reject)|While$/.test(n),i=/^(?:head|last)$/.test(n),s=Mn[i?"take"+("last"==n?"Right":""):n],a=i||/^find/.test(n);s&&(Mn.prototype[n]=function(){var n=this.__wrapped__,o=i?[1]:arguments,c=n instanceof qn,l=o[0],u=c||Ba(n),d=function(e){var t=s.apply(Mn,Pt([e],o));return i&&p?t[0]:t};u&&r&&"function"==typeof l&&1!=l.length&&(c=u=!1);var p=this.__chain__,h=!!this.__actions__.length,m=a&&!p,f=c&&!h;if(!a&&u){n=f?n:new qn(this);var g=t.apply(n,o);return g.__actions__.push({func:da,args:[d],thisArg:e}),new Bn(g,p)}return m&&f?t.apply(this,o):(g=this.thru(d),m?i?g.value()[0]:g.value():g)})}),St(["pop","push","shift","sort","splice","unshift"],function(e){var t=Ie[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);Mn.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var i=this.value();return t.apply(Ba(i)?i:[],e)}return this[n](function(n){return t.apply(Ba(n)?n:[],e)})}}),br(qn.prototype,function(e,t){var n=Mn[t];if(n){var r=n.name+"";Ne.call(Tn,r)||(Tn[r]=[]),Tn[r].push({name:t,func:n})}}),Tn[Mi(e,2).name]=[{name:"wrapper",func:e}],qn.prototype.clone=function(){var e=new qn(this.__wrapped__);return e.__actions__=Ci(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Ci(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Ci(this.__views__),e},qn.prototype.reverse=function(){if(this.__filtered__){var e=new qn(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},qn.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=Ba(e),r=t<0,i=n?e.length:0,s=function(e,t,n){for(var r=-1,i=n.length;++r<i;){var s=n[r],a=s.size;switch(s.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=vn(t,e+a);break;case"takeRight":e=yn(e,t-a)}}return{start:e,end:t}}(0,i,this.__views__),a=s.start,o=s.end,c=o-a,l=r?o:a-1,u=this.__iteratees__,d=u.length,p=0,h=vn(c,this.__takeCount__);if(!n||!r&&i==c&&h==c)return hi(e,this.__actions__);var m=[];e:for(;c--&&p<h;){for(var f=-1,g=e[l+=t];++f<d;){var y=u[f],v=y.iteratee,b=y.type,w=v(g);if(2==b)g=w;else if(!w){if(1==b)continue e;break e}}m[p++]=g}return m},Mn.prototype.at=pa,Mn.prototype.chain=function(){return ua(this)},Mn.prototype.commit=function(){return new Bn(this.value(),this.__chain__)},Mn.prototype.next=function(){this.__values__===e&&(this.__values__=uo(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?e:this.__values__[this.__index__++]}},Mn.prototype.plant=function(t){for(var n,r=this;r instanceof zn;){var i=Ds(r);i.__index__=0,i.__values__=e,n?s.__wrapped__=i:n=i;var s=i;r=r.__wrapped__}return s.__wrapped__=t,n},Mn.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof qn){var n=t;return this.__actions__.length&&(n=new qn(this)),(n=n.reverse()).__actions__.push({func:da,args:[Xs],thisArg:e}),new Bn(n,this.__chain__)}return this.thru(Xs)},Mn.prototype.toJSON=Mn.prototype.valueOf=Mn.prototype.value=function(){return hi(this.__wrapped__,this.__actions__)},Mn.prototype.first=Mn.prototype.head,Qe&&(Mn.prototype[Qe]=function(){return this}),Mn}();pt?((pt.exports=hn)._=hn,dt._=hn):ut._=hn}.call($e);var jR=Le(RR.exports);const NR={"deepseek.r1-v1:0":{"$.model":"us.deepseek.r1-v1:0"},"anthropic.claude-sonnet-4":{"$.model":"us.anthropic.claude-sonnet-4-20250514-v1:0","$.modelKwargs.anthropic_version":"bedrock-2023-05-31"},"anthropic.claude-sonnet-3-7":{"$.model":"arn:aws:bedrock:us-east-1::foundation-model/anthropic.claude-3-7-sonnet-20250219-v1:0","$.modelKwargs.anthropic_version":"bedrock-2023-05-31"},"anthropic.claude-3-7-sonnet-20250219-v1:0":{"$.model":"arn:aws:bedrock:us-east-1::foundation-model/anthropic.claude-3-7-sonnet-20250219-v1:0","$.modelKwargs.anthropic_version":"bedrock-2023-05-31"},"anthropic.claude-sonnet-3-5-2":{"$.model":"anthropic.claude-3-5-sonnet-20241022-v2:0"},"anthropic.claude-sonnet-3-5":{"$.model":"anthropic.claude-3-5-sonnet-20240620-v1:0"},"anthropic.claude-3-5-sonnet-20240620-v1:0":{"$.model":"anthropic.claude-3-5-sonnet-20240620-v1:0","$.modelKwargs.anthropic_version":"bedrock-2023-05-31"},"anthropic.claude-sonnet-3":{"$.model":"anthropic.claude-3-sonnet-20240229-v1:0","$.modelKwargs.anthropic_version":"bedrock-2023-05-31"},"anthropic.claude-3-sonnet-20240229-v1:0":{"$.model":"anthropic.claude-3-sonnet-20240229-v1:0","$.modelKwargs.anthropic_version":"bedrock-2023-05-31"},"anthropic.claude-3-haiku":{"$.model":"anthropic.claude-3-haiku-20240307-v1:0","$.modelKwargs.anthropic_version":"bedrock-2023-05-31"},"anthropic.claude-3-5-haiku":{"$.model":"anthropic.claude-3-5-haiku-20241022","$.modelKwargs.anthropic_version":"bedrock-2023-05-31"},"anthropic.claude-3-5-haiku-serverless":{"$.model":"anthropic.claude-3-haiku-20240307-v1:0","$.modelKwargs.anthropic_version":"bedrock-2023-05-31"},"anthropic.haiku":{"$.model":"anthropic.claude-3-haiku-20240307-v1:0","$.modelKwargs.anthropic_version":"bedrock-2023-05-31"},"anthropic.claude-instant":{"$.model":"anthropic.claude-instant-v1"},"anthropic.claude-instant-v1":{"$.model":"anthropic.claude-instant-v1"},"amazon.nova-premier-v1:0":{"$.model":"arn:aws:bedrock:us-east-1::foundation-model/amazon.nova-premier-v1:0"},"amazon.nova-pro-v1:0":{"$.model":"arn:aws:bedrock:us-east-1::foundation-model/amazon.nova-pro-v1:0"},"amazon.nova-lite-v1:0":{"$.model":"arn:aws:bedrock:us-east-1::foundation-model/amazon.nova-lite-v1:0"},"amazon.nova-micro-v1:0":{"$.model":"arn:aws:bedrock:us-east-1::foundation-model/amazon.nova-micro-v1:0"},"amazon.nova-canvas-v1:0":{"$.model":"amazon.nova-canvas-v1:0"},"amazon.nova-reel-v1:0":{"$.model":"amazon.nova-reel-v1:0"},"amazon.nova-reel-v1:1":{"$.model":"amazon.nova-reel-v1:1"},"amazon.titan-text-premier-v1:0":{"$.model":"amazon.titan-text-premier-v1:0"},"amazon.titan-text-express-v1":{"$.model":"amazon.titan-text-express-v1"},"amazon.titan-text-lite-v1":{"$.model":"amazon.titan-text-lite-v1"},"amazon.titan-embed-text-v1":{"$.model":"amazon.titan-embed-text-v1"},"amazon.titan-embed-text-v2:0":{"$.model":"amazon.titan-embed-text-v2:0"},"amazon.titan-embed-image-v1":{"$.model":"amazon.titan-embed-image-v1"},"amazon.titan-image-generator-v1":{"$.model":"amazon.titan-image-generator-v1"},"amazon.titan-image-generator-v2:0":{"$.model":"amazon.titan-image-generator-v2:0"},"meta.llama3-8b":{"$.model":"meta.llama3-8b-instruct-v1:0"},"meta.llama3-8b-instruct-v1:0":{"$.model":"meta.llama3-8b-instruct-v1:0"},"meta.llama3-70b":{"$.model":"meta.llama3-70b-instruct-v1:0"},"meta.llama3-70b-instruct-v1:0":{"$.model":"meta.llama3-70b-instruct-v1:0"},"ai21.jamba-1-5-large-v1:0":{"$.model":"ai21.jamba-1-5-large-v1:0"},"ai21.jamba-1-5-mini-v1:0":{"$.model":"ai21.jamba-1-5-mini-v1:0"},"ai21.jamba-instruct-v1:0":{"$.model":"ai21.jamba-instruct-v1:0"},"stability.stable-diffusion-xl-v1":{"$.model":"stability.stable-diffusion-xl-v1"},"stability.stable-diffusion-xl-v1:0":{"$.model":"stability.stable-diffusion-xl-v1:0"}};var $R={integrate_model_parameters:(e,t)=>{let n=null;if(t&&t in NR)n=t;else if(t&&t.startsWith("arn:aws:bedrock:")){const e=t.split("/"),r=e[e.length-1];if(r in NR)n=r;else{const e=Object.keys(NR).find(e=>NR[e]["$.model"]===r);e&&(n=e)}}if(n){const t=NR[n];for(const[n,r]of Object.entries(t)){const t=n.replace(/^\$\./,"");jR.set(e,t,r)}}return e}};const LR=(e=[])=>e.map(e=>{if("object"!=typeof e)return null;const{role:t,content:n}=e;return n?["user","human","person"].includes(t)?new Ho({content:n}):["ai","agent","robot"].includes(t)?new Uo({content:n}):["system","core","base"].includes(t)?new Go({content:n}):null:null}).filter(e=>e);function DR(e=[]){const t=[];for(const n of e)if(n.type)t.push(n);else if(n.web_search_20250305)t.push({type:"web_search_20250305",name:n.web_search_20250305.name||"web_search",max_uses:n.web_search_20250305.max_uses||5});else if(n.functionDeclarations)for(const e of n.functionDeclarations)t.push({type:"function",name:e.name,description:e.description,input_schema:e.parameters});else{const e=Object.keys(n);if(e.length>0){const r=e[0],i=n[r];t.push({type:r,...i})}}return t}const UR=e=>{const t=e?.env||process.env;return{AWS_ACCESS_KEY_ID:t.AWS_ACCESS_KEY_ID,AWS_SECRET_ACCESS_KEY:t.AWS_SECRET_ACCESS_KEY,AWS_REGION:t.AWS_REGION}},MR=async({context:e,model:t="meta.llama3-2-11b-instruct-v1:0",system:n="You are a helpful assistant that can understand both text and images.",message:r="",imagePath:i="",prev:s=[]},a=!1,o=!1)=>{const{AWS_ACCESS_KEY_ID:c,AWS_SECRET_ACCESS_KEY:l,AWS_REGION:u}=UR(e),d={region:u,credentials:{accessKeyId:c,secretAccessKey:l}},{integrate_model_parameters:p}=$R,h=p(d,t),m=new ER(h),f=[{role:"system",content:n},...s,{role:"user",content:[{type:"text",text:r},{type:"image_url",image_url:{url:`data:image/jpeg;base64,${U.readFileSync(i).toString("base64")}`}}]}],g=LR(f).filter(Boolean);if(o)return g;return(await m.invoke(g)).content};async function*FR({context:e,model:t="anthropic.claude-3-5-haiku-serverless",system:n="You are a helpful assistant.",max_tokens:r=null,temperature:i=.7,message:s="",prev:a=[],json_mode:o=!1,response_schema:c,region:l="us-east-1",stream:u=!1,tools:d},p=!1,h=!1){const{AWS_ACCESS_KEY_ID:m,AWS_SECRET_ACCESS_KEY:f,AWS_REGION:g}=UR(e),{integrate_model_parameters:y}=$R;if(d?.length){if(d.some(e=>e.type&&!["function"].includes(e.type)&&(e.type.includes("_")||"text_editor_20250429"===e.type||"bash_20250124"===e.type||"web_search_20250305"===e.type))){const e=new gk({region:l||g,credentials:{accessKeyId:m,secretAccessKey:f}}),{integrate_model_parameters:o}=$R,c=o({},t).model||t,u=[];for(const e of a)u.push({role:"assistant"===e.role?"assistant":"user",content:e.content});u.push({role:"user",content:s});const p={anthropic_version:"bedrock-2023-05-31",messages:u,max_tokens:r||4096,temperature:i};n&&(p.system=n);const y=DR(d);if(y.length>0&&(p.tools=y),h)return void(yield{requestBody:p,model:c});try{const t=new YO({modelId:c,body:JSON.stringify(p),contentType:"application/json"}),n=await e.send(t),r=JSON.parse((new TextDecoder).decode(n.body));let i="";const s=[];if(r.content)for(const e of r.content)"text"===e.type?i+=e.text:"tool_use"===e.type&&s.push({type:"function",name:e.name,id:e.id,args:e.input});if(s.length>0){const e={content:i,toolCalls:s,metadata:{finishReason:"TOOL_USE",usage:r.usage||{inputTokens:0,outputTokens:0,totalTokens:0}}};yield e}else yield i;return}catch(e){throw console.error("Native Claude API error:",e),e}}const e=y({region:l||g,credentials:{accessKeyId:m,secretAccessKey:f}},t),o=new RC({...e,temperature:i,maxTokens:r||void 0,streaming:u}),c=function(e=[]){const t=[];for(const n of e)if("function"===n.type)t.push({type:"function",function:{name:n.name,description:n.description,parameters:n.input_schema}});else if(n.type&&"function"!==n.type)t.push({type:n.type,name:n.name||n.type,...n});else if(n.functionDeclarations)for(const e of n.functionDeclarations)t.push({type:"function",function:{name:e.name,description:e.description,parameters:e.parameters}});return t}(d),v=o.bindTools(c),b=[];n&&b.push({role:"system",content:n});for(const e of a)b.push({role:"assistant"===e.role?"assistant":"user",content:e.content});if(b.push({role:"user",content:s}),h)return void(yield{messages:b,tools:c,model:e.model});try{if(u){const e=await v.stream(b);for await(const t of e)yield t;return}const e=await v.invoke(b);if(e.tool_calls&&e.tool_calls.length>0){let t="";if(Array.isArray(e.content))for(const n of e.content)"string"==typeof n?t+=n:"object"==typeof n&&"text"in n&&(t+=n.text);else"string"==typeof e.content&&(t=e.content);const n={content:t,toolCalls:e.tool_calls.map(e=>({type:"function",name:e.name,id:e.id,args:e.args})),metadata:{finishReason:"TOOL_USE",usage:e.usage_metadata||{inputTokens:0,outputTokens:0,totalTokens:0}}};return void(yield n)}return void(p?yield{content:e.content,usage:e.usage_metadata,metadata:e}:yield e.content)}catch(e){throw console.error("ChatBedrockConverse error:",e),e}}const v=t.includes("anthropic")||t.includes("claude"),b=y({},t).model||t,w=b.startsWith("us.")||b.startsWith("arn:aws:bedrock:")||t.includes("sonnet-4")||t.includes("sonnet-3-7")||t.includes("opus-4")||t.includes("deepseek")||t.includes("nova-");if(v&&(o||d?.length||c||w)){const e=y({},t),u=e.model||t;if(w||e.model){const e=new gk({region:l||g,credentials:{accessKeyId:m,secretAccessKey:f}}),t=[];for(const e of a)t.push({role:"assistant"===e.role?"assistant":"user",content:e.content});t.push({role:"user",content:s});const y={anthropic_version:"bedrock-2023-05-31",messages:t,max_tokens:r||4096,temperature:i};if(n&&(y.system=n),d?.length){const e=DR(d);e.length>0&&(y.tools=e)}if(c){const e=c.parameters||c;y.tools=[{name:c.name||"structured_response",description:c.description||"Structured response",input_schema:e}],y.tool_choice={type:"tool",name:c.name||"structured_response"}}else o&&(y.system=(y.system||"")+"\n\nPlease respond with valid JSON format.");if(h)return void(yield{requestBody:y,model:u});try{const t=new YO({modelId:u,body:JSON.stringify(y),contentType:"application/json"}),n=await e.send(t),r=JSON.parse((new TextDecoder).decode(n.body));if(p)return void(yield{content:r,usage:r.usage,metadata:r});if(c&&"tool_use"===r.content?.[0]?.type)yield r.content[0].input;else if(r.content){let e="";const t=[];for(const n of r.content)"text"===n.type?e+=n.text:"tool_use"===n.type&&t.push(n);if(t.length>0){const n={content:e,toolCalls:t.map(e=>({type:e.type,name:e.name,id:e.id,input:e.input})),metadata:{finishReason:r.stop_reason||"STOP",usage:r.usage}};yield n}else if(o&&!c)try{const t=JSON.parse(e);yield t}catch(t){yield e}else yield e}else yield r;return}catch(e){throw e}}}const _=y({region:l||g,credentials:{accessKeyId:m,secretAccessKey:f},httpOptions:{timeout:6e5}},t);let x=new ER({..._,temperature:i,maxTokens:r||void 0,streaming:u});const E=n?[...a,{role:"user",content:`System: ${n}\n\nUser: ${s}`}]:[...a,{role:"user",content:s}],S=LR(E).filter(Boolean);if(h)return void(yield S);if(u){const e=await x.stream(S);for await(const t of e)yield t;return}const k=await x.invoke(S);yield k.content}const zR=async({context:e,model:t="anthropic.claude-instant-v1",system:n="",input:r=""},i=!1,s=!1)=>{try{const{AWS_ACCESS_KEY_ID:n,AWS_SECRET_ACCESS_KEY:i,AWS_REGION:s}=UR(e),a={region:s,credentials:{accessKeyId:n,secretAccessKey:i}},{integrate_model_parameters:o}=$R,c=o(a,t),l=new IR(c);return await l.invoke(`Human: ${r} \nAssistant:`)}catch(e){return console.log("aws llm error",e),!1}},BR=async({context:e,model:t="amazon.titan-embed-text-v1",message:n})=>{const{AWS_ACCESS_KEY_ID:r,AWS_SECRET_ACCESS_KEY:i,AWS_REGION:s}=UR(e),a=new ST({region:s,credentials:{accessKeyId:r,secretAccessKey:i},model:t});return Array.isArray(n)?await a.embedDocuments(n):await a.embedQuery(n)},qR=async({context:e,text:t,output_path:n="./uploads/audios",language:i="en-US",output_format:s="mp3",voice:a="Danielle",engine:o="generative"})=>{try{const{AWS_ACCESS_KEY_ID:l,AWS_SECRET_ACCESS_KEY:u,AWS_REGION:d}=UR(e),p={OutputFormat:s,Text:t,TextType:"text",VoiceId:a,LanguageCode:i,SampleRate:"22050",Engine:o},h=new tP({region:d,credentials:{accessKeyId:l,secretAccessKey:u}}),m=new tR(p),f=await h.send(m);U.existsSync(n)||U.mkdirSync(n,{recursive:!0});const g=`speech_${Date.now()}.${s}`,y=c.join(n,g);return new Promise((e,t)=>{const n=U.createWriteStream(y);f.AudioStream instanceof r?(f.AudioStream.pipe(n),n.on("finish",()=>e(!0)),n.on("error",t)):f.AudioStream instanceof Buffer?U.writeFile(y,f.AudioStream,n=>{n?t(n):e(!0)}):t(new Error("Unsupported AudioStream type"))})}catch(e){return console.log("AWS text to speech error",e),!1}};var WR={generate:FR,generateWithImage:MR,embedding:BR,llm:zR,textToSpeech:qR},HR=Object.freeze({__proto__:null,default:WR,embedding:BR,generate:FR,generateWithImage:MR,llm:zR,textToSpeech:qR});const KR="RFC3986",GR={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},VR=Array.isArray,ZR=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})(),JR=1024;function YR(e,t){if(VR(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const XR=Object.prototype.hasOwnProperty,QR={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},ej=Array.isArray,tj=Array.prototype.push,nj=function(e,t){tj.apply(e,ej(t)?t:[t])},rj=Date.prototype.toISOString,ij={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,r,i)=>{if(0===e.length)return e;let s=e;if("symbol"==typeof e?s=Symbol.prototype.toString.call(e):"string"!=typeof e&&(s=String(e)),"iso-8859-1"===n)return escape(s).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let a="";for(let e=0;e<s.length;e+=JR){const t=s.length>=JR?s.slice(e,e+JR):s,n=[];for(let e=0;e<t.length;++e){let r=t.charCodeAt(e);45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||"RFC1738"===i&&(40===r||41===r)?n[n.length]=t.charAt(e):r<128?n[n.length]=ZR[r]:r<2048?n[n.length]=ZR[192|r>>6]+ZR[128|63&r]:r<55296||r>=57344?n[n.length]=ZR[224|r>>12]+ZR[128|r>>6&63]+ZR[128|63&r]:(e+=1,r=65536+((1023&r)<<10|1023&t.charCodeAt(e)),n[n.length]=ZR[240|r>>18]+ZR[128|r>>12&63]+ZR[128|r>>6&63]+ZR[128|63&r])}a+=n.join("")}return a},encodeValuesOnly:!1,format:KR,formatter:GR[KR],indices:!1,serializeDate:e=>rj.call(e),skipNulls:!1,strictNullHandling:!1};const sj={};function aj(e,t,n,r,i,s,a,o,c,l,u,d,p,h,m,f,g,y){let v=e,b=y,w=0,_=!1;for(;void 0!==(b=b.get(sj))&&!_;){const t=b.get(e);if(w+=1,void 0!==t){if(t===w)throw new RangeError("Cyclic object value");_=!0}void 0===b.get(sj)&&(w=0)}if("function"==typeof l?v=l(t,v):v instanceof Date?v=p?.(v):"comma"===n&&ej(v)&&(v=YR(v,function(e){return e instanceof Date?p?.(e):e})),null===v){if(s)return c&&!f?c(t,ij.encoder,g,"key",h):t;v=""}if(function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||"symbol"==typeof e||"bigint"==typeof e}(v)||function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}(v)){if(c){const e=f?t:c(t,ij.encoder,g,"key",h);return[m?.(e)+"="+m?.(c(v,ij.encoder,g,"value",h))]}return[m?.(t)+"="+m?.(String(v))]}const x=[];if(void 0===v)return x;let E;if("comma"===n&&ej(v))f&&c&&(v=YR(v,c)),E=[{value:v.length>0?v.join(",")||null:void 0}];else if(ej(l))E=l;else{const e=Object.keys(v);E=u?e.sort(u):e}const S=o?String(t).replace(/\./g,"%2E"):String(t),k=r&&ej(v)&&1===v.length?S+"[]":S;if(i&&ej(v)&&0===v.length)return k+"[]";for(let t=0;t<E.length;++t){const b=E[t],_="object"==typeof b&&void 0!==b.value?b.value:v[b];if(a&&null===_)continue;const S=d&&o?b.replace(/\./g,"%2E"):b,A=ej(v)?"function"==typeof n?n(k,S):k:k+(d?"."+S:"["+S+"]");y.set(e,w);const O=new WeakMap;O.set(sj,y),nj(x,aj(_,A,n,r,i,s,a,o,"comma"===n&&f&&ej(v)?null:c,l,u,d,p,h,m,f,g,O))}return x}function oj(e,t={}){let n=e;const r=function(e=ij){if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||ij.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=KR;if(void 0!==e.format){if(!XR.call(GR,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const r=GR[n];let i,s=ij.filter;if(("function"==typeof e.filter||ej(e.filter))&&(s=e.filter),i=e.arrayFormat&&e.arrayFormat in QR?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":ij.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=void 0===e.allowDots?1==!!e.encodeDotInKeys||ij.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:ij.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:ij.allowEmptyArrays,arrayFormat:i,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:ij.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?ij.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:ij.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:ij.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:ij.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:ij.encodeValuesOnly,filter:s,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:ij.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:ij.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:ij.strictNullHandling}}(t);let i,s;"function"==typeof r.filter?(s=r.filter,n=s("",n)):ej(r.filter)&&(s=r.filter,i=s);const a=[];if("object"!=typeof n||null===n)return"";const o=QR[r.arrayFormat],c="comma"===o&&r.commaRoundTrip;i||(i=Object.keys(n)),r.sort&&i.sort(r.sort);const l=new WeakMap;for(let e=0;e<i.length;++e){const t=i[e];r.skipNulls&&null===n[t]||nj(a,aj(n[t],t,o,c,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}const u=a.join(r.delimiter);let d=!0===r.addQueryPrefix?"?":"";return r.charsetSentinel&&("iso-8859-1"===r.charset?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""}const cj="4.104.0";let lj,uj,dj,pj,hj,mj,fj,gj,yj,vj=!1;class bj{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}const wj=()=>{lj||function(e,t={auto:!1}){if(vj)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(lj)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${lj}'\``);vj=t.auto,lj=e.kind,uj=e.fetch,dj=e.FormData,pj=e.File,hj=e.ReadableStream,mj=e.getMultipartRequestOptions,fj=e.getDefaultAgent,gj=e.fileFromPath,yj=e.isFsReadStream}(function({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,r,i,s;try{n=fetch,r=Request,i=Response,s=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:n,Request:r,Response:i,Headers:s,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new bj(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0})};wj();class _j extends Error{}class xj extends _j{constructor(e,t,n,r){super(`${xj.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.request_id=r?.["x-request-id"],this.error=t;const i=t;this.code=i?.code,this.param=i?.param,this.type=i?.type}static makeMessage(e,t,n){const r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new Sj({message:n,cause:EN(t)});const i=t?.error;return 400===e?new Aj(e,i,n,r):401===e?new Oj(e,i,n,r):403===e?new Cj(e,i,n,r):404===e?new Ij(e,i,n,r):409===e?new Tj(e,i,n,r):422===e?new Pj(e,i,n,r):429===e?new Rj(e,i,n,r):e>=500?new jj(e,i,n,r):new xj(e,i,n,r)}}class Ej extends xj{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Sj extends xj{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class kj extends Sj{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Aj extends xj{}class Oj extends xj{}class Cj extends xj{}class Ij extends xj{}class Tj extends xj{}class Pj extends xj{}class Rj extends xj{}class jj extends xj{}class Nj extends _j{constructor(){super("Could not parse response content as the length limit was reached")}}class $j extends _j{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var Lj,Dj=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},Uj=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class Mj{constructor(){Lj.set(this,void 0),this.buffer=new Uint8Array,Dj(this,Lj,null,"f")}decode(e){if(null==e)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?(new TextEncoder).encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const r=[];let i;for(;null!=(i=Fj(this.buffer,Uj(this,Lj,"f")));){if(i.carriage&&null==Uj(this,Lj,"f")){Dj(this,Lj,i.index,"f");continue}if(null!=Uj(this,Lj,"f")&&(i.index!==Uj(this,Lj,"f")+1||i.carriage)){r.push(this.decodeText(this.buffer.slice(0,Uj(this,Lj,"f")-1))),this.buffer=this.buffer.slice(Uj(this,Lj,"f")),Dj(this,Lj,null,"f");continue}const e=null!==Uj(this,Lj,"f")?i.preceding-1:i.preceding,t=this.decodeText(this.buffer.slice(0,e));r.push(t),this.buffer=this.buffer.slice(i.index),Dj(this,Lj,null,"f")}return r}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new _j(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new _j(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new _j("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode("\n"):[]}}function Fj(e,t){for(let n=t??0;n<e.length;n++){if(10===e[n])return{preceding:n,index:n+1,carriage:!1};if(13===e[n])return{preceding:n,index:n+1,carriage:!0}}return null}function zj(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}function Bj(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}Lj=new WeakMap,Mj.NEWLINE_CHARS=new Set(["\n","\r"]),Mj.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class qj{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;return new qj(async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const n of async function*(e,t){if(!e.body)throw t.abort(),new _j("Attempted to iterate over a response with no body");const n=new Wj,r=new Mj,i=Bj(e.body);for await(const e of async function*(e){let t=new Uint8Array;for await(const n of e){if(null==n)continue;const e=n instanceof ArrayBuffer?new Uint8Array(n):"string"==typeof n?(new TextEncoder).encode(n):n;let r,i=new Uint8Array(t.length+e.length);for(i.set(t),i.set(e,t.length),t=i;-1!==(r=zj(t));)yield t.slice(0,r),t=t.slice(r)}t.length>0&&(yield t)}(i))for(const t of r.decode(e)){const e=n.decode(t);e&&(yield e)}for(const e of r.flush()){const t=n.decode(e);t&&(yield t)}}(e,t))if(!r)if(n.data.startsWith("[DONE]"))r=!0;else if(null===n.event||n.event.startsWith("response.")||n.event.startsWith("transcript.")){let t;try{t=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if(t&&t.error)throw new xj(void 0,t.error,void 0,uN(e.headers));yield t}else{let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new xj(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}},t)}static fromReadableStream(e,t){let n=!1;return new qj(async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const t of async function*(){const t=new Mj,n=Bj(e);for await(const e of n)for(const n of t.decode(e))yield n;for(const e of t.flush())yield e}())r||t&&(yield JSON.parse(t));r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}},t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){const r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new qj(()=>r(e),this.controller),new qj(()=>r(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new hj({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:r,done:i}=await t.next();if(i)return e.close();const s=n.encode(JSON.stringify(r)+"\n");e.enqueue(s)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}class Wj{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=function(e,t){const n=e.indexOf(t);if(-1!==n)return[e.substring(0,n),t,e.substring(n+t.length)];return[e,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}const Hj=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,Kj=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&Gj(e),Gj=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function Vj(e,t,n){if(e=await e,Kj(e))return e;if(Hj(e)){const r=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=Gj(r)?[await r.arrayBuffer()]:[r];return new pj(i,t,n)}const r=await async function(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(Gj(e))t.push(await e.arrayBuffer());else{if(!Jj(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){const t=Object.getOwnPropertyNames(e);return`[${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`);for await(const n of e)t.push(n)}return t}(e);if(t||(t=function(e){return Zj(e.name)||Zj(e.filename)||Zj(e.path)?.split(/[\\/]/).pop()}(e)??"unknown_file"),!n?.type){const e=r[0]?.type;"string"==typeof e&&(n={...n,type:e})}return new pj(r,t,n)}const Zj=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,Jj=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],Yj=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],Xj=async e=>{const t=await Qj(e.body);return mj(t,e)},Qj=async e=>{const t=new dj;return await Promise.all(Object.entries(e||{}).map(([e,n])=>eN(t,e,n))),t},eN=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if((e=>Kj(e)||Hj(e)||yj(e))(n)){const r=await Vj(n);e.append(t,r)}else if(Array.isArray(n))await Promise.all(n.map(n=>eN(e,t+"[]",n)));else{if("object"!=typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);await Promise.all(Object.entries(n).map(([n,r])=>eN(e,`${t}[${n}]`,r)))}}};var tN,nN=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},rN=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};async function iN(e){const{response:t}=e;if(e.options.stream)return IN("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):qj.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const n=t.headers.get("content-type"),r=n?.split(";")[0]?.trim();if(r?.includes("application/json")||r?.endsWith("+json")){const e=await t.json();return IN("response",t.status,t.url,t.headers,e),sN(e,t)}const i=await t.text();return IN("response",t.status,t.url,t.headers,i),i}function sN(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}wj();class aN extends Promise{constructor(e,t=iN){super(e=>{e(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new aN(this.responsePromise,async t=>sN(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class oN{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:i}){this.baseURL=e,this.maxRetries=xN("maxRetries",t),this.timeout=xN("timeout",n),this.httpAgent=r,this.fetch=i??uj}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...yN(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${TN()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async n=>{const r=n&&Gj(n?.body)?new DataView(await n.body.arrayBuffer()):n?.body instanceof DataView?n.body:n?.body instanceof ArrayBuffer?new DataView(n.body):n&&ArrayBuffer.isView(n?.body)?new DataView(n.body.buffer):n?.body;return{method:e,path:t,...n,body:r}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder){return(new TextEncoder).encode(e).length.toString()}}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){const n={...e},{method:r,path:i,query:s,headers:a={}}=n,o=ArrayBuffer.isView(n.body)||n.__binaryRequest&&"string"==typeof n.body?n.body:Yj(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,c=this.calculateContentLength(o),l=this.buildURL(i,s);"timeout"in n&&xN("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const u=n.httpAgent??this.httpAgent??fj(l),d=n.timeout+1e3;"number"==typeof u?.options?.timeout&&d>(u.options.timeout??0)&&(u.options.timeout=d),this.idempotencyHeader&&"get"!==r&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);return{req:{method:r,...o&&{body:o},headers:this.buildHeaders({options:n,headers:a,contentLength:c,retryCount:t}),...u&&{agent:u},signal:n.signal??null},url:l,timeout:n.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:r}){const i={};n&&(i["content-length"]=n);const s=this.defaultHeaders(e);return ON(i,s),ON(i,t),Yj(e.body)&&"node"!==lj&&delete i["content-type"],void 0===PN(s,"x-stainless-retry-count")&&void 0===PN(t,"x-stainless-retry-count")&&(i["x-stainless-retry-count"]=String(r)),void 0===PN(s,"x-stainless-timeout")&&void 0===PN(t,"x-stainless-timeout")&&e.timeout&&(i["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(e=>[...e])):{...e}:{}}makeStatusError(e,t,n,r){return xj.generate(e,t,n,r)}request(e,t=null){return new aN(this.makeRequest(e,t))}async makeRequest(e,t){const n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);const{req:i,url:s,timeout:a}=this.buildRequest(n,{retryCount:r-t});if(await this.prepareRequest(i,{url:s,options:n}),IN("request",s,n,i.headers),n.signal?.aborted)throw new Ej;const o=new AbortController,c=await this.fetchWithTimeout(s,i,a,o).catch(EN);if(c instanceof Error){if(n.signal?.aborted)throw new Ej;if(t)return this.retryRequest(n,t);if("AbortError"===c.name)throw new kj;throw new Sj({cause:c})}const l=uN(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){return IN(`response (error; ${`retrying, ${t} attempts remaining`})`,c.status,s,l),this.retryRequest(n,t,l)}const e=await c.text().catch(e=>EN(e).message),r=vN(e),i=r?void 0:e;IN(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,s,l,i);throw this.makeStatusError(c.status,r,i,l)}return{response:c,options:n,controller:o}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new lN(this,n,e)}buildURL(e,t){const n=wN(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return kN(r)||(t={...r,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new _j(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,r){const{signal:i,...s}=t||{};i&&i.addEventListener("abort",()=>r.abort());const a=setTimeout(()=>r.abort(),n),o={signal:r.signal,...s};return o.method&&(o.method=o.method.toUpperCase()),this.fetch.call(void 0,e,o).finally(()=>{clearTimeout(a)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,n){let r;const i=n?.["retry-after-ms"];if(i){const e=parseFloat(i);Number.isNaN(e)||(r=e)}const s=n?.["retry-after"];if(s&&!r){const e=parseFloat(s);r=Number.isNaN(e)?Date.parse(s)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){const n=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,n)}return await _N(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${cj}`}}class cN{constructor(e,t,n,r){tN.set(this,void 0),nN(this,tN,e,"f"),this.options=r,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new _j("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,r]of n)e.url.searchParams.set(t,r);t.query=void 0,t.path=e.url.toString()}return await rN(this,tN,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(tN=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class lN extends aN{constructor(e,t,n){super(t,async t=>new n(e,t.response,await iN(t),t.options))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const uN=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),dN={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},pN=e=>"object"==typeof e&&null!==e&&!kN(e)&&Object.keys(e).every(e=>AN(dN,e)),hN=()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":cj,"X-Stainless-OS":fN(Deno.build.os),"X-Stainless-Arch":mN(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":cj,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":cj,"X-Stainless-OS":fN(process.platform),"X-Stainless-Arch":mN(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":cj,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":cj,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const mN=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",fN=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let gN;const yN=()=>gN??(gN=hN()),vN=e=>{try{return JSON.parse(e)}catch(e){return}},bN=/^[a-z][a-z0-9+.-]*:/i,wN=e=>bN.test(e),_N=e=>new Promise(t=>setTimeout(t,e)),xN=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new _j(`${e} must be an integer`);if(t<0)throw new _j(`${e} must be a positive integer`);return t},EN=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return new Error(JSON.stringify(e))}catch{}return new Error(e)},SN=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function kN(e){if(!e)return!0;for(const t in e)return!1;return!0}function AN(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function ON(e,t){for(const n in t){if(!AN(t,n))continue;const r=n.toLowerCase();if(!r)continue;const i=t[n];null===i?delete e[r]:void 0!==i&&(e[r]=i)}}const CN=new Set(["authorization","api-key"]);function IN(e,...t){if("undefined"!=typeof process&&"true"===process?.env?.DEBUG){const n=t.map(e=>{if(!e)return e;if(e.headers){const t={...e,headers:{...e.headers}};for(const n in e.headers)CN.has(n.toLowerCase())&&(t.headers[n]="REDACTED");return t}let t=null;for(const n in e)CN.has(n.toLowerCase())&&(t??(t={...e}),t[n]="REDACTED");return t??e});console.log(`OpenAI:DEBUG:${e}`,...n)}}const TN=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),PN=(e,t)=>{const n=t.toLowerCase();if((e=>"function"==typeof e?.get)(e)){const r=t[0]?.toUpperCase()+t.substring(1).replace(/([^\w])(\w)/g,(e,t,n)=>t+n.toUpperCase());for(const i of[t,n,t.toUpperCase(),r]){const t=e.get(i);if(t)return t}}for(const[r,i]of Object.entries(e))if(r.toLowerCase()===n)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${t} header, using the first entry.`),i[0]):i};function RN(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}class jN extends cN{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class NN extends cN{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class $N{constructor(e){this._client=e}}let LN=class extends $N{list(e,t={},n){return pN(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,MN,{query:t,...n})}},DN=class extends $N{constructor(){super(...arguments),this.messages=new LN(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return pN(e)?this.list({},e):this._client.getAPIList("/chat/completions",UN,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}};class UN extends NN{}class MN extends NN{}DN.ChatCompletionsPage=UN,DN.Messages=LN;let FN=class extends $N{constructor(){super(...arguments),this.completions=new DN(this._client)}};FN.Completions=DN,FN.ChatCompletionsPage=UN;class zN extends $N{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}}class BN extends $N{create(e,t){return this._client.post("/audio/transcriptions",Xj({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class qN extends $N{create(e,t){return this._client.post("/audio/translations",Xj({body:e,...t,__metadata:{model:e.model}}))}}class WN extends $N{constructor(){super(...arguments),this.transcriptions=new BN(this._client),this.translations=new qN(this._client),this.speech=new zN(this._client)}}WN.Transcriptions=BN,WN.Translations=qN,WN.Speech=zN;class HN extends $N{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return pN(e)?this.list({},e):this._client.getAPIList("/batches",KN,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class KN extends NN{}HN.BatchesPage=KN;var GN,VN,ZN,JN,YN,XN,QN,e$,t$,n$,r$,i$,s$,a$=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},o$=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class c${constructor(){GN.add(this),this.controller=new AbortController,VN.set(this,void 0),ZN.set(this,()=>{}),JN.set(this,()=>{}),YN.set(this,void 0),XN.set(this,()=>{}),QN.set(this,()=>{}),e$.set(this,{}),t$.set(this,!1),n$.set(this,!1),r$.set(this,!1),i$.set(this,!1),a$(this,VN,new Promise((e,t)=>{a$(this,ZN,e,"f"),a$(this,JN,t,"f")}),"f"),a$(this,YN,new Promise((e,t)=>{a$(this,XN,e,"f"),a$(this,QN,t,"f")}),"f"),o$(this,VN,"f").catch(()=>{}),o$(this,YN,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},o$(this,GN,"m",s$).bind(this))},0)}_connected(){this.ended||(o$(this,ZN,"f").call(this),this._emit("connect"))}get ended(){return o$(this,t$,"f")}get errored(){return o$(this,n$,"f")}get aborted(){return o$(this,r$,"f")}abort(){this.controller.abort()}on(e,t){return(o$(this,e$,"f")[e]||(o$(this,e$,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=o$(this,e$,"f")[e];if(!n)return this;const r=n.findIndex(e=>e.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(o$(this,e$,"f")[e]||(o$(this,e$,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{a$(this,i$,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)})}async done(){a$(this,i$,!0,"f"),await o$(this,YN,"f")}_emit(e,...t){if(o$(this,t$,"f"))return;"end"===e&&(a$(this,t$,!0,"f"),o$(this,XN,"f").call(this));const n=o$(this,e$,"f")[e];if(n&&(o$(this,e$,"f")[e]=n.filter(e=>!e.once),n.forEach(({listener:e})=>e(...t))),"abort"===e){const e=t[0];return o$(this,i$,"f")||n?.length||Promise.reject(e),o$(this,JN,"f").call(this,e),o$(this,QN,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];o$(this,i$,"f")||n?.length||Promise.reject(e),o$(this,JN,"f").call(this,e),o$(this,QN,"f").call(this,e),this._emit("end")}}_emitFinal(){}}VN=new WeakMap,ZN=new WeakMap,JN=new WeakMap,YN=new WeakMap,XN=new WeakMap,QN=new WeakMap,e$=new WeakMap,t$=new WeakMap,n$=new WeakMap,r$=new WeakMap,i$=new WeakMap,GN=new WeakSet,s$=function(e){if(a$(this,n$,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new Ej),e instanceof Ej)return a$(this,r$,!0,"f"),this._emit("abort",e);if(e instanceof _j)return this._emit("error",e);if(e instanceof Error){const t=new _j(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new _j(String(e)))};var l$,u$,d$,p$,h$,m$,f$,g$,y$,v$,b$,w$,_$,x$,E$,S$,k$,A$,O$,C$,I$,T$,P$=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},R$=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};class j$ extends c${constructor(){super(...arguments),l$.add(this),u$.set(this,[]),d$.set(this,{}),p$.set(this,{}),h$.set(this,void 0),m$.set(this,void 0),f$.set(this,void 0),g$.set(this,void 0),y$.set(this,void 0),v$.set(this,void 0),b$.set(this,void 0),w$.set(this,void 0),_$.set(this,void 0)}[(u$=new WeakMap,d$=new WeakMap,p$=new WeakMap,h$=new WeakMap,m$=new WeakMap,f$=new WeakMap,g$=new WeakMap,y$=new WeakMap,v$=new WeakMap,b$=new WeakMap,w$=new WeakMap,_$=new WeakMap,l$=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",n=>{const r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new j$;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=qj.fromReadableStream(e,this.controller);for await(const e of r)P$(this,l$,"m",x$).call(this,e);if(r.controller.signal?.aborted)throw new Ej;return this._addRun(P$(this,l$,"m",E$).call(this))}toReadableStream(){return new qj(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r,i){const s=new j$;return s._run(()=>s._runToolAssistantStream(e,t,n,r,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createToolAssistantStream(e,t,n,r,i){const s=i?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.submitToolOutputs(t,n,a,{...i,signal:this.controller.signal});this._connected();for await(const e of o)P$(this,l$,"m",x$).call(this,e);if(o.controller.signal?.aborted)throw new Ej;return this._addRun(P$(this,l$,"m",E$).call(this))}static createThreadAssistantStream(e,t,n){const r=new j$;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,n,r){const i=new j$;return i._run(()=>i._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return P$(this,b$,"f")}currentRun(){return P$(this,w$,"f")}currentMessageSnapshot(){return P$(this,h$,"f")}currentRunStepSnapshot(){return P$(this,_$,"f")}async finalRunSteps(){return await this.done(),Object.values(P$(this,d$,"f"))}async finalMessages(){return await this.done(),Object.values(P$(this,p$,"f"))}async finalRun(){if(await this.done(),!P$(this,m$,"f"))throw Error("Final run was not received.");return P$(this,m$,"f")}async _createThreadAssistantStream(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},s=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(const e of s)P$(this,l$,"m",x$).call(this,e);if(s.controller.signal?.aborted)throw new Ej;return this._addRun(P$(this,l$,"m",E$).call(this))}async _createAssistantStream(e,t,n,r){const i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const s={...n,stream:!0},a=await e.create(t,s,{...r,signal:this.controller.signal});this._connected();for await(const e of a)P$(this,l$,"m",x$).call(this,e);if(a.controller.signal?.aborted)throw new Ej;return this._addRun(P$(this,l$,"m",E$).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(null!=t)if("index"!==n&&"type"!==n){if("string"==typeof t&&"string"==typeof r)t+=r;else if("number"==typeof t&&"number"==typeof r)t+=r;else{if(!RN(t)||!RN(r)){if(Array.isArray(t)&&Array.isArray(r)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...r);continue}for(const e of r){if(!RN(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const n=e.index;if(null==n)throw console.error(e),new Error("Expected array delta entry to have an `index` property");if("number"!=typeof n)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);const r=t[n];null==r?t.push(e):t[n]=this.accumulateDelta(r,e)}continue}throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${t}`)}t=this.accumulateDelta(t,r)}e[n]=t}else e[n]=r;else e[n]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r,i){return await this._createToolAssistantStream(n,e,t,r,i)}}x$=function(e){if(!this.ended)switch(R$(this,b$,e,"f"),P$(this,l$,"m",A$).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":P$(this,l$,"m",T$).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":P$(this,l$,"m",k$).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":P$(this,l$,"m",S$).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},E$=function(){if(this.ended)throw new _j("stream has ended, this shouldn't happen");if(!P$(this,m$,"f"))throw Error("Final run has not been received");return P$(this,m$,"f")},S$=function(e){const[t,n]=P$(this,l$,"m",C$).call(this,e,P$(this,h$,"f"));R$(this,h$,t,"f"),P$(this,p$,"f")[t.id]=t;for(const e of n){const n=t.content[e.index];"text"==n?.type&&this._emit("textCreated",n.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const n of e.data.delta.content){if("text"==n.type&&n.text){let e=n.text,r=t.content[n.index];if(!r||"text"!=r.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,r.text)}if(n.index!=P$(this,f$,"f")){if(P$(this,g$,"f"))switch(P$(this,g$,"f").type){case"text":this._emit("textDone",P$(this,g$,"f").text,P$(this,h$,"f"));break;case"image_file":this._emit("imageFileDone",P$(this,g$,"f").image_file,P$(this,h$,"f"))}R$(this,f$,n.index,"f")}R$(this,g$,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==P$(this,f$,"f")){const t=e.data.content[P$(this,f$,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,P$(this,h$,"f"));break;case"text":this._emit("textDone",t.text,P$(this,h$,"f"))}}P$(this,h$,"f")&&this._emit("messageDone",e.data),R$(this,h$,void 0,"f")}},k$=function(e){const t=P$(this,l$,"m",O$).call(this,e);switch(R$(this,_$,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of n.step_details.tool_calls)e.index==P$(this,y$,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(P$(this,v$,"f")&&this._emit("toolCallDone",P$(this,v$,"f")),R$(this,y$,e.index,"f"),R$(this,v$,t.step_details.tool_calls[e.index],"f"),P$(this,v$,"f")&&this._emit("toolCallCreated",P$(this,v$,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":R$(this,_$,void 0,"f");"tool_calls"==e.data.step_details.type&&P$(this,v$,"f")&&(this._emit("toolCallDone",P$(this,v$,"f")),R$(this,v$,void 0,"f")),this._emit("runStepDone",e.data,t)}},A$=function(e){P$(this,u$,"f").push(e),this._emit("event",e)},O$=function(e){switch(e.event){case"thread.run.step.created":return P$(this,d$,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=P$(this,d$,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=j$.accumulateDelta(t,n.delta);P$(this,d$,"f")[e.data.id]=r}return P$(this,d$,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":P$(this,d$,"f")[e.data.id]=e.data}if(P$(this,d$,"f")[e.data.id])return P$(this,d$,"f")[e.data.id];throw new Error("No snapshot available")},C$=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const e of r.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=P$(this,l$,"m",I$).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},I$=function(e,t){return j$.accumulateDelta(t,e)},T$=function(e){switch(R$(this,w$,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":R$(this,m$,e.data,"f"),P$(this,v$,"f")&&(this._emit("toolCallDone",P$(this,v$,"f")),R$(this,v$,void 0,"f"))}};class N$ extends $N{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return pN(e)?this.list({},e):this._client.getAPIList("/assistants",$$,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class $$ extends NN{}function L$(e){return"function"==typeof e.parse}N$.AssistantsPage=$$;const D$=e=>"assistant"===e?.role,U$=e=>"function"===e?.role,M$=e=>"tool"===e?.role;function F$(e){return"auto-parseable-response-format"===e?.$brand}function z$(e){return"auto-parseable-tool"===e?.$brand}function B$(e,t){const n=e.choices.map(e=>{if("length"===e.finish_reason)throw new Nj;if("content_filter"===e.finish_reason)throw new $j;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>function(e,t){const n=e.tools?.find(e=>e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:z$(n)?n.$parseRaw(t.function.arguments):n?.function.strict?JSON.parse(t.function.arguments):null}}}(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?q$(t,e.message.content):null}}});return{...e,choices:n}}function q$(e,t){if("json_schema"!==e.response_format?.type)return null;if("json_schema"===e.response_format?.type){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(t)}return JSON.parse(t)}return null}function W$(e,t){if(!e)return!1;const n=e.tools?.find(e=>e.function?.name===t.function.name);return z$(n)||n?.function.strict||!1}function H$(e){return!!F$(e.response_format)||(e.tools?.some(e=>z$(e)||"function"===e.type&&!0===e.function.strict)??!1)}var K$,G$,V$,Z$,J$,Y$,X$,Q$,eL=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const tL=10;class nL extends c${constructor(){super(...arguments),K$.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(U$(e)||M$(e))&&e.content)this._emit("functionCallResult",e.content);else if(D$(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(D$(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new _j("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),eL(this,K$,"m",G$).call(this)}async finalMessage(){return await this.done(),eL(this,K$,"m",V$).call(this)}async finalFunctionCall(){return await this.done(),eL(this,K$,"m",Z$).call(this)}async finalFunctionCallResult(){return await this.done(),eL(this,K$,"m",J$).call(this)}async totalUsage(){return await this.done(),eL(this,K$,"m",Y$).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=eL(this,K$,"m",V$).call(this);t&&this._emit("finalMessage",t);const n=eL(this,K$,"m",G$).call(this);n&&this._emit("finalContent",n);const r=eL(this,K$,"m",Z$).call(this);r&&this._emit("finalFunctionCall",r);const i=eL(this,K$,"m",J$).call(this);null!=i&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",eL(this,K$,"m",Y$).call(this))}async _createChatCompletion(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),eL(this,K$,"m",X$).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(B$(i,t))}async _runChatCompletion(e,t,n){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){const r="function",{function_call:i="auto",stream:s,...a}=t,o="string"!=typeof i&&i?.name,{maxChatCompletions:c=tL}=n||{},l={};for(const e of t.functions)l[e.name||e.function.name]=e;const u=t.functions.map(e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description}));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){const t=await this._createChatCompletion(e,{...a,function_call:i,functions:u,messages:[...this.messages]},n),s=t.choices[0]?.message;if(!s)throw new _j("missing message in ChatCompletion response");if(!s.function_call)return;const{name:c,arguments:d}=s.function_call,p=l[c];if(!p){const e=`Invalid function_call: ${JSON.stringify(c)}. Available options are: ${u.map(e=>JSON.stringify(e.name)).join(", ")}. Please try again`;this._addMessage({role:r,name:c,content:e});continue}if(o&&o!==c){const e=`Invalid function_call: ${JSON.stringify(c)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,name:c,content:e});continue}let h;try{h=L$(p)?await p.parse(d):d}catch(e){this._addMessage({role:r,name:c,content:e instanceof Error?e.message:String(e)});continue}const m=await p.function(h,this),f=eL(this,K$,"m",Q$).call(this,m);if(this._addMessage({role:r,name:c,content:f}),o)return}}async _runTools(e,t,n){const r="tool",{tool_choice:i="auto",stream:s,...a}=t,o="string"!=typeof i&&i?.function?.name,{maxChatCompletions:c=tL}=n||{},l=t.tools.map(e=>{if(z$(e)){if(!e.$callback)throw new _j("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),u={};for(const e of l)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);const d="tools"in t?l.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){const t=await this._createChatCompletion(e,{...a,tool_choice:i,tools:d,messages:[...this.messages]},n),s=t.choices[0]?.message;if(!s)throw new _j("missing message in ChatCompletion response");if(!s.tool_calls?.length)return;for(const e of s.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:i}=e.function,s=u[n];if(!s){const e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(u).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}if(o&&o!==n){const e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}let a;try{a=L$(s)?await s.parse(i):i}catch(e){const n=e instanceof Error?e.message:String(e);this._addMessage({role:r,tool_call_id:t,content:n});continue}const c=await s.function(a,this),l=eL(this,K$,"m",Q$).call(this,c);if(this._addMessage({role:r,tool_call_id:t,content:l}),o)return}}}}K$=new WeakSet,G$=function(){return eL(this,K$,"m",V$).call(this).content??null},V$=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(D$(t)){const{function_call:e,...n}=t,r={...n,content:t.content??null,refusal:t.refusal??null};return e&&(r.function_call=e),r}}throw new _j("stream ended without producing a ChatCompletionMessage with role=assistant")},Z$=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(D$(t)&&t?.function_call)return t.function_call;if(D$(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},J$=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(U$(t)&&null!=t.content)return t.content;if(M$(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},Y$=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},X$=function(e){if(null!=e.n&&e.n>1)throw new _j("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Q$=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class rL extends nL{static runFunctions(e,t,n){const r=new rL,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,i)),r}static runTools(e,t,n){const r=new rL,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,i)),r}_addMessage(e,t=!0){super._addMessage(e,t),D$(e)&&e.content&&this._emit("content",e.content)}}const iL=1,sL=2,aL=4,oL=8,cL=16,lL=32,uL=64,dL=128,pL=256,hL=511;class mL extends Error{}class fL extends Error{}const gL=(e,t)=>{const n=e.length;let r=0;const i=e=>{throw new mL(`${e} at position ${r}`)},s=e=>{throw new fL(`${e} at position ${r}`)},a=()=>(d(),r>=n&&i("Unexpected end of input"),'"'===e[r]?o():"{"===e[r]?c():"["===e[r]?l():"null"===e.substring(r,r+4)||cL&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):"true"===e.substring(r,r+4)||lL&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):"false"===e.substring(r,r+5)||lL&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):"Infinity"===e.substring(r,r+8)||dL&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):"-Infinity"===e.substring(r,r+9)||pL&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):"NaN"===e.substring(r,r+3)||uL&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):u()),o=()=>{const a=r;let o=!1;for(r++;r<n&&('"'!==e[r]||o&&"\\"===e[r-1]);)o="\\"===e[r]&&!o,r++;if('"'==e.charAt(r))try{return JSON.parse(e.substring(a,++r-Number(o)))}catch(e){s(String(e))}else if(iL&t)try{return JSON.parse(e.substring(a,r-Number(o))+'"')}catch(t){return JSON.parse(e.substring(a,e.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},c=()=>{r++,d();const s={};try{for(;"}"!==e[r];){if(d(),r>=n&&oL&t)return s;const i=o();d(),r++;try{const e=a();Object.defineProperty(s,i,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(oL&t)return s;throw e}d(),","===e[r]&&r++}}catch(e){if(oL&t)return s;i("Expected '}' at end of object")}return r++,s},l=()=>{r++;const n=[];try{for(;"]"!==e[r];)n.push(a()),d(),","===e[r]&&r++}catch(e){if(aL&t)return n;i("Expected ']' at end of array")}return r++,n},u=()=>{if(0===r){"-"===e&&sL&t&&i("Not sure what '-' is");try{return JSON.parse(e)}catch(n){if(sL&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}s(String(n))}}const a=r;for("-"===e[r]&&r++;e[r]&&!",]}".includes(e[r]);)r++;r!=n||sL&t||i("Unterminated number literal");try{return JSON.parse(e.substring(a,r))}catch(n){"-"===e.substring(a,r)&&sL&t&&i("Not sure what '-' is");try{return JSON.parse(e.substring(a,e.lastIndexOf("e")))}catch(e){s(String(e))}}},d=()=>{for(;r<n&&" \n\r\t".includes(e[r]);)r++};return a()},yL=e=>function(e,t=hL){if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return gL(e.trim(),t)}(e,hL^sL);var vL,bL,wL,_L,xL,EL,SL,kL,AL,OL,CL,IL,TL=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},PL=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class RL extends nL{constructor(e){super(),vL.add(this),bL.set(this,void 0),wL.set(this,void 0),_L.set(this,void 0),TL(this,bL,e,"f"),TL(this,wL,[],"f")}get currentChatCompletionSnapshot(){return PL(this,_L,"f")}static fromReadableStream(e){const t=new RL(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const r=new RL(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,n){super._createChatCompletion;const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),PL(this,vL,"m",xL).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const e of i)PL(this,vL,"m",SL).call(this,e);if(i.controller.signal?.aborted)throw new Ej;return this._addChatCompletion(PL(this,vL,"m",OL).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),PL(this,vL,"m",xL).call(this),this._connected();const r=qj.fromReadableStream(e,this.controller);let i;for await(const e of r)i&&i!==e.id&&this._addChatCompletion(PL(this,vL,"m",OL).call(this)),PL(this,vL,"m",SL).call(this,e),i=e.id;if(r.controller.signal?.aborted)throw new Ej;return this._addChatCompletion(PL(this,vL,"m",OL).call(this))}[(bL=new WeakMap,wL=new WeakMap,_L=new WeakMap,vL=new WeakSet,xL=function(){this.ended||TL(this,_L,void 0,"f")},EL=function(e){let t=PL(this,wL,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},PL(this,wL,"f")[e.index]=t,t)},SL=function(e){if(this.ended)return;const t=PL(this,vL,"m",IL).call(this,e);this._emit("chunk",e,t);for(const n of e.choices){const e=t.choices[n.index];null!=n.delta.content&&"assistant"===e.message?.role&&e.message?.content&&(this._emit("content",n.delta.content,e.message.content),this._emit("content.delta",{delta:n.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=n.delta.refusal&&"assistant"===e.message?.role&&e.message?.refusal&&this._emit("refusal.delta",{delta:n.delta.refusal,snapshot:e.message.refusal}),null!=n.logprobs?.content&&"assistant"===e.message?.role&&this._emit("logprobs.content.delta",{content:n.logprobs?.content,snapshot:e.logprobs?.content??[]}),null!=n.logprobs?.refusal&&"assistant"===e.message?.role&&this._emit("logprobs.refusal.delta",{refusal:n.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});const r=PL(this,vL,"m",EL).call(this,e);e.finish_reason&&(PL(this,vL,"m",AL).call(this,e),null!=r.current_tool_call_index&&PL(this,vL,"m",kL).call(this,e,r.current_tool_call_index));for(const t of n.delta.tool_calls??[])r.current_tool_call_index!==t.index&&(PL(this,vL,"m",AL).call(this,e),null!=r.current_tool_call_index&&PL(this,vL,"m",kL).call(this,e,r.current_tool_call_index)),r.current_tool_call_index=t.index;for(const t of n.delta.tool_calls??[]){const n=e.message.tool_calls?.[t.index];n?.type&&("function"===n?.type?this._emit("tool_calls.function.arguments.delta",{name:n.function?.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):NL(n?.type))}}},kL=function(e,t){if(PL(this,vL,"m",EL).call(this,e).done_tool_calls.has(t))return;const n=e.message.tool_calls?.[t];if(!n)throw new Error("no tool call snapshot");if(!n.type)throw new Error("tool call snapshot missing `type`");if("function"===n.type){const e=PL(this,bL,"f")?.tools?.find(e=>"function"===e.type&&e.function.name===n.function.name);this._emit("tool_calls.function.arguments.done",{name:n.function.name,index:t,arguments:n.function.arguments,parsed_arguments:z$(e)?e.$parseRaw(n.function.arguments):e?.function.strict?JSON.parse(n.function.arguments):null})}else n.type},AL=function(e){const t=PL(this,vL,"m",EL).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;const n=PL(this,vL,"m",CL).call(this);this._emit("content.done",{content:e.message.content,parsed:n?n.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},OL=function(){if(this.ended)throw new _j("stream has ended, this shouldn't happen");const e=PL(this,_L,"f");if(!e)throw new _j("request ended without sending any chunks");return TL(this,_L,void 0,"f"),TL(this,wL,[],"f"),function(e,t){const{id:n,choices:r,created:i,model:s,system_fingerprint:a,...o}=e,c={...o,id:n,choices:r.map(({message:t,finish_reason:n,index:r,logprobs:i,...s})=>{if(!n)throw new _j(`missing finish_reason for choice ${r}`);const{content:a=null,function_call:o,tool_calls:c,...l}=t,u=t.role;if(!u)throw new _j(`missing role for choice ${r}`);if(o){const{arguments:e,name:c}=o;if(null==e)throw new _j(`missing function_call.arguments for choice ${r}`);if(!c)throw new _j(`missing function_call.name for choice ${r}`);return{...s,message:{content:a,function_call:{arguments:e,name:c},role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:i}}return c?{...s,index:r,finish_reason:n,logprobs:i,message:{...l,role:u,content:a,refusal:t.refusal??null,tool_calls:c.map((t,n)=>{const{function:i,type:s,id:a,...o}=t,{arguments:c,name:l,...u}=i||{};if(null==a)throw new _j(`missing choices[${r}].tool_calls[${n}].id\n${jL(e)}`);if(null==s)throw new _j(`missing choices[${r}].tool_calls[${n}].type\n${jL(e)}`);if(null==l)throw new _j(`missing choices[${r}].tool_calls[${n}].function.name\n${jL(e)}`);if(null==c)throw new _j(`missing choices[${r}].tool_calls[${n}].function.arguments\n${jL(e)}`);return{...o,id:a,type:s,function:{...u,name:l,arguments:c}}})}}:{...s,message:{...l,content:a,role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:i}}),created:i,model:s,object:"chat.completion",...a?{system_fingerprint:a}:{}};return function(e,t){return t&&H$(t)?B$(e,t):{...e,choices:e.choices.map(e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(c,t)}(e,PL(this,bL,"f"))},CL=function(){const e=PL(this,bL,"f")?.response_format;return F$(e)?e:null},IL=function(e){var t,n,r,i;let s=PL(this,_L,"f");const{choices:a,...o}=e;s?Object.assign(s,o):s=TL(this,_L,{...o,choices:[]},"f");for(const{delta:a,finish_reason:o,index:c,logprobs:l=null,...u}of e.choices){let e=s.choices[c];if(e||(e=s.choices[c]={finish_reason:o,index:c,message:{},logprobs:l,...u}),l)if(e.logprobs){const{content:r,refusal:i,...s}=l;Object.assign(e.logprobs,s),r&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...r)),i&&((n=e.logprobs).refusal??(n.refusal=[]),e.logprobs.refusal.push(...i))}else e.logprobs=Object.assign({},l);if(o&&(e.finish_reason=o,PL(this,bL,"f")&&H$(PL(this,bL,"f")))){if("length"===o)throw new Nj;if("content_filter"===o)throw new $j}if(Object.assign(e,u),!a)continue;const{content:d,refusal:p,function_call:h,role:m,tool_calls:f,...g}=a;if(Object.assign(e.message,g),p&&(e.message.refusal=(e.message.refusal||"")+p),m&&(e.message.role=m),h&&(e.message.function_call?(h.name&&(e.message.function_call.name=h.name),h.arguments&&((r=e.message.function_call).arguments??(r.arguments=""),e.message.function_call.arguments+=h.arguments)):e.message.function_call=h),d&&(e.message.content=(e.message.content||"")+d,!e.message.refusal&&PL(this,vL,"m",CL).call(this)&&(e.message.parsed=yL(e.message.content))),f){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:n,type:r,function:s,...a}of f){const o=(i=e.message.tool_calls)[t]??(i[t]={});Object.assign(o,a),n&&(o.id=n),r&&(o.type=r),s&&(o.function??(o.function={name:s.name??"",arguments:""})),s?.name&&(o.function.name=s.name),s?.arguments&&(o.function.arguments+=s.arguments,W$(PL(this,bL,"f"),o)&&(o.function.parsed_arguments=yL(o.function.arguments)))}}}return s},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",n=>{const r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new qj(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function jL(e){return JSON.stringify(e)}function NL(e){}class $L extends RL{static fromReadableStream(e){const t=new $L(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const r=new $L(null),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,i)),r}static runTools(e,t,n){const r=new $L(t),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,i)),r}}let LL=class extends $N{parse(e,t){return function(e){for(const t of e??[]){if("function"!==t.type)throw new _j(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new _j(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(t=>B$(t,e))}runFunctions(e,t){return e.stream?$L.runFunctions(this._client,e,t):rL.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?$L.runTools(this._client,e,t):rL.runTools(this._client,e,t)}stream(e,t){return RL.createChatCompletion(this._client,e,t)}};class DL extends $N{constructor(){super(...arguments),this.completions=new LL(this._client)}}!function(e){e.Completions=LL}(DL||(DL={}));class UL extends $N{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class ML extends $N{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class FL extends $N{constructor(){super(...arguments),this.sessions=new UL(this._client),this.transcriptionSessions=new ML(this._client)}}FL.Sessions=UL,FL.TranscriptionSessions=ML;class zL extends $N{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return pN(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,BL,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class BL extends NN{}zL.MessagesPage=BL;class qL extends $N{retrieve(e,t,n,r={},i){return pN(r)?this.retrieve(e,t,n,{},r):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}list(e,t,n={},r){return pN(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,WL,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class WL extends NN{}qL.RunStepsPage=WL;let HL=class extends $N{constructor(){super(...arguments),this.steps=new qL(this._client)}create(e,t,n){const{include:r,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:r},body:i,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return pN(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,KL,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}createAndStream(e,t,n){return j$.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:i,response:s}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await _N(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,n){return j$.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,r){const i=await this.submitToolOutputs(e,t,n,r);return await this.poll(e,i.id,r)}submitToolOutputsStream(e,t,n,r){return j$.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,r)}};class KL extends NN{}HL.RunsPage=KL,HL.Steps=qL,HL.RunStepsPage=WL;class GL extends $N{constructor(){super(...arguments),this.runs=new HL(this._client),this.messages=new zL(this._client)}create(e={},t){return pN(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return j$.createThreadAssistantStream(e,this._client.beta.threads,t)}}GL.Runs=HL,GL.RunsPage=KL,GL.Messages=zL,GL.MessagesPage=BL;class VL extends $N{constructor(){super(...arguments),this.realtime=new FL(this._client),this.chat=new DL(this._client),this.assistants=new N$(this._client),this.threads=new GL(this._client)}}VL.Realtime=FL,VL.Assistants=N$,VL.AssistantsPage=$$,VL.Threads=GL;class ZL extends $N{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class JL extends $N{retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}/content`,{...n,headers:{Accept:"application/binary",...n?.headers},__binaryResponse:!0})}}let YL=class extends $N{constructor(){super(...arguments),this.content=new JL(this._client)}create(e,t,n){return this._client.post(`/containers/${e}/files`,Xj({body:t,...n}))}retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}`,n)}list(e,t={},n){return pN(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,XL,{query:t,...n})}del(e,t,n){return this._client.delete(`/containers/${e}/files/${t}`,{...n,headers:{Accept:"*/*",...n?.headers}})}};class XL extends NN{}YL.FileListResponsesPage=XL,YL.Content=JL;class QL extends $N{constructor(){super(...arguments),this.files=new YL(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return pN(e)?this.list({},e):this._client.getAPIList("/containers",eD,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}}class eD extends NN{}QL.ContainerListResponsesPage=eD,QL.Files=YL,QL.FileListResponsesPage=XL;class tD extends $N{create(e,t){const n=!!e.encoding_format;let r=n?e.encoding_format:"base64";n&&IN("Request","User defined encoding_format:",e.encoding_format);const i=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?i:(IN("response","Decoding base64 embeddings to float32 array"),i._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{const t=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{const t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return Array.from(new Float32Array(r.buffer))}})(t)}),e)))}}class nD extends $N{retrieve(e,t,n,r){return this._client.get(`/evals/${e}/runs/${t}/output_items/${n}`,r)}list(e,t,n={},r){return pN(n)?this.list(e,t,{},n):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,rD,{query:n,...r})}}class rD extends NN{}nD.OutputItemListResponsesPage=rD;class iD extends $N{constructor(){super(...arguments),this.outputItems=new nD(this._client)}create(e,t,n){return this._client.post(`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){return this._client.get(`/evals/${e}/runs/${t}`,n)}list(e,t={},n){return pN(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,sD,{query:t,...n})}del(e,t,n){return this._client.delete(`/evals/${e}/runs/${t}`,n)}cancel(e,t,n){return this._client.post(`/evals/${e}/runs/${t}`,n)}}class sD extends NN{}iD.RunListResponsesPage=sD,iD.OutputItems=nD,iD.OutputItemListResponsesPage=rD;class aD extends $N{constructor(){super(...arguments),this.runs=new iD(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,n){return this._client.post(`/evals/${e}`,{body:t,...n})}list(e={},t){return pN(e)?this.list({},e):this._client.getAPIList("/evals",oD,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}class oD extends NN{}aD.EvalListResponsesPage=oD,aD.Runs=iD,aD.RunListResponsesPage=sD;let cD=class extends $N{create(e,t){return this._client.post("/files",Xj({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return pN(e)?this.list({},e):this._client.getAPIList("/files",lD,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){const r=new Set(["processed","error","deleted"]),i=Date.now();let s=await this.retrieve(e);for(;!s.status||!r.has(s.status);)if(await _N(t),s=await this.retrieve(e),Date.now()-i>n)throw new kj({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return s}};class lD extends NN{}cD.FileObjectsPage=lD;class uD extends $N{}let dD=class extends $N{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class pD extends $N{constructor(){super(...arguments),this.graders=new dD(this._client)}}pD.Graders=dD;class hD extends $N{create(e,t,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,mD,{body:t,method:"post",...n})}retrieve(e,t={},n){return pN(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}del(e,t,n){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,n)}}class mD extends jN{}hD.PermissionCreateResponsesPage=mD;let fD=class extends $N{constructor(){super(...arguments),this.permissions=new hD(this._client)}};fD.Permissions=hD,fD.PermissionCreateResponsesPage=mD;class gD extends $N{list(e,t={},n){return pN(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,yD,{query:t,...n})}}class yD extends NN{}gD.FineTuningJobCheckpointsPage=yD;class vD extends $N{constructor(){super(...arguments),this.checkpoints=new gD(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return pN(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",bD,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return pN(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,wD,{query:t,...n})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}}class bD extends NN{}class wD extends NN{}vD.FineTuningJobsPage=bD,vD.FineTuningJobEventsPage=wD,vD.Checkpoints=gD,vD.FineTuningJobCheckpointsPage=yD;class _D extends $N{constructor(){super(...arguments),this.methods=new uD(this._client),this.jobs=new vD(this._client),this.checkpoints=new fD(this._client),this.alpha=new pD(this._client)}}_D.Methods=uD,_D.Jobs=vD,_D.FineTuningJobsPage=bD,_D.FineTuningJobEventsPage=wD,_D.Checkpoints=fD,_D.Alpha=pD;class xD extends $N{}class ED extends $N{constructor(){super(...arguments),this.graderModels=new xD(this._client)}}ED.GraderModels=xD;class SD extends $N{createVariation(e,t){return this._client.post("/images/variations",Xj({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Xj({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class kD extends $N{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",AD,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class AD extends jN{}kD.ModelsPage=AD;class OD extends $N{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function CD(e,t){return t&&function(e){if(F$(e.text?.format))return!0;return!1}(t)?ID(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}function ID(e,t){const n=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:PD(t,e)};if("message"===e.type){const n=e.content.map(e=>"output_text"===e.type?{...e,parsed:TD(t,e.text)}:e);return{...e,content:n}}return e}),r=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,"output_text")||RD(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const e of r.output)if("message"===e.type)for(const t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed;return null}}),r}function TD(e,t){if("json_schema"!==e.text?.format?.type)return null;if("$parseRaw"in e.text?.format){const n=e.text?.format;return n.$parseRaw(t)}return JSON.parse(t)}function PD(e,t){const n=(r=e.tools??[],i=t.name,r.find(e=>"function"===e.type&&e.name===i));var r,i,s;return{...t,...t,parsed_arguments:(s=n,"auto-parseable-tool"===s?.$brand?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null)}}function RD(e){const t=[];for(const n of e.output)if("message"===n.type)for(const e of n.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}class jD extends $N{list(e,t={},n){return pN(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,KD,{query:t,...n})}}var ND,$D,LD,DD,UD,MD,FD,zD,BD=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},qD=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class WD extends c${constructor(e){super(),ND.add(this),$D.set(this,void 0),LD.set(this,void 0),DD.set(this,void 0),BD(this,$D,e,"f")}static createResponse(e,t,n){const r=new WD(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,n){const r=n?.signal;let i;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),qD(this,ND,"m",UD).call(this);let s=null;"response_id"in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),s=t.starting_after??null):i=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const e of i)qD(this,ND,"m",MD).call(this,e,s);if(i.controller.signal?.aborted)throw new Ej;return qD(this,ND,"m",FD).call(this)}[($D=new WeakMap,LD=new WeakMap,DD=new WeakMap,ND=new WeakSet,UD=function(){this.ended||BD(this,LD,void 0,"f")},MD=function(e,t){if(this.ended)return;const n=(e,n)=>{(null==t||n.sequence_number>t)&&this._emit(e,n)},r=qD(this,ND,"m",zD).call(this,e);switch(n("event",e),e.type){case"response.output_text.delta":{const t=r.output[e.output_index];if(!t)throw new _j(`missing output at index ${e.output_index}`);if("message"===t.type){const r=t.content[e.content_index];if(!r)throw new _j(`missing content at index ${e.content_index}`);if("output_text"!==r.type)throw new _j(`expected content to be 'output_text', got ${r.type}`);n("response.output_text.delta",{...e,snapshot:r.text})}break}case"response.function_call_arguments.delta":{const t=r.output[e.output_index];if(!t)throw new _j(`missing output at index ${e.output_index}`);"function_call"===t.type&&n("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:n(e.type,e)}},FD=function(){if(this.ended)throw new _j("stream has ended, this shouldn't happen");const e=qD(this,LD,"f");if(!e)throw new _j("request ended without sending any events");BD(this,LD,void 0,"f");const t=function(e,t){return CD(e,t)}(e,qD(this,$D,"f"));return BD(this,DD,t,"f"),t},zD=function(e){let t=qD(this,LD,"f");if(!t){if("response.created"!==e.type)throw new _j(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return t=BD(this,LD,e.response,"f"),t}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{const n=t.output[e.output_index];if(!n)throw new _j(`missing output at index ${e.output_index}`);"message"===n.type&&n.content.push(e.part);break}case"response.output_text.delta":{const n=t.output[e.output_index];if(!n)throw new _j(`missing output at index ${e.output_index}`);if("message"===n.type){const t=n.content[e.content_index];if(!t)throw new _j(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new _j(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{const n=t.output[e.output_index];if(!n)throw new _j(`missing output at index ${e.output_index}`);"function_call"===n.type&&(n.arguments+=e.delta);break}case"response.completed":BD(this,LD,e.response,"f")}return t},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",n=>{const r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=qD(this,DD,"f");if(!e)throw new _j("stream ended without producing a ChatCompletion");return e}}class HD extends $N{constructor(){super(...arguments),this.inputItems=new jD(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&RD(e),e))}retrieve(e,t={},n){return this._client.get(`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>ID(t,e))}stream(e,t){return WD.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t?.headers}})}}class KD extends NN{}HD.InputItems=jD;class GD extends $N{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,Xj({body:t,...n}))}}class VD extends $N{constructor(){super(...arguments),this.parts=new GD(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}VD.Parts=GD;class ZD extends $N{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return pN(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,JD,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...n,headers:r}).withResponse(),s=i.data;switch(s.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=i.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await _N(e);break;case"failed":case"completed":return s}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,YD,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class JD extends NN{}class YD extends jN{}ZD.VectorStoreFilesPage=JD,ZD.FileContentResponsesPage=YD;class XD extends $N{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n={},r){return pN(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,JD,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:i,response:s}=await this.retrieve(e,t,{...n,headers:r}).withResponse();switch(i.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await _N(e);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(null==t||0==t.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=r?.maxConcurrency??5,s=Math.min(i,t.length),a=this._client,o=t.values(),c=[...n];const l=Array(s).fill(o).map(async function(e){for(let t of e){const e=await a.files.create({file:t,purpose:"assistants"},r);c.push(e.id)}});return await(async e=>{const t=await Promise.allSettled(e),n=t.filter(e=>"rejected"===e.status);if(n.length){for(const e of n)console.error(e.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const e of t)"fulfilled"===e.status&&r.push(e.value);return r})(l),await this.createAndPoll(e,{file_ids:c})}}class QD extends $N{constructor(){super(...arguments),this.files=new ZD(this._client),this.fileBatches=new XD(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return pN(e)?this.list({},e):this._client.getAPIList("/vector_stores",eU,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,tU,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class eU extends NN{}class tU extends jN{}var nU;QD.VectorStoresPage=eU,QD.VectorStoreSearchResponsesPage=tU,QD.Files=ZD,QD.VectorStoreFilesPage=JD,QD.FileContentResponsesPage=YD,QD.FileBatches=XD;let rU=class extends oN{constructor({baseURL:e=SN("OPENAI_BASE_URL"),apiKey:t=SN("OPENAI_API_KEY"),organization:n=SN("OPENAI_ORG_ID")??null,project:r=SN("OPENAI_PROJECT_ID")??null,...i}={}){if(void 0===t)throw new _j("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const s={apiKey:t,organization:n,project:r,...i,baseURL:e||"https://api.openai.com/v1"};if(!s.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new _j("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:s.baseURL,timeout:s.timeout??6e5,httpAgent:s.httpAgent,maxRetries:s.maxRetries,fetch:s.fetch}),this.completions=new ZL(this),this.chat=new FN(this),this.embeddings=new tD(this),this.files=new cD(this),this.images=new SD(this),this.audio=new WN(this),this.moderations=new OD(this),this.models=new kD(this),this.fineTuning=new _D(this),this.graders=new ED(this),this.vectorStores=new QD(this),this.beta=new VL(this),this.batches=new HN(this),this.uploads=new VD(this),this.responses=new HD(this),this.evals=new aD(this),this.containers=new QL(this),this._options=s,this.apiKey=t,this.organization=n,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return oj(e,{arrayFormat:"brackets"})}};nU=rU,rU.OpenAI=nU,rU.DEFAULT_TIMEOUT=6e5,rU.OpenAIError=_j,rU.APIError=xj,rU.APIConnectionError=Sj,rU.APIConnectionTimeoutError=kj,rU.APIUserAbortError=Ej,rU.NotFoundError=Ij,rU.ConflictError=Tj,rU.RateLimitError=Rj,rU.BadRequestError=Aj,rU.AuthenticationError=Oj,rU.InternalServerError=jj,rU.PermissionDeniedError=Cj,rU.UnprocessableEntityError=Pj,rU.toFile=Vj,rU.fileFromPath=gj,rU.Completions=ZL,rU.Chat=FN,rU.ChatCompletionsPage=UN,rU.Embeddings=tD,rU.Files=cD,rU.FileObjectsPage=lD,rU.Images=SD,rU.Audio=WN,rU.Moderations=OD,rU.Models=kD,rU.ModelsPage=AD,rU.FineTuning=_D,rU.Graders=ED,rU.VectorStores=QD,rU.VectorStoresPage=eU,rU.VectorStoreSearchResponsesPage=tU,rU.Beta=VL,rU.Batches=HN,rU.BatchesPage=KN,rU.Uploads=VD,rU.Responses=HD,rU.Evals=aD,rU.EvalListResponsesPage=oD,rU.Containers=QL,rU.ContainerListResponsesPage=eD;class iU extends gf{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return"string"==typeof e.content?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return"string"==typeof e?this._callWithConfig(async(e,t)=>this.parseResult([{text:e}],t?.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(e,t)=>this.parseResult([{message:e,text:this._baseMessageToString(e)}],t?.callbacks),e,{...t,runType:"parser"})}}class sU extends iU{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}}class aU extends Error{constructor(e,t,n,r=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=r,r&&(void 0===n||void 0===t))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");Zo(this,"OUTPUT_PARSING_FAILURE")}}class oU extends sU{async*_transform(e){for await(const t of e)"string"==typeof t?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class cU extends oU{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=e?.diff??this.diff}async*_transform(e){let t,n;for await(const r of e){if("string"!=typeof r&&"string"!=typeof r.content)throw new Error("Cannot handle non-string output.");let e;if($o(r)){if("string"!=typeof r.content)throw new Error("Cannot handle non-string message output.");e=new cm({message:r,text:r.content})}else if(No(r)){if("string"!=typeof r.content)throw new Error("Cannot handle non-string message output.");e=new cm({message:nc(r),text:r.content})}else e=new om({text:r});n=void 0===n?e:n.concat(e);const i=await this.parsePartialResult([n]);null==i||yC(i,t)||(this.diff?yield this._diff(t,i):yield i,t=i)}}getFormatInstructions(){return""}}class lU extends sU{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){return new this(Nl(Object.fromEntries(Object.entries(e).map(([e,t])=>[e,Rl().describe(t)]))))}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.\n\n"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.\n\nFor example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}\nwould match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.\nThus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.\n\nYour output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!\n\nHere is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:\n\`\`\`json\n${JSON.stringify(tf(this.schema))}\n\`\`\`\n`}async parse(e){try{const t=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(e,t)=>`"${t.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(t))}catch(t){throw new aU(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}class uU extends cU{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?Au(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return eo(e[0].text)}async parse(e){return eo(e,JSON.parse)}getFormatInstructions(){return""}}function dU(e,t){if(void 0===e.function)return;let n;if(t?.partial)try{n=to(e.function.arguments??"{}")}catch(e){return}else try{n=JSON.parse(e.function.arguments)}catch(t){throw new aU([`Function "${e.function.name}" arguments:`,"",e.function.arguments,"","are not valid JSON.",`Error: ${t.message}`].join("\n"))}const r={name:e.function.name,args:n,type:"tool_call"};return t?.returnId&&(r.id=e.id),r}function pU(e){if(void 0===e.id)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:e.id,type:"function",function:{name:e.name,arguments:JSON.stringify(e.args)}}}function hU(e,t){return{name:e.function?.name,args:e.function?.arguments,id:e.id,error:t,type:"invalid_tool_call"}}class mU extends cU{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=e?.returnId??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){const n=e[0].message;let r;if(Mo(n)&&n.tool_calls?.length)r=n.tool_calls.map(e=>{const{id:t,...n}=e;return this.returnId?{id:t,...n}:n});else if(void 0!==n.additional_kwargs.tool_calls){r=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(e=>dU(e,{returnId:this.returnId,partial:t}))}if(!r)return[];const i=[];for(const e of r)if(void 0!==e){const t={type:e.name,args:e.args,id:e.id};i.push(t)}return i}}class fU extends mU{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(void 0===this.zodSchema)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new aU(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const t=(await super.parsePartialResult(e)).filter(e=>e.type===this.keyName);let n=t;if(t.length)return this.returnId||(n=t.map(e=>e.args)),this.returnSingle?n[0]:n}async parseResult(e){const t=(await super.parsePartialResult(e,!1)).filter(e=>e.type===this.keyName);let n=t;if(!t.length)return;if(this.returnId||(n=t.map(e=>e.args)),this.returnSingle)return this._validateResult(n[0]);const r=await Promise.all(n.map(e=>this._validateResult(e)));return r}}const gU=Symbol("Let zodToJsonSchema decide on which parser to use"),yU={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},vU=e=>"_def"in e?e._def:e;const bU=e=>{const t=(e=>"string"==typeof e?{...yU,basePath:["#"],definitions:{},name:e}:{...yU,basePath:["#"],definitions:{},...e})(e),n=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:n,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(t.definitions).map(([e,n])=>[vU(n),{def:vU(n),path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}};function wU(e,t,n,r){r?.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function _U(e,t,n,r,i){e[t]=n,wU(e,t,r,i)}function xU(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((n,r)=>xU(e,t,n))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return EU(e,t)}}const EU=(e,t)=>{const n={type:"integer",format:"unix-time"};if("openApi3"===t.target)return n;for(const r of e.checks)switch(r.kind){case"min":_U(n,"minimum",r.value,r.message,t);break;case"max":_U(n,"maximum",r.value,r.message,t)}return n};let SU;const kU=/^[cC][^\s-]{8,}$/,AU=/^[0-9a-z]+$/,OU=/^[0-9A-HJKMNP-TV-Z]{26}$/,CU=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,IU=()=>(void 0===SU&&(SU=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),SU),TU=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,PU=/^[a-zA-Z0-9_-]{21}$/;function RU(e,t){const n={type:"string"};function r(e){return"escape"===t.patternStrategy?jU(e):e}if(e.checks)for(const i of e.checks)switch(i.kind){case"min":_U(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,i.value):i.value,i.message,t);break;case"max":_U(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,i.value):i.value,i.message,t);break;case"email":switch(t.emailStrategy){case"format:email":NU(n,"email",i.message,t);break;case"format:idn-email":NU(n,"idn-email",i.message,t);break;case"pattern:zod":$U(n,CU,i.message,t)}break;case"url":NU(n,"uri",i.message,t);break;case"uuid":NU(n,"uuid",i.message,t);break;case"regex":$U(n,i.regex,i.message,t);break;case"cuid":$U(n,kU,i.message,t);break;case"cuid2":$U(n,AU,i.message,t);break;case"startsWith":$U(n,RegExp(`^${r(i.value)}`),i.message,t);break;case"endsWith":$U(n,RegExp(`${r(i.value)}$`),i.message,t);break;case"datetime":NU(n,"date-time",i.message,t);break;case"date":NU(n,"date",i.message,t);break;case"time":NU(n,"time",i.message,t);break;case"duration":NU(n,"duration",i.message,t);break;case"length":_U(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,i.value):i.value,i.message,t),_U(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,i.value):i.value,i.message,t);break;case"includes":$U(n,RegExp(r(i.value)),i.message,t);break;case"ip":"v6"!==i.version&&NU(n,"ipv4",i.message,t),"v4"!==i.version&&NU(n,"ipv6",i.message,t);break;case"emoji":$U(n,IU,i.message,t);break;case"ulid":$U(n,OU,i.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":NU(n,"binary",i.message,t);break;case"contentEncoding:base64":_U(n,"contentEncoding","base64",i.message,t);break;case"pattern:zod":$U(n,TU,i.message,t)}break;case"nanoid":$U(n,PU,i.message,t)}return n}const jU=e=>Array.from(e).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),NU=(e,t,n,r)=>{e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):_U(e,"format",t,n,r)},$U=(e,t,n,r)=>{e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:LU(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):_U(e,"pattern",LU(t,r),n,r)},LU=(e,t)=>{const n="function"==typeof e?e():e;if(!t.applyRegexFlags||!n.flags)return n.source;const r=n.flags.includes("i"),i=n.flags.includes("m"),s=n.flags.includes("s"),a=r?n.source.toLowerCase():n.source;let o="",c=!1,l=!1,u=!1;for(let e=0;e<a.length;e++)if(c)o+=a[e],c=!1;else{if(r)if(l){if(a[e].match(/[a-z]/)){u?(o+=a[e],o+=`${a[e-2]}-${a[e]}`.toUpperCase(),u=!1):"-"===a[e+1]&&a[e+2]?.match(/[a-z]/)?(o+=a[e],u=!0):o+=`${a[e]}${a[e].toUpperCase()}`;continue}}else if(a[e].match(/[a-z]/)){o+=`[${a[e]}${a[e].toUpperCase()}]`;continue}if(i){if("^"===a[e]){o+="(^|(?<=[\r\n]))";continue}if("$"===a[e]){o+="($|(?=[\r\n]))";continue}}s&&"."===a[e]?o+=l?`${a[e]}\r\n`:`[${a[e]}\r\n]`:(o+=a[e],"\\"===a[e]?c=!0:l&&"]"===a[e]?l=!1:l||"["!==a[e]||(l=!0))}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return o};function DU(e,t){if("openApi3"===t.target&&e.keyType?._def.typeName===Pl.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((n,r)=>({...n,[r]:zU(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",r]})??{}}),{}),additionalProperties:!1};const n={type:"object",additionalProperties:zU(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return n;if(e.keyType?._def.typeName===Pl.ZodString&&e.keyType._def.checks?.length){const r=Object.entries(RU(e.keyType._def,t)).reduce((e,[t,n])=>"type"===t?e:{...e,[t]:n},{});return{...n,propertyNames:r}}return e.keyType?._def.typeName===Pl.ZodEnum?{...n,propertyNames:{enum:e.keyType._def.values}}:n}const UU={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};const MU=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,n)=>zU(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${n}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return n.length?{anyOf:n}:void 0};function FU(e,t){return"strict"===t.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:zU(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:zU(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}function zU(e,t,n=!1){const r=t.seen.get(e);if(t.override){const i=t.override?.(e,t,r,n);if(i!==gU)return i}if(r&&!n){const e=BU(r,t);if(void 0!==e)return"$ref"in e&&t.seenRefs.add(e.$ref),e}const i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);const s=WU(e,e.typeName,t,n);return s&&HU(e,t,s),i.jsonSchema=s,s}const BU=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"extract-to-root":const n=e.path.slice(t.basePath.length+1).join("_");return n!==t.name&&"duplicate-ref"===t.nameStrategy&&(t.definitions[n]=e.def),{$ref:[...t.basePath,t.definitionPath,n].join("/")};case"relative":return{$ref:qU(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((e,n)=>t.currentPath[n]===e)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):"seen"===t.$refStrategy?{}:void 0}},qU=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")},WU=(e,t,n,r)=>{switch(t){case Pl.ZodString:return RU(e,n);case Pl.ZodNumber:return function(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",wU(n,"type",r.message,t);break;case"min":"jsonSchema7"===t.target?r.inclusive?_U(n,"minimum",r.value,r.message,t):_U(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),_U(n,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?_U(n,"maximum",r.value,r.message,t):_U(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),_U(n,"maximum",r.value,r.message,t));break;case"multipleOf":_U(n,"multipleOf",r.value,r.message,t)}return n}(e,n);case Pl.ZodObject:return function(e,t){const n={type:"object",...Object.entries(e.shape()).reduce((e,[n,r])=>{if(void 0===r||void 0===r._def)return e;const i=[...t.currentPath,"properties",n],s=zU(r._def,{...t,currentPath:i,propertyPath:i});return void 0===s?e:(t.openaiStrictMode&&r.isOptional()&&!r.isNullable()&&console.warn(`Zod field at \`${i.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required\nThis will become an error in a future version of the SDK.`),{properties:{...e.properties,[n]:s},required:r.isOptional()&&!t.openaiStrictMode?e.required:[...e.required,n]})},{properties:{},required:[]}),additionalProperties:FU(e,t)};return n.required.length||delete n.required,n}(e,n);case Pl.ZodBigInt:return function(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":"jsonSchema7"===t.target?r.inclusive?_U(n,"minimum",r.value,r.message,t):_U(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),_U(n,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?_U(n,"maximum",r.value,r.message,t):_U(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),_U(n,"maximum",r.value,r.message,t));break;case"multipleOf":_U(n,"multipleOf",r.value,r.message,t)}return n}(e,n);case Pl.ZodBoolean:return{type:"boolean"};case Pl.ZodDate:return xU(e,n);case Pl.ZodUndefined:return{not:{}};case Pl.ZodNull:return function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}(n);case Pl.ZodArray:return function(e,t){const n={type:"array"};return e.type?._def?.typeName!==Pl.ZodAny&&(n.items=zU(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&_U(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&_U(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(_U(n,"minItems",e.exactLength.value,e.exactLength.message,t),_U(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}(e,n);case Pl.ZodUnion:case Pl.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return MU(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(e=>e._def.typeName in UU&&(!e._def.checks||!e._def.checks.length))){const e=n.reduce((e,t)=>{const n=UU[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e},[]);return{type:e.length>1?e:e[0]}}if(n.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){const e=n.reduce((e,t)=>{const n=typeof t._def.value;switch(n){case"string":case"number":case"boolean":return[...e,n];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===n.length){const t=e.filter((e,t,n)=>n.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:n.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(n.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:n.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return MU(e,t)}(e,n);case Pl.ZodIntersection:return function(e,t){const n=[zU(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),zU(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e);let r="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0;const i=[];return n.forEach(e=>{if((e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e)(e))i.push(...e.allOf),void 0===e.unevaluatedProperties&&(r=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:n,...r}=e;t=r}else r=void 0;i.push(t)}}),i.length?{allOf:i,...r}:void 0}(e,n);case Pl.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,n)=>zU(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:zU(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,n)=>zU(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,n);case Pl.ZodRecord:return DU(e,n);case Pl.ZodLiteral:return function(e,t){const n=typeof e.value;return"bigint"!==n&&"number"!==n&&"boolean"!==n&&"string"!==n?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===n?"integer":n,enum:[e.value]}:{type:"bigint"===n?"integer":n,const:e.value}}(e,n);case Pl.ZodEnum:return function(e){return{type:"string",enum:[...e.values]}}(e);case Pl.ZodNativeEnum:return function(e){const t=e.values,n=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]),r=n.map(e=>t[e]),i=Array.from(new Set(r.map(e=>typeof e)));return{type:1===i.length?"string"===i[0]?"string":"number":["string","number"],enum:r}}(e);case Pl.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target||"property"===t.nullableStrategy?{type:UU[e.innerType._def.typeName],nullable:!0}:{type:[UU[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){const n=zU(e.innerType._def,{...t,currentPath:[...t.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const n=zU(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}(e,n);case Pl.ZodOptional:return((e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return zU(e.innerType._def,t);const n=zU(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}})(e,n);case Pl.ZodMap:return function(e,t){return"record"===t.mapStrategy?DU(e,t):{type:"array",maxItems:125,items:{type:"array",items:[zU(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},zU(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,n);case Pl.ZodSet:return function(e,t){const n={type:"array",uniqueItems:!0,items:zU(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&_U(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&_U(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}(e,n);case Pl.ZodLazy:return zU(e.getter()._def,n);case Pl.ZodPromise:return function(e,t){return zU(e.type._def,t)}(e,n);case Pl.ZodNaN:case Pl.ZodNever:return{not:{}};case Pl.ZodEffects:return function(e,t,n){return"input"===t.effectStrategy?zU(e.schema._def,t,n):{}}(e,n,r);case Pl.ZodAny:case Pl.ZodUnknown:return{};case Pl.ZodDefault:return function(e,t){return{...zU(e.innerType._def,t),default:e.defaultValue()}}(e,n);case Pl.ZodBranded:return function(e,t){return zU(e.type._def,t)}(e,n);case Pl.ZodReadonly:case Pl.ZodCatch:return((e,t)=>zU(e.innerType._def,t))(e,n);case Pl.ZodPipeline:return((e,t)=>{if("input"===t.pipeStrategy)return zU(e.in._def,t);if("output"===t.pipeStrategy)return zU(e.out._def,t);const n=zU(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[n,zU(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]})].filter(e=>void 0!==e)}})(e,n);case Pl.ZodFunction:case Pl.ZodVoid:case Pl.ZodSymbol:default:return}},HU=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n);function KU(e,t){return((e,t)=>{const n=bU(t),r="string"==typeof t?t:"title"===t?.nameStrategy?void 0:t?.name,i=zU(e._def,void 0===r?n:{...n,currentPath:[...n.basePath,n.definitionPath,r]},!1)??{},s="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==s&&(i.title=s);const a=(()=>{if(function(e){if(!e)return!0;for(const t in e)return!1;return!0}(n.definitions))return;const e={},t=new Set;for(let r=0;r<500;r++){const r=Object.entries(n.definitions).filter(([e])=>!t.has(e));if(0===r.length)break;for(const[i,s]of r)e[i]=zU(vU(s),{...n,currentPath:[...n.basePath,n.definitionPath,i]},!0)??{},t.add(i)}return e})(),o=void 0===r?a?{...i,[n.definitionPath]:a}:i:"duplicate-ref"===n.nameStrategy?{...i,...a||n.seenRefs.size?{[n.definitionPath]:{...a,...n.seenRefs.size?{[r]:i}:void 0}}:void 0}:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,r].join("/"),[n.definitionPath]:{...a,[r]:i}};return"jsonSchema7"===n.target?o.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===n.target&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o})(e,{openaiStrictMode:!0,name:t.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function GU(e,t,n){return function(e,t){const n={...e};return Object.defineProperties(n,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:t,enumerable:!1}}),n}({type:"json_schema",json_schema:{...n,name:t,strict:!0,schema:KU(e,{name:t})}},t=>e.parse(JSON.parse(t)))}function VU(e){const{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:n,azureOpenAIApiKey:r,azureOpenAIBasePath:i,baseURL:s,azureADTokenProvider:a,azureOpenAIEndpoint:o}=e;if((r||a)&&i&&t)return`${i}/${t}`;if((r||a)&&o&&t)return`${o}/openai/deployments/${t}`;if(r||a){if(!n)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${n}.openai.azure.com/openai/deployments/${t}`}return s}function ZU(e,t){return e.lc_error_code=t,e.message=`${e.message}\n\nTroubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${t}/\n`,e}function JU(e){let t;return e.constructor.name===kj.name?(t=new Error(e.message),t.name="TimeoutError"):e.constructor.name===Ej.name?(t=new Error(e.message),t.name="AbortError"):t=400===e.status&&e.message.includes("tool_calls")?ZU(e,"INVALID_TOOL_RESULTS"):401===e.status?ZU(e,"MODEL_AUTHENTICATION"):429===e.status?ZU(e,"MODEL_RATE_LIMIT"):404===e.status?ZU(e,"MODEL_NOT_FOUND"):e,t}function YU(e){return e?"any"===e||"required"===e?"required":"auto"===e?"auto":"none"===e?"none":"string"==typeof e?{type:"function",function:{name:e}}:e:void 0}function XU(e,t){const n=[];for(const[r,i]of Object.entries(e.properties??{}))i.description&&t<2&&n.push(`// ${i.description}`),e.required?.includes(r)?n.push(`${r}: ${QU(i,t)},`):n.push(`${r}?: ${QU(i,t)},`);return n.map(e=>" ".repeat(t)+e).join("\n")}function QU(e,t){if(void 0!==(n=e).anyOf&&Array.isArray(n.anyOf))return e.anyOf.map(e=>QU(e,t)).join(" | ");var n;switch(e.type){case"string":return e.enum?e.enum.map(e=>`"${e}"`).join(" | "):"string";case"number":case"integer":return e.enum?e.enum.map(e=>`${e}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",XU(e,t+2),"}"].join("\n");case"array":return e.items?`${QU(e.items,t)}[]`:"any[]";default:return""}}function eM(e,t){let n;return n=gC(e)?function(e){let t;return t=gC(e)?{type:"function",function:vC(e)}:e,t}(e):e,void 0!==t?.strict&&(n.function.strict=t.strict),n}function tM(e){const t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!Bo.isInstance(e))throw new Error("Invalid generic chat message");return function(e){return"system"!==e.role&&"developer"!==e.role&&"assistant"!==e.role&&"user"!==e.role&&"function"!==e.role&&"tool"!==e.role&&console.warn(`Unknown message role: ${e.role}`),e.role}(e);default:throw new Error(`Unknown message type: ${t}`)}}const nM={providerName:"ChatOpenAI",fromStandardTextBlock:e=>({type:"text",text:e.text}),fromStandardImageBlock(e){if("url"===e.source_type)return{type:"image_url",image_url:{url:e.url,...e.metadata?.detail?{detail:e.metadata.detail}:{}}};if("base64"===e.source_type){return{type:"image_url",image_url:{url:`data:${e.mime_type??""};base64,${e.data}`,...e.metadata?.detail?{detail:e.metadata.detail}:{}}}}throw new Error(`Image content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)},fromStandardAudioBlock(e){if("url"===e.source_type){const t=Ao({dataUrl:e.url});if(!t)throw new Error(`URL audio blocks with source_type ${e.source_type} must be formatted as a data URL for ChatOpenAI`);const n=t.mime_type||e.mime_type||"";let r;try{r=ko(n)}catch{throw new Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`)}if("audio"!==r.type||"wav"!==r.subtype&&"mp3"!==r.subtype)throw new Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:r.subtype,data:t.data}}}if("base64"===e.source_type){let t;try{t=ko(e.mime_type??"")}catch{throw new Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`)}if("audio"!==t.type||"wav"!==t.subtype&&"mp3"!==t.subtype)throw new Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:t.subtype,data:e.data}}}throw new Error(`Audio content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)},fromStandardFileBlock(e){if("url"===e.source_type){if(!Ao({dataUrl:e.url}))throw new Error(`URL file blocks with source_type ${e.source_type} must be formatted as a data URL for ChatOpenAI`);return{type:"file",file:{file_data:e.url,...e.metadata?.filename||e.metadata?.name?{filename:e.metadata?.filename||e.metadata?.name}:{}}}}if("base64"===e.source_type)return{type:"file",file:{file_data:`data:${e.mime_type??""};base64,${e.data}`,...e.metadata?.filename||e.metadata?.name||e.metadata?.title?{filename:e.metadata?.filename||e.metadata?.name||e.metadata?.title}:{}}};if("id"===e.source_type)return{type:"file",file:{file_id:e.id}};throw new Error(`File content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)}};function rM(e,t){return e.flatMap(e=>{let n=tM(e);"system"===n&&uM(t)&&(n="developer");const r="string"==typeof e.content?e.content:e.content.map(e=>_o(e)?Oo(e,nM):e),i={role:n,content:r};if(null!=e.name&&(i.name=e.name),null!=e.additional_kwargs.function_call&&(i.function_call=e.additional_kwargs.function_call,i.content=""),Mo(e)&&e.tool_calls?.length?(i.tool_calls=e.tool_calls.map(pU),i.content=""):(null!=e.additional_kwargs.tool_calls&&(i.tool_calls=e.additional_kwargs.tool_calls),null!=e.tool_call_id&&(i.tool_call_id=e.tool_call_id)),e.additional_kwargs.audio&&"object"==typeof e.additional_kwargs.audio&&"id"in e.additional_kwargs.audio){return[i,{role:"assistant",audio:{id:e.additional_kwargs.audio.id}}]}return i})}const iM="__openai_function_call_ids__";function sM(e,t,n){const r=e.filter(e=>Mo(e)).pop(),i=r?.response_metadata?.id;return(i&&i.startsWith("resp_")&&!n?e.slice(e.indexOf(r)+1):e).flatMap(e=>{let r=tM(e);if("system"===r&&uM(t)&&(r="developer"),"function"===r)throw new Error("Function messages are not supported in Responses API");if("tool"===r){const t=e;if("computer_call_output"===t.additional_kwargs?.type){const e=(()=>{if("string"==typeof t.content)return{type:"computer_screenshot",image_url:t.content};if(Array.isArray(t.content)){const e=t.content.find(e=>"computer_screenshot"===e.type);if(e)return e;const n=t.content.find(e=>"image_url"===e.type);if(n)return{type:"computer_screenshot",image_url:"string"==typeof n.image_url?n.image_url:n.image_url.url}}throw new Error("Invalid computer call output")})();return{type:"computer_call_output",output:e,call_id:t.tool_call_id}}return{type:"function_call_output",call_id:t.tool_call_id,id:t.id,output:"string"!=typeof t.content?JSON.stringify(t.content):t.content}}if("assistant"===r){if(!n&&null!=e.response_metadata.output&&Array.isArray(e.response_metadata.output)&&e.response_metadata.output.length>0&&e.response_metadata.output.every(e=>"type"in e))return e.response_metadata.output;const t=[];if(!n&&null!=e.additional_kwargs.reasoning){if((e=>"object"==typeof e&&null!=e&&"type"in e&&"reasoning"===e.type)(e.additional_kwargs.reasoning)){const n=function(e){const t=(e.summary.length>1?e.summary.reduce((e,t)=>{const n=e.at(-1);return n.index===t.index?n.text+=t.text:e.push(t),e},[{...e.summary[0]}]):e.summary).map(e=>Object.fromEntries(Object.entries(e).filter(([e])=>"index"!==e)));return{...e,summary:t}}(e.additional_kwargs.reasoning);t.push(n)}}let{content:r}=e;null!=e.additional_kwargs.refusal&&("string"==typeof r&&(r=[{type:"output_text",text:r,annotations:[]}]),r=[...r,{type:"refusal",refusal:e.additional_kwargs.refusal}]),t.push({type:"message",role:"assistant",...e.id&&!n?{id:e.id}:{},content:"string"==typeof r?r:r.flatMap(e=>"text"===e.type?{type:"output_text",text:e.text,annotations:e.annotations??[]}:"output_text"===e.type||"refusal"===e.type?e:[])});const i=e.additional_kwargs[iM];Mo(e)&&e.tool_calls?.length?t.push(...e.tool_calls.map(e=>({type:"function_call",name:e.name,arguments:JSON.stringify(e.args),call_id:e.id,...n?{id:i?.[e.id]}:{}}))):null!=e.additional_kwargs.tool_calls&&t.push(...e.additional_kwargs.tool_calls.map(e=>({type:"function_call",name:e.function.name,call_id:e.id,...n?{id:i?.[e.id]}:{},arguments:e.function.arguments})));const s=e.response_metadata.output?.length?e.response_metadata.output:e.additional_kwargs.tool_outputs;let a=[];if(null!=s){const e=s;a=e?.filter(e=>"computer_call"===e.type),a.length>0&&t.push(...a)}return t}const i="string"==typeof e.content?e.content:e.content.flatMap(e=>{if(_o(e))return Oo(e,nM);if("text"===e.type)return{type:"input_text",text:e.text};if("image_url"===e.type){return{type:"input_image",image_url:"string"==typeof e.image_url?e.image_url:e.image_url.url,detail:"string"==typeof e.image_url?"auto":e.image_url.detail}}return"input_text"===e.type||"input_image"===e.type||"input_file"===e.type?e:[]});return"user"===r||"system"===r||"developer"===r?{type:"message",role:r,content:i}:(console.warn(`Unsupported role found when converting to OpenAI Responses API: ${r}`),[])})}function aM(e){if(e.error){const t=new Error(e.error.message);throw t.name=e.error.code,t}let t;const n=[],r=[],i=[],s={model:e.model,created_at:e.created_at,id:e.id,incomplete_details:e.incomplete_details,metadata:e.metadata,object:e.object,status:e.status,user:e.user,model_name:e.model},a={};for(const s of e.output)if("message"===s.type)t=s.id,n.push(...s.content.flatMap(e=>"output_text"===e.type?("parsed"in e&&null!=e.parsed&&(a.parsed=e.parsed),{type:"text",text:e.text,annotations:e.annotations}):"refusal"===e.type?(a.refusal=e.refusal,[]):e));else if("function_call"===s.type){const e={function:{name:s.name,arguments:s.arguments},id:s.call_id};try{r.push(dU(e,{returnId:!0}))}catch(t){let n;"object"==typeof t&&null!=t&&"message"in t&&"string"==typeof t.message&&(n=t.message),i.push(hU(e,n))}a[iM]??={},s.id&&(a[iM][s.call_id]=s.id)}else"reasoning"===s.type?a.reasoning=s:(a.tool_outputs??=[],a.tool_outputs.push(s));return new Uo({id:t,content:n,tool_calls:r,invalid_tool_calls:i,usage_metadata:e.usage,additional_kwargs:a,response_metadata:s})}function oM(e){const t=[];let n,r={};const i=[],s={},a={};let o;if("response.output_text.delta"===e.type)t.push({type:"text",text:e.delta,index:e.content_index});else if("response.output_text.annotation.added"===e.type)t.push({type:"text",text:"",annotations:[e.annotation],index:e.content_index});else if("response.output_item.added"===e.type&&"message"===e.item.type)o=e.item.id;else if("response.output_item.added"===e.type&&"function_call"===e.item.type)i.push({type:"tool_call_chunk",name:e.item.name,args:e.item.arguments,id:e.item.call_id,index:e.output_index}),a[iM]={[e.item.call_id]:e.item.id};else if("response.output_item.done"!==e.type||"web_search_call"!==e.item.type&&"file_search_call"!==e.item.type&&"computer_call"!==e.item.type)if("response.created"===e.type)s.id=e.response.id,s.model_name=e.response.model,s.model=e.response.model;else if("response.completed"===e.type){const t=aM(e.response);n=e.response.usage,"json_schema"===e.response.text?.format?.type&&(a.parsed??=JSON.parse(t.text));for(const[t,n]of Object.entries(e.response))"id"!==t&&(s[t]=n)}else if("response.function_call_arguments.delta"===e.type)i.push({type:"tool_call_chunk",args:e.delta,index:e.output_index});else if("response.web_search_call.completed"===e.type||"response.file_search_call.completed"===e.type)r={tool_outputs:{id:e.item_id,type:e.type.replace("response.","").replace(".completed",""),status:"completed"}};else if("response.refusal.done"===e.type)a.refusal=e.refusal;else if("response.output_item.added"===e.type&&"item"in e&&"reasoning"===e.item.type){const t=e.item.summary?e.item.summary.map((e,t)=>({...e,index:t})):void 0;a.reasoning={id:e.item.id,type:e.item.type,...t?{summary:t}:{}}}else if("response.reasoning_summary_part.added"===e.type)a.reasoning={type:"reasoning",summary:[{...e.part,index:e.summary_index}]};else{if("response.reasoning_summary_text.delta"!==e.type)return null;a.reasoning={type:"reasoning",summary:[{text:e.delta,type:"summary_text",index:e.summary_index}]}}else a.tool_outputs=[e.item];return new cm({text:t.map(e=>e.text).join(""),message:new zo({id:o,content:t,tool_call_chunks:i,usage_metadata:n,additional_kwargs:a,response_metadata:s}),generationInfo:r})}function cM(e){return"type"in e&&"function"!==e.type}function lM(e,t){return sg(e)?void 0!==t?.strict?{...e,function:{...e.function,strict:t.strict}}:e:eM(e,t)}function uM(e){return e&&/^o\d/.test(e)}class dM extends dg{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming","useResponsesApi","zdrEnabled","reasoning"]}constructor(e){super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoning",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zdrEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.apiKey??e?.openAIApiKey??e?.configuration?.apiKey??Pu("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=e?.configuration?.organization??Pu("OPENAI_ORGANIZATION"),this.model=e?.model??e?.modelName??this.model,this.modelName=this.model,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=this.stop,this.user=e?.user,this.__includeRawResponse=e?.__includeRawResponse,this.audio=e?.audio,this.modalities=e?.modalities,this.reasoningEffort=e?.reasoningEffort??e?.reasoning?.effort,this.reasoning=e?.reasoning??(e?.reasoningEffort?{effort:e.reasoningEffort}:void 0),this.maxTokens=e?.maxCompletionTokens??e?.maxTokens,this.useResponsesApi=e?.useResponsesApi??this.useResponsesApi,this.disableStreaming=e?.disableStreaming??this.disableStreaming,this.streaming=e?.streaming??!1,this.disableStreaming&&(this.streaming=!1),this.streamUsage=e?.streamUsage??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e?.configuration},void 0!==e?.supportsStrictToolCalling&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling),this.zdrEnabled=e?.zdrEnabled??!1}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let n;return void 0!==t?.strict?n=t.strict:void 0!==this.supportsStrictToolCalling&&(n=this.supportsStrictToolCalling),this.withConfig({tools:e.map(e=>cM(e)?e:lM(e,{strict:n})),...t})}createResponseFormat(e){return e&&"json_schema"===e.type&&e.json_schema.schema&&pM(e.json_schema.schema)?GU(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}getReasoningParams(e){if(!uM(this.model))return;let t;return void 0!==this.reasoningEffort&&(t={effort:this.reasoningEffort}),void 0!==this.reasoning&&(t={...t,...this.reasoning}),void 0!==e?.reasoning_effort&&(t={...t,effort:e.reasoning_effort}),void 0!==e?.reasoning&&(t={...t,...e.reasoning}),t}invocationParams(e,t){let n;if(void 0!==e?.strict?n=e.strict:void 0!==this.supportsStrictToolCalling&&(n=this.supportsStrictToolCalling),this._useResponseApi(e)){const t={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e?.previous_response_id,truncation:e?.truncation,include:e?.include,tools:e?.tools?.length?e.tools.map(e=>cM(e)?e:sg(e)?{type:"function",name:e.function.name,parameters:e.function.parameters,description:e.function.description,strict:n}:null).filter(e=>null!==e):void 0,tool_choice:(r=e?.tool_choice,null!=r&&"object"==typeof r&&"type"in r&&"function"!==r.type?e?.tool_choice:(()=>{const t=YU(e?.tool_choice);return"object"==typeof t&&"type"in t?{type:"function",name:t.function.name}:void 0})()),text:(()=>{if(e?.text)return e.text;const t=this.createResponseFormat(e?.response_format);return"json_schema"===t?.type?null!=t.json_schema.schema?{format:{type:"json_schema",schema:t.json_schema.schema,description:t.json_schema.description,name:t.json_schema.name,strict:t.json_schema.strict}}:void 0:{format:t}})(),parallel_tool_calls:e?.parallel_tool_calls,max_output_tokens:-1===this.maxTokens?void 0:this.maxTokens,...this.zdrEnabled?{store:!1}:{},...this.modelKwargs},i=this.getReasoningParams(e);return void 0!==i&&(t.reasoning=i),t}var r;let i={};void 0!==e?.stream_options?i={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t?.streaming)&&(i={stream_options:{include_usage:!0}});const s={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:e?.tools?.length?e.tools.map(e=>lM(e,{strict:n})):void 0,tool_choice:YU(e?.tool_choice),response_format:this.createResponseFormat(e?.response_format),seed:e?.seed,...i,parallel_tool_calls:e?.parallel_tool_calls,...this.audio||e?.audio?{audio:this.audio||e?.audio}:{},...this.modalities||e?.modalities?{modalities:this.modalities||e?.modalities}:{},...this.modelKwargs};void 0!==e?.prediction&&(s.prediction=e.prediction);const a=this.getReasoningParams(e);return void 0!==a&&void 0!==a.effort&&(s.reasoning_effort=a.effort),uM(s.model)?s.max_completion_tokens=-1===this.maxTokens?void 0:this.maxTokens:s.max_tokens=-1===this.maxTokens?void 0:this.maxTokens,s}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const n=e.tool_calls;if("assistant"===e.role){const r=[],i=[];for(const e of n??[])try{r.push(dU(e,{returnId:!0}))}catch(t){i.push(hU(e,t.message))}const s={function_call:e.function_call,tool_calls:n};void 0!==this.__includeRawResponse&&(s.__raw_response=t);const a={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(s.audio=e.audio),new Uo({content:e.content||"",tool_calls:r,invalid_tool_calls:i,additional_kwargs:s,response_metadata:a,id:t.id})}return new Bo(e.content||"",e.role??"unknown")}_convertOpenAIDeltaToBaseMessageChunk(e,t,n){const r=e.role??n,i=e.content??"";let s;s=e.function_call?{function_call:e.function_call}:e.tool_calls?{tool_calls:e.tool_calls}:{},this.__includeRawResponse&&(s.__raw_response=t),e.audio&&(s.audio={...e.audio,index:t.choices[0].index});const a={usage:{...t.usage}};if("user"===r)return new Ko({content:i,response_metadata:a});if("assistant"===r){const n=[];if(Array.isArray(e.tool_calls))for(const t of e.tool_calls)n.push({name:t.function?.name,args:t.function?.arguments,id:t.id,index:t.index,type:"tool_call_chunk"});return new zo({content:i,tool_call_chunks:n,additional_kwargs:s,id:t.id,response_metadata:a})}return"system"===r?new Vo({content:i,response_metadata:a}):"developer"===r?new Vo({content:i,response_metadata:a,additional_kwargs:{__openai_role__:"developer"}}):"function"===r?new Wo({content:i,additional_kwargs:s,name:e.name,response_metadata:a}):"tool"===r?new Do({content:i,additional_kwargs:s,tool_call_id:e.tool_call_id,response_metadata:a}):new qo({content:i,role:r,response_metadata:a})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){if(this._useResponseApi(t)){const n=e.filter(e=>Mo(e)).pop(),r=n?.response_metadata?.id,i=await this.responseApiWithRetry({...this.invocationParams(t,{streaming:!0}),input:sM(e,this.model,this.zdrEnabled),stream:!0,...r&&r.startsWith("resp_")&&!this.zdrEnabled?{previous_response_id:r}:{}},t);for await(const e of i){const t=oM(e);null!=t&&(yield t)}return}const r=rM(e,this.model),i={...this.invocationParams(t,{streaming:!0}),messages:r,stream:!0};let s;const a=await this.completionWithRetry(i,t);let o;for await(const e of a){const r=e?.choices?.[0];if(e.usage&&(o=e.usage),!r)continue;const{delta:i}=r;if(!i)continue;const a=this._convertOpenAIDeltaToBaseMessageChunk(i,e,s);s=i.role??s;const c={prompt:t.promptIndex??0,completion:r.index??0};if("string"!=typeof a.content){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const l={...c};null!=r.finish_reason&&(l.finish_reason=r.finish_reason,l.system_fingerprint=e.system_fingerprint,l.model_name=e.model),this.logprobs&&(l.logprobs=r.logprobs);const u=new cm({message:a,text:a.content,generationInfo:l});yield u,await(n?.handleLLMNewToken(u.text??"",c,void 0,void 0,void 0,{chunk:u}))}if(o){const e={...null!==o.prompt_tokens_details?.audio_tokens&&{audio:o.prompt_tokens_details?.audio_tokens},...null!==o.prompt_tokens_details?.cached_tokens&&{cache_read:o.prompt_tokens_details?.cached_tokens}},t={...null!==o.completion_tokens_details?.audio_tokens&&{audio:o.completion_tokens_details?.audio_tokens},...null!==o.completion_tokens_details?.reasoning_tokens&&{reasoning:o.completion_tokens_details?.reasoning_tokens}},n=new cm({message:new zo({content:"",response_metadata:{usage:{...o}},usage_metadata:{input_tokens:o.prompt_tokens,output_tokens:o.completion_tokens,total_tokens:o.total_tokens,...Object.keys(e).length>0&&{input_token_details:e},...Object.keys(t).length>0&&{output_token_details:t}}}),text:""});yield n}if(t.signal?.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _responseApiGenerate(e,t,n){const r=this.invocationParams(t);if(r.stream){const r=this._streamResponseChunks(e,t,n);let i;for await(const e of r)e.message.response_metadata={...e.generationInfo,...e.message.response_metadata},i=i?.concat(e)??e;return{generations:i?[i]:[],llmOutput:{estimatedTokenUsage:i?.message?.usage_metadata}}}const i=e.filter(e=>Mo(e)).pop(),s=i?.response_metadata?.id,a=sM(e,this.model,this.zdrEnabled),o=await this.responseApiWithRetry({input:a,...r,...s&&s.startsWith("resp_")&&!this.zdrEnabled?{previous_response_id:s}:{}},{signal:t?.signal,...t?.options});return{generations:[{text:o.output_text,message:aM(o)}],llmOutput:{id:o.id,estimatedTokenUsage:o.usage?{promptTokens:o.usage.input_tokens,completionTokens:o.usage.output_tokens,totalTokens:o.usage.total_tokens}:void 0}}}_useResponseApi(e){const t=e?.tools?.some(cM),n=null!=e?.previous_response_id||null!=e?.text||null!=e?.truncation||null!=e?.include||null!=e?.reasoning?.summary||null!=this.reasoning?.summary;return this.useResponsesApi||t||n}async _generate(e,t,n){if(this._useResponseApi(t))return this._responseApiGenerate(e,t,n);const r={},i=this.invocationParams(t),s=rM(e,this.model);if(i.stream){const i=this._streamResponseChunks(e,t,n),s={};for await(const e of i){e.message.response_metadata={...e.generationInfo,...e.message.response_metadata};const t=e.generationInfo?.completion??0;void 0===s[t]?s[t]=e:s[t]=s[t].concat(e)}const a=Object.entries(s).sort(([e],[t])=>parseInt(e,10)-parseInt(t,10)).map(([e,t])=>t),{functions:o,function_call:c}=this.invocationParams(t),l=await this.getEstimatedTokenCountFromPrompt(e,o,c),u=await this.getNumTokensFromGenerations(a);return r.input_tokens=l,r.output_tokens=u,r.total_tokens=l+u,{generations:a,llmOutput:{estimatedTokenUsage:{promptTokens:r.input_tokens,completionTokens:r.output_tokens,totalTokens:r.total_tokens}}}}{let e;e=t.response_format&&"json_schema"===t.response_format.type?await this.betaParsedCompletionWithRetry({...i,stream:!1,messages:s},{signal:t?.signal,...t?.options}):await this.completionWithRetry({...i,stream:!1,messages:s},{signal:t?.signal,...t?.options});const{completion_tokens:n,prompt_tokens:a,total_tokens:o,prompt_tokens_details:c,completion_tokens_details:l}=e?.usage??{};n&&(r.output_tokens=(r.output_tokens??0)+n),a&&(r.input_tokens=(r.input_tokens??0)+a),o&&(r.total_tokens=(r.total_tokens??0)+o),null===c?.audio_tokens&&null===c?.cached_tokens||(r.input_token_details={...null!==c?.audio_tokens&&{audio:c?.audio_tokens},...null!==c?.cached_tokens&&{cache_read:c?.cached_tokens}}),null===l?.audio_tokens&&null===l?.reasoning_tokens||(r.output_token_details={...null!==l?.audio_tokens&&{audio:l?.audio_tokens},...null!==l?.reasoning_tokens&&{reasoning:l?.reasoning_tokens}});const u=[];for(const t of e?.choices??[]){const n={text:t.message?.content??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(t.message??{role:"assistant"},e)};n.generationInfo={...t.finish_reason?{finish_reason:t.finish_reason}:{},...t.logprobs?{logprobs:t.logprobs}:{}},Mo(n.message)&&(n.message.usage_metadata=r),n.message=new Uo(Object.fromEntries(Object.entries(n.message).filter(([e])=>!e.startsWith("lc_")))),u.push(n)}return{generations:u,llmOutput:{tokenUsage:{promptTokens:r.input_tokens,completionTokens:r.output_tokens,totalTokens:r.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let r=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&"auto"!==n){const e=function(e){const t=["namespace functions {",""];for(const n of e)n.description&&t.push(`// ${n.description}`),Object.keys(n.parameters.properties??{}).length>0?(t.push(`type ${n.name} = (_: {`),t.push(XU(n.parameters,0)),t.push("}) => any;")):t.push(`type ${n.name} = () => any;`),t.push("");return t.push("} // namespace functions"),t.join("\n")}(t);r+=await this.getNumTokens(e),r+=9}return t&&e.find(e=>"system"===e._getType())&&(r-=4),"none"===n?r+=1:"object"==typeof n&&(r+=await this.getNumTokens(n.name)+4),r}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async e=>e.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([e.message])).countPerMessage[0]:await this.getNumTokens(e.message.content)))).reduce((e,t)=>e+t,0)}async getNumTokensFromMessages(e){let t=0,n=0,r=0;"gpt-3.5-turbo-0301"===this.model?(n=4,r=-1):(n=3,r=1);const i=await Promise.all(e.map(async e=>{const i=await this.getNumTokens(e.content),s=await this.getNumTokens(tM(e)),a=void 0!==e.name?r+await this.getNumTokens(e.name):0;let o=i+n+s+a;const c=e;if("function"===c._getType()&&(o-=2),c.additional_kwargs?.function_call&&(o+=3),c?.additional_kwargs.function_call?.name&&(o+=await this.getNumTokens(c.additional_kwargs.function_call?.name)),c.additional_kwargs.function_call?.arguments)try{o+=await this.getNumTokens(JSON.stringify(JSON.parse(c.additional_kwargs.function_call?.arguments)))}catch(e){console.error("Error parsing function arguments",e,JSON.stringify(c.additional_kwargs.function_call)),o+=await this.getNumTokens(c.additional_kwargs.function_call?.arguments)}return t+=o,o}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(e){throw JU(e)}})}async responseApiWithRetry(e,t){return this.caller.call(async()=>{const n=this._getClientOptions(t);try{return"json_schema"!==e.text?.format?.type||e.stream?await this.client.responses.create(e,n):await this.client.responses.parse(e,n)}catch(e){throw JU(e)}})}async betaParsedCompletionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,n)}catch(e){throw JU(e)}})}_getClientOptions(e){if(!this.client){const e=VU({baseURL:this.clientConfig.baseURL}),t={...this.clientConfig,baseURL:e,timeout:this.timeout,maxRetries:0};t.baseURL||delete t.baseURL,this.client=new rU(t)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((e,t)=>(t&&t.tokenUsage&&(e.tokenUsage.completionTokens+=t.tokenUsage.completionTokens??0,e.tokenUsage.promptTokens+=t.tokenUsage.promptTokens??0,e.tokenUsage.totalTokens+=t.tokenUsage.totalTokens??0),e),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,r,i,s,a,o;if(!function(e){return void 0!==e&&"object"==typeof e.schema}(e)?(n=e,r=t?.name,i=t?.method,s=t?.includeRaw):(n=e.schema,r=e.name,i=e.method,s=e.includeRaw),void 0!==t?.strict&&"jsonMode"===i)throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(this.model.startsWith("gpt-3")||this.model.startsWith("gpt-4-")||"gpt-4"===this.model?"jsonSchema"===i&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`):void 0===i&&(i="jsonSchema"),"jsonMode"===i)a=this.withConfig({response_format:{type:"json_object"}}),o=pM(n)?lU.fromZodSchema(n):new uU;else if("jsonSchema"===i)if(a=this.withConfig({response_format:{type:"json_schema",json_schema:{name:r??"extract",description:n.description,schema:n,strict:t?.strict}}}),pM(n)){const e=lU.fromZodSchema(n);o=Ef.from(t=>"parsed"in t.additional_kwargs?t.additional_kwargs.parsed:e)}else o=new uU;else{let e=r??"extract";if(pM(n)){const r=tf(n);a=this.withConfig({tools:[{type:"function",function:{name:e,description:r.description,parameters:r}}],tool_choice:{type:"function",function:{name:e}},...void 0!==t?.strict?{strict:t.strict}:{}}),o=new fU({returnSingle:!0,keyName:e,zodSchema:n})}else{let r;"string"==typeof n.name&&"object"==typeof n.parameters&&null!=n.parameters?(r=n,e=n.name):(e=n.title??e,r={name:e,description:n.description??"",parameters:n}),a=this.withConfig({tools:[{type:"function",function:r}],tool_choice:{type:"function",function:{name:e}},...void 0!==t?.strict?{strict:t.strict}:{}}),o=new fU({returnSingle:!0,keyName:e})}}if(!s)return a.pipe(o);const c=cg.assign({parsed:(e,t)=>o.invoke(e.raw,t)}),l=cg.assign({parsed:()=>null}),u=c.withFallbacks({fallbacks:[l]});return wf.from([{raw:a},u])}}function pM(e){return"function"==typeof e?.parse}const hM=(e,t)=>e.reduce((e,n,r)=>{const i=Math.floor(r/t),s=e[i]||[];return e[i]=s.concat([n]),e},[]);class mM extends ET{constructor(e){const t={maxConcurrency:2,...e};super(t),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"dimensions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const n=t?.apiKey??t?.openAIApiKey??Pu("OPENAI_API_KEY");this.organization=t?.configuration?.organization??Pu("OPENAI_ORGANIZATION"),this.model=t?.model??t?.modelName??this.model,this.modelName=this.model,this.batchSize=t?.batchSize??this.batchSize,this.stripNewLines=t?.stripNewLines??this.stripNewLines,this.timeout=t?.timeout,this.dimensions=t?.dimensions,this.clientConfig={apiKey:n,organization:this.organization,dangerouslyAllowBrowser:!0,...e?.configuration}}async embedDocuments(e){const t=hM(this.stripNewLines?e.map(e=>e.replace(/\n/g," ")):e,this.batchSize),n=t.map(e=>{const t={model:this.model,input:e};return this.dimensions&&(t.dimensions=this.dimensions),this.embeddingWithRetry(t)}),r=await Promise.all(n),i=[];for(let e=0;e<r.length;e+=1){const n=t[e],{data:s}=r[e];for(let e=0;e<n.length;e+=1)i.push(s[e].embedding)}return i}async embedQuery(e){const t={model:this.model,input:this.stripNewLines?e.replace(/\n/g," "):e};this.dimensions&&(t.dimensions=this.dimensions);const{data:n}=await this.embeddingWithRetry(t);return n[0].embedding}async embeddingWithRetry(e){if(!this.client){const e=VU({baseURL:this.clientConfig.baseURL}),t={...this.clientConfig,baseURL:e,timeout:this.timeout,maxRetries:0};t.baseURL||delete t.baseURL,this.client=new rU(t)}const t={};return this.caller.call(async()=>{try{return await this.client.embeddings.create(e,t)}catch(e){throw JU(e)}})}}const fM=e=>({OPENAI_API_KEY:(e?.env||process.env).OPENAI_API_KEY});async function*gM({context:e,model:t="gpt-4o-mini",system:n="You are a helpful assistant. Never explain what you do, just provide the requested response.",message:r="",prev:i=[],temperature:s=.7,json_mode:a=!1,response_schema:o,stream:c=!1},l=!1,u=!1){const{OPENAI_API_KEY:d}=fM(e);if(!d)throw new Error("OPENAI_API_KEY not found in environment variables");let p=new dM({apiKey:d,modelName:t,temperature:s,streaming:c});if(a)if(o){let e=o.parameters||o;if("object"===e.type){const t="additionalProperties"in e,n=!1!==o.strict;t||(e={...e,additionalProperties:!n})}const t=!1!==o.strict;p=p.withStructuredOutput(e,{name:o.name||"structured_output",strict:t})}else{const e={type:"object",properties:{response:{type:"string",description:"The response content"}},required:["response"],additionalProperties:!1};p=p.withStructuredOutput(e,{name:"json_response",strict:!0})}const h=[{role:"system",content:n},...i,{role:"user",content:r}],m=LR(h).filter(Boolean);if(u)return void(yield m);if(c){const e=await p.stream(m);for await(const t of e)yield t;return}const f=await p.invoke(m);a?yield f:yield f.content}const yM=async({model:e="text-embedding-3-small",message:t})=>{const{OPENAI_API_KEY:n}=fM();if(!n)throw new Error("OPENAI_API_KEY not found in environment variables");const r=new mM({apiKey:n,modelName:e});return Array.isArray(t)?await r.embedDocuments(t):await r.embedQuery(t)},vM=async()=>{throw new Error("OpenAI: generateWithImage is not supported in this provider.")},bM=async()=>{throw new Error("OpenAI: llm is not supported in this provider.")},wM=async()=>{throw new Error("OpenAI: textToSpeech is not supported in this provider.")};var _M,xM,EM,SM={generate:gM,embedding:yM,generateWithImage:vM,llm:bM,textToSpeech:wM},kM=Object.freeze({__proto__:null,default:SM,embedding:yM,generate:gM,generateWithImage:vM,llm:bM,textToSpeech:wM});!function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"}(_M||(_M={})),function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"}(xM||(xM={})),function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"}(EM||(EM={}));
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const AM=["user","model","function","system"];var OM,CM,IM,TM,PM,RM,jM,NM;!function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"}(OM||(OM={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(CM||(CM={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(IM||(IM={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"}(TM||(TM={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"}(PM||(PM={})),function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"}(RM||(RM={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"}(jM||(jM={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"}(NM||(NM={}));
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class $M extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class LM extends $M{constructor(e,t){super(e),this.response=t}}class DM extends $M{constructor(e,t,n,r){super(e),this.status=t,this.statusText=n,this.errorDetails=r}}class UM extends $M{}class MM extends $M{}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var FM;!function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"}(FM||(FM={}));class zM{constructor(e,t,n,r,i){this.model=e,this.task=t,this.apiKey=n,this.stream=r,this.requestOptions=i}toString(){var e,t;const n=(null===(e=this.requestOptions)||void 0===e?void 0:e.apiVersion)||"v1beta";let r=`${(null===(t=this.requestOptions)||void 0===t?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com"}/${n}/${this.model}:${this.task}`;return this.stream&&(r+="?alt=sse"),r}}async function BM(e){var t;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",function(e){const t=[];return(null==e?void 0:e.apiClient)&&t.push(e.apiClient),t.push("genai-js/0.24.1"),t.join(" ")}(e.requestOptions)),n.append("x-goog-api-key",e.apiKey);let r=null===(t=e.requestOptions)||void 0===t?void 0:t.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(e){throw new UM(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${e.message}`)}for(const[e,t]of r.entries()){if("x-goog-api-key"===e)throw new UM(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new UM(`Header name ${e} can only be set using the apiClient field`);n.append(e,t)}}return n}async function qM(e,t,n,r,i,s={},a=fetch){const{url:o,fetchOptions:c}=await async function(e,t,n,r,i,s){const a=new zM(e,t,n,r,s);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},WM(s)),{method:"POST",headers:await BM(a),body:i})}}(e,t,n,r,i,s);return async function(e,t,n=fetch){let r;try{r=await n(e,t)}catch(t){!function(e,t){let n=e;"AbortError"===n.name?(n=new MM(`Request aborted when fetching ${t.toString()}: ${e.message}`),n.stack=e.stack):e instanceof DM||e instanceof UM||(n=new $M(`Error fetching from ${t.toString()}: ${e.message}`),n.stack=e.stack);throw n}(t,e)}r.ok||await async function(e,t){let n,r="";try{const t=await e.json();r=t.error.message,t.error.details&&(r+=` ${JSON.stringify(t.error.details)}`,n=t.error.details)}catch(e){}throw new DM(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${r}`,e.status,e.statusText,n)}(r,e);return r}(o,c,a)}function WM(e){const t={};if(void 0!==(null==e?void 0:e.signal)||(null==e?void 0:e.timeout)>=0){const n=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>n.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HM(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),VM(e.candidates[0]))throw new LM(`${ZM(e)}`,e);return function(e){var t,n,r,i;const s=[];if(null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)for(const t of null===(i=null===(r=e.candidates)||void 0===r?void 0:r[0].content)||void 0===i?void 0:i.parts)t.text&&s.push(t.text),t.executableCode&&s.push("\n```"+t.executableCode.language+"\n"+t.executableCode.code+"\n```\n"),t.codeExecutionResult&&s.push("\n```\n"+t.codeExecutionResult.output+"\n```\n");return s.length>0?s.join(""):""}(e)}if(e.promptFeedback)throw new LM(`Text not available. ${ZM(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),VM(e.candidates[0]))throw new LM(`${ZM(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),KM(e)[0]}if(e.promptFeedback)throw new LM(`Function call not available. ${ZM(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),VM(e.candidates[0]))throw new LM(`${ZM(e)}`,e);return KM(e)}if(e.promptFeedback)throw new LM(`Function call not available. ${ZM(e)}`,e)},e}function KM(e){var t,n,r,i;const s=[];if(null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)for(const t of null===(i=null===(r=e.candidates)||void 0===r?void 0:r[0].content)||void 0===i?void 0:i.parts)t.functionCall&&s.push(t.functionCall);return s.length>0?s:void 0}const GM=[PM.RECITATION,PM.SAFETY,PM.LANGUAGE];function VM(e){return!!e.finishReason&&GM.includes(e.finishReason)}function ZM(e){var t,n,r;let i="";if(e.candidates&&0!==e.candidates.length||!e.promptFeedback){if(null===(r=e.candidates)||void 0===r?void 0:r[0]){const t=e.candidates[0];VM(t)&&(i+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(i+=`: ${t.finishMessage}`))}}else i+="Response was blocked",(null===(t=e.promptFeedback)||void 0===t?void 0:t.blockReason)&&(i+=` due to ${e.promptFeedback.blockReason}`),(null===(n=e.promptFeedback)||void 0===n?void 0:n.blockReasonMessage)&&(i+=`: ${e.promptFeedback.blockReasonMessage}`);return i}function JM(e){return this instanceof JM?(this.v=e,this):new JM(e)}function YM(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(e){i[e]&&(r[e]=function(t){return new Promise(function(n,r){s.push([e,t,n,r])>1||o(e,t)})})}function o(e,t){try{!function(e){e.value instanceof JM?Promise.resolve(e.value.v).then(c,l):u(s[0][2],e)}(i[e](t))}catch(e){u(s[0][3],e)}}function c(e){o("next",e)}function l(e){o("throw",e)}function u(e,t){e(t),s.shift(),s.length&&o(s[0][0],s[0][1])}}"function"==typeof SuppressedError&&SuppressedError;
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const XM=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function QM(e){const t=function(e){const t=e.getReader(),n=new ReadableStream({start(e){let n="";return r();function r(){return t.read().then(({value:t,done:i})=>{if(i)return n.trim()?void e.error(new $M("Failed to parse stream")):void e.close();n+=t;let s,a=n.match(XM);for(;a;){try{s=JSON.parse(a[1])}catch(t){return void e.error(new $M(`Error parsing JSON response: "${a[1]}"`))}e.enqueue(s),n=n.substring(a[0].length),a=n.match(XM)}return r()}).catch(e=>{let t=e;throw t.stack=e.stack,t="AbortError"===t.name?new MM("Request aborted when reading from the stream"):new $M("Error reading from the stream"),t})}}});return n}(e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0}))),[n,r]=t.tee();return{stream:tF(n),response:eF(r)}}async function eF(e){const t=[],n=e.getReader();for(;;){const{done:e,value:r}=await n.read();if(e)return HM(nF(t));t.push(r)}}function tF(e){return YM(this,arguments,function*(){const t=e.getReader();for(;;){const{value:e,done:n}=yield JM(t.read());if(n)break;yield yield JM(HM(e))}})}function nF(e){const t=e[e.length-1],n={promptFeedback:null==t?void 0:t.promptFeedback};for(const t of e){if(t.candidates){let e=0;for(const r of t.candidates)if(n.candidates||(n.candidates=[]),n.candidates[e]||(n.candidates[e]={index:e}),n.candidates[e].citationMetadata=r.citationMetadata,n.candidates[e].groundingMetadata=r.groundingMetadata,n.candidates[e].finishReason=r.finishReason,n.candidates[e].finishMessage=r.finishMessage,n.candidates[e].safetyRatings=r.safetyRatings,r.content&&r.content.parts){n.candidates[e].content||(n.candidates[e].content={role:r.content.role||"user",parts:[]});const t={};for(const i of r.content.parts)i.text&&(t.text=i.text),i.functionCall&&(t.functionCall=i.functionCall),i.executableCode&&(t.executableCode=i.executableCode),i.codeExecutionResult&&(t.codeExecutionResult=i.codeExecutionResult),0===Object.keys(t).length&&(t.text=""),n.candidates[e].content.parts.push(t)}e++}t.usageMetadata&&(n.usageMetadata=t.usageMetadata)}return n}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rF(e,t,n,r){return QM(await qM(t,FM.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),r))}async function iF(e,t,n,r){const i=await qM(t,FM.GENERATE_CONTENT,e,!1,JSON.stringify(n),r);return{response:HM(await i.json())}}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sF(e){if(null!=e)return"string"==typeof e?{role:"system",parts:[{text:e}]}:e.text?{role:"system",parts:[e]}:e.parts?e.role?e:{role:"system",parts:e.parts}:void 0}function aF(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(const n of e)"string"==typeof n?t.push({text:n}):t.push(n);return function(e){const t={role:"user",parts:[]},n={role:"function",parts:[]};let r=!1,i=!1;for(const s of e)"functionResponse"in s?(n.parts.push(s),i=!0):(t.parts.push(s),r=!0);if(r&&i)throw new $M("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!i)throw new $M("No content is provided for sending chat message.");if(r)return t;return n}(t)}function oF(e){let t;if(e.contents)t=e;else{t={contents:[aF(e)]}}return e.systemInstruction&&(t.systemInstruction=sF(e.systemInstruction)),t}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const cF=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],lF={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function uF(e){var t;if(void 0===e.candidates||0===e.candidates.length)return!1;const n=null===(t=e.candidates[0])||void 0===t?void 0:t.content;if(void 0===n)return!1;if(void 0===n.parts||0===n.parts.length)return!1;for(const e of n.parts){if(void 0===e||0===Object.keys(e).length)return!1;if(void 0!==e.text&&""===e.text)return!1}return!0}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dF="SILENT_ERROR";class pF{constructor(e,t,n,r={}){this.model=t,this.params=n,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==n?void 0:n.history)&&(!function(e){let t=!1;for(const n of e){const{role:e,parts:r}=n;if(!t&&"user"!==e)throw new $M(`First content should be with role 'user', got ${e}`);if(!AM.includes(e))throw new $M(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(AM)}`);if(!Array.isArray(r))throw new $M("Content should have 'parts' property with an array of Parts");if(0===r.length)throw new $M("Each Content should have at least one part");const i={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const e of r)for(const t of cF)t in e&&(i[t]+=1);const s=lF[e];for(const t of cF)if(!s.includes(t)&&i[t]>0)throw new $M(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,r,i,s,a,o;await this._sendPromise;const c=aF(e),l={safetySettings:null===(n=this.params)||void 0===n?void 0:n.safetySettings,generationConfig:null===(r=this.params)||void 0===r?void 0:r.generationConfig,tools:null===(i=this.params)||void 0===i?void 0:i.tools,toolConfig:null===(s=this.params)||void 0===s?void 0:s.toolConfig,systemInstruction:null===(a=this.params)||void 0===a?void 0:a.systemInstruction,cachedContent:null===(o=this.params)||void 0===o?void 0:o.cachedContent,contents:[...this._history,c]},u=Object.assign(Object.assign({},this._requestOptions),t);let d;return this._sendPromise=this._sendPromise.then(()=>iF(this._apiKey,this.model,l,u)).then(e=>{var t;if(uF(e.response)){this._history.push(c);const n=Object.assign({parts:[],role:"model"},null===(t=e.response.candidates)||void 0===t?void 0:t[0].content);this._history.push(n)}else{const t=ZM(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}d=e}).catch(e=>{throw this._sendPromise=Promise.resolve(),e}),await this._sendPromise,d}async sendMessageStream(e,t={}){var n,r,i,s,a,o;await this._sendPromise;const c=aF(e),l={safetySettings:null===(n=this.params)||void 0===n?void 0:n.safetySettings,generationConfig:null===(r=this.params)||void 0===r?void 0:r.generationConfig,tools:null===(i=this.params)||void 0===i?void 0:i.tools,toolConfig:null===(s=this.params)||void 0===s?void 0:s.toolConfig,systemInstruction:null===(a=this.params)||void 0===a?void 0:a.systemInstruction,cachedContent:null===(o=this.params)||void 0===o?void 0:o.cachedContent,contents:[...this._history,c]},u=Object.assign(Object.assign({},this._requestOptions),t),d=rF(this._apiKey,this.model,l,u);return this._sendPromise=this._sendPromise.then(()=>d).catch(e=>{throw new Error(dF)}).then(e=>e.response).then(e=>{if(uF(e)){this._history.push(c);const t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{const t=ZM(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}}).catch(e=>{e.message!==dF&&console.error(e)}),d}}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class hF{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=sF(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;const r=oF(e),i=Object.assign(Object.assign({},this._requestOptions),t);return iF(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},r),i)}async generateContentStream(e,t={}){var n;const r=oF(e),i=Object.assign(Object.assign({},this._requestOptions),t);return rF(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},r),i)}startChat(e){var t;return new pF(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(t=this.cachedContent)||void 0===t?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const n=function(e,t){var n;let r={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null===(n=null==t?void 0:t.cachedContent)||void 0===n?void 0:n.name,contents:[]};const i=null!=e.generateContentRequest;if(e.contents){if(i)throw new UM("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=e.contents}else if(i)r=Object.assign(Object.assign({},r),e.generateContentRequest);else{const t=aF(e);r.contents=[t]}return{generateContentRequest:r}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),t);return async function(e,t,n,r){return(await qM(t,FM.COUNT_TOKENS,e,!1,JSON.stringify(n),r)).json()}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this.apiKey,this.model,n,r)}async embedContent(e,t={}){const n=function(e){if("string"==typeof e||Array.isArray(e))return{content:aF(e)};return e}(e),r=Object.assign(Object.assign({},this._requestOptions),t);return async function(e,t,n,r){return(await qM(t,FM.EMBED_CONTENT,e,!1,JSON.stringify(n),r)).json()}(this.apiKey,this.model,n,r)}async batchEmbedContents(e,t={}){const n=Object.assign(Object.assign({},this._requestOptions),t);return async function(e,t,n,r){const i=n.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await qM(t,FM.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:i}),r)).json()}(this.apiKey,this.model,e,n)}}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mF{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new $M("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new hF(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new UM("Cached content must contain a `name` field.");if(!e.model)throw new UM("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const n of r)if((null==t?void 0:t[n])&&e[n]&&(null==t?void 0:t[n])!==e[n]){if("model"===n){if((t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue}throw new UM(`Different value for "${n}" specified in modelParams (${t[n]}) and cachedContent (${e[n]})`)}const i=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new hF(this.apiKey,i,n)}}function fF(e){if("object"==typeof e&&null!==e){const t={...e};"additionalProperties"in t&&delete t.additionalProperties,"$schema"in t&&delete t.$schema,"strict"in t&&delete t.strict;for(const e in t)e in t&&(Array.isArray(t[e])?t[e]=t[e].map(fF):"object"==typeof t[e]&&null!==t[e]&&(t[e]=fF(t[e])));return t}return e}function gF(e){const t=fF(lg(e)?tf(e):e),{$schema:n,...r}=t;return r}function yF(e){const t=fF(e),{$schema:n,...r}=t;return r}const vF=[];for(let e=0;e<256;++e)vF.push((e+256).toString(16).slice(1));let bF;const wF=new Uint8Array(16);var _F={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function xF(e,t,n){if(_F.randomUUID&&!e)return _F.randomUUID();const r=(e=e||{}).random??e.rng?.()??function(){if(!bF){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");bF=crypto.getRandomValues.bind(crypto)}return bF(wF)}();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=15&r[6]|64,r[8]=63&r[8]|128,function(e,t=0){return(vF[e[t+0]]+vF[e[t+1]]+vF[e[t+2]]+vF[e[t+3]]+"-"+vF[e[t+4]]+vF[e[t+5]]+"-"+vF[e[t+6]]+vF[e[t+7]]+"-"+vF[e[t+8]]+vF[e[t+9]]+"-"+vF[e[t+10]]+vF[e[t+11]]+vF[e[t+12]]+vF[e[t+13]]+vF[e[t+14]]+vF[e[t+15]]).toLowerCase()}(r)}function EF(e,t,n){if(function(e){return"tool"===e._getType()}(e)){const t=e.name??function(e,t){return t.map(e=>Mo(e)?e.tool_calls??[]:[]).flat().find(t=>t.id===e.tool_call_id)?.name}(e,n);if(void 0===t)throw new Error(`Google requires a tool name for each tool call response, and we could not infer a called tool name for ToolMessage "${e.id}" from your passed messages. Please populate a "name" field on that ToolMessage explicitly.`);return[{functionResponse:{name:t,response:"string"==typeof e.content?{result:e.content}:e.content}}]}let r=[];const i=[];return"string"==typeof e.content&&e.content&&i.push({text:e.content}),Array.isArray(e.content)&&e.content.forEach(e=>{if("text"===e.type)i.push({text:e.text});else if("executableCode"===e.type)i.push({executableCode:e.executableCode});else if("codeExecutionResult"===e.type)i.push({codeExecutionResult:e.codeExecutionResult});else if("image_url"===e.type){if(!t)throw new Error("This model does not support images");let n;if("string"==typeof e.image_url)n=e.image_url;else{if("object"!=typeof e.image_url||!("url"in e.image_url))throw new Error("Please provide image as base64 encoded data URL");n=e.image_url.url}const[r,s]=n.split(",");if(!r.startsWith("data:"))throw new Error("Please provide image as base64 encoded data URL");const[a,o]=r.replace(/^data:/,"").split(";");if("base64"!==o)throw new Error("Please provide image as base64 encoded data URL");i.push({inlineData:{data:s,mimeType:a}})}else if("media"===e.type)i.push(function(e){if("mimeType"in e&&"data"in e)return{inlineData:{mimeType:e.mimeType,data:e.data}};if("mimeType"in e&&"fileUri"in e)return{fileData:{mimeType:e.mimeType,fileUri:e.fileUri}};throw new Error("Invalid media content")}(e));else if("tool_use"===e.type)r.push({functionCall:{name:e.name,args:e.input}});else if(e.type?.includes("/")&&2===e.type.split("/").length&&"data"in e&&"string"==typeof e.data)i.push({inlineData:{mimeType:e.type,data:e.data}});else if(!("functionCall"in e))throw"type"in e?new Error(`Unknown content type ${e.type}`):new Error(`Unknown content ${JSON.stringify(e)}`)}),Mo(e)&&e.tool_calls?.length&&(r=e.tool_calls.map(e=>({functionCall:{name:e.name,args:e.args}}))),[...i,...r]}function SF(e,t,n=!1){return e.reduce((r,i,s)=>{if(!No(i))throw new Error("Unsupported message input");const a=function(e){const t=e._getType();return Bo.isInstance(e)?e.role:"tool"===t?t:e.name??t}(i);if("system"===a&&0!==s)throw new Error("System message should be the first one");const o=function(e){switch(e){case"supervisor":case"ai":case"model":return"model";case"system":return"system";case"human":return"user";case"tool":case"function":return"function";default:throw new Error(`Unknown / unsupported author: ${e}`)}}(a),c=r.content[r.content.length];if(!r.mergeWithPreviousContent&&c&&c.role===o)throw new Error("Google Generative AI requires alternate messages between authors");const l=EF(i,t,e.slice(0,s));if(r.mergeWithPreviousContent){const e=r.content[r.content.length-1];if(!e)throw new Error("There was a problem parsing your system message. Please try a prompt without one.");return e.parts.push(...l),{mergeWithPreviousContent:!1,content:r.content}}let u=o;("function"===u||"system"===u&&!n)&&(u="user");const d={role:u,parts:l};return{mergeWithPreviousContent:"system"===a&&!n,content:[...r.content,d]}},{content:[],mergeWithPreviousContent:!1}).content}function kF(e,t){if(!e.candidates||0===e.candidates.length)return null;const n=e.functionCalls(),[r]=e.candidates,{content:i,...s}=r;let a;i?.parts&&i.parts.every(e=>"text"in e)?a=i.parts.map(e=>e.text).join(""):i.parts&&(a=i.parts.map(e=>"text"in e?{type:"text",text:e.text}:"executableCode"in e?{type:"executableCode",executableCode:e.executableCode}:"codeExecutionResult"in e?{type:"codeExecutionResult",codeExecutionResult:e.codeExecutionResult}:e));let o="";a&&"string"==typeof a?o=a:a&&"object"==typeof a&&"text"in a[0]&&(o=a[0].text);const c=[];return n&&c.push(...n.map(e=>({...e,args:JSON.stringify(e.args),index:t.index,type:"tool_call_chunk",id:"id"in e&&"string"==typeof e.id?e.id:xF()}))),new cm({text:o,message:new zo({content:a||"",name:i?i.role:void 0,tool_call_chunks:c,additional_kwargs:{},usage_metadata:t.usageMetadata}),generationInfo:s})}class AF extends iU{static lc_name(){return"GoogleGenerativeAIToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","google_genai","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(void 0===this.zodSchema)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new aU(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parseResult(e){const t=e.flatMap(e=>{const{message:t}=e;return"tool_calls"in t&&Array.isArray(t.tool_calls)?t.tool_calls:[]});if(void 0===t[0])throw new Error("No parseable tool calls provided to GoogleGenerativeAIToolsOutputParser.");const[n]=t;return await this._validateResult(n.args)}}function OF(e,t){const n=function(e){let t=[];const n=[];e.forEach(e=>{if(gC(e)){const[n]=function(e){return e.every(e=>"functionDeclarations"in e&&Array.isArray(e.functionDeclarations))?e:[{functionDeclarations:e.map(e=>{if(gC(e)){const t=gF(e.schema);return"object"===t.type&&"properties"in t&&0===Object.keys(t.properties).length?{name:e.name,description:e.description}:{name:e.name,description:e.description,parameters:t}}return sg(e)?{name:e.function.name,description:e.function.description??"A function available to call.",parameters:yF(e.function.parameters)}:e})}]}([e]);n.functionDeclarations&&t.push(...n.functionDeclarations)}else if(sg(e)){const{functionDeclarations:n}=function(e){return{functionDeclarations:[{name:e.function.name,description:e.function.description,parameters:fF(e.function.parameters)}]}}(e);if(!n)throw new Error("Failed to convert OpenAI structured tool to GenerativeAI tool");t.push(...n)}else n.push(e)});const r=n.find(e=>"functionDeclarations"in e);if(r)return n.map(e=>{if(t?.length>0&&"functionDeclarations"in e){const n={functionDeclarations:[...e.functionDeclarations||[],...t]};return t=[],n}return e});return[...n,...t.length>0?[{functionDeclarations:t}]:[]]}(e),r=function(e,t){if(!e.length||!t)return;const{toolChoice:n,allowedFunctionNames:r}=t,i={any:jM.ANY,auto:jM.AUTO,none:jM.NONE};if(n&&["any","auto","none"].includes(n))return{functionCallingConfig:{mode:i[n]??"MODE_UNSPECIFIED",allowedFunctionNames:r}};if("string"==typeof n||r)return{functionCallingConfig:{mode:jM.ANY,allowedFunctionNames:[...r??[],...n&&"string"==typeof n?[n]:[]]}};return}(n,t);return{tools:n,toolConfig:r}}class CF extends dg{static lc_name(){return"ChatGoogleGenerativeAI"}get lc_secrets(){return{apiKey:"GOOGLE_API_KEY"}}get lc_aliases(){return{apiKey:"google_api_key"}}get _isMultimodalModel(){return this.model.includes("vision")||this.model.startsWith("gemini-1.5")||this.model.startsWith("gemini-2")}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","google_genai"]}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxOutputTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"safetySettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"convertSystemMessageToHumanContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.model=e.model.replace(/^models\//,""),this.maxOutputTokens=e.maxOutputTokens??this.maxOutputTokens,this.maxOutputTokens&&this.maxOutputTokens<0)throw new Error("`maxOutputTokens` must be a positive integer");if(this.temperature=e.temperature??this.temperature,this.temperature&&(this.temperature<0||this.temperature>2))throw new Error("`temperature` must be in the range of [0.0,2.0]");if(this.topP=e.topP??this.topP,this.topP&&this.topP<0)throw new Error("`topP` must be a positive integer");if(this.topP&&this.topP>1)throw new Error("`topP` must be below 1.");if(this.topK=e.topK??this.topK,this.topK&&this.topK<0)throw new Error("`topK` must be a positive integer");if(this.stopSequences=e.stopSequences??this.stopSequences,this.apiKey=e.apiKey??Pu("GOOGLE_API_KEY"),!this.apiKey)throw new Error("Please set an API key for Google GenerativeAI in the environment variable GOOGLE_API_KEY or in the `apiKey` field of the ChatGoogleGenerativeAI constructor");if(this.safetySettings=e.safetySettings??this.safetySettings,this.safetySettings&&this.safetySettings.length>0){const e=new Set(this.safetySettings.map(e=>e.category));if(e.size!==this.safetySettings.length)throw new Error("The categories in `safetySettings` array must be unique")}this.streaming=e.streaming??this.streaming,this.json=e.json,this.client=new mF(this.apiKey).getGenerativeModel({model:this.model,safetySettings:this.safetySettings,generationConfig:{stopSequences:this.stopSequences,maxOutputTokens:this.maxOutputTokens,temperature:this.temperature,topP:this.topP,topK:this.topK,...this.json?{responseMimeType:"application/json"}:{}}},{apiVersion:e.apiVersion,baseUrl:e.baseUrl}),this.streamUsage=e.streamUsage??this.streamUsage}useCachedContent(e,t,n){this.apiKey&&(this.client=new mF(this.apiKey).getGenerativeModelFromCachedContent(e,t,n))}get useSystemInstruction(){return"boolean"==typeof this.convertSystemMessageToHumanContent?!this.convertSystemMessageToHumanContent:this.computeUseSystemInstruction}get computeUseSystemInstruction(){return"gemini-1.0-pro-001"!==this.model&&(!this.model.startsWith("gemini-pro-vision")&&(!this.model.startsWith("gemini-1.0-pro-vision")&&"gemini-pro"!==this.model))}getLsParams(e){return{ls_provider:"google_genai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:this.client.generationConfig.temperature,ls_max_tokens:this.client.generationConfig.maxOutputTokens,ls_stop:e.stop}}_combineLLMOutput(){return[]}_llmType(){return"googlegenerativeai"}bindTools(e,t){return this.bind({tools:OF(e)?.tools,...t})}invocationParams(e){const t=e?.tools?.length?OF(e.tools,{toolChoice:e.tool_choice,allowedFunctionNames:e.allowedFunctionNames}):void 0;return e?.responseSchema?(this.client.generationConfig.responseSchema=e.responseSchema,this.client.generationConfig.responseMimeType="application/json"):(this.client.generationConfig.responseSchema=void 0,this.client.generationConfig.responseMimeType=this.json?"application/json":void 0),{...t?.tools?{tools:t.tools}:{},...t?.toolConfig?{toolConfig:t.toolConfig}:{}}}async _generate(e,t,n){const r=SF(e,this._isMultimodalModel,this.useSystemInstruction);let i=r;if("system"===r[0].role){const[e]=r;this.client.systemInstruction=e,i=r.slice(1)}const s=this.invocationParams(t);if(this.streaming){const r={},i=this._streamResponseChunks(e,t,n),s={};for await(const e of i){const t=e.generationInfo?.completion??0;void 0===s[t]?s[t]=e:s[t]=s[t].concat(e)}const a=Object.entries(s).sort(([e],[t])=>parseInt(e,10)-parseInt(t,10)).map(([e,t])=>t);return{generations:a,llmOutput:{estimatedTokenUsage:r}}}const a=await this.completionWithRetry({...s,contents:i});let o;if("usageMetadata"in a.response){const e=a.response.usageMetadata;o={input_tokens:e.promptTokenCount??0,output_tokens:e.candidatesTokenCount??0,total_tokens:e.totalTokenCount??0}}const c=function(e,t){if(!e.candidates||0===e.candidates.length||!e.candidates[0])return{generations:[],llmOutput:{filters:e.promptFeedback}};const n=e.functionCalls(),[r]=e.candidates,{content:i,...s}=r;let a;a=1===i?.parts.length&&i.parts[0].text?i.parts[0].text:i.parts.map(e=>"text"in e?{type:"text",text:e.text}:"executableCode"in e?{type:"executableCode",executableCode:e.executableCode}:"codeExecutionResult"in e?{type:"codeExecutionResult",codeExecutionResult:e.codeExecutionResult}:e);let o="";return"string"==typeof a?o=a:"text"in a[0]&&(o=a[0].text),{generations:[{text:o,message:new Uo({content:a,tool_calls:n?.map(e=>({...e,type:"tool_call",id:"id"in e&&"string"==typeof e.id?e.id:xF()})),additional_kwargs:{...s},usage_metadata:t?.usageMetadata}),generationInfo:s}],llmOutput:{tokenUsage:{promptTokens:t?.usageMetadata?.input_tokens,completionTokens:t?.usageMetadata?.output_tokens,totalTokens:t?.usageMetadata?.total_tokens}}}}(a.response,{usageMetadata:o});return await(n?.handleLLMNewToken(c.generations[0].text??"")),c}async*_streamResponseChunks(e,t,n){const r=SF(e,this._isMultimodalModel,this.useSystemInstruction);let i=r;if("system"===r[0].role){const[e]=r;this.client.systemInstruction=e,i=r.slice(1)}const s={...this.invocationParams(t),contents:i},a=await this.caller.callWithOptions({signal:t?.signal},async()=>{const{stream:e}=await this.client.generateContentStream(s);return e});let o,c=0;for await(const e of a){if("usageMetadata"in e&&!1!==this.streamUsage&&!1!==t.streamUsage){const t=e.usageMetadata;if(o){const e=(t.candidatesTokenCount??0)-o.output_tokens;o={input_tokens:0,output_tokens:e,total_tokens:e}}else o={input_tokens:t.promptTokenCount??0,output_tokens:t.candidatesTokenCount??0,total_tokens:t.totalTokenCount??0}}const r=kF(e,{usageMetadata:o,index:c});c+=1,r&&(yield r,await(n?.handleLLMNewToken(r.text??"")))}}async completionWithRetry(e,t){return this.caller.callWithOptions({signal:t?.signal},async()=>{try{return await this.client.generateContent(e)}catch(e){throw e.message?.includes("400 Bad Request")&&(e.status=400),e}})}withStructuredOutput(e,t){const n=e,r=t?.name,i=t?.method,s=t?.includeRaw;if("jsonMode"===i)throw new Error('ChatGoogleGenerativeAI only supports "jsonSchema" or "functionCalling" as a method.');let a,o;if("functionCalling"===i){let e,t=r??"extract";if(lg(n)){const r=gF(n);e=[{functionDeclarations:[{name:t,description:r.description??"A function available to call.",parameters:r}]}],o=new AF({returnSingle:!0,keyName:t,zodSchema:n})}else{let r;"string"==typeof n.name&&"object"==typeof n.parameters&&null!=n.parameters?(r=n,r.parameters=fF(n.parameters),t=n.name):r={name:t,description:n.description??"",parameters:fF(n)},e=[{functionDeclarations:[r]}],o=new AF({returnSingle:!0,keyName:t})}a=this.bind({tools:e,tool_choice:t})}else{const e=gF(n);a=this.bind({responseSchema:e}),o=new uU}if(!s)return a.pipe(o).withConfig({runName:"ChatGoogleGenerativeAIStructuredOutput"});const c=cg.assign({parsed:(e,t)=>o.invoke(e.raw,t)}),l=cg.assign({parsed:()=>null}),u=c.withFallbacks({fallbacks:[l]});return wf.from([{raw:a},u]).withConfig({runName:"StructuredOutputRunnable"})}}class IF extends ET{constructor(e){if(super(e??{}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"embedding-001"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"embedding-001"}),Object.defineProperty(this,"taskType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"title",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxBatchSize",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.modelName=e?.model?.replace(/^models\//,"")??e?.modelName?.replace(/^models\//,"")??this.modelName,this.model=this.modelName,this.taskType=e?.taskType??this.taskType,this.title=e?.title??this.title,this.title&&"RETRIEVAL_DOCUMENT"!==this.taskType)throw new Error("title can only be sepcified with TaskType.RETRIEVAL_DOCUMENT");if(this.apiKey=e?.apiKey??Pu("GOOGLE_API_KEY"),!this.apiKey)throw new Error("Please set an API key for Google GenerativeAI in the environmentb variable GOOGLE_API_KEY or in the `apiKey` field of the GoogleGenerativeAIEmbeddings constructor");this.client=new mF(this.apiKey).getGenerativeModel({model:this.model})}_convertToContent(e){return{content:{role:"user",parts:[{text:this.stripNewLines?e.replace(/\n/g," "):e}]},taskType:this.taskType,title:this.title}}async _embedQueryContent(e){const t=this._convertToContent(e);return(await this.client.embedContent(t)).embedding.values??[]}async _embedDocumentsContent(e){const t=hM(e,this.maxBatchSize),n=t.map(e=>({requests:e.map(e=>this._convertToContent(e))})),r=(await Promise.allSettled(n.map(e=>this.client.batchEmbedContents(e)))).flatMap((e,n)=>"fulfilled"===e.status?e.value.embeddings.map(e=>e.values||[]):Array(t[n].length).fill([]));return r}embedQuery(e){return this.caller.call(this._embedQueryContent.bind(this),e)}embedDocuments(e){return this.caller.call(this._embedDocumentsContent.bind(this),e)}}const TF=e=>({GOOGLEGENAI_API_KEY:(e?.env||process.env).GOOGLEGENAI_API_KEY});async function*PF({context:e,model:t="gemini-pro",system:n="You are a helpful assistant. Never explain what you do, just provide the requested response.",message:r="",prev:i=[],temperature:s=.7,json_mode:a=!1,response_schema:o,stream:c=!1,tools:l=[]},u=!1,d=!1){const{GOOGLEGENAI_API_KEY:p}=TF(e);let h=new CF({model:t,maxOutputTokens:2048,apiKey:p,temperature:s,streaming:c});const m={};if(l&&l.length>0){const e=function(e){const t=[];for(const n of e)void 0!==n.google_search&&t.push({google_search:{}}),void 0!==n.code_execution&&t.push({code_execution:{}}),n.functionDeclarations&&n.functionDeclarations.length>0&&t.push({functionDeclarations:n.functionDeclarations});return t}(l);e.length>0&&(m.tools=e)}a&&(m.responseMimeType="application/json",o&&(m.responseSchema=function(e){function t(e){if("object"===e.type){const n={type:"object",properties:{}};if(e.properties)for(const[r,i]of Object.entries(e.properties))n.properties[r]=t(i);return e.required&&(n.required=e.required),n}return"array"===e.type?{type:"array",items:e.items?t(e.items):{type:"string"}}:{type:e.type,description:e.description}}return t(e.parameters||e)}(o))),Object.keys(m).length>0&&(h=h.bind(m));const f=[{role:"system",content:n},...i,{role:"user",content:r}],g=LR(f).filter(Boolean);if(d)return void(yield g);if(c){const e=await h.stream(g);for await(const t of e)yield t;return}const y=await h.invoke(g);if(a)try{const e=JSON.parse(y.content);yield e}catch(e){yield y.content}else l&&l.length>0?yield{...y,content:y.content,enhanced_metadata:{response_metadata:y.response_metadata||{},usage_metadata:y.usage_metadata||{},tool_calls:y.tool_calls||[]}}:yield y.content}const RF=async({context:e,model:t="text-embedding-004",message:n})=>{const{GOOGLEGENAI_API_KEY:r}=TF(e),i=new IF({apiKey:r,taskType:RM.RETRIEVAL_DOCUMENT,model:t});return Array.isArray(n)?await i.embedDocuments(n):await i.embedQuery(n)},jF=async()=>{throw new Error("GoogleGenAI: generateWithImage is not supported in this provider.")},NF=async()=>{throw new Error("GoogleGenAI: llm is not supported in this provider.")},$F=async()=>{throw new Error("GoogleGenAI: textToSpeech is not supported in this provider.")};var LF={generate:PF,embedding:RF,generateWithImage:jF,llm:NF,textToSpeech:$F};const DF={bedrock:HR,openai:kM,google:Object.freeze({__proto__:null,default:LF,embedding:RF,generate:PF,generateWithImage:jF,llm:NF,textToSpeech:$F})},UF=async(e,t,...n)=>t.stream?DF[e].generate({...t,stream:!0},...n):DF[e].generate(t,...n),MF=async(e,t,...n)=>DF[e].generate(t,...n),FF=async(e,t,n)=>{const r={...t,context:n};if(!0===t.stream)return await UF(e,{...r,stream:!0});{const n=await UF(e,{...r,stream:!1});let i=null,s="";for await(const e of n)if(i=e,e&&"object"==typeof e&&!Array.isArray(e)){const t=e.kwargs;t&&"string"==typeof t.content&&(s+=t.content)}else"string"==typeof e&&(s+=e);return t.tools&&t.tools.length>0&&i?BF(i):s||i}},zF=async(e,t,n)=>{const r={...t,context:n};if(!0===t.stream)return await MF(e,{...r,stream:!0});{const n=await MF(e,{...r,stream:!1});let i=null;for await(const e of n)i=e;if(t.tools&&t.tools.length>0&&i)return BF(i);if(i&&"object"==typeof i&&!Array.isArray(i)){if(i.content)return i.content;const e=i.kwargs;if(e&&"string"==typeof e.content)return e.content}return i}};function BF(e){const t=e.content||e.kwargs?.content||"",n=e.additional_kwargs?.groundingMetadata||e.kwargs?.additional_kwargs?.groundingMetadata||e.response_metadata?.groundingMetadata,r=e.toolCalls||[],i=e.usage_metadata||e.kwargs?.usage_metadata||e.response_metadata?.tokenUsage||e.metadata?.usage,s={content:t,metadata:{finishReason:e.additional_kwargs?.finishReason||e.kwargs?.additional_kwargs?.finishReason||e.response_metadata?.finishReason||e.metadata?.finishReason||"STOP",usage:{inputTokens:i?.input_tokens||i?.promptTokens||0,outputTokens:i?.output_tokens||i?.completionTokens||0,totalTokens:i?.total_tokens||i?.totalTokens||0}}};n&&(s.groundingMetadata={webSearchQueries:n.webSearchQueries||[],searchEntryPoint:n.searchEntryPoint||null,groundingChunks:n.groundingChunks||[],groundingSupports:n.groundingSupports||[]}),r&&r.length>0&&(s.toolCalls=r.map(e=>({type:e.type,name:e.name,id:e.id,args:e.args||e.input})));const a=function(e){const t=[],n=e.candidates||e.kwargs?.candidates||e.additional_kwargs?.candidates||[];for(const e of n)if(e.content&&e.content.parts)for(const n of e.content.parts)if(n.executable_code||n.code_execution_result){const e={};n.executable_code&&(e.executable_code={language:n.executable_code.language||"PYTHON",code:n.executable_code.code||""}),n.code_execution_result&&(e.code_execution_result={outcome:n.code_execution_result.outcome||"OUTCOME_UNKNOWN",output:n.code_execution_result.output||""}),n.text&&(e.text=n.text),t.push(e)}return t}(e);return a.length>0&&(s.codeExecution=a),s}const qF=async(e,t,n)=>{const r={...t,context:n};return await(async(e,t,...n)=>DF[e].generateWithImage(t,...n))(e,r)},WF=async(e,t,n)=>{const r={...t,context:n};return await(async(e,t)=>DF[e].embedding(t))(e,r)},HF=async(e,t,n)=>{const r={...t,context:n};return await(async(e,t,...n)=>DF[e].llm(t,...n))(e,r)},KF=async(e,t,n)=>{const r={...t,context:n};return await(async(e,t)=>DF[e].textToSpeech(t))(e,r)},GF=e=>{const t=["bedrock","openai","google"];if(!t.includes(e))throw new Error(`Unsupported provider: ${e}. Valid providers are: ${t.join(", ")}`);return!0},VF=(e,t)=>({env:{OPENAI_API_KEY:process.env.OPENAI_API_KEY||e?.env?.OPENAI_API_KEY,GOOGLEGENAI_API_KEY:process.env.GOOGLEGENAI_API_KEY||e?.env?.GOOGLEGENAI_API_KEY,AWS_ACCESS_KEY_ID:process.env.AWS_ACCESS_KEY_ID||e?.env?.AWS_ACCESS_KEY_ID,AWS_SECRET_ACCESS_KEY:process.env.AWS_SECRET_ACCESS_KEY||e?.env?.AWS_SECRET_ACCESS_KEY,AWS_REGION:process.env.AWS_REGION||e?.env?.AWS_REGION,...t}});const ZF=[{name:"scripts-hook",config:({filter:e,action:t,schedule:n},r)=>{n("*/20 * * * * *",async()=>{console.log("Running scheduled task every segundos")})}}],JF=[{name:"scripts",config:(e,t)=>{e.get("/status",async(e,t)=>{const n=await Xa.getStatus(),r={openai:!!process.env.OPENAI_API_KEY,google:!!process.env.GOOGLEGENAI_API_KEY,aws:!!process.env.AWS_ACCESS_KEY_ID};t.json({status:"Script Composer is running",version:Qa,providers:r,vectordb:n})}),e.get("/hello",async(e,t)=>{t.json({status:"hello"})}),e.post("/instruction",async(e,n)=>{try{const r="google",{instruction:i}=e.body;if(!i)return n.status(400).json({error:"Instruction is required"});const s={model:"gemini-2.5-flash",message:`busca 5 oportunidades de empleo concretas en Chile (con un link y un ficha) que calcen bien con el siguiente perfil que escribi un usuario: ${i}`,stream:!1,tools:[{google_search:{}}]};GF(r);const a=VF(t),o=await zF(r,s,a),c={model:"gemini-2.5-flash",message:`dale estructura al siguiente resultado: ${JSON.stringify(o)}`,stream:!1,json_mode:!0,response_schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"OportunidadesLaboralesTerceraEdad",type:"object",properties:{oportunidades:{type:"array",description:"Lista de oportunidades laborales relevantes para adultos mayores o jubilados.",items:{type:"object",properties:{titulo:{type:"string",description:"Nombre o ttulo del puesto de trabajo."},descripcion:{type:"string",description:"Descripcin detallada de la oportunidad laboral."},perfil_requerido:{type:"string",description:"Requisitos o perfil buscado para la posicin."},horario:{type:"string",description:"Horario de trabajo especificado para la oferta."},ubicacion:{type:"string",description:"Ciudad o regin donde se ofrece el empleo."},link:{type:"string",format:"uri",description:"Enlace a la fuente o pgina donde se encuentra la oferta de empleo."}},required:["titulo","descripcion","perfil_requerido","horario","ubicacion","link"],additionalProperties:!1},minItems:1}},required:["oportunidades"],additionalProperties:!1}},l=await FF(r,c,a);n.json({result:l})}catch(e){n.status(400).json({error:e.message})}})}},{name:"generations",config:(e,t)=>{const n=e=>{const t=e.params.provider,{env:n,...r}=e.body||{};return{provider:t,args:r,customEnv:n}};e.post("/:provider/generate",async(e,r)=>{try{const{provider:i,args:s,customEnv:a}=n(e);GF(i);const o=VF(t,a);if(!0===s.stream){r.setHeader("Content-Type","text/event-stream"),r.setHeader("Cache-Control","no-cache"),r.setHeader("Connection","keep-alive"),r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Headers","Cache-Control"),r.flushHeaders();const e=await FF(i,s,o);if(e&&"function"==typeof e[Symbol.asyncIterator])for await(const t of e)r.write(`data: ${JSON.stringify(t)}\n\n`);else r.write(`data: ${JSON.stringify(e)}\n\n`);r.end()}else{const e=await FF(i,s,o);r.json({result:e})}}catch(e){r.status(400).json({error:e.message})}}),e.post("/:provider/generateWithImage",async(e,r)=>{try{const{provider:i,args:s,customEnv:a}=n(e);GF(i);const o=VF(t,a),c=await qF(i,s,o);r.json({result:c})}catch(e){r.status(400).json({error:e.message})}}),e.post("/:provider/generateWithTools",async(e,r)=>{try{const{provider:i,args:s,customEnv:a}=n(e);GF(i);const o=VF(t,a);if(!0===s.stream){r.setHeader("Content-Type","text/event-stream"),r.setHeader("Cache-Control","no-cache"),r.setHeader("Connection","keep-alive"),r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Headers","Cache-Control"),r.flushHeaders();const e=await zF(i,s,o);if(e&&"function"==typeof e[Symbol.asyncIterator])for await(const t of e)r.write(`data: ${JSON.stringify(t)}\n\n`);else r.write(`data: ${JSON.stringify(e)}\n\n`);r.end()}else{const e=await zF(i,s,o);r.json({result:e})}}catch(e){r.status(400).json({error:e.message})}}),e.post("/:provider/embedding",async(e,r)=>{try{const{provider:i,args:s,customEnv:a}=n(e);GF(i);const o=VF(t,a),c=await WF(i,s,o);r.json({result:c})}catch(e){r.status(400).json({error:e.message})}}),e.post("/:provider/llm",async(e,r)=>{try{const{provider:i,args:s,customEnv:a}=n(e);GF(i);const o=VF(t,a),c=await HF(i,s,o);r.json({result:c})}catch(e){r.status(400).json({error:e.message})}}),e.post("/:provider/textToSpeech",async(e,r)=>{try{const{provider:i,args:s,customEnv:a}=n(e);GF(i);const o=VF(t,a),c=await KF(i,s,o);r.json({result:c})}catch(e){r.status(400).json({error:e.message})}}),e.get("/providers",(e,t)=>{t.json({providers:["bedrock","openai","google"],capabilities:{bedrock:["generate","generateWithImage","embedding","llm","textToSpeech"],openai:["generate","generateWithImage","embedding","llm","textToSpeech"],google:["generate","generateWithImage","generateWithTools","embedding","llm","textToSpeech","google_search","code_execution"]},endpoints:["POST /:provider/generate","POST /:provider/generateWithImage","POST /:provider/generateWithTools","POST /:provider/embedding","POST /:provider/llm","POST /:provider/textToSpeech","GET /providers"]})})}}],YF=[];function XF(e){return new Promise((t,n)=>{const r=h({method:"GET",...e,hostname:e.hostname?.replace(/^\[(.+)\]$/,"$1")});r.on("error",e=>{n(Object.assign(new hb("Unable to connect to instance metadata service"),e)),r.destroy()}),r.on("timeout",()=>{n(new hb("TimeoutError from instance metadata service")),r.destroy()}),r.on("response",e=>{const{statusCode:i=400}=e;(i<200||300<=i)&&(n(Object.assign(new hb("Error response received from instance metadata service"),{statusCode:i})),r.destroy());const s=[];e.on("data",e=>{s.push(e)}),e.on("end",()=>{t($.concat(s)),r.destroy()})}),r.end()})}const QF=e=>Boolean(e)&&"object"==typeof e&&"string"==typeof e.AccessKeyId&&"string"==typeof e.SecretAccessKey&&"string"==typeof e.Token&&"string"==typeof e.Expiration,ez=e=>({accessKeyId:e.AccessKeyId,secretAccessKey:e.SecretAccessKey,sessionToken:e.Token,expiration:new Date(e.Expiration),...e.AccountId&&{accountId:e.AccountId}}),tz=({maxRetries:e=0,timeout:t=1e3})=>({maxRetries:e,timeout:t}),nz=(e,t)=>{let n=e();for(let r=0;r<t;r++)n=n.catch(e);return n},rz="AWS_CONTAINER_CREDENTIALS_FULL_URI",iz="AWS_CONTAINER_CREDENTIALS_RELATIVE_URI",sz="AWS_CONTAINER_AUTHORIZATION_TOKEN",az=async(e,t)=>{process.env[sz]&&(t.headers={...t.headers,Authorization:process.env[sz]});return(await XF({...t,timeout:e})).toString()},oz={localhost:!0,"127.0.0.1":!0},cz={"http:":!0,"https:":!0},lz=async({logger:e})=>{if(process.env[iz])return{hostname:"169.254.170.2",path:process.env[iz]};if(process.env[rz]){const t=v(process.env[rz]);if(!t.hostname||!(t.hostname in oz))throw new mb(`${t.hostname} is not a valid container metadata service hostname`,{tryNextLink:!1,logger:e});if(!t.protocol||!(t.protocol in cz))throw new mb(`${t.protocol} is not a valid container metadata service protocol`,{tryNextLink:!1,logger:e});return{...t,port:t.port?parseInt(t.port,10):void 0}}throw new mb(`The container metadata credential provider cannot be used unless the ${iz} or ${rz} environment variable is set`,{tryNextLink:!1,logger:e})};class uz extends mb{constructor(e,t=!0){super(e,t),this.tryNextLink=t,this.name="InstanceMetadataV1FallbackError",Object.setPrototypeOf(this,uz.prototype)}}var dz;!function(e){e.IPv4="http://169.254.169.254",e.IPv6="http://[fd00:ec2::254]"}(dz||(dz={}));const pz={environmentVariableSelector:e=>e.AWS_EC2_METADATA_SERVICE_ENDPOINT,configFileSelector:e=>e.ec2_metadata_service_endpoint,default:void 0};var hz;!function(e){e.IPv4="IPv4",e.IPv6="IPv6"}(hz||(hz={}));const mz={environmentVariableSelector:e=>e.AWS_EC2_METADATA_SERVICE_ENDPOINT_MODE,configFileSelector:e=>e.ec2_metadata_service_endpoint_mode,default:hz.IPv4},fz=async()=>tE(await gz()||await yz()),gz=async()=>Yx(pz)(),yz=async()=>{const e=await Yx(mz)();switch(e){case hz.IPv4:return dz.IPv4;case hz.IPv6:return dz.IPv6;default:throw new Error(`Unsupported endpoint mode: ${e}. Select from ${Object.values(hz)}`)}},vz=(e,t)=>{const n=300+Math.floor(300*Math.random()),r=new Date(Date.now()+1e3*n);t.warn(`Attempting credential expiration extension due to a credential service availability issue. A refresh of these credentials will be attempted after ${new Date(r)}.\nFor more information, please visit: https://docs.aws.amazon.com/sdkref/latest/guide/feature-static-credentials.html`);const i=e.originalExpiration??e.expiration;return{...e,...i?{originalExpiration:i}:{},expiration:r}},bz="/latest/meta-data/iam/security-credentials/",wz="AWS_EC2_METADATA_V1_DISABLED",_z="ec2_metadata_v1_disabled",xz="x-aws-ec2-metadata-token",Ez=(e={})=>{let t=!1;const{logger:n,profile:r}=e,{timeout:i,maxRetries:s}=tz(e),a=async(n,i)=>{if(t||null==i.headers?.[xz]){let t=!1,n=!1;const i=await Yx({environmentVariableSelector:t=>{const r=t[wz];if(n=!!r&&"false"!==r,void 0===r)throw new mb(`${wz} not set in env, checking config file next.`,{logger:e.logger});return n},configFileSelector:e=>{const n=e[_z];return t=!!n&&"false"!==n,t},default:!1},{profile:r})();if(e.ec2MetadataV1Disabled||i){const r=[];throw e.ec2MetadataV1Disabled&&r.push("credential provider initialization (runtime option ec2MetadataV1Disabled)"),t&&r.push(`config file profile (${_z})`),n&&r.push(`process environment variable (${wz})`),new uz(`AWS EC2 Metadata v1 fallback has been blocked by AWS SDK configuration in the following: [${r.join(", ")}].`)}}const s=(await nz(async()=>{let e;try{e=await kz(i)}catch(e){throw 401===e.statusCode&&(t=!1),e}return e},n)).trim();return nz(async()=>{let n;try{n=await Az(s,i,e)}catch(e){throw 401===e.statusCode&&(t=!1),e}return n},n)};return async()=>{const e=await fz();if(t)return n?.debug("AWS SDK Instance Metadata","using v1 fallback (no token fetch)"),a(s,{...e,timeout:i});{let r;try{r=(await Sz({...e,timeout:i})).toString()}catch(r){if(400===r?.statusCode)throw Object.assign(r,{message:"EC2 Metadata token request returned error"});return("TimeoutError"===r.message||[403,404,405].includes(r.statusCode))&&(t=!0),n?.debug("AWS SDK Instance Metadata","using v1 fallback (initial)"),a(s,{...e,timeout:i})}return a(s,{...e,headers:{[xz]:r},timeout:i})}}},Sz=async e=>XF({...e,path:"/latest/api/token",method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"21600"}}),kz=async e=>(await XF({...e,path:bz})).toString(),Az=async(e,t,n)=>{const r=JSON.parse((await XF({...t,path:bz+e})).toString());if(!QF(r))throw new mb("Invalid response received from instance metadata service.",{logger:n.logger});return ez(r)};var Oz=Object.freeze({__proto__:null,DEFAULT_MAX_RETRIES:0,DEFAULT_TIMEOUT:1e3,ENV_CMDS_AUTH_TOKEN:sz,ENV_CMDS_FULL_URI:rz,ENV_CMDS_RELATIVE_URI:iz,get Endpoint(){return dz},fromContainerMetadata:(e={})=>{const{timeout:t,maxRetries:n}=tz(e);return()=>nz(async()=>{const n=await lz({logger:e.logger}),r=JSON.parse(await az(t,n));if(!QF(r))throw new mb("Invalid response received from instance metadata service.",{logger:e.logger});return ez(r)},n)},fromInstanceMetadata:(e={})=>((e,t={})=>{const n=t?.logger||console;let r;return async()=>{let t;try{t=await e(),t.expiration&&t.expiration.getTime()<Date.now()&&(t=vz(t,n))}catch(e){if(!r)throw e;n.warn("Credential renew failed: ",e),t=vz(r,n)}return r=t,t}})(Ez(e),{logger:e.logger}),getInstanceMetadataEndpoint:fz,httpRequest:XF,providerConfigFromInit:tz});var Cz=Object.freeze({__proto__:null,fromHttp:(e={})=>{let t;e.logger?.debug("@aws-sdk/credential-provider-http - fromHttp");const n=e.awsContainerCredentialsRelativeUri??process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI,r=e.awsContainerCredentialsFullUri??process.env.AWS_CONTAINER_CREDENTIALS_FULL_URI,i=e.awsContainerAuthorizationToken??process.env.AWS_CONTAINER_AUTHORIZATION_TOKEN,s=e.awsContainerAuthorizationTokenFile??process.env.AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE,a="NoOpLogger"!==e.logger?.constructor?.name&&e.logger?e.logger.warn:console.warn;if(n&&r&&(a("@aws-sdk/credential-provider-http: you have set both awsContainerCredentialsRelativeUri and awsContainerCredentialsFullUri."),a("awsContainerCredentialsFullUri will take precedence.")),i&&s&&(a("@aws-sdk/credential-provider-http: you have set both awsContainerAuthorizationToken and awsContainerAuthorizationTokenFile."),a("awsContainerAuthorizationToken will take precedence.")),r)t=r;else{if(!n)throw new mb("No HTTP credential provider host provided.\nSet AWS_CONTAINER_CREDENTIALS_FULL_URI or AWS_CONTAINER_CREDENTIALS_RELATIVE_URI.",{logger:e.logger});t=`http://169.254.170.2${n}`}const o=new URL(t);((e,t)=>{if("https:"!==e.protocol&&"169.254.170.2"!==e.hostname&&"169.254.170.23"!==e.hostname&&"[fd00:ec2::23]"!==e.hostname){if(e.hostname.includes("[")){if("[::1]"===e.hostname||"[0000:0000:0000:0000:0000:0000:0000:0001]"===e.hostname)return}else{if("localhost"===e.hostname)return;const t=e.hostname.split("."),n=e=>{const t=parseInt(e,10);return 0<=t&&t<=255};if("127"===t[0]&&n(t[1])&&n(t[2])&&n(t[3])&&4===t.length)return}throw new mb("URL not accepted. It must either be HTTPS or match one of the following:\n  - loopback CIDR 127.0.0.0/8 or [::1/128]\n  - ECS container host 169.254.170.2\n  - EKS container host 169.254.170.23 or [fd00:ec2::23]",{logger:t})}})(o,e.logger);const c=new dy({requestTimeout:e.timeout??1e3,connectionTimeout:e.timeout??1e3});return l=async()=>{const t=function(e){return new xg({protocol:e.protocol,hostname:e.hostname,port:Number(e.port),path:e.pathname,query:Array.from(e.searchParams.entries()).reduce((e,[t,n])=>(e[t]=n,e),{}),fragment:e.hash})}(o);i?t.headers.Authorization=i:s&&(t.headers.Authorization=(await M.readFile(s)).toString());try{return async function(e,t){const n=Oy(e.body),r=await n.transformToString();if(200===e.statusCode){const e=JSON.parse(r);if("string"!=typeof e.AccessKeyId||"string"!=typeof e.SecretAccessKey||"string"!=typeof e.Token||"string"!=typeof e.Expiration)throw new mb("HTTP credential provider response not of the required format, an object matching: { AccessKeyId: string, SecretAccessKey: string, Token: string, Expiration: string(rfc3339) }",{logger:t});return{accessKeyId:e.AccessKeyId,secretAccessKey:e.SecretAccessKey,sessionToken:e.Token,expiration:Xy(e.Expiration)}}if(e.statusCode>=400&&e.statusCode<500){let n={};try{n=JSON.parse(r)}catch(e){}throw Object.assign(new mb(`Server responded with status: ${e.statusCode}`,{logger:t}),{Code:n.Code,Message:n.Message})}throw new mb(`Server responded with status: ${e.statusCode}`,{logger:t})}((await c.handle(t)).response).then(e=>nb(e,"CREDENTIALS_HTTP","z"))}catch(t){throw new mb(String(t),{logger:e.logger})}},u=e.maxRetries??3,d=e.timeout??1e3,async()=>{for(let e=0;e<u;++e)try{return await l()}catch(e){await new Promise(e=>setTimeout(e,d))}return await l()};var l,u,d}});const Iz=e=>e&&("string"==typeof e.sso_start_url||"string"==typeof e.sso_account_id||"string"==typeof e.sso_session||"string"==typeof e.sso_region||"string"==typeof e.sso_role_name),Tz="To refresh this SSO session run 'aws sso login' with the corresponding profile.",Pz=async(e,t,n={})=>{const{CreateTokenCommand:r}=await Promise.resolve().then(function(){return Fq}),i=await(async(e,t={})=>{const{SSOOIDCClient:n}=await Promise.resolve().then(function(){return Fq});return new n(Object.assign({},t.clientConfig??{},{region:e??t.clientConfig?.region,logger:t.clientConfig?.logger??t.parentClientConfig?.logger}))})(t,n);return i.send(new r({clientId:e.clientId,clientSecret:e.clientSecret,refreshToken:e.refreshToken,grantType:"refresh_token"}))},Rz=e=>{if(e.expiration&&e.expiration.getTime()<Date.now())throw new fb(`Token is expired. ${Tz}`,!1)},jz=(e,t,n=!1)=>{if(void 0===t)throw new fb(`Value not present for '${e}' in SSO Token${n?". Cannot refresh":""}. ${Tz}`,!1)},{writeFile:Nz}=w,$z=new Date(0),Lz=(e={})=>async({callerClientConfig:t}={})=>{const n={...e,parentClientConfig:{...t,...e.parentClientConfig}};n.logger?.debug("@aws-sdk/token-providers - fromSso");const r=await Zx(n),i=Tx({profile:n.profile??t?.profile}),s=r[i];if(!s)throw new fb(`Profile '${i}' could not be found in shared credentials file.`,!1);if(!s.sso_session)throw new fb(`Profile '${i}' is missing required property 'sso_session'.`);const a=s.sso_session,o=(await Vx(n))[a];if(!o)throw new fb(`Sso session '${a}' could not be found in shared credentials file.`,!1);for(const e of["sso_start_url","sso_region"])if(!o[e])throw new fb(`Sso session '${a}' is missing required property '${e}'.`,!1);o.sso_start_url;const c=o.sso_region;let l;try{l=await jx(a)}catch(e){throw new fb(`The SSO session token associated with profile=${i} was not found or is invalid. ${Tz}`,!1)}jz("accessToken",l.accessToken),jz("expiresAt",l.expiresAt);const{accessToken:u,expiresAt:d}=l,p={token:u,expiration:new Date(d)};if(p.expiration.getTime()-Date.now()>3e5)return p;if(Date.now()-$z.getTime()<3e4)return Rz(p),p;jz("clientId",l.clientId,!0),jz("clientSecret",l.clientSecret,!0),jz("refreshToken",l.refreshToken,!0);try{$z.setTime(Date.now());const e=await Pz(l,c,n);jz("accessToken",e.accessToken),jz("expiresIn",e.expiresIn);const t=new Date(Date.now()+1e3*e.expiresIn);try{await((e,t)=>{const n=Px(e),r=JSON.stringify(t,null,2);return Nz(n,r)})(a,{...l,accessToken:e.accessToken,expiresAt:t.toISOString(),refreshToken:e.refreshToken})}catch(e){}return{token:e.accessToken,expiration:t}}catch(e){return Rz(p),p}},Dz=!1,Uz=async({ssoStartUrl:e,ssoSession:t,ssoAccountId:n,ssoRegion:r,ssoRoleName:i,ssoClient:s,clientConfig:a,parentClientConfig:o,profile:c,logger:l})=>{let u;const d="To refresh this SSO session run aws sso login with the corresponding profile.";if(t)try{const e=await Lz({profile:c})();u={accessToken:e.token,expiresAt:new Date(e.expiration).toISOString()}}catch(e){throw new mb(e.message,{tryNextLink:Dz,logger:l})}else try{u=await jx(e)}catch(e){throw new mb(`The SSO session associated with this profile is invalid. ${d}`,{tryNextLink:Dz,logger:l})}if(new Date(u.expiresAt).getTime()-Date.now()<=0)throw new mb(`The SSO session associated with this profile has expired. ${d}`,{tryNextLink:Dz,logger:l});const{accessToken:p}=u,{SSOClient:h,GetRoleCredentialsCommand:m}=await Promise.resolve().then(function(){return qW}),f=s||new h(Object.assign({},a??{},{logger:a?.logger??o?.logger,region:a?.region??r}));let g;try{g=await f.send(new m({accountId:n,roleName:i,accessToken:p}))}catch(e){throw new mb(e,{tryNextLink:Dz,logger:l})}const{roleCredentials:{accessKeyId:y,secretAccessKey:v,sessionToken:b,expiration:w,credentialScope:_,accountId:x}={}}=g;if(!(y&&v&&b&&w))throw new mb("SSO returns an invalid temporary credential.",{tryNextLink:Dz,logger:l});const E={accessKeyId:y,secretAccessKey:v,sessionToken:b,expiration:new Date(w),..._&&{credentialScope:_},...x&&{accountId:x}};return t?nb(E,"CREDENTIALS_SSO","s"):nb(E,"CREDENTIALS_SSO_LEGACY","u"),E},Mz=(e,t)=>{const{sso_start_url:n,sso_account_id:r,sso_region:i,sso_role_name:s}=e;if(!(n&&r&&i&&s))throw new mb(`Profile is configured with invalid SSO credentials. Required parameters "sso_account_id", "sso_region", "sso_role_name", "sso_start_url". Got ${Object.keys(e).join(", ")}\nReference: https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sso.html`,{tryNextLink:!1,logger:t});return e};var Fz=Object.freeze({__proto__:null,fromSSO:(e={})=>async({callerClientConfig:t}={})=>{e.logger?.debug("@aws-sdk/credential-provider-sso - fromSSO");const{ssoStartUrl:n,ssoAccountId:r,ssoRegion:i,ssoRoleName:s,ssoSession:a}=e,{ssoClient:o}=e,c=Tx({profile:e.profile??t?.profile});if(n||r||i||s||a){if(n&&r&&i&&s)return Uz({ssoStartUrl:n,ssoSession:a,ssoAccountId:r,ssoRegion:i,ssoRoleName:s,ssoClient:o,clientConfig:e.clientConfig,parentClientConfig:e.parentClientConfig,profile:c});throw new mb('Incomplete configuration. The fromSSO() argument hash must include "ssoStartUrl", "ssoAccountId", "ssoRegion", "ssoRoleName"',{tryNextLink:!1,logger:e.logger})}{const t=(await Zx(e))[c];if(!t)throw new mb(`Profile ${c} was not found.`,{logger:e.logger});if(!Iz(t))throw new mb(`Profile ${c} is not configured with SSO credentials.`,{logger:e.logger});if(t?.sso_session){const r=(await Vx(e))[t.sso_session],s=` configurations in profile ${c} and sso-session ${t.sso_session}`;if(i&&i!==r.sso_region)throw new mb("Conflicting SSO region"+s,{tryNextLink:!1,logger:e.logger});if(n&&n!==r.sso_start_url)throw new mb("Conflicting SSO start_url"+s,{tryNextLink:!1,logger:e.logger});t.sso_region=r.sso_region,t.sso_start_url=r.sso_start_url}const{sso_start_url:r,sso_account_id:s,sso_region:a,sso_role_name:l,sso_session:u}=Mz(t,e.logger);return Uz({ssoStartUrl:r,ssoSession:u,ssoAccountId:s,ssoRegion:a,ssoRoleName:l,ssoClient:o,clientConfig:e.clientConfig,parentClientConfig:e.parentClientConfig,profile:c})}},isSsoProfile:Iz,validateSsoProfile:Mz});const zz=e=>nb(e,"CREDENTIALS_PROFILE_NAMED_PROVIDER","p"),Bz=(e,{profile:t,logger:n})=>{const r="string"==typeof e.source_profile&&void 0===e.credential_source;return r&&n?.debug?.(`    ${t} isAssumeRoleWithSourceProfile source_profile=${e.source_profile}`),r},qz=(e,{profile:t,logger:n})=>{const r="string"==typeof e.credential_source&&void 0===e.source_profile;return r&&n?.debug?.(`    ${t} isCredentialSourceProfile credential_source=${e.credential_source}`),r},Wz=async(e,t,n,r={})=>{n.logger?.debug("@aws-sdk/credential-provider-ini - resolveAssumeRoleCredentials (STS)");const i=t[e],{source_profile:s,region:a}=i;if(!n.roleAssumer){const{getDefaultRoleAssumer:e}=await Promise.resolve().then(function(){return xG});n.roleAssumer=e({...n.clientConfig,credentialProviderLogger:n.logger,parentClientConfig:{...n?.parentClientConfig,region:a??n?.parentClientConfig?.region}},n.clientPlugins)}if(s&&s in r)throw new mb(`Detected a cycle attempting to resolve credentials for profile ${Tx(n)}. Profiles visited: `+Object.keys(r).join(", "),{logger:n.logger});n.logger?.debug("@aws-sdk/credential-provider-ini - finding credential resolver using "+(s?`source_profile=[${s}]`:`profile=[${e}]`));const o=s?Vz(s,t,n,{...r,[s]:!0},Hz(t[s]??{})):(await((e,t,n)=>{const r={EcsContainer:async e=>{const{fromHttp:t}=await Promise.resolve().then(function(){return Cz}),{fromContainerMetadata:r}=await Promise.resolve().then(function(){return Oz});return n?.debug("@aws-sdk/credential-provider-ini - credential_source is EcsContainer"),async()=>gb(t(e??{}),r(e))().then(zz)},Ec2InstanceMetadata:async e=>{n?.debug("@aws-sdk/credential-provider-ini - credential_source is Ec2InstanceMetadata");const{fromInstanceMetadata:t}=await Promise.resolve().then(function(){return Oz});return async()=>t(e)().then(zz)},Environment:async e=>{n?.debug("@aws-sdk/credential-provider-ini - credential_source is Environment");const{fromEnv:t}=await Promise.resolve().then(function(){return HE});return async()=>t(e)().then(zz)}};if(e in r)return r[e];throw new mb(`Unsupported credential source in profile ${t}. Got ${e}, expected EcsContainer or Ec2InstanceMetadata or Environment.`,{logger:n})})(i.credential_source,e,n.logger)(n))();if(Hz(i))return o.then(e=>nb(e,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"));{const t={RoleArn:i.role_arn,RoleSessionName:i.role_session_name||`aws-sdk-js-${Date.now()}`,ExternalId:i.external_id,DurationSeconds:parseInt(i.duration_seconds||"3600",10)},{mfa_serial:r}=i;if(r){if(!n.mfaCodeProvider)throw new mb(`Profile ${e} requires multi-factor authentication, but no MFA code callback was provided.`,{logger:n.logger,tryNextLink:!1});t.SerialNumber=r,t.TokenCode=await n.mfaCodeProvider(r)}const s=await o;return n.roleAssumer(s,t).then(e=>nb(e,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"))}},Hz=e=>!e.role_arn&&!!e.credential_source,Kz=e=>Boolean(e)&&"object"==typeof e&&"string"==typeof e.aws_access_key_id&&"string"==typeof e.aws_secret_access_key&&["undefined","string"].indexOf(typeof e.aws_session_token)>-1&&["undefined","string"].indexOf(typeof e.aws_account_id)>-1,Gz=async(e,t)=>{t?.logger?.debug("@aws-sdk/credential-provider-ini - resolveStaticCredentials");return nb({accessKeyId:e.aws_access_key_id,secretAccessKey:e.aws_secret_access_key,sessionToken:e.aws_session_token,...e.aws_credential_scope&&{credentialScope:e.aws_credential_scope},...e.aws_account_id&&{accountId:e.aws_account_id}},"CREDENTIALS_PROFILE","n")},Vz=async(e,t,n,r={},i=!1)=>{const s=t[e];if(Object.keys(r).length>0&&Kz(s))return Gz(s,n);if(i||((e,{profile:t="default",logger:n}={})=>Boolean(e)&&"object"==typeof e&&"string"==typeof e.role_arn&&["undefined","string"].indexOf(typeof e.role_session_name)>-1&&["undefined","string"].indexOf(typeof e.external_id)>-1&&["undefined","string"].indexOf(typeof e.mfa_serial)>-1&&(Bz(e,{profile:t,logger:n})||qz(e,{profile:t,logger:n})))(s,{profile:e,logger:n.logger}))return Wz(e,t,n,r);if(Kz(s))return Gz(s,n);if(a=s,Boolean(a)&&"object"==typeof a&&"string"==typeof a.web_identity_token_file&&"string"==typeof a.role_arn&&["undefined","string"].indexOf(typeof a.role_session_name)>-1)return(async(e,t)=>Promise.resolve().then(function(){return eB}).then(({fromTokenFile:n})=>n({webIdentityTokenFile:e.web_identity_token_file,roleArn:e.role_arn,roleSessionName:e.role_session_name,roleAssumerWithWebIdentity:t.roleAssumerWithWebIdentity,logger:t.logger,parentClientConfig:t.parentClientConfig})().then(e=>nb(e,"CREDENTIALS_PROFILE_STS_WEB_ID_TOKEN","q"))))(s,n);var a;if((e=>Boolean(e)&&"object"==typeof e&&"string"==typeof e.credential_process)(s))return(async(e,t)=>Promise.resolve().then(function(){return Yz}).then(({fromProcess:n})=>n({...e,profile:t})().then(e=>nb(e,"CREDENTIALS_PROFILE_PROCESS","v"))))(n,e);if((e=>e&&("string"==typeof e.sso_start_url||"string"==typeof e.sso_account_id||"string"==typeof e.sso_session||"string"==typeof e.sso_region||"string"==typeof e.sso_role_name))(s))return await(async(e,t,n={})=>{const{fromSSO:r}=await Promise.resolve().then(function(){return Fz});return r({profile:e,logger:n.logger,parentClientConfig:n.parentClientConfig,clientConfig:n.clientConfig})().then(e=>t.sso_session?nb(e,"CREDENTIALS_PROFILE_SSO","r"):nb(e,"CREDENTIALS_PROFILE_SSO_LEGACY","t"))})(e,s,n);throw new mb(`Could not resolve credentials using profile: [${e}] in configuration/credentials file(s).`,{logger:n.logger})};var Zz=Object.freeze({__proto__:null,fromIni:(e={})=>async({callerClientConfig:t}={})=>{const n={...e,parentClientConfig:{...t,...e.parentClientConfig}};n.logger?.debug("@aws-sdk/credential-provider-ini - fromIni");const r=await Zx(n);return Vz(Tx({profile:e.profile??t?.profile}),r,n)}});const Jz=async(e,n,r)=>{const i=n[e];if(!n[e])throw new mb(`Profile ${e} could not be found in shared credentials file.`,{logger:r});{const s=i.credential_process;if(void 0===s)throw new mb(`Profile ${e} did not contain credential_process.`,{logger:r});{const i=t(F);try{const{stdout:t}=await i(s);let r;try{r=JSON.parse(t.trim())}catch{throw Error(`Profile ${e} credential_process returned invalid JSON.`)}return((e,t,n)=>{if(1!==t.Version)throw Error(`Profile ${e} credential_process did not return Version 1.`);if(void 0===t.AccessKeyId||void 0===t.SecretAccessKey)throw Error(`Profile ${e} credential_process returned invalid credentials.`);if(t.Expiration){const n=new Date;if(new Date(t.Expiration)<n)throw Error(`Profile ${e} credential_process returned expired credentials.`)}let r=t.AccountId;!r&&n?.[e]?.aws_account_id&&(r=n[e].aws_account_id);const i={accessKeyId:t.AccessKeyId,secretAccessKey:t.SecretAccessKey,...t.SessionToken&&{sessionToken:t.SessionToken},...t.Expiration&&{expiration:new Date(t.Expiration)},...t.CredentialScope&&{credentialScope:t.CredentialScope},...r&&{accountId:r}};return nb(i,"CREDENTIALS_PROCESS","w"),i})(e,r,n)}catch(e){throw new mb(e.message,{logger:r})}}}};var Yz=Object.freeze({__proto__:null,fromProcess:(e={})=>async({callerClientConfig:t}={})=>{e.logger?.debug("@aws-sdk/credential-provider-process - fromProcess");const n=await Zx(e);return Jz(Tx({profile:e.profile??t?.profile}),n,e.logger)}});const Xz=e=>async t=>{e.logger?.debug("@aws-sdk/credential-provider-web-identity - fromWebToken");const{roleArn:n,roleSessionName:r,webIdentityToken:i,providerId:s,policyArns:a,policy:o,durationSeconds:c}=e;let{roleAssumerWithWebIdentity:l}=e;if(!l){const{getDefaultRoleAssumerWithWebIdentity:n}=await Promise.resolve().then(function(){return xG});l=n({...e.clientConfig,credentialProviderLogger:e.logger,parentClientConfig:{...t?.callerClientConfig,...e.parentClientConfig}},e.clientPlugins)}return l({RoleArn:n,RoleSessionName:r??`aws-sdk-js-session-${Date.now()}`,WebIdentityToken:i,ProviderId:s,PolicyArns:a,Policy:o,DurationSeconds:c})},Qz="AWS_WEB_IDENTITY_TOKEN_FILE";var eB=Object.freeze({__proto__:null,fromTokenFile:(e={})=>async()=>{e.logger?.debug("@aws-sdk/credential-provider-web-identity - fromTokenFile");const t=e?.webIdentityTokenFile??process.env[Qz],n=e?.roleArn??process.env.AWS_ROLE_ARN,r=e?.roleSessionName??process.env.AWS_ROLE_SESSION_NAME;if(!t||!n)throw new mb("Web identity configuration not specified",{logger:e.logger});const i=await Xz({...e,webIdentityToken:E(t,{encoding:"ascii"}),roleArn:n,roleSessionName:r})();return t===process.env[Qz]&&nb(i,"CREDENTIALS_ENV_VARS_STS_WEB_ID_TOKEN","h"),i},fromWebToken:Xz});var tB=Object.freeze({__proto__:null,fromHttp:(e={})=>{let t;e.logger?.debug("@aws-sdk/credential-provider-http - fromHttp");const n=e.awsContainerCredentialsRelativeUri??process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI,r=e.awsContainerCredentialsFullUri??process.env.AWS_CONTAINER_CREDENTIALS_FULL_URI,i=e.awsContainerAuthorizationToken??process.env.AWS_CONTAINER_AUTHORIZATION_TOKEN,s=e.awsContainerAuthorizationTokenFile??process.env.AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE,a="NoOpLogger"!==e.logger?.constructor?.name&&e.logger?e.logger.warn:console.warn;if(n&&r&&(a("@aws-sdk/credential-provider-http: you have set both awsContainerCredentialsRelativeUri and awsContainerCredentialsFullUri."),a("awsContainerCredentialsFullUri will take precedence.")),i&&s&&(a("@aws-sdk/credential-provider-http: you have set both awsContainerAuthorizationToken and awsContainerAuthorizationTokenFile."),a("awsContainerAuthorizationToken will take precedence.")),r)t=r;else{if(!n)throw new mb("No HTTP credential provider host provided.\nSet AWS_CONTAINER_CREDENTIALS_FULL_URI or AWS_CONTAINER_CREDENTIALS_RELATIVE_URI.",{logger:e.logger});t=`http://169.254.170.2${n}`}const o=new URL(t);((e,t)=>{if("https:"!==e.protocol&&"169.254.170.2"!==e.hostname&&"169.254.170.23"!==e.hostname&&"[fd00:ec2::23]"!==e.hostname){if(e.hostname.includes("[")){if("[::1]"===e.hostname||"[0000:0000:0000:0000:0000:0000:0000:0001]"===e.hostname)return}else{if("localhost"===e.hostname)return;const t=e.hostname.split("."),n=e=>{const t=parseInt(e,10);return 0<=t&&t<=255};if("127"===t[0]&&n(t[1])&&n(t[2])&&n(t[3])&&4===t.length)return}throw new mb("URL not accepted. It must either be HTTPS or match one of the following:\n  - loopback CIDR 127.0.0.0/8 or [::1/128]\n  - ECS container host 169.254.170.2\n  - EKS container host 169.254.170.23 or [fd00:ec2::23]",{logger:t})}})(o,e.logger);const c=new dy({requestTimeout:e.timeout??1e3,connectionTimeout:e.timeout??1e3});return l=async()=>{const t=function(e){return new xg({protocol:e.protocol,hostname:e.hostname,port:Number(e.port),path:e.pathname,query:Array.from(e.searchParams.entries()).reduce((e,[t,n])=>(e[t]=n,e),{}),fragment:e.hash})}(o);i?t.headers.Authorization=i:s&&(t.headers.Authorization=(await M.readFile(s)).toString());try{return async function(e,t){const n=Oy(e.body),r=await n.transformToString();if(200===e.statusCode){const e=JSON.parse(r);if("string"!=typeof e.AccessKeyId||"string"!=typeof e.SecretAccessKey||"string"!=typeof e.Token||"string"!=typeof e.Expiration)throw new mb("HTTP credential provider response not of the required format, an object matching: { AccessKeyId: string, SecretAccessKey: string, Token: string, Expiration: string(rfc3339) }",{logger:t});return{accessKeyId:e.AccessKeyId,secretAccessKey:e.SecretAccessKey,sessionToken:e.Token,expiration:Xy(e.Expiration)}}if(e.statusCode>=400&&e.statusCode<500){let n={};try{n=JSON.parse(r)}catch(e){}throw Object.assign(new mb(`Server responded with status: ${e.statusCode}`,{logger:t}),{Code:n.Code,Message:n.Message})}throw new mb(`Server responded with status: ${e.statusCode}`,{logger:t})}((await c.handle(t)).response).then(e=>eC(e,"CREDENTIALS_HTTP","z"))}catch(t){throw new mb(String(t),{logger:e.logger})}},u=e.maxRetries??3,d=e.timeout??1e3,async()=>{for(let e=0;e<u;++e)try{return await l()}catch(e){await new Promise(e=>setTimeout(e,d))}return await l()};var l,u,d}});const nB=e=>e&&("string"==typeof e.sso_start_url||"string"==typeof e.sso_account_id||"string"==typeof e.sso_session||"string"==typeof e.sso_region||"string"==typeof e.sso_role_name),rB="To refresh this SSO session run 'aws sso login' with the corresponding profile.",iB=async(e,t,n={})=>{const{CreateTokenCommand:r}=await Promise.resolve().then(function(){return $V}),i=await(async(e,t={})=>{const{SSOOIDCClient:n}=await Promise.resolve().then(function(){return $V});return new n(Object.assign({},t.clientConfig??{},{region:e??t.clientConfig?.region,logger:t.clientConfig?.logger??t.parentClientConfig?.logger}))})(t,n);return i.send(new r({clientId:e.clientId,clientSecret:e.clientSecret,refreshToken:e.refreshToken,grantType:"refresh_token"}))},sB=e=>{if(e.expiration&&e.expiration.getTime()<Date.now())throw new fb(`Token is expired. ${rB}`,!1)},aB=(e,t,n=!1)=>{if(void 0===t)throw new fb(`Value not present for '${e}' in SSO Token${n?". Cannot refresh":""}. ${rB}`,!1)},{writeFile:oB}=w,cB=new Date(0),lB=(e={})=>async({callerClientConfig:t}={})=>{const n={...e,parentClientConfig:{...t,...e.parentClientConfig}};n.logger?.debug("@aws-sdk/token-providers - fromSso");const r=await Zx(n),i=Tx({profile:n.profile??t?.profile}),s=r[i];if(!s)throw new fb(`Profile '${i}' could not be found in shared credentials file.`,!1);if(!s.sso_session)throw new fb(`Profile '${i}' is missing required property 'sso_session'.`);const a=s.sso_session,o=(await Vx(n))[a];if(!o)throw new fb(`Sso session '${a}' could not be found in shared credentials file.`,!1);for(const e of["sso_start_url","sso_region"])if(!o[e])throw new fb(`Sso session '${a}' is missing required property '${e}'.`,!1);o.sso_start_url;const c=o.sso_region;let l;try{l=await jx(a)}catch(e){throw new fb(`The SSO session token associated with profile=${i} was not found or is invalid. ${rB}`,!1)}aB("accessToken",l.accessToken),aB("expiresAt",l.expiresAt);const{accessToken:u,expiresAt:d}=l,p={token:u,expiration:new Date(d)};if(p.expiration.getTime()-Date.now()>3e5)return p;if(Date.now()-cB.getTime()<3e4)return sB(p),p;aB("clientId",l.clientId,!0),aB("clientSecret",l.clientSecret,!0),aB("refreshToken",l.refreshToken,!0);try{cB.setTime(Date.now());const e=await iB(l,c,n);aB("accessToken",e.accessToken),aB("expiresIn",e.expiresIn);const t=new Date(Date.now()+1e3*e.expiresIn);try{await((e,t)=>{const n=Px(e),r=JSON.stringify(t,null,2);return oB(n,r)})(a,{...l,accessToken:e.accessToken,expiresAt:t.toISOString(),refreshToken:e.refreshToken})}catch(e){}return{token:e.accessToken,expiration:t}}catch(e){return sB(p),p}},uB=!1,dB=async({ssoStartUrl:e,ssoSession:t,ssoAccountId:n,ssoRegion:r,ssoRoleName:i,ssoClient:s,clientConfig:a,parentClientConfig:o,profile:c,logger:l})=>{let u;const d="To refresh this SSO session run aws sso login with the corresponding profile.";if(t)try{const e=await lB({profile:c})();u={accessToken:e.token,expiresAt:new Date(e.expiration).toISOString()}}catch(e){throw new mb(e.message,{tryNextLink:uB,logger:l})}else try{u=await jx(e)}catch(e){throw new mb(`The SSO session associated with this profile is invalid. ${d}`,{tryNextLink:uB,logger:l})}if(new Date(u.expiresAt).getTime()-Date.now()<=0)throw new mb(`The SSO session associated with this profile has expired. ${d}`,{tryNextLink:uB,logger:l});const{accessToken:p}=u,{SSOClient:h,GetRoleCredentialsCommand:m}=await Promise.resolve().then(function(){return UZ}),f=s||new h(Object.assign({},a??{},{logger:a?.logger??o?.logger,region:a?.region??r}));let g;try{g=await f.send(new m({accountId:n,roleName:i,accessToken:p}))}catch(e){throw new mb(e,{tryNextLink:uB,logger:l})}const{roleCredentials:{accessKeyId:y,secretAccessKey:v,sessionToken:b,expiration:w,credentialScope:_,accountId:x}={}}=g;if(!(y&&v&&b&&w))throw new mb("SSO returns an invalid temporary credential.",{tryNextLink:uB,logger:l});const E={accessKeyId:y,secretAccessKey:v,sessionToken:b,expiration:new Date(w),..._&&{credentialScope:_},...x&&{accountId:x}};return t?eC(E,"CREDENTIALS_SSO","s"):eC(E,"CREDENTIALS_SSO_LEGACY","u"),E},pB=(e,t)=>{const{sso_start_url:n,sso_account_id:r,sso_region:i,sso_role_name:s}=e;if(!(n&&r&&i&&s))throw new mb(`Profile is configured with invalid SSO credentials. Required parameters "sso_account_id", "sso_region", "sso_role_name", "sso_start_url". Got ${Object.keys(e).join(", ")}\nReference: https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sso.html`,{tryNextLink:!1,logger:t});return e};var hB=Object.freeze({__proto__:null,fromSSO:(e={})=>async({callerClientConfig:t}={})=>{e.logger?.debug("@aws-sdk/credential-provider-sso - fromSSO");const{ssoStartUrl:n,ssoAccountId:r,ssoRegion:i,ssoRoleName:s,ssoSession:a}=e,{ssoClient:o}=e,c=Tx({profile:e.profile??t?.profile});if(n||r||i||s||a){if(n&&r&&i&&s)return dB({ssoStartUrl:n,ssoSession:a,ssoAccountId:r,ssoRegion:i,ssoRoleName:s,ssoClient:o,clientConfig:e.clientConfig,parentClientConfig:e.parentClientConfig,profile:c});throw new mb('Incomplete configuration. The fromSSO() argument hash must include "ssoStartUrl", "ssoAccountId", "ssoRegion", "ssoRoleName"',{tryNextLink:!1,logger:e.logger})}{const t=(await Zx(e))[c];if(!t)throw new mb(`Profile ${c} was not found.`,{logger:e.logger});if(!nB(t))throw new mb(`Profile ${c} is not configured with SSO credentials.`,{logger:e.logger});if(t?.sso_session){const r=(await Vx(e))[t.sso_session],s=` configurations in profile ${c} and sso-session ${t.sso_session}`;if(i&&i!==r.sso_region)throw new mb("Conflicting SSO region"+s,{tryNextLink:!1,logger:e.logger});if(n&&n!==r.sso_start_url)throw new mb("Conflicting SSO start_url"+s,{tryNextLink:!1,logger:e.logger});t.sso_region=r.sso_region,t.sso_start_url=r.sso_start_url}const{sso_start_url:r,sso_account_id:s,sso_region:a,sso_role_name:l,sso_session:u}=pB(t,e.logger);return dB({ssoStartUrl:r,ssoSession:u,ssoAccountId:s,ssoRegion:a,ssoRoleName:l,ssoClient:o,clientConfig:e.clientConfig,parentClientConfig:e.parentClientConfig,profile:c})}},isSsoProfile:nB,validateSsoProfile:pB});const mB=e=>eC(e,"CREDENTIALS_PROFILE_NAMED_PROVIDER","p"),fB=(e,{profile:t,logger:n})=>{const r="string"==typeof e.source_profile&&void 0===e.credential_source;return r&&n?.debug?.(`    ${t} isAssumeRoleWithSourceProfile source_profile=${e.source_profile}`),r},gB=(e,{profile:t,logger:n})=>{const r="string"==typeof e.credential_source&&void 0===e.source_profile;return r&&n?.debug?.(`    ${t} isCredentialSourceProfile credential_source=${e.credential_source}`),r},yB=async(e,t,n,r={})=>{n.logger?.debug("@aws-sdk/credential-provider-ini - resolveAssumeRoleCredentials (STS)");const i=t[e],{source_profile:s,region:a}=i;if(!n.roleAssumer){const{getDefaultRoleAssumer:e}=await Promise.resolve().then(function(){return yX});n.roleAssumer=e({...n.clientConfig,credentialProviderLogger:n.logger,parentClientConfig:{...n?.parentClientConfig,region:a??n?.parentClientConfig?.region}},n.clientPlugins)}if(s&&s in r)throw new mb(`Detected a cycle attempting to resolve credentials for profile ${Tx(n)}. Profiles visited: `+Object.keys(r).join(", "),{logger:n.logger});n.logger?.debug("@aws-sdk/credential-provider-ini - finding credential resolver using "+(s?`source_profile=[${s}]`:`profile=[${e}]`));const o=s?_B(s,t,n,{...r,[s]:!0},vB(t[s]??{})):(await((e,t,n)=>{const r={EcsContainer:async e=>{const{fromHttp:t}=await Promise.resolve().then(function(){return tB}),{fromContainerMetadata:r}=await Promise.resolve().then(function(){return Oz});return n?.debug("@aws-sdk/credential-provider-ini - credential_source is EcsContainer"),async()=>gb(t(e??{}),r(e))().then(mB)},Ec2InstanceMetadata:async e=>{n?.debug("@aws-sdk/credential-provider-ini - credential_source is Ec2InstanceMetadata");const{fromInstanceMetadata:t}=await Promise.resolve().then(function(){return Oz});return async()=>t(e)().then(mB)},Environment:async e=>{n?.debug("@aws-sdk/credential-provider-ini - credential_source is Environment");const{fromEnv:t}=await Promise.resolve().then(function(){return lC});return async()=>t(e)().then(mB)}};if(e in r)return r[e];throw new mb(`Unsupported credential source in profile ${t}. Got ${e}, expected EcsContainer or Ec2InstanceMetadata or Environment.`,{logger:n})})(i.credential_source,e,n.logger)(n))();if(vB(i))return o.then(e=>eC(e,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"));{const t={RoleArn:i.role_arn,RoleSessionName:i.role_session_name||`aws-sdk-js-${Date.now()}`,ExternalId:i.external_id,DurationSeconds:parseInt(i.duration_seconds||"3600",10)},{mfa_serial:r}=i;if(r){if(!n.mfaCodeProvider)throw new mb(`Profile ${e} requires multi-factor authentication, but no MFA code callback was provided.`,{logger:n.logger,tryNextLink:!1});t.SerialNumber=r,t.TokenCode=await n.mfaCodeProvider(r)}const s=await o;return n.roleAssumer(s,t).then(e=>eC(e,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"))}},vB=e=>!e.role_arn&&!!e.credential_source,bB=e=>Boolean(e)&&"object"==typeof e&&"string"==typeof e.aws_access_key_id&&"string"==typeof e.aws_secret_access_key&&["undefined","string"].indexOf(typeof e.aws_session_token)>-1&&["undefined","string"].indexOf(typeof e.aws_account_id)>-1,wB=async(e,t)=>{t?.logger?.debug("@aws-sdk/credential-provider-ini - resolveStaticCredentials");return eC({accessKeyId:e.aws_access_key_id,secretAccessKey:e.aws_secret_access_key,sessionToken:e.aws_session_token,...e.aws_credential_scope&&{credentialScope:e.aws_credential_scope},...e.aws_account_id&&{accountId:e.aws_account_id}},"CREDENTIALS_PROFILE","n")},_B=async(e,t,n,r={},i=!1)=>{const s=t[e];if(Object.keys(r).length>0&&bB(s))return wB(s,n);if(i||((e,{profile:t="default",logger:n}={})=>Boolean(e)&&"object"==typeof e&&"string"==typeof e.role_arn&&["undefined","string"].indexOf(typeof e.role_session_name)>-1&&["undefined","string"].indexOf(typeof e.external_id)>-1&&["undefined","string"].indexOf(typeof e.mfa_serial)>-1&&(fB(e,{profile:t,logger:n})||gB(e,{profile:t,logger:n})))(s,{profile:e,logger:n.logger}))return yB(e,t,n,r);if(bB(s))return wB(s,n);if(a=s,Boolean(a)&&"object"==typeof a&&"string"==typeof a.web_identity_token_file&&"string"==typeof a.role_arn&&["undefined","string"].indexOf(typeof a.role_session_name)>-1)return(async(e,t)=>Promise.resolve().then(function(){return OB}).then(({fromTokenFile:n})=>n({webIdentityTokenFile:e.web_identity_token_file,roleArn:e.role_arn,roleSessionName:e.role_session_name,roleAssumerWithWebIdentity:t.roleAssumerWithWebIdentity,logger:t.logger,parentClientConfig:t.parentClientConfig})().then(e=>eC(e,"CREDENTIALS_PROFILE_STS_WEB_ID_TOKEN","q"))))(s,n);var a;if((e=>Boolean(e)&&"object"==typeof e&&"string"==typeof e.credential_process)(s))return(async(e,t)=>Promise.resolve().then(function(){return SB}).then(({fromProcess:n})=>n({...e,profile:t})().then(e=>eC(e,"CREDENTIALS_PROFILE_PROCESS","v"))))(n,e);if((e=>e&&("string"==typeof e.sso_start_url||"string"==typeof e.sso_account_id||"string"==typeof e.sso_session||"string"==typeof e.sso_region||"string"==typeof e.sso_role_name))(s))return await(async(e,t,n={})=>{const{fromSSO:r}=await Promise.resolve().then(function(){return hB});return r({profile:e,logger:n.logger,parentClientConfig:n.parentClientConfig,clientConfig:n.clientConfig})().then(e=>t.sso_session?eC(e,"CREDENTIALS_PROFILE_SSO","r"):eC(e,"CREDENTIALS_PROFILE_SSO_LEGACY","t"))})(e,s,n);throw new mb(`Could not resolve credentials using profile: [${e}] in configuration/credentials file(s).`,{logger:n.logger})};var xB=Object.freeze({__proto__:null,fromIni:(e={})=>async({callerClientConfig:t}={})=>{const n={...e,parentClientConfig:{...t,...e.parentClientConfig}};n.logger?.debug("@aws-sdk/credential-provider-ini - fromIni");const r=await Zx(n);return _B(Tx({profile:e.profile??t?.profile}),r,n)}});const EB=async(e,n,r)=>{const i=n[e];if(!n[e])throw new mb(`Profile ${e} could not be found in shared credentials file.`,{logger:r});{const s=i.credential_process;if(void 0===s)throw new mb(`Profile ${e} did not contain credential_process.`,{logger:r});{const i=t(F);try{const{stdout:t}=await i(s);let r;try{r=JSON.parse(t.trim())}catch{throw Error(`Profile ${e} credential_process returned invalid JSON.`)}return((e,t,n)=>{if(1!==t.Version)throw Error(`Profile ${e} credential_process did not return Version 1.`);if(void 0===t.AccessKeyId||void 0===t.SecretAccessKey)throw Error(`Profile ${e} credential_process returned invalid credentials.`);if(t.Expiration){const n=new Date;if(new Date(t.Expiration)<n)throw Error(`Profile ${e} credential_process returned expired credentials.`)}let r=t.AccountId;!r&&n?.[e]?.aws_account_id&&(r=n[e].aws_account_id);const i={accessKeyId:t.AccessKeyId,secretAccessKey:t.SecretAccessKey,...t.SessionToken&&{sessionToken:t.SessionToken},...t.Expiration&&{expiration:new Date(t.Expiration)},...t.CredentialScope&&{credentialScope:t.CredentialScope},...r&&{accountId:r}};return eC(i,"CREDENTIALS_PROCESS","w"),i})(e,r,n)}catch(e){throw new mb(e.message,{logger:r})}}}};var SB=Object.freeze({__proto__:null,fromProcess:(e={})=>async({callerClientConfig:t}={})=>{e.logger?.debug("@aws-sdk/credential-provider-process - fromProcess");const n=await Zx(e);return EB(Tx({profile:e.profile??t?.profile}),n,e.logger)}});const kB=e=>async t=>{e.logger?.debug("@aws-sdk/credential-provider-web-identity - fromWebToken");const{roleArn:n,roleSessionName:r,webIdentityToken:i,providerId:s,policyArns:a,policy:o,durationSeconds:c}=e;let{roleAssumerWithWebIdentity:l}=e;if(!l){const{getDefaultRoleAssumerWithWebIdentity:n}=await Promise.resolve().then(function(){return yX});l=n({...e.clientConfig,credentialProviderLogger:e.logger,parentClientConfig:{...t?.callerClientConfig,...e.parentClientConfig}},e.clientPlugins)}return l({RoleArn:n,RoleSessionName:r??`aws-sdk-js-session-${Date.now()}`,WebIdentityToken:i,ProviderId:s,PolicyArns:a,Policy:o,DurationSeconds:c})},AB="AWS_WEB_IDENTITY_TOKEN_FILE";var OB=Object.freeze({__proto__:null,fromTokenFile:(e={})=>async()=>{e.logger?.debug("@aws-sdk/credential-provider-web-identity - fromTokenFile");const t=e?.webIdentityTokenFile??process.env[AB],n=e?.roleArn??process.env.AWS_ROLE_ARN,r=e?.roleSessionName??process.env.AWS_ROLE_SESSION_NAME;if(!t||!n)throw new mb("Web identity configuration not specified",{logger:e.logger});const i=await kB({...e,webIdentityToken:E(t,{encoding:"ascii"}),roleArn:n,roleSessionName:r})();return t===process.env[AB]&&eC(i,"CREDENTIALS_ENV_VARS_STS_WEB_ID_TOKEN","h"),i},fromWebToken:kB});const CB=async(e,t,n)=>({operation:Pg(t).operation,region:await Rg(e.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});const IB=e=>{const t=[];if("CreateToken"===e.operation)t.push({schemeId:"smithy.api#noAuth"});else t.push(function(e){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"sso-oauth",region:e.region},propertiesExtractor:(e,t)=>({signingProperties:{config:e,context:t}})}}(e));return t},TB={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}};var PB="3.816.0";const RB="required",jB="fn",NB="argv",$B="ref",LB=!0,DB="isSet",UB="booleanEquals",MB="error",FB="endpoint",zB="tree",BB="PartitionResult",qB="getAttr",WB={[RB]:!1,type:"String"},HB={[RB]:!0,default:!1,type:"Boolean"},KB={[$B]:"Endpoint"},GB={[jB]:UB,[NB]:[{[$B]:"UseFIPS"},!0]},VB={[jB]:UB,[NB]:[{[$B]:"UseDualStack"},!0]},ZB={},JB={[jB]:qB,[NB]:[{[$B]:BB},"supportsFIPS"]},YB={[$B]:BB},XB={[jB]:UB,[NB]:[!0,{[jB]:qB,[NB]:[YB,"supportsDualStack"]}]},QB=[GB],eq=[VB],tq=[{[$B]:"Region"}],nq={parameters:{Region:WB,UseDualStack:HB,UseFIPS:HB,Endpoint:WB},rules:[{conditions:[{[jB]:DB,[NB]:[KB]}],rules:[{conditions:QB,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:MB},{conditions:eq,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:MB},{endpoint:{url:KB,properties:ZB,headers:ZB},type:FB}],type:zB},{conditions:[{[jB]:DB,[NB]:tq}],rules:[{conditions:[{[jB]:"aws.partition",[NB]:tq,assign:BB}],rules:[{conditions:[GB,VB],rules:[{conditions:[{[jB]:UB,[NB]:[LB,JB]},XB],rules:[{endpoint:{url:"https://oidc-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:ZB,headers:ZB},type:FB}],type:zB},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:MB}],type:zB},{conditions:QB,rules:[{conditions:[{[jB]:UB,[NB]:[JB,LB]}],rules:[{conditions:[{[jB]:"stringEquals",[NB]:[{[jB]:qB,[NB]:[YB,"name"]},"aws-us-gov"]}],endpoint:{url:"https://oidc.{Region}.amazonaws.com",properties:ZB,headers:ZB},type:FB},{endpoint:{url:"https://oidc-fips.{Region}.{PartitionResult#dnsSuffix}",properties:ZB,headers:ZB},type:FB}],type:zB},{error:"FIPS is enabled but this partition does not support FIPS",type:MB}],type:zB},{conditions:eq,rules:[{conditions:[XB],rules:[{endpoint:{url:"https://oidc.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:ZB,headers:ZB},type:FB}],type:zB},{error:"DualStack is enabled but this partition does not support DualStack",type:MB}],type:zB},{endpoint:{url:"https://oidc.{Region}.{PartitionResult#dnsSuffix}",properties:ZB,headers:ZB},type:FB}],type:zB}],type:zB},{error:"Invalid Configuration: Missing Region",type:MB}]},rq=new kv({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),iq=(e,t={})=>rq.get(e,()=>Jv(nq,{endpointParams:e,logger:t.logger}));Tv.aws=Qv;const sq=e=>{dw(process.version);const t=uk(e),n=()=>t().then(lw),r=(e=>({apiVersion:"2019-06-10",base64Decoder:e?.base64Decoder??Zg,base64Encoder:e?.base64Encoder??Qg,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??iq,extensions:e?.extensions??[],httpAuthSchemeProvider:e?.httpAuthSchemeProvider??IB,httpAuthSchemes:e?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4"),signer:new cb},{schemeId:"smithy.api#noAuth",identityProvider:e=>e.getIdentityProvider("smithy.api#noAuth")||(async()=>({})),signer:new vv}],logger:e?.logger??new gw,serviceId:e?.serviceId??"SSO OIDC",urlParser:e?.urlParser??tE,utf8Decoder:e?.utf8Decoder??Jg,utf8Encoder:e?.utf8Encoder??Xg}))(e);tb(process.version);const i={profile:e?.profile,logger:r.logger};return{...r,...e,runtime:"node",defaultsMode:t,authSchemePreference:e?.authSchemePreference??Yx(pb,i),bodyLengthChecker:e?.bodyLengthChecker??NS,defaultUserAgentProvider:e?.defaultUserAgentProvider??AS({serviceId:r.serviceId,clientVersion:PB}),maxAttempts:e?.maxAttempts??Yx(SE,e),region:e?.region??Yx(px,{...hx,...i}),requestHandler:dy.create(e?.requestHandler??n),retryMode:e?.retryMode??Yx({...AE,default:async()=>(await n()).retryMode||lE},e),sha256:e?.sha256??RS.bind(null,"sha256"),streamCollector:e?.streamCollector??gy,useDualstackEndpoint:e?.useDualstackEndpoint??Yx(ux,i),useFipsEndpoint:e?.useFipsEndpoint??Yx(dx,i),userAgentAppId:e?.userAgentAppId??Yx(OS,i)}};let aq=class extends ew{config;constructor(...[e]){const t=sq(e||{});super(t),this.initConfig=t;var n;const r=Sv((n=t,Object.assign(n,{useDualstackEndpoint:n.useDualstackEndpoint??!1,useFipsEndpoint:n.useFipsEndpoint??!1,defaultSigningName:"sso-oauth"}))),i=kE(r),s=gx(i),a=((e,t)=>{const n=Object.assign(mk(e),pw(e),pg(e),(e=>{const t=e.httpAuthSchemes;let n=e.httpAuthSchemeProvider,r=e.credentials;return{setHttpAuthScheme(e){const n=t.findIndex(t=>t.schemeId===e.schemeId);-1===n?t.push(e):t.splice(n,1,e)},httpAuthSchemes:()=>t,setHttpAuthSchemeProvider(e){n=e},httpAuthSchemeProvider:()=>n,setCredentials(e){r=e},credentials:()=>r}})(e));return t.forEach(e=>e.configure(n)),Object.assign(e,fk(n),hw(n),hg(n),{httpAuthSchemes:(r=n).httpAuthSchemes(),httpAuthSchemeProvider:r.httpAuthSchemeProvider(),credentials:r.credentials()});var r})((e=>{const t=Vb(e);return Object.assign(t,{authSchemePreference:Rg(e.authSchemePreference??[])})})(oE(s)),e?.extensions||[]);this.config=a,this.middlewareStack.use(ox(this.config)),this.middlewareStack.use(RE(this.config)),this.middlewareStack.use(bx(this.config)),this.middlewareStack.use(kg(this.config)),this.middlewareStack.use(Og(this.config)),this.middlewareStack.use(Tg(this.config)),this.middlewareStack.use($g(this.config,{httpAuthSchemeParametersProvider:CB,identityProviderConfigProvider:async e=>new yv({"aws.auth#sigv4":e.credentials})})),this.middlewareStack.use(qg(this.config))}destroy(){super.destroy()}},oq=class e extends sw{constructor(t){super(t),Object.setPrototypeOf(this,e.prototype)}},cq=class e extends oq{name="AccessDeniedException";$fault="client";error;error_description;constructor(t){super({name:"AccessDeniedException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},lq=class e extends oq{name="AuthorizationPendingException";$fault="client";error;error_description;constructor(t){super({name:"AuthorizationPendingException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}};const uq=e=>({...e,...e.clientSecret&&{clientSecret:rw},...e.refreshToken&&{refreshToken:rw},...e.codeVerifier&&{codeVerifier:rw}}),dq=e=>({...e,...e.accessToken&&{accessToken:rw},...e.refreshToken&&{refreshToken:rw},...e.idToken&&{idToken:rw}});let pq=class e extends oq{name="ExpiredTokenException";$fault="client";error;error_description;constructor(t){super({name:"ExpiredTokenException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},hq=class e extends oq{name="InternalServerException";$fault="server";error;error_description;constructor(t){super({name:"InternalServerException",$fault:"server",...t}),Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},mq=class e extends oq{name="InvalidClientException";$fault="client";error;error_description;constructor(t){super({name:"InvalidClientException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},fq=class e extends oq{name="InvalidGrantException";$fault="client";error;error_description;constructor(t){super({name:"InvalidGrantException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},gq=class e extends oq{name="InvalidRequestException";$fault="client";error;error_description;constructor(t){super({name:"InvalidRequestException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},yq=class e extends oq{name="InvalidScopeException";$fault="client";error;error_description;constructor(t){super({name:"InvalidScopeException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},vq=class e extends oq{name="SlowDownException";$fault="client";error;error_description;constructor(t){super({name:"SlowDownException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},bq=class e extends oq{name="UnauthorizedClientException";$fault="client";error;error_description;constructor(t){super({name:"UnauthorizedClientException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},wq=class e extends oq{name="UnsupportedGrantTypeException";$fault="client";error;error_description;constructor(t){super({name:"UnsupportedGrantTypeException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}};const _q=async(e,t)=>{const n=fv(e,t);let r;return n.bp("/token"),r=JSON.stringify(vw(e,{clientId:[],clientSecret:[],code:[],codeVerifier:[],deviceCode:[],grantType:[],redirectUri:[],refreshToken:[],scope:e=>Sw(e)})),n.m("POST").h({"content-type":"application/json"}).b(r),n.build()},xq=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return Eq(e,t);const n=yw({$metadata:Lq(e)}),r=My(Fy(await Ow(e.body,t)),"body"),i=vw(r,{accessToken:zy,expiresIn:Ny,idToken:zy,refreshToken:zy,tokenType:zy});return Object.assign(n,i),n},Eq=async(e,t)=>{const n={...e,body:await Cw(e.body,t)},r=Iw(e,n.body);switch(r){case"AccessDeniedException":case"com.amazonaws.ssooidc#AccessDeniedException":throw await kq(n);case"AuthorizationPendingException":case"com.amazonaws.ssooidc#AuthorizationPendingException":throw await Aq(n);case"ExpiredTokenException":case"com.amazonaws.ssooidc#ExpiredTokenException":throw await Oq(n);case"InternalServerException":case"com.amazonaws.ssooidc#InternalServerException":throw await Cq(n);case"InvalidClientException":case"com.amazonaws.ssooidc#InvalidClientException":throw await Iq(n);case"InvalidGrantException":case"com.amazonaws.ssooidc#InvalidGrantException":throw await Tq(n);case"InvalidRequestException":case"com.amazonaws.ssooidc#InvalidRequestException":throw await Pq(n);case"InvalidScopeException":case"com.amazonaws.ssooidc#InvalidScopeException":throw await Rq(n);case"SlowDownException":case"com.amazonaws.ssooidc#SlowDownException":throw await jq(n);case"UnauthorizedClientException":case"com.amazonaws.ssooidc#UnauthorizedClientException":throw await Nq(n);case"UnsupportedGrantTypeException":case"com.amazonaws.ssooidc#UnsupportedGrantTypeException":throw await $q(n);default:const t=n.body;return Sq({output:e,parsedBody:t,errorCode:r})}},Sq=ow(oq),kq=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new cq({$metadata:Lq(e),...n});return aw(s,e.body)},Aq=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new lq({$metadata:Lq(e),...n});return aw(s,e.body)},Oq=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new pq({$metadata:Lq(e),...n});return aw(s,e.body)},Cq=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new hq({$metadata:Lq(e),...n});return aw(s,e.body)},Iq=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new mq({$metadata:Lq(e),...n});return aw(s,e.body)},Tq=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new fq({$metadata:Lq(e),...n});return aw(s,e.body)},Pq=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new gq({$metadata:Lq(e),...n});return aw(s,e.body)},Rq=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new yq({$metadata:Lq(e),...n});return aw(s,e.body)},jq=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new vq({$metadata:Lq(e),...n});return aw(s,e.body)},Nq=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new bq({$metadata:Lq(e),...n});return aw(s,e.body)},$q=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new wq({$metadata:Lq(e),...n});return aw(s,e.body)},Lq=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]});let Dq=class extends(tw.classBuilder().ep(TB).m(function(e,t,n,r){return[Mg(n,this.serialize,this.deserialize),aE(n,e.getEndpointParameterInstructions())]}).s("AWSSSOOIDCService","CreateToken",{}).n("SSOOIDCClient","CreateTokenCommand").f(uq,dq).ser(_q).de(xq).build()){};const Uq={CreateTokenCommand:Dq};let Mq=class extends aq{};iw(Uq,Mq);var Fq=Object.freeze({__proto__:null,$Command:tw,AccessDeniedException:cq,AuthorizationPendingException:lq,CreateTokenCommand:Dq,CreateTokenRequestFilterSensitiveLog:uq,CreateTokenResponseFilterSensitiveLog:dq,ExpiredTokenException:pq,InternalServerException:hq,InvalidClientException:mq,InvalidGrantException:fq,InvalidRequestException:gq,InvalidScopeException:yq,SSOOIDC:Mq,SSOOIDCClient:aq,SSOOIDCServiceException:oq,SlowDownException:vq,UnauthorizedClientException:bq,UnsupportedGrantTypeException:wq,__Client:ew});const zq=async(e,t,n)=>({operation:Pg(t).operation,region:await Rg(e.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});const Bq=e=>{const t=[];switch(e.operation){case"GetRoleCredentials":case"ListAccountRoles":case"ListAccounts":case"Logout":t.push({schemeId:"smithy.api#noAuth"});break;default:t.push(function(e){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"awsssoportal",region:e.region},propertiesExtractor:(e,t)=>({signingProperties:{config:e,context:t}})}}(e))}return t},qq={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}};var Wq="3.816.0";const Hq="required",Kq="fn",Gq="argv",Vq="ref",Zq=!0,Jq="isSet",Yq="booleanEquals",Xq="error",Qq="endpoint",eW="tree",tW="PartitionResult",nW="getAttr",rW={[Hq]:!1,type:"String"},iW={[Hq]:!0,default:!1,type:"Boolean"},sW={[Vq]:"Endpoint"},aW={[Kq]:Yq,[Gq]:[{[Vq]:"UseFIPS"},!0]},oW={[Kq]:Yq,[Gq]:[{[Vq]:"UseDualStack"},!0]},cW={},lW={[Kq]:nW,[Gq]:[{[Vq]:tW},"supportsFIPS"]},uW={[Vq]:tW},dW={[Kq]:Yq,[Gq]:[!0,{[Kq]:nW,[Gq]:[uW,"supportsDualStack"]}]},pW=[aW],hW=[oW],mW=[{[Vq]:"Region"}],fW={parameters:{Region:rW,UseDualStack:iW,UseFIPS:iW,Endpoint:rW},rules:[{conditions:[{[Kq]:Jq,[Gq]:[sW]}],rules:[{conditions:pW,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:Xq},{conditions:hW,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:Xq},{endpoint:{url:sW,properties:cW,headers:cW},type:Qq}],type:eW},{conditions:[{[Kq]:Jq,[Gq]:mW}],rules:[{conditions:[{[Kq]:"aws.partition",[Gq]:mW,assign:tW}],rules:[{conditions:[aW,oW],rules:[{conditions:[{[Kq]:Yq,[Gq]:[Zq,lW]},dW],rules:[{endpoint:{url:"https://portal.sso-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:cW,headers:cW},type:Qq}],type:eW},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:Xq}],type:eW},{conditions:pW,rules:[{conditions:[{[Kq]:Yq,[Gq]:[lW,Zq]}],rules:[{conditions:[{[Kq]:"stringEquals",[Gq]:[{[Kq]:nW,[Gq]:[uW,"name"]},"aws-us-gov"]}],endpoint:{url:"https://portal.sso.{Region}.amazonaws.com",properties:cW,headers:cW},type:Qq},{endpoint:{url:"https://portal.sso-fips.{Region}.{PartitionResult#dnsSuffix}",properties:cW,headers:cW},type:Qq}],type:eW},{error:"FIPS is enabled but this partition does not support FIPS",type:Xq}],type:eW},{conditions:hW,rules:[{conditions:[dW],rules:[{endpoint:{url:"https://portal.sso.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:cW,headers:cW},type:Qq}],type:eW},{error:"DualStack is enabled but this partition does not support DualStack",type:Xq}],type:eW},{endpoint:{url:"https://portal.sso.{Region}.{PartitionResult#dnsSuffix}",properties:cW,headers:cW},type:Qq}],type:eW}],type:eW},{error:"Invalid Configuration: Missing Region",type:Xq}]},gW=new kv({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),yW=(e,t={})=>gW.get(e,()=>Jv(fW,{endpointParams:e,logger:t.logger}));Tv.aws=Qv;const vW=e=>{dw(process.version);const t=uk(e),n=()=>t().then(lw),r=(e=>({apiVersion:"2019-06-10",base64Decoder:e?.base64Decoder??Zg,base64Encoder:e?.base64Encoder??Qg,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??yW,extensions:e?.extensions??[],httpAuthSchemeProvider:e?.httpAuthSchemeProvider??Bq,httpAuthSchemes:e?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4"),signer:new cb},{schemeId:"smithy.api#noAuth",identityProvider:e=>e.getIdentityProvider("smithy.api#noAuth")||(async()=>({})),signer:new vv}],logger:e?.logger??new gw,serviceId:e?.serviceId??"SSO",urlParser:e?.urlParser??tE,utf8Decoder:e?.utf8Decoder??Jg,utf8Encoder:e?.utf8Encoder??Xg}))(e);tb(process.version);const i={profile:e?.profile,logger:r.logger};return{...r,...e,runtime:"node",defaultsMode:t,authSchemePreference:e?.authSchemePreference??Yx(pb,i),bodyLengthChecker:e?.bodyLengthChecker??NS,defaultUserAgentProvider:e?.defaultUserAgentProvider??AS({serviceId:r.serviceId,clientVersion:Wq}),maxAttempts:e?.maxAttempts??Yx(SE,e),region:e?.region??Yx(px,{...hx,...i}),requestHandler:dy.create(e?.requestHandler??n),retryMode:e?.retryMode??Yx({...AE,default:async()=>(await n()).retryMode||lE},e),sha256:e?.sha256??RS.bind(null,"sha256"),streamCollector:e?.streamCollector??gy,useDualstackEndpoint:e?.useDualstackEndpoint??Yx(ux,i),useFipsEndpoint:e?.useFipsEndpoint??Yx(dx,i),userAgentAppId:e?.userAgentAppId??Yx(OS,i)}};let bW=class e extends sw{constructor(t){super(t),Object.setPrototypeOf(this,e.prototype)}},wW=class e extends bW{name="InvalidRequestException";$fault="client";constructor(t){super({name:"InvalidRequestException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype)}},_W=class e extends bW{name="ResourceNotFoundException";$fault="client";constructor(t){super({name:"ResourceNotFoundException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype)}},xW=class e extends bW{name="TooManyRequestsException";$fault="client";constructor(t){super({name:"TooManyRequestsException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype)}},EW=class e extends bW{name="UnauthorizedException";$fault="client";constructor(t){super({name:"UnauthorizedException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype)}};const SW=e=>({...e,...e.accessToken&&{accessToken:rw}}),kW=e=>({...e,...e.secretAccessKey&&{secretAccessKey:rw},...e.sessionToken&&{sessionToken:rw}}),AW=e=>({...e,...e.roleCredentials&&{roleCredentials:kW(e.roleCredentials)}}),OW=async(e,t)=>{const n=fv(e,t),r=yw({},fw,{[zW]:e[DW]});n.bp("/federation/credentials");const i=yw({[FW]:[,My(e[MW],"roleName")],[UW]:[,My(e[LW],"accountId")]});return n.m("GET").h(r).q(i).b(undefined),n.build()},CW=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return IW(e,t);const n=yw({$metadata:$W(e)}),r=My(Fy(await Ow(e.body,t)),"body"),i=vw(r,{roleCredentials:Sw});return Object.assign(n,i),n},IW=async(e,t)=>{const n={...e,body:await Cw(e.body,t)},r=Iw(e,n.body);switch(r){case"InvalidRequestException":case"com.amazonaws.sso#InvalidRequestException":throw await PW(n);case"ResourceNotFoundException":case"com.amazonaws.sso#ResourceNotFoundException":throw await RW(n);case"TooManyRequestsException":case"com.amazonaws.sso#TooManyRequestsException":throw await jW(n);case"UnauthorizedException":case"com.amazonaws.sso#UnauthorizedException":throw await NW(n);default:const t=n.body;return TW({output:e,parsedBody:t,errorCode:r})}},TW=ow(bW),PW=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new wW({$metadata:$W(e),...n});return aw(s,e.body)},RW=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new _W({$metadata:$W(e),...n});return aw(s,e.body)},jW=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new xW({$metadata:$W(e),...n});return aw(s,e.body)},NW=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new EW({$metadata:$W(e),...n});return aw(s,e.body)},$W=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),LW="accountId",DW="accessToken",UW="account_id",MW="roleName",FW="role_name",zW="x-amz-sso_bearer_token";let BW=class extends(tw.classBuilder().ep(qq).m(function(e,t,n,r){return[Mg(n,this.serialize,this.deserialize),aE(n,e.getEndpointParameterInstructions())]}).s("SWBPortalService","GetRoleCredentials",{}).n("SSOClient","GetRoleCredentialsCommand").f(SW,AW).ser(OW).de(CW).build()){};var qW=Object.freeze({__proto__:null,GetRoleCredentialsCommand:BW,SSOClient:class extends ew{config;constructor(...[e]){const t=vW(e||{});super(t),this.initConfig=t;var n;const r=Sv((n=t,Object.assign(n,{useDualstackEndpoint:n.useDualstackEndpoint??!1,useFipsEndpoint:n.useFipsEndpoint??!1,defaultSigningName:"awsssoportal"}))),i=kE(r),s=gx(i),a=((e,t)=>{const n=Object.assign(mk(e),pw(e),pg(e),(e=>{const t=e.httpAuthSchemes;let n=e.httpAuthSchemeProvider,r=e.credentials;return{setHttpAuthScheme(e){const n=t.findIndex(t=>t.schemeId===e.schemeId);-1===n?t.push(e):t.splice(n,1,e)},httpAuthSchemes:()=>t,setHttpAuthSchemeProvider(e){n=e},httpAuthSchemeProvider:()=>n,setCredentials(e){r=e},credentials:()=>r}})(e));return t.forEach(e=>e.configure(n)),Object.assign(e,fk(n),hw(n),hg(n),{httpAuthSchemes:(r=n).httpAuthSchemes(),httpAuthSchemeProvider:r.httpAuthSchemeProvider(),credentials:r.credentials()});var r})((e=>{const t=Vb(e);return Object.assign(t,{authSchemePreference:Rg(e.authSchemePreference??[])})})(oE(s)),e?.extensions||[]);this.config=a,this.middlewareStack.use(ox(this.config)),this.middlewareStack.use(RE(this.config)),this.middlewareStack.use(bx(this.config)),this.middlewareStack.use(kg(this.config)),this.middlewareStack.use(Og(this.config)),this.middlewareStack.use(Tg(this.config)),this.middlewareStack.use($g(this.config,{httpAuthSchemeParametersProvider:zq,identityProviderConfigProvider:async e=>new yv({"aws.auth#sigv4":e.credentials})})),this.middlewareStack.use(qg(this.config))}destroy(){super.destroy()}}});const WW=async(e,t,n)=>({operation:Pg(t).operation,region:await Rg(e.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});const HW=e=>{const t=[];if("AssumeRoleWithWebIdentity"===e.operation)t.push({schemeId:"smithy.api#noAuth"});else t.push(function(e){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"sts",region:e.region},propertiesExtractor:(e,t)=>({signingProperties:{config:e,context:t}})}}(e));return t},KW=e=>{const t=(n=e,Object.assign(n,{stsClientCtor:jH}));var n;const r=Vb(t);return Object.assign(r,{authSchemePreference:Rg(e.authSchemePreference??[])})},GW={UseGlobalEndpoint:{type:"builtInParams",name:"useGlobalEndpoint"},UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}},VW="required",ZW="type",JW="fn",YW="argv",XW="ref",QW=!1,eH=!0,tH="booleanEquals",nH="stringEquals",rH="sigv4",iH="us-east-1",sH="endpoint",aH="https://sts.{Region}.{PartitionResult#dnsSuffix}",oH="tree",cH="error",lH="getAttr",uH={[VW]:!1,[ZW]:"String"},dH={[VW]:!0,default:!1,[ZW]:"Boolean"},pH={[XW]:"Endpoint"},hH={[JW]:"isSet",[YW]:[{[XW]:"Region"}]},mH={[XW]:"Region"},fH={[JW]:"aws.partition",[YW]:[mH],assign:"PartitionResult"},gH={[XW]:"UseFIPS"},yH={[XW]:"UseDualStack"},vH={url:"https://sts.amazonaws.com",properties:{authSchemes:[{name:rH,signingName:"sts",signingRegion:iH}]},headers:{}},bH={},wH={conditions:[{[JW]:nH,[YW]:[mH,"aws-global"]}],[sH]:vH,[ZW]:sH},_H={[JW]:tH,[YW]:[gH,!0]},xH={[JW]:tH,[YW]:[yH,!0]},EH={[JW]:lH,[YW]:[{[XW]:"PartitionResult"},"supportsFIPS"]},SH={[XW]:"PartitionResult"},kH={[JW]:tH,[YW]:[!0,{[JW]:lH,[YW]:[SH,"supportsDualStack"]}]},AH=[{[JW]:"isSet",[YW]:[pH]}],OH=[_H],CH=[xH],IH={parameters:{Region:uH,UseDualStack:dH,UseFIPS:dH,Endpoint:uH,UseGlobalEndpoint:dH},rules:[{conditions:[{[JW]:tH,[YW]:[{[XW]:"UseGlobalEndpoint"},eH]},{[JW]:"not",[YW]:AH},hH,fH,{[JW]:tH,[YW]:[gH,QW]},{[JW]:tH,[YW]:[yH,QW]}],rules:[{conditions:[{[JW]:nH,[YW]:[mH,"ap-northeast-1"]}],endpoint:vH,[ZW]:sH},{conditions:[{[JW]:nH,[YW]:[mH,"ap-south-1"]}],endpoint:vH,[ZW]:sH},{conditions:[{[JW]:nH,[YW]:[mH,"ap-southeast-1"]}],endpoint:vH,[ZW]:sH},{conditions:[{[JW]:nH,[YW]:[mH,"ap-southeast-2"]}],endpoint:vH,[ZW]:sH},wH,{conditions:[{[JW]:nH,[YW]:[mH,"ca-central-1"]}],endpoint:vH,[ZW]:sH},{conditions:[{[JW]:nH,[YW]:[mH,"eu-central-1"]}],endpoint:vH,[ZW]:sH},{conditions:[{[JW]:nH,[YW]:[mH,"eu-north-1"]}],endpoint:vH,[ZW]:sH},{conditions:[{[JW]:nH,[YW]:[mH,"eu-west-1"]}],endpoint:vH,[ZW]:sH},{conditions:[{[JW]:nH,[YW]:[mH,"eu-west-2"]}],endpoint:vH,[ZW]:sH},{conditions:[{[JW]:nH,[YW]:[mH,"eu-west-3"]}],endpoint:vH,[ZW]:sH},{conditions:[{[JW]:nH,[YW]:[mH,"sa-east-1"]}],endpoint:vH,[ZW]:sH},{conditions:[{[JW]:nH,[YW]:[mH,iH]}],endpoint:vH,[ZW]:sH},{conditions:[{[JW]:nH,[YW]:[mH,"us-east-2"]}],endpoint:vH,[ZW]:sH},{conditions:[{[JW]:nH,[YW]:[mH,"us-west-1"]}],endpoint:vH,[ZW]:sH},{conditions:[{[JW]:nH,[YW]:[mH,"us-west-2"]}],endpoint:vH,[ZW]:sH},{endpoint:{url:aH,properties:{authSchemes:[{name:rH,signingName:"sts",signingRegion:"{Region}"}]},headers:bH},[ZW]:sH}],[ZW]:oH},{conditions:AH,rules:[{conditions:OH,error:"Invalid Configuration: FIPS and custom endpoint are not supported",[ZW]:cH},{conditions:CH,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",[ZW]:cH},{endpoint:{url:pH,properties:bH,headers:bH},[ZW]:sH}],[ZW]:oH},{conditions:[hH],rules:[{conditions:[fH],rules:[{conditions:[_H,xH],rules:[{conditions:[{[JW]:tH,[YW]:[eH,EH]},kH],rules:[{endpoint:{url:"https://sts-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:bH,headers:bH},[ZW]:sH}],[ZW]:oH},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",[ZW]:cH}],[ZW]:oH},{conditions:OH,rules:[{conditions:[{[JW]:tH,[YW]:[EH,eH]}],rules:[{conditions:[{[JW]:nH,[YW]:[{[JW]:lH,[YW]:[SH,"name"]},"aws-us-gov"]}],endpoint:{url:"https://sts.{Region}.amazonaws.com",properties:bH,headers:bH},[ZW]:sH},{endpoint:{url:"https://sts-fips.{Region}.{PartitionResult#dnsSuffix}",properties:bH,headers:bH},[ZW]:sH}],[ZW]:oH},{error:"FIPS is enabled but this partition does not support FIPS",[ZW]:cH}],[ZW]:oH},{conditions:CH,rules:[{conditions:[kH],rules:[{endpoint:{url:"https://sts.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:bH,headers:bH},[ZW]:sH}],[ZW]:oH},{error:"DualStack is enabled but this partition does not support DualStack",[ZW]:cH}],[ZW]:oH},wH,{endpoint:{url:aH,properties:bH,headers:bH},[ZW]:sH}],[ZW]:oH}],[ZW]:oH},{error:"Invalid Configuration: Missing Region",[ZW]:cH}]},TH=new kv({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS","UseGlobalEndpoint"]}),PH=(e,t={})=>TH.get(e,()=>Jv(IH,{endpointParams:e,logger:t.logger}));Tv.aws=Qv;const RH=e=>{dw(process.version);const t=uk(e),n=()=>t().then(lw),r=(e=>({apiVersion:"2011-06-15",base64Decoder:e?.base64Decoder??Zg,base64Encoder:e?.base64Encoder??Qg,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??PH,extensions:e?.extensions??[],httpAuthSchemeProvider:e?.httpAuthSchemeProvider??HW,httpAuthSchemes:e?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4"),signer:new cb},{schemeId:"smithy.api#noAuth",identityProvider:e=>e.getIdentityProvider("smithy.api#noAuth")||(async()=>({})),signer:new vv}],logger:e?.logger??new gw,serviceId:e?.serviceId??"STS",urlParser:e?.urlParser??tE,utf8Decoder:e?.utf8Decoder??Jg,utf8Encoder:e?.utf8Encoder??Xg}))(e);tb(process.version);const i={profile:e?.profile,logger:r.logger};return{...r,...e,runtime:"node",defaultsMode:t,authSchemePreference:e?.authSchemePreference??Yx(pb,i),bodyLengthChecker:e?.bodyLengthChecker??NS,defaultUserAgentProvider:e?.defaultUserAgentProvider??AS({serviceId:r.serviceId,clientVersion:PB}),httpAuthSchemes:e?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:t=>t.getIdentityProvider("aws.auth#sigv4")||(async t=>await e.credentialDefaultProvider(t?.__config||{})()),signer:new cb},{schemeId:"smithy.api#noAuth",identityProvider:e=>e.getIdentityProvider("smithy.api#noAuth")||(async()=>({})),signer:new vv}],maxAttempts:e?.maxAttempts??Yx(SE,e),region:e?.region??Yx(px,{...hx,...i}),requestHandler:dy.create(e?.requestHandler??n),retryMode:e?.retryMode??Yx({...AE,default:async()=>(await n()).retryMode||lE},e),sha256:e?.sha256??RS.bind(null,"sha256"),streamCollector:e?.streamCollector??gy,useDualstackEndpoint:e?.useDualstackEndpoint??Yx(ux,i),useFipsEndpoint:e?.useFipsEndpoint??Yx(dx,i),userAgentAppId:e?.userAgentAppId??Yx(OS,i)}};let jH=class extends ew{config;constructor(...[e]){const t=RH(e||{});super(t),this.initConfig=t;var n;const r=Sv((n=t,Object.assign(n,{useDualstackEndpoint:n.useDualstackEndpoint??!1,useFipsEndpoint:n.useFipsEndpoint??!1,useGlobalEndpoint:n.useGlobalEndpoint??!1,defaultSigningName:"sts"}))),i=kE(r),s=gx(i),a=oE(s),o=((e,t)=>{const n=Object.assign(mk(e),pw(e),pg(e),(e=>{const t=e.httpAuthSchemes;let n=e.httpAuthSchemeProvider,r=e.credentials;return{setHttpAuthScheme(e){const n=t.findIndex(t=>t.schemeId===e.schemeId);-1===n?t.push(e):t.splice(n,1,e)},httpAuthSchemes:()=>t,setHttpAuthSchemeProvider(e){n=e},httpAuthSchemeProvider:()=>n,setCredentials(e){r=e},credentials:()=>r}})(e));return t.forEach(e=>e.configure(n)),Object.assign(e,fk(n),hw(n),hg(n),{httpAuthSchemes:(r=n).httpAuthSchemes(),httpAuthSchemeProvider:r.httpAuthSchemeProvider(),credentials:r.credentials()});var r})(KW(a),e?.extensions||[]);this.config=o,this.middlewareStack.use(ox(this.config)),this.middlewareStack.use(RE(this.config)),this.middlewareStack.use(bx(this.config)),this.middlewareStack.use(kg(this.config)),this.middlewareStack.use(Og(this.config)),this.middlewareStack.use(Tg(this.config)),this.middlewareStack.use($g(this.config,{httpAuthSchemeParametersProvider:WW,identityProviderConfigProvider:async e=>new yv({"aws.auth#sigv4":e.credentials})})),this.middlewareStack.use(qg(this.config))}destroy(){super.destroy()}},NH=class e extends sw{constructor(t){super(t),Object.setPrototypeOf(this,e.prototype)}};const $H=e=>({...e,...e.SecretAccessKey&&{SecretAccessKey:rw}}),LH=e=>({...e,...e.Credentials&&{Credentials:$H(e.Credentials)}});let DH=class e extends NH{name="ExpiredTokenException";$fault="client";constructor(t){super({name:"ExpiredTokenException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype)}},UH=class e extends NH{name="MalformedPolicyDocumentException";$fault="client";constructor(t){super({name:"MalformedPolicyDocumentException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype)}},MH=class e extends NH{name="PackedPolicyTooLargeException";$fault="client";constructor(t){super({name:"PackedPolicyTooLargeException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype)}},FH=class e extends NH{name="RegionDisabledException";$fault="client";constructor(t){super({name:"RegionDisabledException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype)}},zH=class e extends NH{name="IDPRejectedClaimException";$fault="client";constructor(t){super({name:"IDPRejectedClaimException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype)}},BH=class e extends NH{name="InvalidIdentityTokenException";$fault="client";constructor(t){super({name:"InvalidIdentityTokenException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype)}};const qH=e=>({...e,...e.WebIdentityToken&&{WebIdentityToken:rw}}),WH=e=>({...e,...e.Credentials&&{Credentials:$H(e.Credentials)}});let HH=class e extends NH{name="IDPCommunicationErrorException";$fault="client";constructor(t){super({name:"IDPCommunicationErrorException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype)}};const KH=async(e,t)=>{const n=OK;let r;return r=dG({...iK(e),[IK]:PK,[aG]:CK}),AK(t,n,"/",void 0,r)},GH=async(e,t)=>{const n=OK;let r;return r=dG({...sK(e),[IK]:NK,[aG]:CK}),AK(t,n,"/",void 0,r)},VH=async(e,t)=>{if(e.statusCode>=300)return JH(e,t);const n=await Y_(e.body,t);let r={};r=mK(n.AssumeRoleResult);return{$metadata:SK(e),...r}},ZH=async(e,t)=>{if(e.statusCode>=300)return JH(e,t);const n=await Y_(e.body,t);let r={};r=fK(n.AssumeRoleWithWebIdentityResult);return{$metadata:SK(e),...r}},JH=async(e,t)=>{const n={...e,body:await X_(e.body,t)},r=pG(e,n.body);switch(r){case"ExpiredTokenException":case"com.amazonaws.sts#ExpiredTokenException":throw await YH(n);case"MalformedPolicyDocument":case"com.amazonaws.sts#MalformedPolicyDocumentException":throw await tK(n);case"PackedPolicyTooLarge":case"com.amazonaws.sts#PackedPolicyTooLargeException":throw await nK(n);case"RegionDisabledException":case"com.amazonaws.sts#RegionDisabledException":throw await rK(n);case"IDPCommunicationError":case"com.amazonaws.sts#IDPCommunicationErrorException":throw await XH(n);case"IDPRejectedClaim":case"com.amazonaws.sts#IDPRejectedClaimException":throw await QH(n);case"InvalidIdentityToken":case"com.amazonaws.sts#InvalidIdentityTokenException":throw await eK(n);default:const t=n.body;return kK({output:e,parsedBody:t.Error,errorCode:r})}},YH=async(e,t)=>{const n=e.body,r=yK(n.Error),i=new DH({$metadata:SK(e),...r});return aw(i,n)},XH=async(e,t)=>{const n=e.body,r=vK(n.Error),i=new HH({$metadata:SK(e),...r});return aw(i,n)},QH=async(e,t)=>{const n=e.body,r=bK(n.Error),i=new zH({$metadata:SK(e),...r});return aw(i,n)},eK=async(e,t)=>{const n=e.body,r=wK(n.Error),i=new BH({$metadata:SK(e),...r});return aw(i,n)},tK=async(e,t)=>{const n=e.body,r=_K(n.Error),i=new UH({$metadata:SK(e),...r});return aw(i,n)},nK=async(e,t)=>{const n=e.body,r=xK(n.Error),i=new MH({$metadata:SK(e),...r});return aw(i,n)},rK=async(e,t)=>{const n=e.body,r=EK(n.Error),i=new FH({$metadata:SK(e),...r});return aw(i,n)},iK=(e,t)=>{const n={};if(null!=e[JK]&&(n[JK]=e[JK]),null!=e[YK]&&(n[YK]=e[YK]),null!=e[WK]){const t=aK(e[WK]);0===e[WK]?.length&&(n.PolicyArns=[]),Object.entries(t).forEach(([e,t])=>{n[`PolicyArns.${e}`]=t})}if(null!=e[qK]&&(n[qK]=e[qK]),null!=e[MK]&&(n[MK]=e[MK]),null!=e[rG]){const t=pK(e[rG]);0===e[rG]?.length&&(n.Tags=[]),Object.entries(t).forEach(([e,t])=>{n[`Tags.${e}`]=t})}if(null!=e[sG]){const t=dK(e[sG]);0===e[sG]?.length&&(n.TransitiveTagKeys=[]),Object.entries(t).forEach(([e,t])=>{n[`TransitiveTagKeys.${e}`]=t})}if(null!=e[zK]&&(n[zK]=e[zK]),null!=e[tG]&&(n[tG]=e[tG]),null!=e[iG]&&(n[iG]=e[iG]),null!=e[eG]&&(n[eG]=e[eG]),null!=e[KK]){const t=lK(e[KK]);0===e[KK]?.length&&(n.ProvidedContexts=[]),Object.entries(t).forEach(([e,t])=>{n[`ProvidedContexts.${e}`]=t})}return n},sK=(e,t)=>{const n={};if(null!=e[JK]&&(n[JK]=e[JK]),null!=e[YK]&&(n[YK]=e[YK]),null!=e[cG]&&(n[cG]=e[cG]),null!=e[GK]&&(n[GK]=e[GK]),null!=e[WK]){const t=aK(e[WK]);0===e[WK]?.length&&(n.PolicyArns=[]),Object.entries(t).forEach(([e,t])=>{n[`PolicyArns.${e}`]=t})}return null!=e[qK]&&(n[qK]=e[qK]),null!=e[MK]&&(n[MK]=e[MK]),n},aK=(e,t)=>{const n={};let r=1;for(const t of e){if(null===t)continue;const e=oK(t);Object.entries(e).forEach(([e,t])=>{n[`member.${r}.${e}`]=t}),r++}return n},oK=(e,t)=>{const n={};return null!=e[lG]&&(n[lG]=e[lG]),n},cK=(e,t)=>{const n={};return null!=e[HK]&&(n[HK]=e[HK]),null!=e[UK]&&(n[UK]=e[UK]),n},lK=(e,t)=>{const n={};let r=1;for(const t of e){if(null===t)continue;const e=cK(t);Object.entries(e).forEach(([e,t])=>{n[`member.${r}.${e}`]=t}),r++}return n},uK=(e,t)=>{const n={};return null!=e[BK]&&(n[BK]=e[BK]),null!=e[oG]&&(n[oG]=e[oG]),n},dK=(e,t)=>{const n={};let r=1;for(const t of e)null!==t&&(n[`member.${r}`]=t,r++);return n},pK=(e,t)=>{const n={};let r=1;for(const t of e){if(null===t)continue;const e=uK(t);Object.entries(e).forEach(([e,t])=>{n[`member.${r}.${e}`]=t}),r++}return n},hK=(e,t)=>{const n={};return null!=e[RK]&&(n[RK]=zy(e[RK])),null!=e[$K]&&(n[$K]=zy(e[$K])),n},mK=(e,t)=>{const n={};return null!=e[DK]&&(n[DK]=gK(e[DK])),null!=e[jK]&&(n[jK]=hK(e[jK])),null!=e[VK]&&(n[VK]=Ky(e[VK])),null!=e[eG]&&(n[eG]=zy(e[eG])),n},fK=(e,t)=>{const n={};return null!=e[DK]&&(n[DK]=gK(e[DK])),null!=e[QK]&&(n[QK]=zy(e[QK])),null!=e[jK]&&(n[jK]=hK(e[jK])),null!=e[VK]&&(n[VK]=Ky(e[VK])),null!=e[ZK]&&(n[ZK]=zy(e[ZK])),null!=e[LK]&&(n[LK]=zy(e[LK])),null!=e[eG]&&(n[eG]=zy(e[eG])),n},gK=(e,t)=>{const n={};return null!=e[TK]&&(n[TK]=zy(e[TK])),null!=e[XK]&&(n[XK]=zy(e[XK])),null!=e[nG]&&(n[nG]=zy(e[nG])),null!=e[FK]&&(n[FK]=My(ev(e[FK]))),n},yK=(e,t)=>{const n={};return null!=e[uG]&&(n[uG]=zy(e[uG])),n},vK=(e,t)=>{const n={};return null!=e[uG]&&(n[uG]=zy(e[uG])),n},bK=(e,t)=>{const n={};return null!=e[uG]&&(n[uG]=zy(e[uG])),n},wK=(e,t)=>{const n={};return null!=e[uG]&&(n[uG]=zy(e[uG])),n},_K=(e,t)=>{const n={};return null!=e[uG]&&(n[uG]=zy(e[uG])),n},xK=(e,t)=>{const n={};return null!=e[uG]&&(n[uG]=zy(e[uG])),n},EK=(e,t)=>{const n={};return null!=e[uG]&&(n[uG]=zy(e[uG])),n},SK=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),kK=ow(NH),AK=async(e,t,n,r,i)=>{const{hostname:s,protocol:a="https",port:o,path:c}=await e.endpoint(),l={protocol:a,hostname:s,port:o,method:"POST",path:c.endsWith("/")?c.slice(0,-1)+n:c+n,headers:t};return void 0!==i&&(l.body=i),new xg(l)},OK={"content-type":"application/x-www-form-urlencoded"},CK="2011-06-15",IK="Action",TK="AccessKeyId",PK="AssumeRole",RK="AssumedRoleId",jK="AssumedRoleUser",NK="AssumeRoleWithWebIdentity",$K="Arn",LK="Audience",DK="Credentials",UK="ContextAssertion",MK="DurationSeconds",FK="Expiration",zK="ExternalId",BK="Key",qK="Policy",WK="PolicyArns",HK="ProviderArn",KK="ProvidedContexts",GK="ProviderId",VK="PackedPolicySize",ZK="Provider",JK="RoleArn",YK="RoleSessionName",XK="SecretAccessKey",QK="SubjectFromWebIdentityToken",eG="SourceIdentity",tG="SerialNumber",nG="SessionToken",rG="Tags",iG="TokenCode",sG="TransitiveTagKeys",aG="Version",oG="Value",cG="WebIdentityToken",lG="arn",uG="message",dG=e=>Object.entries(e).map(([e,t])=>Iy(e)+"="+Iy(t)).join("&"),pG=(e,t)=>void 0!==t.Error?.Code?t.Error.Code:404==e.statusCode?"NotFound":void 0;let hG=class extends(tw.classBuilder().ep(GW).m(function(e,t,n,r){return[Mg(n,this.serialize,this.deserialize),aE(n,e.getEndpointParameterInstructions())]}).s("AWSSecurityTokenServiceV20110615","AssumeRole",{}).n("STSClient","AssumeRoleCommand").f(void 0,LH).ser(KH).de(VH).build()){},mG=class extends(tw.classBuilder().ep(GW).m(function(e,t,n,r){return[Mg(n,this.serialize,this.deserialize),aE(n,e.getEndpointParameterInstructions())]}).s("AWSSecurityTokenServiceV20110615","AssumeRoleWithWebIdentity",{}).n("STSClient","AssumeRoleWithWebIdentityCommand").f(qH,WH).ser(GH).de(ZH).build()){};const fG={AssumeRoleCommand:hG,AssumeRoleWithWebIdentityCommand:mG};let gG=class extends jH{};iw(fG,gG);const yG="us-east-1",vG=e=>{if("string"==typeof e?.Arn){const t=e.Arn.split(":");if(t.length>4&&""!==t[4])return t[4]}},bG=async(e,t,n)=>{const r="function"==typeof e?await e():e,i="function"==typeof t?await t():t;return n?.debug?.("@aws-sdk/client-sts::resolveRegion","accepting first of:",`${r} (provider)`,`${i} (parent client)`,`${yG} (STS default)`),r??i??yG},wG=e=>"h2"===e?.metadata?.handlerProtocol,_G=(e,t)=>t?class extends e{constructor(e){super(e);for(const e of t)this.middlewareStack.use(e)}}:e;var xG=Object.freeze({__proto__:null,$Command:tw,AssumeRoleCommand:hG,AssumeRoleResponseFilterSensitiveLog:LH,AssumeRoleWithWebIdentityCommand:mG,AssumeRoleWithWebIdentityRequestFilterSensitiveLog:qH,AssumeRoleWithWebIdentityResponseFilterSensitiveLog:WH,CredentialsFilterSensitiveLog:$H,ExpiredTokenException:DH,IDPCommunicationErrorException:HH,IDPRejectedClaimException:zH,InvalidIdentityTokenException:BH,MalformedPolicyDocumentException:UH,PackedPolicyTooLargeException:MH,RegionDisabledException:FH,STS:gG,STSClient:jH,STSServiceException:NH,__Client:ew,getDefaultRoleAssumer:(e={},t)=>((e,t)=>{let n,r;return async(i,s)=>{if(r=i,!n){const{logger:i=e?.parentClientConfig?.logger,region:s,requestHandler:a=e?.parentClientConfig?.requestHandler,credentialProviderLogger:o}=e,c=await bG(s,e?.parentClientConfig?.region,o),l=!wG(a);n=new t({profile:e?.parentClientConfig?.profile,credentialDefaultProvider:()=>async()=>r,region:c,requestHandler:l?a:void 0,logger:i})}const{Credentials:a,AssumedRoleUser:o}=await n.send(new hG(s));if(!a||!a.AccessKeyId||!a.SecretAccessKey)throw new Error(`Invalid response from STS.assumeRole call with role ${s.RoleArn}`);const c=vG(o),l={accessKeyId:a.AccessKeyId,secretAccessKey:a.SecretAccessKey,sessionToken:a.SessionToken,expiration:a.Expiration,...a.CredentialScope&&{credentialScope:a.CredentialScope},...c&&{accountId:c}};return nb(l,"CREDENTIALS_STS_ASSUME_ROLE","i"),l}})(e,_G(jH,t)),getDefaultRoleAssumerWithWebIdentity:(e={},t)=>((e,t)=>{let n;return async r=>{if(!n){const{logger:r=e?.parentClientConfig?.logger,region:i,requestHandler:s=e?.parentClientConfig?.requestHandler,credentialProviderLogger:a}=e,o=await bG(i,e?.parentClientConfig?.region,a),c=!wG(s);n=new t({profile:e?.parentClientConfig?.profile,region:o,requestHandler:c?s:void 0,logger:r})}const{Credentials:i,AssumedRoleUser:s}=await n.send(new mG(r));if(!i||!i.AccessKeyId||!i.SecretAccessKey)throw new Error(`Invalid response from STS.assumeRoleWithWebIdentity call with role ${r.RoleArn}`);const a=vG(s),o={accessKeyId:i.AccessKeyId,secretAccessKey:i.SecretAccessKey,sessionToken:i.SessionToken,expiration:i.Expiration,...i.CredentialScope&&{credentialScope:i.CredentialScope},...a&&{accountId:a}};return a&&nb(o,"RESOLVED_ACCOUNT_ID","T"),nb(o,"CREDENTIALS_STS_ASSUME_ROLE_WEB_ID","k"),o}})(e,_G(jH,t))});const EG=async(e,t,n)=>({operation:Pg(t).operation,region:await Rg(e.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});const SG=e=>{const t=[];if("CreateToken"===e.operation)t.push({schemeId:"smithy.api#noAuth"});else t.push(function(e){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"sso-oauth",region:e.region},propertiesExtractor:(e,t)=>({signingProperties:{config:e,context:t}})}}(e));return t},kG={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}};var AG="3.864.0";const OG="required",CG="fn",IG="argv",TG="ref",PG=!0,RG="isSet",jG="booleanEquals",NG="error",$G="endpoint",LG="tree",DG="PartitionResult",UG="getAttr",MG={[OG]:!1,type:"String"},FG={[OG]:!0,default:!1,type:"Boolean"},zG={[TG]:"Endpoint"},BG={[CG]:jG,[IG]:[{[TG]:"UseFIPS"},!0]},qG={[CG]:jG,[IG]:[{[TG]:"UseDualStack"},!0]},WG={},HG={[CG]:UG,[IG]:[{[TG]:DG},"supportsFIPS"]},KG={[TG]:DG},GG={[CG]:jG,[IG]:[!0,{[CG]:UG,[IG]:[KG,"supportsDualStack"]}]},VG=[BG],ZG=[qG],JG=[{[TG]:"Region"}],YG={parameters:{Region:MG,UseDualStack:FG,UseFIPS:FG,Endpoint:MG},rules:[{conditions:[{[CG]:RG,[IG]:[zG]}],rules:[{conditions:VG,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:NG},{conditions:ZG,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:NG},{endpoint:{url:zG,properties:WG,headers:WG},type:$G}],type:LG},{conditions:[{[CG]:RG,[IG]:JG}],rules:[{conditions:[{[CG]:"aws.partition",[IG]:JG,assign:DG}],rules:[{conditions:[BG,qG],rules:[{conditions:[{[CG]:jG,[IG]:[PG,HG]},GG],rules:[{endpoint:{url:"https://oidc-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:WG,headers:WG},type:$G}],type:LG},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:NG}],type:LG},{conditions:VG,rules:[{conditions:[{[CG]:jG,[IG]:[HG,PG]}],rules:[{conditions:[{[CG]:"stringEquals",[IG]:[{[CG]:UG,[IG]:[KG,"name"]},"aws-us-gov"]}],endpoint:{url:"https://oidc.{Region}.amazonaws.com",properties:WG,headers:WG},type:$G},{endpoint:{url:"https://oidc-fips.{Region}.{PartitionResult#dnsSuffix}",properties:WG,headers:WG},type:$G}],type:LG},{error:"FIPS is enabled but this partition does not support FIPS",type:NG}],type:LG},{conditions:ZG,rules:[{conditions:[GG],rules:[{endpoint:{url:"https://oidc.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:WG,headers:WG},type:$G}],type:LG},{error:"DualStack is enabled but this partition does not support DualStack",type:NG}],type:LG},{endpoint:{url:"https://oidc.{Region}.{PartitionResult#dnsSuffix}",properties:WG,headers:WG},type:$G}],type:LG}],type:LG},{error:"Invalid Configuration: Missing Region",type:NG}]},XG=new kv({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),QG=(e,t={})=>XG.get(e,()=>Jv(YG,{endpointParams:e,logger:t.logger}));Tv.aws=WC;const eV=e=>{dw(process.version);const t=uk(e),n=()=>t().then(lw),r=(e=>({apiVersion:"2019-06-10",base64Decoder:e?.base64Decoder??Zg,base64Encoder:e?.base64Encoder??Qg,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??QG,extensions:e?.extensions??[],httpAuthSchemeProvider:e?.httpAuthSchemeProvider??SG,httpAuthSchemes:e?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4"),signer:new ZC},{schemeId:"smithy.api#noAuth",identityProvider:e=>e.getIdentityProvider("smithy.api#noAuth")||(async()=>({})),signer:new vv}],logger:e?.logger??new gw,serviceId:e?.serviceId??"SSO OIDC",urlParser:e?.urlParser??tE,utf8Decoder:e?.utf8Decoder??Jg,utf8Encoder:e?.utf8Encoder??Xg}))(e);QO(process.version);const i={profile:e?.profile,logger:r.logger};return{...r,...e,runtime:"node",defaultsMode:t,authSchemePreference:e?.authSchemePreference??Yx(QC,i),bodyLengthChecker:e?.bodyLengthChecker??NS,defaultUserAgentProvider:e?.defaultUserAgentProvider??bT({serviceId:r.serviceId,clientVersion:AG}),maxAttempts:e?.maxAttempts??Yx(SE,e),region:e?.region??Yx(px,{...hx,...i}),requestHandler:dy.create(e?.requestHandler??n),retryMode:e?.retryMode??Yx({...AE,default:async()=>(await n()).retryMode||lE},e),sha256:e?.sha256??RS.bind(null,"sha256"),streamCollector:e?.streamCollector??gy,useDualstackEndpoint:e?.useDualstackEndpoint??Yx(ux,i),useFipsEndpoint:e?.useFipsEndpoint??Yx(dx,i),userAgentAppId:e?.userAgentAppId??Yx(wT,i)}};class tV extends ew{config;constructor(...[e]){const t=eV(e||{});super(t),this.initConfig=t;var n;const r=zC((n=t,Object.assign(n,{useDualstackEndpoint:n.useDualstackEndpoint??!1,useFipsEndpoint:n.useFipsEndpoint??!1,defaultSigningName:"sso-oauth"}))),i=kE(r),s=gx(i),a=((e,t)=>{const n=Object.assign(_T(e),pw(e),pg(e),(e=>{const t=e.httpAuthSchemes;let n=e.httpAuthSchemeProvider,r=e.credentials;return{setHttpAuthScheme(e){const n=t.findIndex(t=>t.schemeId===e.schemeId);-1===n?t.push(e):t.splice(n,1,e)},httpAuthSchemes:()=>t,setHttpAuthSchemeProvider(e){n=e},httpAuthSchemeProvider:()=>n,setCredentials(e){r=e},credentials:()=>r}})(e));return t.forEach(e=>e.configure(n)),Object.assign(e,xT(n),hw(n),hg(n),{httpAuthSchemes:(r=n).httpAuthSchemes(),httpAuthSchemeProvider:r.httpAuthSchemeProvider(),credentials:r.credentials()});var r})((e=>{const t=eI(e);return Object.assign(t,{authSchemePreference:Rg(e.authSchemePreference??[])})})(oE(s)),e?.extensions||[]);this.config=a,this.middlewareStack.use(vT(this.config)),this.middlewareStack.use(RE(this.config)),this.middlewareStack.use(bx(this.config)),this.middlewareStack.use(NC(this.config)),this.middlewareStack.use(LC(this.config)),this.middlewareStack.use(MC(this.config)),this.middlewareStack.use($g(this.config,{httpAuthSchemeParametersProvider:EG,identityProviderConfigProvider:async e=>new yv({"aws.auth#sigv4":e.credentials})})),this.middlewareStack.use(qg(this.config))}destroy(){super.destroy()}}class nV extends sw{constructor(e){super(e),Object.setPrototypeOf(this,nV.prototype)}}class rV extends nV{name="AccessDeniedException";$fault="client";error;error_description;constructor(e){super({name:"AccessDeniedException",$fault:"client",...e}),Object.setPrototypeOf(this,rV.prototype),this.error=e.error,this.error_description=e.error_description}}class iV extends nV{name="AuthorizationPendingException";$fault="client";error;error_description;constructor(e){super({name:"AuthorizationPendingException",$fault:"client",...e}),Object.setPrototypeOf(this,iV.prototype),this.error=e.error,this.error_description=e.error_description}}const sV=e=>({...e,...e.clientSecret&&{clientSecret:rw},...e.refreshToken&&{refreshToken:rw},...e.codeVerifier&&{codeVerifier:rw}}),aV=e=>({...e,...e.accessToken&&{accessToken:rw},...e.refreshToken&&{refreshToken:rw},...e.idToken&&{idToken:rw}});let oV=class e extends nV{name="ExpiredTokenException";$fault="client";error;error_description;constructor(t){super({name:"ExpiredTokenException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}};class cV extends nV{name="InternalServerException";$fault="server";error;error_description;constructor(e){super({name:"InternalServerException",$fault:"server",...e}),Object.setPrototypeOf(this,cV.prototype),this.error=e.error,this.error_description=e.error_description}}class lV extends nV{name="InvalidClientException";$fault="client";error;error_description;constructor(e){super({name:"InvalidClientException",$fault:"client",...e}),Object.setPrototypeOf(this,lV.prototype),this.error=e.error,this.error_description=e.error_description}}class uV extends nV{name="InvalidGrantException";$fault="client";error;error_description;constructor(e){super({name:"InvalidGrantException",$fault:"client",...e}),Object.setPrototypeOf(this,uV.prototype),this.error=e.error,this.error_description=e.error_description}}let dV=class e extends nV{name="InvalidRequestException";$fault="client";error;error_description;constructor(t){super({name:"InvalidRequestException",$fault:"client",...t}),Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}};class pV extends nV{name="InvalidScopeException";$fault="client";error;error_description;constructor(e){super({name:"InvalidScopeException",$fault:"client",...e}),Object.setPrototypeOf(this,pV.prototype),this.error=e.error,this.error_description=e.error_description}}class hV extends nV{name="SlowDownException";$fault="client";error;error_description;constructor(e){super({name:"SlowDownException",$fault:"client",...e}),Object.setPrototypeOf(this,hV.prototype),this.error=e.error,this.error_description=e.error_description}}class mV extends nV{name="UnauthorizedClientException";$fault="client";error;error_description;constructor(e){super({name:"UnauthorizedClientException",$fault:"client",...e}),Object.setPrototypeOf(this,mV.prototype),this.error=e.error,this.error_description=e.error_description}}class fV extends nV{name="UnsupportedGrantTypeException";$fault="client";error;error_description;constructor(e){super({name:"UnsupportedGrantTypeException",$fault:"client",...e}),Object.setPrototypeOf(this,fV.prototype),this.error=e.error,this.error_description=e.error_description}}const gV=async(e,t)=>{const n=fv(e,t);let r;return n.bp("/token"),r=JSON.stringify(vw(e,{clientId:[],clientSecret:[],code:[],codeVerifier:[],deviceCode:[],grantType:[],redirectUri:[],refreshToken:[],scope:e=>Sw(e)})),n.m("POST").h({"content-type":"application/json"}).b(r),n.build()},yV=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return vV(e,t);const n=yw({$metadata:PV(e)}),r=My(Fy(await nI(e.body,t)),"body"),i=vw(r,{accessToken:zy,expiresIn:Ny,idToken:zy,refreshToken:zy,tokenType:zy});return Object.assign(n,i),n},vV=async(e,t)=>{const n={...e,body:await rI(e.body,t)},r=iI(e,n.body);switch(r){case"AccessDeniedException":case"com.amazonaws.ssooidc#AccessDeniedException":throw await wV(n);case"AuthorizationPendingException":case"com.amazonaws.ssooidc#AuthorizationPendingException":throw await _V(n);case"ExpiredTokenException":case"com.amazonaws.ssooidc#ExpiredTokenException":throw await xV(n);case"InternalServerException":case"com.amazonaws.ssooidc#InternalServerException":throw await EV(n);case"InvalidClientException":case"com.amazonaws.ssooidc#InvalidClientException":throw await SV(n);case"InvalidGrantException":case"com.amazonaws.ssooidc#InvalidGrantException":throw await kV(n);case"InvalidRequestException":case"com.amazonaws.ssooidc#InvalidRequestException":throw await AV(n);case"InvalidScopeException":case"com.amazonaws.ssooidc#InvalidScopeException":throw await OV(n);case"SlowDownException":case"com.amazonaws.ssooidc#SlowDownException":throw await CV(n);case"UnauthorizedClientException":case"com.amazonaws.ssooidc#UnauthorizedClientException":throw await IV(n);case"UnsupportedGrantTypeException":case"com.amazonaws.ssooidc#UnsupportedGrantTypeException":throw await TV(n);default:const t=n.body;return bV({output:e,parsedBody:t,errorCode:r})}},bV=ow(nV),wV=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new rV({$metadata:PV(e),...n});return aw(s,e.body)},_V=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new iV({$metadata:PV(e),...n});return aw(s,e.body)},xV=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new oV({$metadata:PV(e),...n});return aw(s,e.body)},EV=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new cV({$metadata:PV(e),...n});return aw(s,e.body)},SV=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new lV({$metadata:PV(e),...n});return aw(s,e.body)},kV=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new uV({$metadata:PV(e),...n});return aw(s,e.body)},AV=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new dV({$metadata:PV(e),...n});return aw(s,e.body)},OV=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new pV({$metadata:PV(e),...n});return aw(s,e.body)},CV=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new hV({$metadata:PV(e),...n});return aw(s,e.body)},IV=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new mV({$metadata:PV(e),...n});return aw(s,e.body)},TV=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{error:zy,error_description:zy});Object.assign(n,i);const s=new fV({$metadata:PV(e),...n});return aw(s,e.body)},PV=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]});class RV extends(tw.classBuilder().ep(kG).m(function(e,t,n,r){return[Mg(n,this.serialize,this.deserialize),aE(n,e.getEndpointParameterInstructions())]}).s("AWSSSOOIDCService","CreateToken",{}).n("SSOOIDCClient","CreateTokenCommand").f(sV,aV).ser(gV).de(yV).build()){}const jV={CreateTokenCommand:RV};class NV extends tV{}iw(jV,NV);var $V=Object.freeze({__proto__:null,$Command:tw,AccessDeniedException:rV,AuthorizationPendingException:iV,CreateTokenCommand:RV,CreateTokenRequestFilterSensitiveLog:sV,CreateTokenResponseFilterSensitiveLog:aV,ExpiredTokenException:oV,InternalServerException:cV,InvalidClientException:lV,InvalidGrantException:uV,InvalidRequestException:dV,InvalidScopeException:pV,SSOOIDC:NV,SSOOIDCClient:tV,SSOOIDCServiceException:nV,SlowDownException:hV,UnauthorizedClientException:mV,UnsupportedGrantTypeException:fV,__Client:ew});const LV=async(e,t,n)=>({operation:Pg(t).operation,region:await Rg(e.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});const DV=e=>{const t=[];switch(e.operation){case"GetRoleCredentials":case"ListAccountRoles":case"ListAccounts":case"Logout":t.push({schemeId:"smithy.api#noAuth"});break;default:t.push(function(e){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"awsssoportal",region:e.region},propertiesExtractor:(e,t)=>({signingProperties:{config:e,context:t}})}}(e))}return t},UV={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}};var MV="3.864.0";const FV="required",zV="fn",BV="argv",qV="ref",WV=!0,HV="isSet",KV="booleanEquals",GV="error",VV="endpoint",ZV="tree",JV="PartitionResult",YV="getAttr",XV={[FV]:!1,type:"String"},QV={[FV]:!0,default:!1,type:"Boolean"},eZ={[qV]:"Endpoint"},tZ={[zV]:KV,[BV]:[{[qV]:"UseFIPS"},!0]},nZ={[zV]:KV,[BV]:[{[qV]:"UseDualStack"},!0]},rZ={},iZ={[zV]:YV,[BV]:[{[qV]:JV},"supportsFIPS"]},sZ={[qV]:JV},aZ={[zV]:KV,[BV]:[!0,{[zV]:YV,[BV]:[sZ,"supportsDualStack"]}]},oZ=[tZ],cZ=[nZ],lZ=[{[qV]:"Region"}],uZ={parameters:{Region:XV,UseDualStack:QV,UseFIPS:QV,Endpoint:XV},rules:[{conditions:[{[zV]:HV,[BV]:[eZ]}],rules:[{conditions:oZ,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:GV},{conditions:cZ,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:GV},{endpoint:{url:eZ,properties:rZ,headers:rZ},type:VV}],type:ZV},{conditions:[{[zV]:HV,[BV]:lZ}],rules:[{conditions:[{[zV]:"aws.partition",[BV]:lZ,assign:JV}],rules:[{conditions:[tZ,nZ],rules:[{conditions:[{[zV]:KV,[BV]:[WV,iZ]},aZ],rules:[{endpoint:{url:"https://portal.sso-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:rZ,headers:rZ},type:VV}],type:ZV},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:GV}],type:ZV},{conditions:oZ,rules:[{conditions:[{[zV]:KV,[BV]:[iZ,WV]}],rules:[{conditions:[{[zV]:"stringEquals",[BV]:[{[zV]:YV,[BV]:[sZ,"name"]},"aws-us-gov"]}],endpoint:{url:"https://portal.sso.{Region}.amazonaws.com",properties:rZ,headers:rZ},type:VV},{endpoint:{url:"https://portal.sso-fips.{Region}.{PartitionResult#dnsSuffix}",properties:rZ,headers:rZ},type:VV}],type:ZV},{error:"FIPS is enabled but this partition does not support FIPS",type:GV}],type:ZV},{conditions:cZ,rules:[{conditions:[aZ],rules:[{endpoint:{url:"https://portal.sso.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:rZ,headers:rZ},type:VV}],type:ZV},{error:"DualStack is enabled but this partition does not support DualStack",type:GV}],type:ZV},{endpoint:{url:"https://portal.sso.{Region}.{PartitionResult#dnsSuffix}",properties:rZ,headers:rZ},type:VV}],type:ZV}],type:ZV},{error:"Invalid Configuration: Missing Region",type:GV}]},dZ=new kv({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),pZ=(e,t={})=>dZ.get(e,()=>Jv(uZ,{endpointParams:e,logger:t.logger}));Tv.aws=WC;const hZ=e=>{dw(process.version);const t=uk(e),n=()=>t().then(lw),r=(e=>({apiVersion:"2019-06-10",base64Decoder:e?.base64Decoder??Zg,base64Encoder:e?.base64Encoder??Qg,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??pZ,extensions:e?.extensions??[],httpAuthSchemeProvider:e?.httpAuthSchemeProvider??DV,httpAuthSchemes:e?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4"),signer:new ZC},{schemeId:"smithy.api#noAuth",identityProvider:e=>e.getIdentityProvider("smithy.api#noAuth")||(async()=>({})),signer:new vv}],logger:e?.logger??new gw,serviceId:e?.serviceId??"SSO",urlParser:e?.urlParser??tE,utf8Decoder:e?.utf8Decoder??Jg,utf8Encoder:e?.utf8Encoder??Xg}))(e);QO(process.version);const i={profile:e?.profile,logger:r.logger};return{...r,...e,runtime:"node",defaultsMode:t,authSchemePreference:e?.authSchemePreference??Yx(QC,i),bodyLengthChecker:e?.bodyLengthChecker??NS,defaultUserAgentProvider:e?.defaultUserAgentProvider??bT({serviceId:r.serviceId,clientVersion:MV}),maxAttempts:e?.maxAttempts??Yx(SE,e),region:e?.region??Yx(px,{...hx,...i}),requestHandler:dy.create(e?.requestHandler??n),retryMode:e?.retryMode??Yx({...AE,default:async()=>(await n()).retryMode||lE},e),sha256:e?.sha256??RS.bind(null,"sha256"),streamCollector:e?.streamCollector??gy,useDualstackEndpoint:e?.useDualstackEndpoint??Yx(ux,i),useFipsEndpoint:e?.useFipsEndpoint??Yx(dx,i),userAgentAppId:e?.userAgentAppId??Yx(wT,i)}};class mZ extends sw{constructor(e){super(e),Object.setPrototypeOf(this,mZ.prototype)}}class fZ extends mZ{name="InvalidRequestException";$fault="client";constructor(e){super({name:"InvalidRequestException",$fault:"client",...e}),Object.setPrototypeOf(this,fZ.prototype)}}class gZ extends mZ{name="ResourceNotFoundException";$fault="client";constructor(e){super({name:"ResourceNotFoundException",$fault:"client",...e}),Object.setPrototypeOf(this,gZ.prototype)}}class yZ extends mZ{name="TooManyRequestsException";$fault="client";constructor(e){super({name:"TooManyRequestsException",$fault:"client",...e}),Object.setPrototypeOf(this,yZ.prototype)}}class vZ extends mZ{name="UnauthorizedException";$fault="client";constructor(e){super({name:"UnauthorizedException",$fault:"client",...e}),Object.setPrototypeOf(this,vZ.prototype)}}const bZ=e=>({...e,...e.accessToken&&{accessToken:rw}}),wZ=e=>({...e,...e.secretAccessKey&&{secretAccessKey:rw},...e.sessionToken&&{sessionToken:rw}}),_Z=e=>({...e,...e.roleCredentials&&{roleCredentials:wZ(e.roleCredentials)}}),xZ=async(e,t)=>{const n=fv(e,t),r=yw({},fw,{[LZ]:e[RZ]});n.bp("/federation/credentials");const i=yw({[$Z]:[,My(e[NZ],"roleName")],[jZ]:[,My(e[PZ],"accountId")]});return n.m("GET").h(r).q(i).b(undefined),n.build()},EZ=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return SZ(e,t);const n=yw({$metadata:TZ(e)}),r=My(Fy(await nI(e.body,t)),"body"),i=vw(r,{roleCredentials:Sw});return Object.assign(n,i),n},SZ=async(e,t)=>{const n={...e,body:await rI(e.body,t)},r=iI(e,n.body);switch(r){case"InvalidRequestException":case"com.amazonaws.sso#InvalidRequestException":throw await AZ(n);case"ResourceNotFoundException":case"com.amazonaws.sso#ResourceNotFoundException":throw await OZ(n);case"TooManyRequestsException":case"com.amazonaws.sso#TooManyRequestsException":throw await CZ(n);case"UnauthorizedException":case"com.amazonaws.sso#UnauthorizedException":throw await IZ(n);default:const t=n.body;return kZ({output:e,parsedBody:t,errorCode:r})}},kZ=ow(mZ),AZ=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new fZ({$metadata:TZ(e),...n});return aw(s,e.body)},OZ=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new gZ({$metadata:TZ(e),...n});return aw(s,e.body)},CZ=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new yZ({$metadata:TZ(e),...n});return aw(s,e.body)},IZ=async(e,t)=>{const n=yw({}),r=e.body,i=vw(r,{message:zy});Object.assign(n,i);const s=new vZ({$metadata:TZ(e),...n});return aw(s,e.body)},TZ=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),PZ="accountId",RZ="accessToken",jZ="account_id",NZ="roleName",$Z="role_name",LZ="x-amz-sso_bearer_token";class DZ extends(tw.classBuilder().ep(UV).m(function(e,t,n,r){return[Mg(n,this.serialize,this.deserialize),aE(n,e.getEndpointParameterInstructions())]}).s("SWBPortalService","GetRoleCredentials",{}).n("SSOClient","GetRoleCredentialsCommand").f(bZ,_Z).ser(xZ).de(EZ).build()){}var UZ=Object.freeze({__proto__:null,GetRoleCredentialsCommand:DZ,SSOClient:class extends ew{config;constructor(...[e]){const t=hZ(e||{});super(t),this.initConfig=t;var n;const r=zC((n=t,Object.assign(n,{useDualstackEndpoint:n.useDualstackEndpoint??!1,useFipsEndpoint:n.useFipsEndpoint??!1,defaultSigningName:"awsssoportal"}))),i=kE(r),s=gx(i),a=((e,t)=>{const n=Object.assign(_T(e),pw(e),pg(e),(e=>{const t=e.httpAuthSchemes;let n=e.httpAuthSchemeProvider,r=e.credentials;return{setHttpAuthScheme(e){const n=t.findIndex(t=>t.schemeId===e.schemeId);-1===n?t.push(e):t.splice(n,1,e)},httpAuthSchemes:()=>t,setHttpAuthSchemeProvider(e){n=e},httpAuthSchemeProvider:()=>n,setCredentials(e){r=e},credentials:()=>r}})(e));return t.forEach(e=>e.configure(n)),Object.assign(e,xT(n),hw(n),hg(n),{httpAuthSchemes:(r=n).httpAuthSchemes(),httpAuthSchemeProvider:r.httpAuthSchemeProvider(),credentials:r.credentials()});var r})((e=>{const t=eI(e);return Object.assign(t,{authSchemePreference:Rg(e.authSchemePreference??[])})})(oE(s)),e?.extensions||[]);this.config=a,this.middlewareStack.use(vT(this.config)),this.middlewareStack.use(RE(this.config)),this.middlewareStack.use(bx(this.config)),this.middlewareStack.use(NC(this.config)),this.middlewareStack.use(LC(this.config)),this.middlewareStack.use(MC(this.config)),this.middlewareStack.use($g(this.config,{httpAuthSchemeParametersProvider:LV,identityProviderConfigProvider:async e=>new yv({"aws.auth#sigv4":e.credentials})})),this.middlewareStack.use(qg(this.config))}destroy(){super.destroy()}}});const MZ=async(e,t,n)=>({operation:Pg(t).operation,region:await Rg(e.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});const FZ=e=>{const t=[];if("AssumeRoleWithWebIdentity"===e.operation)t.push({schemeId:"smithy.api#noAuth"});else t.push(function(e){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"sts",region:e.region},propertiesExtractor:(e,t)=>({signingProperties:{config:e,context:t}})}}(e));return t},zZ=e=>{const t=(n=e,Object.assign(n,{stsClientCtor:CJ}));var n;const r=eI(t);return Object.assign(r,{authSchemePreference:Rg(e.authSchemePreference??[])})},BZ={UseGlobalEndpoint:{type:"builtInParams",name:"useGlobalEndpoint"},UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}},qZ="required",WZ="type",HZ="fn",KZ="argv",GZ="ref",VZ=!1,ZZ=!0,JZ="booleanEquals",YZ="stringEquals",XZ="sigv4",QZ="us-east-1",eJ="endpoint",tJ="https://sts.{Region}.{PartitionResult#dnsSuffix}",nJ="tree",rJ="error",iJ="getAttr",sJ={[qZ]:!1,[WZ]:"String"},aJ={[qZ]:!0,default:!1,[WZ]:"Boolean"},oJ={[GZ]:"Endpoint"},cJ={[HZ]:"isSet",[KZ]:[{[GZ]:"Region"}]},lJ={[GZ]:"Region"},uJ={[HZ]:"aws.partition",[KZ]:[lJ],assign:"PartitionResult"},dJ={[GZ]:"UseFIPS"},pJ={[GZ]:"UseDualStack"},hJ={url:"https://sts.amazonaws.com",properties:{authSchemes:[{name:XZ,signingName:"sts",signingRegion:QZ}]},headers:{}},mJ={},fJ={conditions:[{[HZ]:YZ,[KZ]:[lJ,"aws-global"]}],[eJ]:hJ,[WZ]:eJ},gJ={[HZ]:JZ,[KZ]:[dJ,!0]},yJ={[HZ]:JZ,[KZ]:[pJ,!0]},vJ={[HZ]:iJ,[KZ]:[{[GZ]:"PartitionResult"},"supportsFIPS"]},bJ={[GZ]:"PartitionResult"},wJ={[HZ]:JZ,[KZ]:[!0,{[HZ]:iJ,[KZ]:[bJ,"supportsDualStack"]}]},_J=[{[HZ]:"isSet",[KZ]:[oJ]}],xJ=[gJ],EJ=[yJ],SJ={parameters:{Region:sJ,UseDualStack:aJ,UseFIPS:aJ,Endpoint:sJ,UseGlobalEndpoint:aJ},rules:[{conditions:[{[HZ]:JZ,[KZ]:[{[GZ]:"UseGlobalEndpoint"},ZZ]},{[HZ]:"not",[KZ]:_J},cJ,uJ,{[HZ]:JZ,[KZ]:[dJ,VZ]},{[HZ]:JZ,[KZ]:[pJ,VZ]}],rules:[{conditions:[{[HZ]:YZ,[KZ]:[lJ,"ap-northeast-1"]}],endpoint:hJ,[WZ]:eJ},{conditions:[{[HZ]:YZ,[KZ]:[lJ,"ap-south-1"]}],endpoint:hJ,[WZ]:eJ},{conditions:[{[HZ]:YZ,[KZ]:[lJ,"ap-southeast-1"]}],endpoint:hJ,[WZ]:eJ},{conditions:[{[HZ]:YZ,[KZ]:[lJ,"ap-southeast-2"]}],endpoint:hJ,[WZ]:eJ},fJ,{conditions:[{[HZ]:YZ,[KZ]:[lJ,"ca-central-1"]}],endpoint:hJ,[WZ]:eJ},{conditions:[{[HZ]:YZ,[KZ]:[lJ,"eu-central-1"]}],endpoint:hJ,[WZ]:eJ},{conditions:[{[HZ]:YZ,[KZ]:[lJ,"eu-north-1"]}],endpoint:hJ,[WZ]:eJ},{conditions:[{[HZ]:YZ,[KZ]:[lJ,"eu-west-1"]}],endpoint:hJ,[WZ]:eJ},{conditions:[{[HZ]:YZ,[KZ]:[lJ,"eu-west-2"]}],endpoint:hJ,[WZ]:eJ},{conditions:[{[HZ]:YZ,[KZ]:[lJ,"eu-west-3"]}],endpoint:hJ,[WZ]:eJ},{conditions:[{[HZ]:YZ,[KZ]:[lJ,"sa-east-1"]}],endpoint:hJ,[WZ]:eJ},{conditions:[{[HZ]:YZ,[KZ]:[lJ,QZ]}],endpoint:hJ,[WZ]:eJ},{conditions:[{[HZ]:YZ,[KZ]:[lJ,"us-east-2"]}],endpoint:hJ,[WZ]:eJ},{conditions:[{[HZ]:YZ,[KZ]:[lJ,"us-west-1"]}],endpoint:hJ,[WZ]:eJ},{conditions:[{[HZ]:YZ,[KZ]:[lJ,"us-west-2"]}],endpoint:hJ,[WZ]:eJ},{endpoint:{url:tJ,properties:{authSchemes:[{name:XZ,signingName:"sts",signingRegion:"{Region}"}]},headers:mJ},[WZ]:eJ}],[WZ]:nJ},{conditions:_J,rules:[{conditions:xJ,error:"Invalid Configuration: FIPS and custom endpoint are not supported",[WZ]:rJ},{conditions:EJ,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",[WZ]:rJ},{endpoint:{url:oJ,properties:mJ,headers:mJ},[WZ]:eJ}],[WZ]:nJ},{conditions:[cJ],rules:[{conditions:[uJ],rules:[{conditions:[gJ,yJ],rules:[{conditions:[{[HZ]:JZ,[KZ]:[ZZ,vJ]},wJ],rules:[{endpoint:{url:"https://sts-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:mJ,headers:mJ},[WZ]:eJ}],[WZ]:nJ},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",[WZ]:rJ}],[WZ]:nJ},{conditions:xJ,rules:[{conditions:[{[HZ]:JZ,[KZ]:[vJ,ZZ]}],rules:[{conditions:[{[HZ]:YZ,[KZ]:[{[HZ]:iJ,[KZ]:[bJ,"name"]},"aws-us-gov"]}],endpoint:{url:"https://sts.{Region}.amazonaws.com",properties:mJ,headers:mJ},[WZ]:eJ},{endpoint:{url:"https://sts-fips.{Region}.{PartitionResult#dnsSuffix}",properties:mJ,headers:mJ},[WZ]:eJ}],[WZ]:nJ},{error:"FIPS is enabled but this partition does not support FIPS",[WZ]:rJ}],[WZ]:nJ},{conditions:EJ,rules:[{conditions:[wJ],rules:[{endpoint:{url:"https://sts.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:mJ,headers:mJ},[WZ]:eJ}],[WZ]:nJ},{error:"DualStack is enabled but this partition does not support DualStack",[WZ]:rJ}],[WZ]:nJ},fJ,{endpoint:{url:tJ,properties:mJ,headers:mJ},[WZ]:eJ}],[WZ]:nJ}],[WZ]:nJ},{error:"Invalid Configuration: Missing Region",[WZ]:rJ}]},kJ=new kv({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS","UseGlobalEndpoint"]}),AJ=(e,t={})=>kJ.get(e,()=>Jv(SJ,{endpointParams:e,logger:t.logger}));Tv.aws=WC;const OJ=e=>{dw(process.version);const t=uk(e),n=()=>t().then(lw),r=(e=>({apiVersion:"2011-06-15",base64Decoder:e?.base64Decoder??Zg,base64Encoder:e?.base64Encoder??Qg,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??AJ,extensions:e?.extensions??[],httpAuthSchemeProvider:e?.httpAuthSchemeProvider??FZ,httpAuthSchemes:e?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4"),signer:new ZC},{schemeId:"smithy.api#noAuth",identityProvider:e=>e.getIdentityProvider("smithy.api#noAuth")||(async()=>({})),signer:new vv}],logger:e?.logger??new gw,serviceId:e?.serviceId??"STS",urlParser:e?.urlParser??tE,utf8Decoder:e?.utf8Decoder??Jg,utf8Encoder:e?.utf8Encoder??Xg}))(e);QO(process.version);const i={profile:e?.profile,logger:r.logger};return{...r,...e,runtime:"node",defaultsMode:t,authSchemePreference:e?.authSchemePreference??Yx(QC,i),bodyLengthChecker:e?.bodyLengthChecker??NS,defaultUserAgentProvider:e?.defaultUserAgentProvider??bT({serviceId:r.serviceId,clientVersion:AG}),httpAuthSchemes:e?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:t=>t.getIdentityProvider("aws.auth#sigv4")||(async t=>await e.credentialDefaultProvider(t?.__config||{})()),signer:new ZC},{schemeId:"smithy.api#noAuth",identityProvider:e=>e.getIdentityProvider("smithy.api#noAuth")||(async()=>({})),signer:new vv}],maxAttempts:e?.maxAttempts??Yx(SE,e),region:e?.region??Yx(px,{...hx,...i}),requestHandler:dy.create(e?.requestHandler??n),retryMode:e?.retryMode??Yx({...AE,default:async()=>(await n()).retryMode||lE},e),sha256:e?.sha256??RS.bind(null,"sha256"),streamCollector:e?.streamCollector??gy,useDualstackEndpoint:e?.useDualstackEndpoint??Yx(ux,i),useFipsEndpoint:e?.useFipsEndpoint??Yx(dx,i),userAgentAppId:e?.userAgentAppId??Yx(wT,i)}};class CJ extends ew{config;constructor(...[e]){const t=OJ(e||{});super(t),this.initConfig=t;var n;const r=zC((n=t,Object.assign(n,{useDualstackEndpoint:n.useDualstackEndpoint??!1,useFipsEndpoint:n.useFipsEndpoint??!1,useGlobalEndpoint:n.useGlobalEndpoint??!1,defaultSigningName:"sts"}))),i=kE(r),s=gx(i),a=oE(s),o=((e,t)=>{const n=Object.assign(_T(e),pw(e),pg(e),(e=>{const t=e.httpAuthSchemes;let n=e.httpAuthSchemeProvider,r=e.credentials;return{setHttpAuthScheme(e){const n=t.findIndex(t=>t.schemeId===e.schemeId);-1===n?t.push(e):t.splice(n,1,e)},httpAuthSchemes:()=>t,setHttpAuthSchemeProvider(e){n=e},httpAuthSchemeProvider:()=>n,setCredentials(e){r=e},credentials:()=>r}})(e));return t.forEach(e=>e.configure(n)),Object.assign(e,xT(n),hw(n),hg(n),{httpAuthSchemes:(r=n).httpAuthSchemes(),httpAuthSchemeProvider:r.httpAuthSchemeProvider(),credentials:r.credentials()});var r})(zZ(a),e?.extensions||[]);this.config=o,this.middlewareStack.use(vT(this.config)),this.middlewareStack.use(RE(this.config)),this.middlewareStack.use(bx(this.config)),this.middlewareStack.use(NC(this.config)),this.middlewareStack.use(LC(this.config)),this.middlewareStack.use(MC(this.config)),this.middlewareStack.use($g(this.config,{httpAuthSchemeParametersProvider:MZ,identityProviderConfigProvider:async e=>new yv({"aws.auth#sigv4":e.credentials})})),this.middlewareStack.use(qg(this.config))}destroy(){super.destroy()}}class IJ extends sw{constructor(e){super(e),Object.setPrototypeOf(this,IJ.prototype)}}const TJ=e=>({...e,...e.SecretAccessKey&&{SecretAccessKey:rw}}),PJ=e=>({...e,...e.Credentials&&{Credentials:TJ(e.Credentials)}});class RJ extends IJ{name="ExpiredTokenException";$fault="client";constructor(e){super({name:"ExpiredTokenException",$fault:"client",...e}),Object.setPrototypeOf(this,RJ.prototype)}}class jJ extends IJ{name="MalformedPolicyDocumentException";$fault="client";constructor(e){super({name:"MalformedPolicyDocumentException",$fault:"client",...e}),Object.setPrototypeOf(this,jJ.prototype)}}class NJ extends IJ{name="PackedPolicyTooLargeException";$fault="client";constructor(e){super({name:"PackedPolicyTooLargeException",$fault:"client",...e}),Object.setPrototypeOf(this,NJ.prototype)}}class $J extends IJ{name="RegionDisabledException";$fault="client";constructor(e){super({name:"RegionDisabledException",$fault:"client",...e}),Object.setPrototypeOf(this,$J.prototype)}}class LJ extends IJ{name="IDPRejectedClaimException";$fault="client";constructor(e){super({name:"IDPRejectedClaimException",$fault:"client",...e}),Object.setPrototypeOf(this,LJ.prototype)}}class DJ extends IJ{name="InvalidIdentityTokenException";$fault="client";constructor(e){super({name:"InvalidIdentityTokenException",$fault:"client",...e}),Object.setPrototypeOf(this,DJ.prototype)}}const UJ=e=>({...e,...e.WebIdentityToken&&{WebIdentityToken:rw}}),MJ=e=>({...e,...e.Credentials&&{Credentials:TJ(e.Credentials)}});class FJ extends IJ{name="IDPCommunicationErrorException";$fault="client";constructor(e){super({name:"IDPCommunicationErrorException",$fault:"client",...e}),Object.setPrototypeOf(this,FJ.prototype)}}const zJ=async(e,t)=>{const n=xY;let r;return r=aX({...QJ(e),[SY]:AY,[tX]:EY}),_Y(t,n,"/",void 0,r)},BJ=async(e,t)=>{const n=xY;let r;return r=aX({...eY(e),[SY]:IY,[tX]:EY}),_Y(t,n,"/",void 0,r)},qJ=async(e,t)=>{if(e.statusCode>=300)return HJ(e,t);const n=await cT(e.body,t);let r={};r=lY(n.AssumeRoleResult);return{$metadata:bY(e),...r}},WJ=async(e,t)=>{if(e.statusCode>=300)return HJ(e,t);const n=await cT(e.body,t);let r={};r=uY(n.AssumeRoleWithWebIdentityResult);return{$metadata:bY(e),...r}},HJ=async(e,t)=>{const n={...e,body:await lT(e.body,t)},r=oX(e,n.body);switch(r){case"ExpiredTokenException":case"com.amazonaws.sts#ExpiredTokenException":throw await KJ(n);case"MalformedPolicyDocument":case"com.amazonaws.sts#MalformedPolicyDocumentException":throw await JJ(n);case"PackedPolicyTooLarge":case"com.amazonaws.sts#PackedPolicyTooLargeException":throw await YJ(n);case"RegionDisabledException":case"com.amazonaws.sts#RegionDisabledException":throw await XJ(n);case"IDPCommunicationError":case"com.amazonaws.sts#IDPCommunicationErrorException":throw await GJ(n);case"IDPRejectedClaim":case"com.amazonaws.sts#IDPRejectedClaimException":throw await VJ(n);case"InvalidIdentityToken":case"com.amazonaws.sts#InvalidIdentityTokenException":throw await ZJ(n);default:const t=n.body;return wY({output:e,parsedBody:t.Error,errorCode:r})}},KJ=async(e,t)=>{const n=e.body,r=pY(n.Error),i=new RJ({$metadata:bY(e),...r});return aw(i,n)},GJ=async(e,t)=>{const n=e.body,r=hY(n.Error),i=new FJ({$metadata:bY(e),...r});return aw(i,n)},VJ=async(e,t)=>{const n=e.body,r=mY(n.Error),i=new LJ({$metadata:bY(e),...r});return aw(i,n)},ZJ=async(e,t)=>{const n=e.body,r=fY(n.Error),i=new DJ({$metadata:bY(e),...r});return aw(i,n)},JJ=async(e,t)=>{const n=e.body,r=gY(n.Error),i=new jJ({$metadata:bY(e),...r});return aw(i,n)},YJ=async(e,t)=>{const n=e.body,r=yY(n.Error),i=new NJ({$metadata:bY(e),...r});return aw(i,n)},XJ=async(e,t)=>{const n=e.body,r=vY(n.Error),i=new $J({$metadata:bY(e),...r});return aw(i,n)},QJ=(e,t)=>{const n={};if(null!=e[HY]&&(n[HY]=e[HY]),null!=e[KY]&&(n[KY]=e[KY]),null!=e[MY]){const t=tY(e[MY]);0===e[MY]?.length&&(n.PolicyArns=[]),Object.entries(t).forEach(([e,t])=>{n[`PolicyArns.${e}`]=t})}if(null!=e[UY]&&(n[UY]=e[UY]),null!=e[NY]&&(n[NY]=e[NY]),null!=e[XY]){const t=oY(e[XY]);0===e[XY]?.length&&(n.Tags=[]),Object.entries(t).forEach(([e,t])=>{n[`Tags.${e}`]=t})}if(null!=e[eX]){const t=aY(e[eX]);0===e[eX]?.length&&(n.TransitiveTagKeys=[]),Object.entries(t).forEach(([e,t])=>{n[`TransitiveTagKeys.${e}`]=t})}if(null!=e[LY]&&(n[LY]=e[LY]),null!=e[JY]&&(n[JY]=e[JY]),null!=e[QY]&&(n[QY]=e[QY]),null!=e[ZY]&&(n[ZY]=e[ZY]),null!=e[zY]){const t=iY(e[zY]);0===e[zY]?.length&&(n.ProvidedContexts=[]),Object.entries(t).forEach(([e,t])=>{n[`ProvidedContexts.${e}`]=t})}return n},eY=(e,t)=>{const n={};if(null!=e[HY]&&(n[HY]=e[HY]),null!=e[KY]&&(n[KY]=e[KY]),null!=e[rX]&&(n[rX]=e[rX]),null!=e[BY]&&(n[BY]=e[BY]),null!=e[MY]){const t=tY(e[MY]);0===e[MY]?.length&&(n.PolicyArns=[]),Object.entries(t).forEach(([e,t])=>{n[`PolicyArns.${e}`]=t})}return null!=e[UY]&&(n[UY]=e[UY]),null!=e[NY]&&(n[NY]=e[NY]),n},tY=(e,t)=>{const n={};let r=1;for(const t of e){if(null===t)continue;const e=nY(t);Object.entries(e).forEach(([e,t])=>{n[`member.${r}.${e}`]=t}),r++}return n},nY=(e,t)=>{const n={};return null!=e[iX]&&(n[iX]=e[iX]),n},rY=(e,t)=>{const n={};return null!=e[FY]&&(n[FY]=e[FY]),null!=e[jY]&&(n[jY]=e[jY]),n},iY=(e,t)=>{const n={};let r=1;for(const t of e){if(null===t)continue;const e=rY(t);Object.entries(e).forEach(([e,t])=>{n[`member.${r}.${e}`]=t}),r++}return n},sY=(e,t)=>{const n={};return null!=e[DY]&&(n[DY]=e[DY]),null!=e[nX]&&(n[nX]=e[nX]),n},aY=(e,t)=>{const n={};let r=1;for(const t of e)null!==t&&(n[`member.${r}`]=t,r++);return n},oY=(e,t)=>{const n={};let r=1;for(const t of e){if(null===t)continue;const e=sY(t);Object.entries(e).forEach(([e,t])=>{n[`member.${r}.${e}`]=t}),r++}return n},cY=(e,t)=>{const n={};return null!=e[OY]&&(n[OY]=zy(e[OY])),null!=e[TY]&&(n[TY]=zy(e[TY])),n},lY=(e,t)=>{const n={};return null!=e[RY]&&(n[RY]=dY(e[RY])),null!=e[CY]&&(n[CY]=cY(e[CY])),null!=e[qY]&&(n[qY]=Ky(e[qY])),null!=e[ZY]&&(n[ZY]=zy(e[ZY])),n},uY=(e,t)=>{const n={};return null!=e[RY]&&(n[RY]=dY(e[RY])),null!=e[VY]&&(n[VY]=zy(e[VY])),null!=e[CY]&&(n[CY]=cY(e[CY])),null!=e[qY]&&(n[qY]=Ky(e[qY])),null!=e[WY]&&(n[WY]=zy(e[WY])),null!=e[PY]&&(n[PY]=zy(e[PY])),null!=e[ZY]&&(n[ZY]=zy(e[ZY])),n},dY=(e,t)=>{const n={};return null!=e[kY]&&(n[kY]=zy(e[kY])),null!=e[GY]&&(n[GY]=zy(e[GY])),null!=e[YY]&&(n[YY]=zy(e[YY])),null!=e[$Y]&&(n[$Y]=My(ev(e[$Y]))),n},pY=(e,t)=>{const n={};return null!=e[sX]&&(n[sX]=zy(e[sX])),n},hY=(e,t)=>{const n={};return null!=e[sX]&&(n[sX]=zy(e[sX])),n},mY=(e,t)=>{const n={};return null!=e[sX]&&(n[sX]=zy(e[sX])),n},fY=(e,t)=>{const n={};return null!=e[sX]&&(n[sX]=zy(e[sX])),n},gY=(e,t)=>{const n={};return null!=e[sX]&&(n[sX]=zy(e[sX])),n},yY=(e,t)=>{const n={};return null!=e[sX]&&(n[sX]=zy(e[sX])),n},vY=(e,t)=>{const n={};return null!=e[sX]&&(n[sX]=zy(e[sX])),n},bY=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),wY=ow(IJ),_Y=async(e,t,n,r,i)=>{const{hostname:s,protocol:a="https",port:o,path:c}=await e.endpoint(),l={protocol:a,hostname:s,port:o,method:"POST",path:c.endsWith("/")?c.slice(0,-1)+n:c+n,headers:t};return void 0!==i&&(l.body=i),new xg(l)},xY={"content-type":"application/x-www-form-urlencoded"},EY="2011-06-15",SY="Action",kY="AccessKeyId",AY="AssumeRole",OY="AssumedRoleId",CY="AssumedRoleUser",IY="AssumeRoleWithWebIdentity",TY="Arn",PY="Audience",RY="Credentials",jY="ContextAssertion",NY="DurationSeconds",$Y="Expiration",LY="ExternalId",DY="Key",UY="Policy",MY="PolicyArns",FY="ProviderArn",zY="ProvidedContexts",BY="ProviderId",qY="PackedPolicySize",WY="Provider",HY="RoleArn",KY="RoleSessionName",GY="SecretAccessKey",VY="SubjectFromWebIdentityToken",ZY="SourceIdentity",JY="SerialNumber",YY="SessionToken",XY="Tags",QY="TokenCode",eX="TransitiveTagKeys",tX="Version",nX="Value",rX="WebIdentityToken",iX="arn",sX="message",aX=e=>Object.entries(e).map(([e,t])=>Iy(e)+"="+Iy(t)).join("&"),oX=(e,t)=>void 0!==t.Error?.Code?t.Error.Code:404==e.statusCode?"NotFound":void 0;class cX extends(tw.classBuilder().ep(BZ).m(function(e,t,n,r){return[Mg(n,this.serialize,this.deserialize),aE(n,e.getEndpointParameterInstructions())]}).s("AWSSecurityTokenServiceV20110615","AssumeRole",{}).n("STSClient","AssumeRoleCommand").f(void 0,PJ).ser(zJ).de(qJ).build()){}class lX extends(tw.classBuilder().ep(BZ).m(function(e,t,n,r){return[Mg(n,this.serialize,this.deserialize),aE(n,e.getEndpointParameterInstructions())]}).s("AWSSecurityTokenServiceV20110615","AssumeRoleWithWebIdentity",{}).n("STSClient","AssumeRoleWithWebIdentityCommand").f(UJ,MJ).ser(BJ).de(WJ).build()){}const uX={AssumeRoleCommand:cX,AssumeRoleWithWebIdentityCommand:lX};class dX extends CJ{}iw(uX,dX);const pX="us-east-1",hX=e=>{if("string"==typeof e?.Arn){const t=e.Arn.split(":");if(t.length>4&&""!==t[4])return t[4]}},mX=async(e,t,n)=>{const r="function"==typeof e?await e():e,i="function"==typeof t?await t():t;return n?.debug?.("@aws-sdk/client-sts::resolveRegion","accepting first of:",`${r} (provider)`,`${i} (parent client)`,`${pX} (STS default)`),r??i??pX},fX=e=>"h2"===e?.metadata?.handlerProtocol,gX=(e,t)=>t?class extends e{constructor(e){super(e);for(const e of t)this.middlewareStack.use(e)}}:e;var yX=Object.freeze({__proto__:null,$Command:tw,AssumeRoleCommand:cX,AssumeRoleResponseFilterSensitiveLog:PJ,AssumeRoleWithWebIdentityCommand:lX,AssumeRoleWithWebIdentityRequestFilterSensitiveLog:UJ,AssumeRoleWithWebIdentityResponseFilterSensitiveLog:MJ,CredentialsFilterSensitiveLog:TJ,ExpiredTokenException:RJ,IDPCommunicationErrorException:FJ,IDPRejectedClaimException:LJ,InvalidIdentityTokenException:DJ,MalformedPolicyDocumentException:jJ,PackedPolicyTooLargeException:NJ,RegionDisabledException:$J,STS:dX,STSClient:CJ,STSServiceException:IJ,__Client:ew,getDefaultRoleAssumer:(e={},t)=>((e,t)=>{let n,r;return async(i,s)=>{if(r=i,!n){const{logger:i=e?.parentClientConfig?.logger,region:s,requestHandler:a=e?.parentClientConfig?.requestHandler,credentialProviderLogger:o}=e,c=await mX(s,e?.parentClientConfig?.region,o),l=!fX(a);n=new t({profile:e?.parentClientConfig?.profile,credentialDefaultProvider:()=>async()=>r,region:c,requestHandler:l?a:void 0,logger:i})}const{Credentials:a,AssumedRoleUser:o}=await n.send(new cX(s));if(!a||!a.AccessKeyId||!a.SecretAccessKey)throw new Error(`Invalid response from STS.assumeRole call with role ${s.RoleArn}`);const c=hX(o),l={accessKeyId:a.AccessKeyId,secretAccessKey:a.SecretAccessKey,sessionToken:a.SessionToken,expiration:a.Expiration,...a.CredentialScope&&{credentialScope:a.CredentialScope},...c&&{accountId:c}};return eC(l,"CREDENTIALS_STS_ASSUME_ROLE","i"),l}})(e,gX(CJ,t)),getDefaultRoleAssumerWithWebIdentity:(e={},t)=>((e,t)=>{let n;return async r=>{if(!n){const{logger:r=e?.parentClientConfig?.logger,region:i,requestHandler:s=e?.parentClientConfig?.requestHandler,credentialProviderLogger:a}=e,o=await mX(i,e?.parentClientConfig?.region,a),c=!fX(s);n=new t({profile:e?.parentClientConfig?.profile,region:o,requestHandler:c?s:void 0,logger:r})}const{Credentials:i,AssumedRoleUser:s}=await n.send(new lX(r));if(!i||!i.AccessKeyId||!i.SecretAccessKey)throw new Error(`Invalid response from STS.assumeRoleWithWebIdentity call with role ${r.RoleArn}`);const a=hX(s),o={accessKeyId:i.AccessKeyId,secretAccessKey:i.SecretAccessKey,sessionToken:i.SessionToken,expiration:i.Expiration,...i.CredentialScope&&{credentialScope:i.CredentialScope},...a&&{accountId:a}};return a&&eC(o,"RESOLVED_ACCOUNT_ID","T"),eC(o,"CREDENTIALS_STS_ASSUME_ROLE_WEB_ID","k"),o}})(e,gX(CJ,t))});export{JF as endpoints,ZF as hooks,YF as operations};
